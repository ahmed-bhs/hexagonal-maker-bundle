{"config":{"lang":["en"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Hexagonal Maker Bundle","text":"<p> Symfony Maker Bundle for Hexagonal Architecture (Ports &amp; Adapters) </p> <p> </p> <p>   \u2728 19 maker commands | \ud83d\udc8e Pure Domain | \ud83c\udfaf CQRS Pattern | \ud83c\udfd7\ufe0f Full Layer Coverage </p>"},{"location":"#why-hexagonal-architecture","title":"Why Hexagonal Architecture?","text":"<p>Hexagonal architecture (aka Ports &amp; Adapters) helps you build maintainable, testable applications by:</p> <ul> <li>\ud83d\udc8e Pure Domain Isolation - Business logic independent of frameworks</li> <li>\ud83c\udfaf Dependency Control - Infrastructure depends on domain, not vice versa</li> <li>\u26a1 Testing Speed - Unit tests run 1000x faster (no database needed)</li> <li>\ud83d\udd04 Technology Freedom - Swap databases, frameworks without touching business logic</li> <li>\ud83d\udcb0 Cost Predictability - Features cost consistent time, no technical debt tax</li> </ul> <p>Read the complete guide \u2192</p>"},{"location":"#quick-start-2-minutes","title":"\u26a1 Quick Start (2 minutes)","text":"<p>Step 1: Install</p> <pre><code>composer require ahmed-bhs/hexagonal-maker-bundle --dev\n</code></pre> <p>Step 2: Generate your first module</p> <pre><code># Create a User Registration module\nbin/console make:hexagonal:entity user/account User\nbin/console make:hexagonal:repository user/account User\nbin/console make:hexagonal:command user/account register --factory\nbin/console make:hexagonal:controller user/account RegisterUser /users/register\n</code></pre> <p>Step 3: Configure Doctrine mapping</p> <pre><code># config/packages/doctrine.yaml\ndoctrine:\n    orm:\n        mappings:\n            UserAccount:\n                type: yml\n                dir: '%kernel.project_dir%/src/User/Account/Infrastructure/Persistence/Doctrine/Orm/Mapping'\n                prefix: 'App\\User\\Account\\Domain\\Model'\n</code></pre> <p>Result: Complete hexagonal module with pure domain, CQRS commands, and web controllers! \ud83d\ude80</p> <p>Full installation guide \u2192</p>"},{"location":"#features","title":"Features","text":""},{"location":"#19-maker-commands","title":"19 Maker Commands","text":"<p>Generate complete hexagonal architecture with a single command:</p> Layer Maker What it generates Domain <code>make:hexagonal:entity</code> Pure PHP entities + YAML mapping Domain <code>make:hexagonal:value-object</code> Immutable value objects Domain <code>make:hexagonal:exception</code> Business exceptions Application <code>make:hexagonal:command</code> CQRS commands + handlers Application <code>make:hexagonal:query</code> CQRS queries + handlers + responses Application <code>make:hexagonal:repository</code> Repository port + Doctrine adapter UI <code>make:hexagonal:controller</code> Web controllers UI <code>make:hexagonal:form</code> Symfony forms UI <code>make:hexagonal:cli-command</code> Console commands Tests <code>make:hexagonal:use-case-test</code> Use case tests Rapid <code>make:hexagonal:crud</code> Complete CRUD module (20+ files) <p>See all 19 commands \u2192</p>"},{"location":"#example-complete-user-module","title":"Example: Complete User Module","text":""},{"location":"#step-1-domain","title":"Step 1: Domain","text":"<p>Generate pure domain entities</p> <pre><code>bin/console make:hexagonal:entity user/account User\nbin/console make:hexagonal:value-object user/account Email\nbin/console make:hexagonal:exception user/account InvalidEmailException\n</code></pre> <p>Generated: - <code>Domain/Model/User.php</code> (pure PHP) - <code>Domain/ValueObject/Email.php</code> - <code>Domain/Exception/InvalidEmailException.php</code></p>"},{"location":"#step-2-application","title":"Step 2: Application","text":"<p>Generate use cases and commands</p> <pre><code>bin/console make:hexagonal:repository user/account User\nbin/console make:hexagonal:command user/account register --factory\nbin/console make:hexagonal:query user/account find-by-id\n</code></pre> <p>Generated: - <code>Domain/Port/UserRepositoryInterface.php</code> - <code>Application/Register/RegisterCommand.php</code> - <code>Application/Register/RegisterCommandHandler.php</code> - <code>Application/FindById/FindByIdQuery.php</code></p>"},{"location":"#step-3-infrastructure","title":"Step 3: Infrastructure","text":"<p>Auto-generated adapters</p> <pre><code># Already generated with repository command!\n</code></pre> <p>Generated: - <code>Infrastructure/Persistence/Doctrine/DoctrineUserRepository.php</code> - <code>Infrastructure/Persistence/Doctrine/Orm/Mapping/User.orm.yml</code></p>"},{"location":"#step-4-ui","title":"Step 4: UI","text":"<p>Generate controllers and forms</p> <pre><code>bin/console make:hexagonal:controller user/account RegisterUser /users/register\nbin/console make:hexagonal:form user/account User\n</code></pre> <p>Generated: - <code>UI/Http/Web/Controller/RegisterUserController.php</code> - <code>UI/Http/Web/Form/UserType.php</code></p>"},{"location":"#architecture-layers","title":"Architecture Layers","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph TB\n    subgraph UI[\"\ud83c\udfae UI LAYER\"]\n        HTTP[\"HTTP Controllers\"]\n        CLI[\"CLI Commands\"]\n    end\n\n    subgraph APP[\"\u2699\ufe0f APPLICATION LAYER\"]\n        Commands[\"Commands &amp; Queries\"]\n    end\n\n    subgraph DOMAIN[\"\ud83d\udc8e DOMAIN LAYER\"]\n        Entities[\"Entities &amp; Value Objects\"]\n        Ports[\"Ports (Interfaces)\"]\n    end\n\n    subgraph INFRA[\"\ud83d\udd0c INFRASTRUCTURE LAYER\"]\n        Adapters[\"Adapters (Implementations)\"]\n    end\n\n    UI ==&gt;|uses| APP\n    APP ==&gt;|depends on| DOMAIN\n    INFRA -.-&gt;|implements| Ports\n\n    style DOMAIN fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px\n    style APP fill:#B3E5FC,stroke:#0277BD,stroke-width:3px\n    style INFRA fill:#F8BBD0,stroke:#C2185B,stroke-width:3px\n    style UI fill:#E1BEE7,stroke:#6A1B9A,stroke-width:3px</code></pre> <p>Dependency Rule: All dependencies point inward. Domain has zero dependencies.</p> <p>Architecture guide \u2192</p>"},{"location":"#crud-in-1-command","title":"CRUD in 1 Command \u26a1","text":"<p>Generate complete CRUD module with all layers:</p> <pre><code>bin/console make:hexagonal:crud blog/post Post --with-tests --with-id-vo\n</code></pre> <p>Generated (30+ files): - Entity + ValueObjects + Repository - 5 Use Cases (Create, Update, Delete, Get, List) - 5 Controllers + Form - All tests (Use Case + Controller) - Doctrine YAML mapping</p> <p>CRUD examples \u2192</p>"},{"location":"#documentation","title":"Documentation","text":""},{"location":"#core-guides","title":"Core Guides","text":"Guide Description Quick Start Install and generate your first module in 2 minutes Maker Commands Complete reference for all 19 maker commands Architecture Guide Deep dive into hexagonal architecture patterns Why Hexagonal Business case and technical benefits SOLID Principles How hexagonal architecture enforces SOLID Examples Real-world examples and use cases"},{"location":"#advanced-topics","title":"Advanced Topics \ud83c\udd95","text":"<p>In-depth guides covering critical aspects of hexagonal architecture:</p> Guide Description Domain vs Application Logic Decision guide: where to place your business logic Request-Response Flow Complete end-to-end flow with diagrams Port Design Principles How to design effective port interfaces Primary vs Secondary Adapters Understanding the two sides of the hexagon CQRS: Cost-Benefit Analysis When to use CQRS (and when to avoid it) Dependency Injection Guide Complete Symfony configuration Factory Pattern Guide Complete factory implementation Error Handling Strategy Exception handling and error management Anti-Patterns &amp; Pitfalls Avoid common mistakes"},{"location":"#requirements","title":"Requirements","text":"<ul> <li>PHP 8.1+</li> <li>Symfony 6.4+ or 7.x</li> <li>Composer</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>We welcome contributions! See our Contributing Guide.</p>"},{"location":"#license","title":"License","text":"<p>MIT License - see LICENSE for details.</p> <p>Created by Ahmed EBEN HASSINE</p> <p> </p>"},{"location":"ARCHITECTURE/","title":"Architecture Hexagonale - Guide Complet","text":""},{"location":"ARCHITECTURE/#table-des-matieres","title":"Table des mati\u00e8res","text":"<ol> <li>Vue d'ensemble</li> <li>Les 3 Couches</li> <li>Ports vs Adapters</li> <li>CQRS Pattern</li> <li>Testabilit\u00e9</li> <li>Structure de r\u00e9pertoires</li> <li>Bonnes pratiques</li> <li>Design Patterns Favoris\u00e9s</li> <li>8.1 Patterns de Cr\u00e9ation - Factory, Builder, Singleton</li> <li>8.2 Patterns Structuraux - Adapter, Repository, DTO</li> <li>8.3 Patterns Comportementaux - Strategy, Command, Observer</li> <li>8.4 Autres Patterns - Specification, Null Object</li> <li>Migration progressive</li> <li>Ressources</li> </ol>"},{"location":"ARCHITECTURE/#1-vue-densemble","title":"1. Vue d'ensemble","text":"<p>L'architecture hexagonale (aussi appel\u00e9e Ports and Adapters) est un pattern architectural qui vise \u00e0 isoler la logique m\u00e9tier des pr\u00e9occupations techniques (framework, base de donn\u00e9es, API externes, etc.).</p>"},{"location":"ARCHITECTURE/#11-principe-fondamental","title":"1.1 Principe fondamental","text":"<p>Les d\u00e9pendances pointent toujours vers l'int\u00e9rieur (vers le domaine)</p> <pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'16px'}}}%%\ngraph LR\n    Infra[\"\ud83d\udd0c Infrastructure&lt;br/&gt;&lt;small&gt;Adapters&lt;/small&gt;\"]\n    App[\"\u2699\ufe0f Application&lt;br/&gt;&lt;small&gt;Use Cases&lt;/small&gt;\"]\n    Domain[\"\ud83d\udc8e Domain&lt;br/&gt;&lt;small&gt;Business Logic&lt;/small&gt;\"]\n\n    Infra ==&gt;|\"depends on\"| App\n    App ==&gt;|\"depends on\"| Domain\n\n    style Domain fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px,color:#000\n    style App fill:#B3E5FC,stroke:#0277BD,stroke-width:3px,color:#000\n    style Infra fill:#F8BBD0,stroke:#C2185B,stroke-width:3px,color:#000</code></pre>"},{"location":"ARCHITECTURE/#2-les-3-couches","title":"2. Les 3 Couches","text":""},{"location":"ARCHITECTURE/#21-domain-cur-hexagone","title":"2.1 Domain (C\u0153ur - Hexagone)","text":"<p>Responsabilit\u00e9: Logique m\u00e9tier pure, r\u00e8gles de gestion, invariants</p> <p>Contient: - <code>Model/</code> - Entit\u00e9s avec identit\u00e9 et cycle de vie - <code>ValueObject/</code> - Objets immuables d\u00e9finis par leurs valeurs - <code>Port/</code> - Interfaces (contrats) pour les d\u00e9pendances externes</p> <p>R\u00e8gles strictes: - AUCUNE d\u00e9pendance vers les couches externes - AUCUNE annotation/attribut Symfony/Doctrine - PHP pur uniquement - Ind\u00e9pendant du framework</p> <p>Exemple Entity: <pre><code>namespace App\\User\\Account\\Domain\\Model;\n\nfinal class User\n{\n    public function __construct(\n        private UserId $id,\n        private Email $email,\n        private bool $isActive = false,\n    ) {\n    }\n\n    // Business logic\n    public function activate(): void\n    {\n        if ($this-&gt;isActive) {\n            throw new UserAlreadyActiveException();\n        }\n        $this-&gt;isActive = true;\n    }\n}\n</code></pre></p> <p>Exemple Value Object: <pre><code>namespace App\\User\\Account\\Domain\\ValueObject;\n\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n    }\n}\n</code></pre></p> <p>Exemple Port (Interface): <pre><code>namespace App\\User\\Account\\Domain\\Port;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n}\n</code></pre></p>"},{"location":"ARCHITECTURE/#22-application-orchestration","title":"2.2 Application (Orchestration)","text":"<p>Responsabilit\u00e9: Cas d'utilisation, orchestration des op\u00e9rations m\u00e9tier</p> <p>Contient: - <code>Command/</code> - Commandes CQRS (\u00e9critures) - <code>Query/</code> - Requ\u00eates CQRS (lectures) - Handlers - Logique d'orchestration</p> <p>R\u00e8gles: - D\u00e9pend du Domain uniquement - Utilise les Ports (interfaces) - Coordonne les op\u00e9rations - Ne contient PAS de logique m\u00e9tier</p> <p>Command: <pre><code>namespace App\\User\\Account\\Application\\Register;\n\nfinal readonly class RegisterCommand\n{\n    public function __construct(\n        public string $email,\n        public string $password,\n    ) {\n    }\n}\n</code></pre></p> <p>Command Handler: <pre><code>namespace App\\User\\Account\\Application\\Register;\n\nuse App\\User\\Account\\Domain\\Port\\UserRepositoryInterface;\nuse Symfony\\Component\\Messenger\\Attribute\\AsMessageHandler;\n\n#[AsMessageHandler]\nfinal readonly class RegisterCommandHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $repository,\n        private PasswordHasherInterface $hasher,\n    ) {\n    }\n\n    public function __invoke(RegisterCommand $command): void\n    {\n        // Orchestration only, no business logic\n        $user = new User(\n            id: UserId::generate(),\n            email: new Email($command-&gt;email),\n            password: $this-&gt;hasher-&gt;hash($command-&gt;password),\n        );\n\n        $this-&gt;repository-&gt;save($user);\n    }\n}\n</code></pre></p>"},{"location":"ARCHITECTURE/#23-infrastructure-details-techniques","title":"2.3 Infrastructure (D\u00e9tails techniques)","text":"<p>Responsabilit\u00e9: Impl\u00e9mentations concr\u00e8tes, d\u00e9tails techniques</p> <p>Contient: - <code>Persistence/</code> - Adapters pour la persistance (Doctrine, etc.) - <code>Messaging/</code> - Adapters pour la messagerie - <code>ExternalAPI/</code> - Adapters pour les APIs externes</p> <p>R\u00e8gles: - Impl\u00e9mente les Ports (interfaces du Domain) - Contient les d\u00e9tails techniques - Peut d\u00e9pendre de Domain et Application - Utilise Doctrine, HTTP clients, etc.</p> <p>Adapter Doctrine: <pre><code>namespace App\\User\\Account\\Infrastructure\\Persistence\\Doctrine;\n\nuse App\\User\\Account\\Domain\\Model\\User;\nuse App\\User\\Account\\Domain\\Port\\UserRepositoryInterface;\nuse Doctrine\\ORM\\EntityManagerInterface;\n\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private readonly EntityManagerInterface $em,\n    ) {\n    }\n\n    public function save(User $user): void\n    {\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n    }\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;em-&gt;find(User::class, $id-&gt;value);\n    }\n}\n</code></pre></p>"},{"location":"ARCHITECTURE/#3-ports-vs-adapters","title":"3. Ports vs Adapters","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'15px'}}}%%\ngraph LR\n    subgraph Primary[\"\ud83c\udfae Primary Adapters (Driving)\"]\n        HTTP[\"\ud83c\udf10 HTTP Controller\"]\n        CLI[\"\u2328\ufe0f CLI Command\"]\n        GraphQL[\"\ud83d\udcca GraphQL Resolver\"]\n    end\n\n    subgraph Core[\"\ud83d\udc8e Core - Domain + Application\"]\n        UseCases[\"\u2699\ufe0f Use Cases&lt;br/&gt;&lt;small&gt;Handlers&lt;/small&gt;\"]\n        Ports[\"\ud83d\udd17 Ports&lt;br/&gt;&lt;small&gt;Interfaces&lt;/small&gt;\"]\n    end\n\n    subgraph Secondary[\"\ud83d\udd0c Secondary Adapters (Driven)\"]\n        Doctrine[\"\ud83d\uddc4\ufe0f Doctrine&lt;br/&gt;&lt;small&gt;Repository&lt;/small&gt;\"]\n        Redis[\"\u26a1 Redis&lt;br/&gt;&lt;small&gt;Cache&lt;/small&gt;\"]\n        SMTP[\"\ud83d\udce7 SMTP&lt;br/&gt;&lt;small&gt;Mailer&lt;/small&gt;\"]\n    end\n\n    Primary ==&gt;|\"calls\"| UseCases\n    UseCases ==&gt;|\"uses\"| Ports\n    Secondary -.-&gt;|\"\ud83c\udfaf implements\"| Ports\n\n    style Core fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px,color:#000\n    style Primary fill:#E1BEE7,stroke:#6A1B9A,stroke-width:3px,color:#000\n    style Secondary fill:#F8BBD0,stroke:#C2185B,stroke-width:3px,color:#000</code></pre>"},{"location":"ARCHITECTURE/#31-port-interface","title":"3.1 Port (Interface)","text":"<p>Un Port est une interface d\u00e9finie dans le Domain qui repr\u00e9sente un besoin.</p> <p>Types de Ports:</p> <ol> <li>Ports Primaires (Driving/Primary) - Ce que l'application offre</li> <li>Exemple : Use case handlers</li> <li> <p>Appel\u00e9s par les adapters primaires (UI)</p> </li> <li> <p>Ports Secondaires (Driven/Secondary) - Ce que l'application requiert</p> </li> <li>Exemple : <code>RepositoryInterface</code>, <code>EmailSenderInterface</code></li> <li>Impl\u00e9ment\u00e9s par les adapters secondaires (Infrastructure)</li> </ol>"},{"location":"ARCHITECTURE/#32-adapter-implementation","title":"3.2 Adapter (Impl\u00e9mentation)","text":"<p>Un Adapter est une impl\u00e9mentation concr\u00e8te d'un Port dans l'Infrastructure.</p> <p>Exemples d'Adapters:</p> <pre><code>// Port (Domain)\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n}\n\n// Adapter 1 - Doctrine (Infrastructure)\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n    }\n}\n\n// Adapter 2 - In Memory (Infrastructure/Tests)\nclass InMemoryUserRepository implements UserRepositoryInterface\n{\n    private array $users = [];\n\n    public function save(User $user): void\n    {\n        $this-&gt;users[$user-&gt;getId()-&gt;value] = $user;\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#4-cqrs-pattern","title":"4. CQRS Pattern","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph TB\n    UI[\"\ud83c\udfae UI Layer&lt;br/&gt;&lt;small&gt;Controller/CLI&lt;/small&gt;\"]\n\n    subgraph Write[\"\u270d\ufe0f Write Side - Commands\"]\n        CMD[\"\ud83d\udcdd Command&lt;br/&gt;&lt;small&gt;RegisterUserCommand&lt;/small&gt;\"]\n        CMDH[\"\u2699\ufe0f Command Handler&lt;br/&gt;&lt;small&gt;RegisterUserCommandHandler&lt;/small&gt;\"]\n        WriteRepo[\"\ud83d\udcbe Write Repository&lt;br/&gt;&lt;small&gt;Save/Update/Delete&lt;/small&gt;\"]\n    end\n\n    subgraph Read[\"\ud83d\udcd6 Read Side - Queries\"]\n        QRY[\"\ud83d\udd0d Query&lt;br/&gt;&lt;small&gt;FindUserQuery&lt;/small&gt;\"]\n        QRYH[\"\u2699\ufe0f Query Handler&lt;br/&gt;&lt;small&gt;FindUserQueryHandler&lt;/small&gt;\"]\n        ReadRepo[\"\ud83d\udcda Read Repository&lt;br/&gt;&lt;small&gt;Find/List/Search&lt;/small&gt;\"]\n        RESP[\"\ud83d\udccb Response&lt;br/&gt;&lt;small&gt;FindUserResponse&lt;/small&gt;\"]\n    end\n\n    UI ==&gt;|\"dispatch\"| CMD\n    UI ==&gt;|\"dispatch\"| QRY\n\n    CMD ==&gt; CMDH\n    CMDH ==&gt;|\"uses\"| WriteRepo\n\n    QRY ==&gt; QRYH\n    QRYH ==&gt;|\"uses\"| ReadRepo\n    QRYH ==&gt;|\"returns\"| RESP\n\n    style Write fill:#FFCDD2,stroke:#C62828,stroke-width:3px,color:#000\n    style Read fill:#B3E5FC,stroke:#0277BD,stroke-width:3px,color:#000\n    style UI fill:#E1BEE7,stroke:#6A1B9A,stroke-width:3px,color:#000</code></pre>"},{"location":"ARCHITECTURE/#41-command-ecriture","title":"4.1 Command (\u00c9criture)","text":"<p>Caract\u00e9ristiques: - Intention de modifier l'\u00e9tat - Retourne <code>void</code> - Nom au pr\u00e9sent : <code>RegisterUser</code>, <code>PublishArticle</code></p> <pre><code>final readonly class PublishArticleCommand\n{\n    public function __construct(\n        public string $articleId,\n        public \\DateTimeImmutable $publishedAt,\n    ) {\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#42-query-lecture","title":"4.2 Query (Lecture)","text":"<p>Caract\u00e9ristiques: - Intention de lire des donn\u00e9es - Retourne un <code>Response</code> - Nom descriptif : <code>FindUserById</code>, <code>ListArticles</code></p> <pre><code>final readonly class FindUserByIdQuery\n{\n    public function __construct(\n        public string $userId,\n    ) {\n    }\n}\n\nfinal readonly class FindUserByIdResponse\n{\n    public function __construct(\n        public string $id,\n        public string $email,\n        public bool $isActive,\n    ) {\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#43-separation-stricte","title":"4.3 S\u00e9paration stricte","text":"<pre><code>// MAUVAIS - Retourne une valeur\nclass RegisterUserCommand\n{\n    public function __invoke(RegisterCommand $cmd): User { ... }\n}\n\n// BON - Void uniquement\nclass RegisterUserCommandHandler\n{\n    public function __invoke(RegisterCommand $cmd): void { ... }\n}\n\n// BON - Query retourne les donn\u00e9es\nclass FindUserQueryHandler\n{\n    public function __invoke(FindUserQuery $q): FindUserResponse { ... }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#5-testabilite","title":"5. Testabilit\u00e9","text":"<p>L'architecture hexagonale facilite grandement les tests :</p> <pre><code>graph TB\n    subgraph Pyramid[\"Pyramide des Tests\"]\n        E2E[Tests E2E&lt;br/&gt;Lents - Peu nombreux&lt;br/&gt;Full stack avec DB]\n        Integration[Tests d'Int\u00e9gration&lt;br/&gt;Moyens - Mod\u00e9r\u00e9s&lt;br/&gt;Avec Symfony Kernel]\n        Unit[Tests Unitaires&lt;br/&gt;Rapides - Nombreux&lt;br/&gt;InMemory - Mocks]\n    end\n\n    subgraph Layers[\"Couches Test\u00e9es\"]\n        UnitTests[Domain + Application&lt;br/&gt;Tests unitaires&lt;br/&gt;InMemoryRepository]\n        IntTests[Handlers + Adapters&lt;br/&gt;Tests d'int\u00e9gration&lt;br/&gt;DoctrineRepository]\n        E2ETests[UI \u2192 DB&lt;br/&gt;Tests E2E&lt;br/&gt;Parcours complet]\n    end\n\n    Unit -.-&gt;|teste| UnitTests\n    Integration -.-&gt;|teste| IntTests\n    E2E -.-&gt;|teste| E2ETests\n\n    style Unit fill:#90EE90,stroke:#333,stroke-width:2px\n    style Integration fill:#87CEEB,stroke:#333,stroke-width:2px\n    style E2E fill:#FFB6C1,stroke:#333,stroke-width:2px</code></pre>"},{"location":"ARCHITECTURE/#51-test-du-domain-ultra-rapide","title":"5.1 Test du Domain (ultra rapide)","text":"<pre><code>class UserTest extends TestCase\n{\n    public function testUserCanBeActivated(): void\n    {\n        $user = new User(\n            id: UserId::generate(),\n            email: new Email('test@example.com'),\n        );\n\n        $user-&gt;activate();\n\n        $this-&gt;assertTrue($user-&gt;isActive());\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#52-test-de-lapplication-avec-inmemory","title":"5.2 Test de l'Application avec InMemory","text":"<pre><code>class RegisterCommandHandlerTest extends TestCase\n{\n    public function testUserIsRegistered(): void\n    {\n        $repository = new InMemoryUserRepository();\n        $handler = new RegisterCommandHandler($repository);\n\n        $command = new RegisterCommand(\n            email: 'test@example.com',\n            password: 'secret',\n        );\n\n        $handler($command);\n\n        $this-&gt;assertCount(1, $repository-&gt;all());\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#6-structure-de-repertoires","title":"6. Structure de r\u00e9pertoires","text":"<pre><code>src/\n\u2514\u2500\u2500 User/                          # Bounded Context\n    \u2514\u2500\u2500 Account/                   # Module\n        \u251c\u2500\u2500 Application/           # Couche Application\n        \u2502   \u251c\u2500\u2500 Register/\n        \u2502   \u2502   \u251c\u2500\u2500 RegisterCommand.php\n        \u2502   \u2502   \u251c\u2500\u2500 RegisterCommandHandler.php\n        \u2502   \u2502   \u2514\u2500\u2500 AccountFactory.php\n        \u2502   \u2514\u2500\u2500 Find/\n        \u2502       \u251c\u2500\u2500 FindQuery.php\n        \u2502       \u251c\u2500\u2500 FindQueryHandler.php\n        \u2502       \u2514\u2500\u2500 FindResponse.php\n        \u2502\n        \u251c\u2500\u2500 Domain/                # Couche Domain (C\u0153ur)\n        \u2502   \u251c\u2500\u2500 Model/\n        \u2502   \u2502   \u2514\u2500\u2500 User.php\n        \u2502   \u251c\u2500\u2500 ValueObject/\n        \u2502   \u2502   \u251c\u2500\u2500 Email.php\n        \u2502   \u2502   \u2514\u2500\u2500 UserId.php\n        \u2502   \u2514\u2500\u2500 Port/\n        \u2502       \u2514\u2500\u2500 UserRepositoryInterface.php\n        \u2502\n        \u2514\u2500\u2500 Infrastructure/        # Couche Infrastructure\n            \u251c\u2500\u2500 Persistence/\n            \u2502   \u251c\u2500\u2500 Doctrine/\n            \u2502   \u2502   \u251c\u2500\u2500 DoctrineUserRepository.php\n            \u2502   \u2502   \u2514\u2500\u2500 Mapping/\n            \u2502   \u2502       \u2514\u2500\u2500 User.orm.xml\n            \u2502   \u2514\u2500\u2500 InMemory/\n            \u2502       \u2514\u2500\u2500 InMemoryUserRepository.php\n            \u2514\u2500\u2500 Messaging/\n                \u2514\u2500\u2500 SymfonyMessengerAdapter.php\n</code></pre>"},{"location":"ARCHITECTURE/#7-bonnes-pratiques","title":"7. Bonnes pratiques","text":""},{"location":"ARCHITECTURE/#71-domain-pur","title":"7.1 Domain pur","text":"<pre><code>// MAUVAIS - D\u00e9pendance \u00e0 Doctrine\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\nclass User { }\n\n// BON - PHP pur\nclass User\n{\n    public function __construct(\n        private UserId $id,\n        private Email $email,\n    ) {\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#72-value-objects-immuables","title":"7.2 Value Objects immuables","text":"<pre><code>// MAUVAIS - Mutable\nclass Email\n{\n    public string $value;\n\n    public function setValue(string $value): void\n    {\n        $this-&gt;value = $value;\n    }\n}\n\n// BON - Immutable avec readonly\nfinal readonly class Email\n{\n    public function __construct(\n        public string $value,\n    ) {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException();\n        }\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#73-ports-dans-le-domain","title":"7.3 Ports dans le Domain","text":"<pre><code>// MAUVAIS - Adapter dans le Domain\nnamespace App\\Domain;\n\nuse Doctrine\\ORM\\EntityManagerInterface;\n\nclass UserService\n{\n    public function __construct(\n        private EntityManagerInterface $em\n    ) {}\n}\n\n// BON - Port (interface) dans le Domain\nnamespace App\\Domain\\Port;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n}\n\nnamespace App\\Application;\n\nclass RegisterHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $repository\n    ) {}\n}\n</code></pre>"},{"location":"ARCHITECTURE/#74-factories-pour-creation-complexe","title":"7.4 Factories pour cr\u00e9ation complexe","text":"<pre><code>final readonly class OrderFactory\n{\n    public function __construct(\n        private IdGeneratorInterface $idGenerator,\n        private ClockInterface $clock,\n    ) {\n    }\n\n    public function create(CreateOrderCommand $command): Order\n    {\n        return new Order(\n            id: new OrderId($this-&gt;idGenerator-&gt;generate()),\n            customerId: new CustomerId($command-&gt;customerId),\n            items: $this-&gt;createOrderItems($command-&gt;items),\n            createdAt: $this-&gt;clock-&gt;now(),\n        );\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#8-design-patterns-favorises","title":"8. Design Patterns Favoris\u00e9s","text":"<p>L'architecture hexagonale encourage naturellement l'utilisation de nombreux design patterns \u00e9prouv\u00e9s. Cette section explore comment l'hexagonal facilite et favorise ces patterns.</p> <pre><code>graph TB\n    subgraph Creational[\"Patterns de Cr\u00e9ation (Creational)\"]\n        Factory[Factory Pattern]\n        Builder[Builder Pattern]\n        Singleton[Singleton Pattern]\n    end\n\n    subgraph Structural[\"Patterns Structuraux (Structural)\"]\n        Adapter[Adapter Pattern]\n        Repository[Repository Pattern]\n        DTO[DTO Pattern]\n    end\n\n    subgraph Behavioral[\"Patterns Comportementaux (Behavioral)\"]\n        Strategy[Strategy Pattern]\n        Observer[Observer Pattern]\n        Command[Command Pattern]\n    end\n\n    subgraph Hexagonal[\"Architecture Hexagonale\"]\n        Domain[Domain Layer]\n        App[Application Layer]\n        Infra[Infrastructure Layer]\n    end\n\n    Factory -.-&gt;|cr\u00e9e| Domain\n    Builder -.-&gt;|construit| Domain\n    Adapter -.-&gt;|impl\u00e9mente ports| Infra\n    Repository -.-&gt;|abstrait persistance| Domain\n    DTO -.-&gt;|transf\u00e8re donn\u00e9es| App\n    Strategy -.-&gt;|s\u00e9lection impl\u00e9mentation| Infra\n    Command -.-&gt;|encapsule intention| App\n\n    style Creational fill:#FFD700,stroke:#333,stroke-width:2px\n    style Structural fill:#87CEEB,stroke:#333,stroke-width:2px\n    style Behavioral fill:#FFB6C1,stroke:#333,stroke-width:2px\n    style Hexagonal fill:#90EE90,stroke:#333,stroke-width:2px</code></pre>"},{"location":"ARCHITECTURE/#81-patterns-de-creation-creational-patterns","title":"8.1 Patterns de Cr\u00e9ation (Creational Patterns)","text":""},{"location":"ARCHITECTURE/#811-factory-pattern","title":"8.1.1 Factory Pattern","text":"<p>Pourquoi l'hexagonal le favorise: - La cr\u00e9ation d'entit\u00e9s complexes n\u00e9cessite souvent plusieurs Value Objects - Validation et logique m\u00e9tier doivent \u00eatre centralis\u00e9es - Le Domain ne doit pas d\u00e9pendre de l'Infrastructure</p> <p>Exemple: <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\User\\Account\\Application\\Register;\n\nuse App\\User\\Account\\Domain\\Model\\User;\nuse App\\User\\Account\\Domain\\ValueObject\\Email;\nuse App\\User\\Account\\Domain\\ValueObject\\UserId;\nuse App\\User\\Account\\Domain\\ValueObject\\HashedPassword;\nuse App\\Shared\\Domain\\Service\\IdGeneratorInterface;\nuse App\\Shared\\Domain\\Service\\PasswordHasherInterface;\n\n/**\n * Factory Pattern - Cr\u00e9e des entit\u00e9s complexes du Domain\n */\nfinal readonly class UserFactory\n{\n    public function __construct(\n        private IdGeneratorInterface $idGenerator,\n        private PasswordHasherInterface $passwordHasher,\n    ) {\n    }\n\n    public function createFromCommand(RegisterCommand $command): User\n    {\n        return new User(\n            id: new UserId($this-&gt;idGenerator-&gt;generate()),\n            email: new Email($command-&gt;email),\n            password: new HashedPassword(\n                $this-&gt;passwordHasher-&gt;hash($command-&gt;password)\n            ),\n            createdAt: new \\DateTimeImmutable(),\n        );\n    }\n}\n</code></pre></p> <p>Avantages dans l'hexagonal: - Encapsule la logique de cr\u00e9ation complexe - Isole les d\u00e9pendances (ID generator, hasher) de l'entit\u00e9 - Facilite les tests (mock de la factory)</p>"},{"location":"ARCHITECTURE/#812-builder-pattern","title":"8.1.2 Builder Pattern","text":"<p>Utilisation: - Construction progressive d'objets complexes - Configurations avec nombreuses options</p> <p>Exemple: <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\Order\\Domain\\Builder;\n\nuse App\\Order\\Domain\\Model\\Order;\nuse App\\Order\\Domain\\ValueObject\\OrderId;\nuse App\\Order\\Domain\\ValueObject\\OrderItem;\n\n/**\n * Builder Pattern - Construction progressive d'une commande\n */\nfinal class OrderBuilder\n{\n    private ?OrderId $id = null;\n    private ?string $customerId = null;\n    private array $items = [];\n    private ?string $shippingAddress = null;\n    private ?string $billingAddress = null;\n\n    public function withId(OrderId $id): self\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    public function forCustomer(string $customerId): self\n    {\n        $this-&gt;customerId = $customerId;\n        return $this;\n    }\n\n    public function addItem(OrderItem $item): self\n    {\n        $this-&gt;items[] = $item;\n        return $this;\n    }\n\n    public function withShippingAddress(string $address): self\n    {\n        $this-&gt;shippingAddress = $address;\n        return $this;\n    }\n\n    public function build(): Order\n    {\n        if ($this-&gt;id === null || $this-&gt;customerId === null) {\n            throw new \\LogicException('Order must have id and customer');\n        }\n\n        return new Order(\n            id: $this-&gt;id,\n            customerId: $this-&gt;customerId,\n            items: $this-&gt;items,\n            shippingAddress: $this-&gt;shippingAddress,\n            billingAddress: $this-&gt;billingAddress ?? $this-&gt;shippingAddress,\n        );\n    }\n}\n\n// Utilisation dans un test\n$order = (new OrderBuilder())\n    -&gt;withId(OrderId::generate())\n    -&gt;forCustomer('customer-123')\n    -&gt;addItem(new OrderItem('product-1', 2))\n    -&gt;addItem(new OrderItem('product-2', 1))\n    -&gt;withShippingAddress('123 Main St')\n    -&gt;build();\n</code></pre></p>"},{"location":"ARCHITECTURE/#813-singleton-pattern-port-registry","title":"8.1.3 Singleton Pattern (Port Registry)","text":"<p>Cas d'usage limit\u00e9 mais pertinent: - Registre de ports disponibles - Configuration globale</p> <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\Shared\\Infrastructure\\Registry;\n\n/**\n * Singleton - Registre des adapters disponibles\n */\nfinal class AdapterRegistry\n{\n    private static ?self $instance = null;\n    private array $adapters = [];\n\n    private function __construct() {}\n\n    public static function getInstance(): self\n    {\n        if (self::$instance === null) {\n            self::$instance = new self();\n        }\n\n        return self::$instance;\n    }\n\n    public function register(string $portName, object $adapter): void\n    {\n        $this-&gt;adapters[$portName] = $adapter;\n    }\n\n    public function get(string $portName): object\n    {\n        return $this-&gt;adapters[$portName] ?? throw new \\RuntimeException(\n            \"No adapter registered for port: {$portName}\"\n        );\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#82-patterns-structuraux-structural-patterns","title":"8.2 Patterns Structuraux (Structural Patterns)","text":""},{"location":"ARCHITECTURE/#821-adapter-pattern-cur-de-lhexagonal","title":"8.2.1 Adapter Pattern (C\u0153ur de l'Hexagonal)","text":"<p>C'est LE pattern central de l'architecture hexagonale!</p> <p>Pourquoi: - Traduit les interfaces externes vers les Ports du Domain - Permet de changer d'infrastructure sans toucher au Domain</p> <p>Exemple complet: <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\n// PORT (Domain Layer)\nnamespace App\\User\\Account\\Domain\\Port;\n\nuse App\\User\\Account\\Domain\\Model\\User;\nuse App\\User\\Account\\Domain\\ValueObject\\UserId;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findByEmail(string $email): ?User;\n}\n\n// ADAPTER 1 - Doctrine (Infrastructure)\nnamespace App\\User\\Account\\Infrastructure\\Persistence\\Doctrine;\n\nuse App\\User\\Account\\Domain\\Model\\User;\nuse App\\User\\Account\\Domain\\Port\\UserRepositoryInterface;\nuse App\\User\\Account\\Domain\\ValueObject\\UserId;\nuse Doctrine\\ORM\\EntityManagerInterface;\n\n/**\n * Adapter Pattern - Adapte Doctrine vers notre Port\n */\nfinal readonly class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager,\n    ) {\n    }\n\n    public function save(User $user): void\n    {\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n    }\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;entityManager-&gt;find(User::class, $id-&gt;value);\n    }\n\n    public function findByEmail(string $email): ?User\n    {\n        return $this-&gt;entityManager\n            -&gt;getRepository(User::class)\n            -&gt;findOneBy(['email.value' =&gt; $email]);\n    }\n}\n\n// ADAPTER 2 - MongoDB (Infrastructure)\nnamespace App\\User\\Account\\Infrastructure\\Persistence\\MongoDB;\n\nuse App\\User\\Account\\Domain\\Model\\User;\nuse App\\User\\Account\\Domain\\Port\\UserRepositoryInterface;\nuse MongoDB\\Client;\n\n/**\n * Adapter Pattern - Adapte MongoDB vers le m\u00eame Port\n */\nfinal readonly class MongoUserRepository implements UserRepositoryInterface\n{\n    private const COLLECTION = 'users';\n\n    public function __construct(\n        private Client $mongoClient,\n        private string $databaseName,\n    ) {\n    }\n\n    public function save(User $user): void\n    {\n        $collection = $this-&gt;mongoClient\n            -&gt;selectDatabase($this-&gt;databaseName)\n            -&gt;selectCollection(self::COLLECTION);\n\n        $collection-&gt;updateOne(\n            ['_id' =&gt; $user-&gt;getId()-&gt;value],\n            ['$set' =&gt; $this-&gt;serialize($user)],\n            ['upsert' =&gt; true]\n        );\n    }\n\n    // ... autres m\u00e9thodes\n}\n\n// ADAPTER 3 - InMemory (Tests)\nnamespace Tests\\Unit\\User\\Account\\Infrastructure\\Persistence\\InMemory;\n\nuse App\\User\\Account\\Domain\\Model\\User;\nuse App\\User\\Account\\Domain\\Port\\UserRepositoryInterface;\n\n/**\n * Adapter Pattern - Impl\u00e9mentation en m\u00e9moire pour tests rapides\n */\nfinal class InMemoryUserRepository implements UserRepositoryInterface\n{\n    private array $users = [];\n\n    public function save(User $user): void\n    {\n        $this-&gt;users[$user-&gt;getId()-&gt;value] = $user;\n    }\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;users[$id-&gt;value] ?? null;\n    }\n\n    public function findByEmail(string $email): ?User\n    {\n        foreach ($this-&gt;users as $user) {\n            if ($user-&gt;getEmail()-&gt;value === $email) {\n                return $user;\n            }\n        }\n\n        return null;\n    }\n\n    // Helper pour les tests\n    public function clear(): void\n    {\n        $this-&gt;users = [];\n    }\n}\n</code></pre></p> <p>B\u00e9n\u00e9fices: - 3 adapters diff\u00e9rents pour le m\u00eame port - Le Domain ne change jamais - L'Application ne change jamais - Changement de DB = changer l'adapter dans <code>services.yaml</code></p>"},{"location":"ARCHITECTURE/#822-repository-pattern","title":"8.2.2 Repository Pattern","text":"<p>Int\u00e9gration naturelle: - Les Ports d\u00e9finissent les interfaces de Repository - Les Adapters impl\u00e9mentent la persistance</p> <p>Exemple avec m\u00e9thodes m\u00e9tier: <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\n// Port avec m\u00e9thodes m\u00e9tier\nnamespace App\\Product\\Domain\\Port;\n\nuse App\\Product\\Domain\\Model\\Product;\n\ninterface ProductRepositoryInterface\n{\n    public function save(Product $product): void;\n    public function findById(string $id): ?Product;\n\n    // M\u00e9thodes m\u00e9tier (pas technique)\n    public function findActiveProducts(): array;\n    public function findProductsLowInStock(int $threshold): array;\n    public function findBestSellers(int $limit): array;\n}\n\n// Adapter Doctrine\nnamespace App\\Product\\Infrastructure\\Persistence\\Doctrine;\n\nuse App\\Product\\Domain\\Model\\Product;\nuse App\\Product\\Domain\\Port\\ProductRepositoryInterface;\n\nfinal readonly class DoctrineProductRepository implements ProductRepositoryInterface\n{\n    public function findActiveProducts(): array\n    {\n        return $this-&gt;entityManager\n            -&gt;createQueryBuilder()\n            -&gt;select('p')\n            -&gt;from(Product::class, 'p')\n            -&gt;where('p.isActive = :active')\n            -&gt;setParameter('active', true)\n            -&gt;getQuery()\n            -&gt;getResult();\n    }\n\n    public function findProductsLowInStock(int $threshold): array\n    {\n        return $this-&gt;entityManager\n            -&gt;createQueryBuilder()\n            -&gt;select('p')\n            -&gt;from(Product::class, 'p')\n            -&gt;where('p.stock &lt; :threshold')\n            -&gt;setParameter('threshold', $threshold)\n            -&gt;orderBy('p.stock', 'ASC')\n            -&gt;getQuery()\n            -&gt;getResult();\n    }\n}\n</code></pre></p>"},{"location":"ARCHITECTURE/#823-dto-pattern-data-transfer-object","title":"8.2.3 DTO Pattern (Data Transfer Object)","text":"<p>Utilisation syst\u00e9matique dans l'hexagonal:</p> <p>1. Commands (Write) - DTOs immuables <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\User\\Account\\Application\\Register;\n\n/**\n * DTO Pattern - Command = DTO immutable pour l'\u00e9criture\n */\nfinal readonly class RegisterCommand\n{\n    public function __construct(\n        public string $email,\n        public string $password,\n        public string $firstName,\n        public string $lastName,\n    ) {\n    }\n}\n</code></pre></p> <p>2. Queries Response - DTOs de lecture <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\User\\Account\\Application\\FindById;\n\n/**\n * DTO Pattern - Response = DTO pour la lecture\n */\nfinal readonly class FindByIdResponse\n{\n    public function __construct(\n        public string $id,\n        public string $email,\n        public string $firstName,\n        public string $lastName,\n        public bool $isActive,\n        public string $createdAt,\n    ) {\n    }\n\n    public static function fromUser(User $user): self\n    {\n        return new self(\n            id: $user-&gt;getId()-&gt;value,\n            email: $user-&gt;getEmail()-&gt;value,\n            firstName: $user-&gt;getFirstName(),\n            lastName: $user-&gt;getLastName(),\n            isActive: $user-&gt;isActive(),\n            createdAt: $user-&gt;getCreatedAt()-&gt;format('Y-m-d H:i:s'),\n        );\n    }\n}\n</code></pre></p> <p>3. API DTOs - S\u00e9paration UI/Application <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\UI\\Http\\DTO;\n\n/**\n * DTO Pattern - DTO sp\u00e9cifique \u00e0 l'API HTTP\n */\nfinal readonly class RegisterUserRequest\n{\n    public function __construct(\n        public string $email,\n        public string $password,\n        public string $first_name,  // snake_case pour API\n        public string $last_name,\n    ) {\n    }\n\n    public function toCommand(): RegisterCommand\n    {\n        return new RegisterCommand(\n            email: $this-&gt;email,\n            password: $this-&gt;password,\n            firstName: $this-&gt;first_name,  // Conversion vers Domain\n            lastName: $this-&gt;last_name,\n        );\n    }\n}\n</code></pre></p> <p>Flux complet: <pre><code>HTTP Request (JSON)\n    \u2192 RegisterUserRequest (DTO API)\n    \u2192 RegisterCommand (DTO Application)\n    \u2192 User (Domain Entity)\n    \u2192 Persistence\n</code></pre></p>"},{"location":"ARCHITECTURE/#83-patterns-comportementaux-behavioral-patterns","title":"8.3 Patterns Comportementaux (Behavioral Patterns)","text":""},{"location":"ARCHITECTURE/#831-strategy-pattern","title":"8.3.1 Strategy Pattern","text":"<p>Usage naturel dans l'hexagonal: - S\u00e9lection dynamique d'adapters - Algorithmes de calcul interchangeables</p> <p>Exemple - Multiple payment strategies: <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\n// Port (Interface = Strategy)\nnamespace App\\Payment\\Domain\\Port;\n\nuse App\\Payment\\Domain\\Model\\Payment;\n\ninterface PaymentGatewayInterface\n{\n    public function process(Payment $payment): bool;\n    public function refund(Payment $payment): bool;\n}\n\n// Strategy 1 - Stripe\nnamespace App\\Payment\\Infrastructure\\Gateway;\n\nuse App\\Payment\\Domain\\Port\\PaymentGatewayInterface;\nuse Stripe\\StripeClient;\n\nfinal readonly class StripePaymentGateway implements PaymentGatewayInterface\n{\n    public function __construct(\n        private StripeClient $stripe,\n    ) {\n    }\n\n    public function process(Payment $payment): bool\n    {\n        $result = $this-&gt;stripe-&gt;charges-&gt;create([\n            'amount' =&gt; $payment-&gt;getAmount()-&gt;inCents(),\n            'currency' =&gt; $payment-&gt;getAmount()-&gt;currency,\n            'source' =&gt; $payment-&gt;getToken(),\n        ]);\n\n        return $result-&gt;status === 'succeeded';\n    }\n\n    public function refund(Payment $payment): bool\n    {\n        // Stripe refund logic\n    }\n}\n\n// Strategy 2 - PayPal\nnamespace App\\Payment\\Infrastructure\\Gateway;\n\nuse App\\Payment\\Domain\\Port\\PaymentGatewayInterface;\n\nfinal readonly class PayPalPaymentGateway implements PaymentGatewayInterface\n{\n    public function process(Payment $payment): bool\n    {\n        // PayPal logic\n    }\n}\n\n// Context - Utilisation de la strat\u00e9gie\nnamespace App\\Payment\\Application\\ProcessPayment;\n\nuse App\\Payment\\Domain\\Port\\PaymentGatewayInterface;\n\n#[AsMessageHandler]\nfinal readonly class ProcessPaymentCommandHandler\n{\n    public function __construct(\n        private PaymentGatewayInterface $paymentGateway,  // Strategy inject\u00e9e\n    ) {\n    }\n\n    public function __invoke(ProcessPaymentCommand $command): void\n    {\n        $payment = $this-&gt;createPayment($command);\n\n        // La strat\u00e9gie est utilis\u00e9e sans savoir laquelle c'est\n        $success = $this-&gt;paymentGateway-&gt;process($payment);\n\n        if (!$success) {\n            throw new PaymentFailedException();\n        }\n    }\n}\n</code></pre></p> <p>Configuration Symfony (choix de strat\u00e9gie): <pre><code># config/services.yaml\nservices:\n    # Strat\u00e9gie par d\u00e9faut\n    App\\Payment\\Domain\\Port\\PaymentGatewayInterface:\n        class: App\\Payment\\Infrastructure\\Gateway\\StripePaymentGateway\n\n    # Ou selon environnement\n    App\\Payment\\Domain\\Port\\PaymentGatewayInterface:\n        class: '%env(PAYMENT_GATEWAY)%'\n        # PAYMENT_GATEWAY=App\\Payment\\Infrastructure\\Gateway\\PayPalPaymentGateway\n</code></pre></p>"},{"location":"ARCHITECTURE/#832-command-pattern-cqrs","title":"8.3.2 Command Pattern (CQRS)","text":"<p>Impl\u00e9mentation native dans l'hexagonal:</p> <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\Order\\Application\\PlaceOrder;\n\n/**\n * Command Pattern - Encapsule une requ\u00eate comme un objet\n */\nfinal readonly class PlaceOrderCommand\n{\n    public function __construct(\n        public string $customerId,\n        public array $items,\n        public string $shippingAddress,\n    ) {\n    }\n}\n\n// Handler = Receiver\n#[AsMessageHandler]\nfinal readonly class PlaceOrderCommandHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orderRepository,\n        private OrderFactory $orderFactory,\n    ) {\n    }\n\n    public function __invoke(PlaceOrderCommand $command): void\n    {\n        $order = $this-&gt;orderFactory-&gt;createFromCommand($command);\n        $this-&gt;orderRepository-&gt;save($order);\n    }\n}\n\n// Invoker\nnamespace App\\UI\\Http\\Controller;\n\nuse Symfony\\Component\\Messenger\\MessageBusInterface;\n\nfinal class OrderController\n{\n    public function __construct(\n        private MessageBusInterface $commandBus,  // Invoker\n    ) {\n    }\n\n    #[Route('/orders', methods: ['POST'])]\n    public function placeOrder(Request $request): Response\n    {\n        $command = new PlaceOrderCommand(\n            customerId: $request-&gt;get('customer_id'),\n            items: $request-&gt;get('items'),\n            shippingAddress: $request-&gt;get('shipping_address'),\n        );\n\n        // Invocation du command\n        $this-&gt;commandBus-&gt;dispatch($command);\n\n        return new JsonResponse(['status' =&gt; 'success']);\n    }\n}\n</code></pre> <p>Avantages: - Historique des commandes (event sourcing possible) - Annulation/Redo possible - Validation centralis\u00e9e - Asynchrone facilement (via message queue)</p>"},{"location":"ARCHITECTURE/#833-observer-pattern-domain-events","title":"8.3.3 Observer Pattern (Domain Events)","text":"<p>\u00c9v\u00e9nements du Domain:</p> <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\n// Event\nnamespace App\\User\\Account\\Domain\\Event;\n\nfinal readonly class UserRegisteredEvent\n{\n    public function __construct(\n        public string $userId,\n        public string $email,\n        public \\DateTimeImmutable $occurredAt,\n    ) {\n    }\n}\n\n// Entity qui dispatche l'\u00e9v\u00e9nement\nnamespace App\\User\\Account\\Domain\\Model;\n\nfinal class User\n{\n    private array $domainEvents = [];\n\n    public function register(): void\n    {\n        // Logique m\u00e9tier\n        $this-&gt;isActive = true;\n\n        // Enregistre l'\u00e9v\u00e9nement\n        $this-&gt;domainEvents[] = new UserRegisteredEvent(\n            userId: $this-&gt;id-&gt;value,\n            email: $this-&gt;email-&gt;value,\n            occurredAt: new \\DateTimeImmutable(),\n        );\n    }\n\n    public function pullDomainEvents(): array\n    {\n        $events = $this-&gt;domainEvents;\n        $this-&gt;domainEvents = [];\n        return $events;\n    }\n}\n\n// Observer 1 - Envoyer email\nnamespace App\\User\\Account\\Application\\EventSubscriber;\n\nuse Symfony\\Component\\Messenger\\Attribute\\AsMessageHandler;\n\n#[AsMessageHandler]\nfinal readonly class SendWelcomeEmailOnUserRegistered\n{\n    public function __construct(\n        private MailerInterface $mailer,\n    ) {\n    }\n\n    public function __invoke(UserRegisteredEvent $event): void\n    {\n        $this-&gt;mailer-&gt;send(\n            new WelcomeEmail($event-&gt;email)\n        );\n    }\n}\n\n// Observer 2 - Logger\n#[AsMessageHandler]\nfinal readonly class LogUserRegistration\n{\n    public function __construct(\n        private LoggerInterface $logger,\n    ) {\n    }\n\n    public function __invoke(UserRegisteredEvent $event): void\n    {\n        $this-&gt;logger-&gt;info('New user registered', [\n            'user_id' =&gt; $event-&gt;userId,\n            'email' =&gt; $event-&gt;email,\n        ]);\n    }\n}\n\n// Observer 3 - Cr\u00e9er profil\n#[AsMessageHandler]\nfinal readonly class CreateUserProfileOnUserRegistered\n{\n    public function __invoke(UserRegisteredEvent $event): void\n    {\n        // Cr\u00e9er le profil utilisateur\n    }\n}\n</code></pre> <p>B\u00e9n\u00e9fices: - D\u00e9couplage total entre modules - Extensibilit\u00e9 - ajouter observer = nouvelle classe - Single Responsibility - chaque observer fait une chose</p>"},{"location":"ARCHITECTURE/#84-autres-patterns-importants","title":"8.4 Autres Patterns Importants","text":""},{"location":"ARCHITECTURE/#841-specification-pattern","title":"8.4.1 Specification Pattern","text":"<p>Pour les requ\u00eates complexes:</p> <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\Product\\Domain\\Specification;\n\nuse App\\Product\\Domain\\Model\\Product;\n\ninterface ProductSpecificationInterface\n{\n    public function isSatisfiedBy(Product $product): bool;\n}\n\nfinal readonly class ActiveProductSpecification implements ProductSpecificationInterface\n{\n    public function isSatisfiedBy(Product $product): bool\n    {\n        return $product-&gt;isActive();\n    }\n}\n\nfinal readonly class InStockSpecification implements ProductSpecificationInterface\n{\n    public function isSatisfiedBy(Product $product): bool\n    {\n        return $product-&gt;getStock() &gt; 0;\n    }\n}\n\n// Composite Specification\nfinal readonly class AndSpecification implements ProductSpecificationInterface\n{\n    public function __construct(\n        private ProductSpecificationInterface $spec1,\n        private ProductSpecificationInterface $spec2,\n    ) {\n    }\n\n    public function isSatisfiedBy(Product $product): bool\n    {\n        return $this-&gt;spec1-&gt;isSatisfiedBy($product)\n            &amp;&amp; $this-&gt;spec2-&gt;isSatisfiedBy($product);\n    }\n}\n\n// Utilisation\n$activeAndInStock = new AndSpecification(\n    new ActiveProductSpecification(),\n    new InStockSpecification()\n);\n\n$filteredProducts = array_filter(\n    $products,\n    fn(Product $p) =&gt; $activeAndInStock-&gt;isSatisfiedBy($p)\n);\n</code></pre>"},{"location":"ARCHITECTURE/#842-null-object-pattern","title":"8.4.2 Null Object Pattern","text":"<p>Pour \u00e9viter les null checks:</p> <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\User\\Account\\Domain\\Model;\n\n// Interface\ninterface UserInterface\n{\n    public function getId(): UserId;\n    public function getEmail(): Email;\n    public function isActive(): bool;\n}\n\n// User r\u00e9el\nfinal class User implements UserInterface\n{\n    // ... impl\u00e9mentation normale\n}\n\n// Null User\nfinal class NullUser implements UserInterface\n{\n    public function getId(): UserId\n    {\n        return new UserId('null');\n    }\n\n    public function getEmail(): Email\n    {\n        return new Email('null@example.com');\n    }\n\n    public function isActive(): bool\n    {\n        return false;\n    }\n}\n\n// Repository\nfinal class DoctrineUserRepository\n{\n    public function findById(UserId $id): UserInterface\n    {\n        $user = $this-&gt;entityManager-&gt;find(User::class, $id-&gt;value);\n\n        // Retourne NullUser au lieu de null\n        return $user ?? new NullUser();\n    }\n}\n\n// Utilisation - pas de null check!\n$user = $repository-&gt;findById($userId);\nif ($user-&gt;isActive()) {  // Pas de null check n\u00e9cessaire\n    // ...\n}\n</code></pre>"},{"location":"ARCHITECTURE/#85-tableau-recapitulatif","title":"8.5 Tableau R\u00e9capitulatif","text":"Pattern Cat\u00e9gorie Couche Hexagonale Usage Principal Factory Creational Application/Domain Cr\u00e9ation d'entit\u00e9s complexes Builder Creational Domain/Tests Construction progressive Singleton Creational Infrastructure Registres, configurations Adapter Structural Infrastructure CORE - Impl\u00e9mente les ports Repository Structural Domain (Port) + Infra (Adapter) Abstraction persistance DTO Structural Application Commands, Queries, Responses Strategy Behavioral Infrastructure Algorithmes interchangeables Command Behavioral Application CQRS - Use cases Observer Behavioral Application Domain Events Specification Domain Domain R\u00e8gles m\u00e9tier complexes Null Object Special Domain \u00c9viter null checks"},{"location":"ARCHITECTURE/#86-anti-patterns-a-eviter","title":"8.6 Anti-Patterns \u00e0 \u00c9viter","text":""},{"location":"ARCHITECTURE/#service-locator-dans-le-domain","title":"\ud83c\udf2a\ufe0f Service Locator dans le Domain","text":"<pre><code>// MAUVAIS\nclass User\n{\n    public function save(): void\n    {\n        $repository = ServiceLocator::get(UserRepositoryInterface::class);\n        $repository-&gt;save($this);\n    }\n}\n\n// BON - Injection de d\u00e9pendances\nclass RegisterCommandHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $repository\n    ) {}\n}\n</code></pre>"},{"location":"ARCHITECTURE/#god-object-anemic-domain","title":"\ud83c\udf2a\ufe0f God Object / Anemic Domain","text":"<pre><code>// MAUVAIS - Anemic\nclass User\n{\n    public string $email;\n    public string $password;\n    // Pas de logique\n}\n\nclass UserService\n{\n    public function register(User $user): void\n    {\n        // Toute la logique ici\n    }\n}\n\n// BON - Rich Domain\nclass User\n{\n    public function register(Email $email, HashedPassword $password): void\n    {\n        // Validation et logique m\u00e9tier ici\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#9-migration-progressive","title":"9. Migration progressive","text":""},{"location":"ARCHITECTURE/#91-etape-1-extraire-le-domain","title":"9.1 \u00c9tape 1 : Extraire le Domain","text":"<pre><code>// Avant\nclass UserController\n{\n    public function register(Request $request): Response\n    {\n        $user = new User();\n        $user-&gt;setEmail($request-&gt;get('email'));\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n    }\n}\n\n// Apr\u00e8s\nclass UserController\n{\n    public function register(Request $request): Response\n    {\n        $command = new RegisterCommand($request-&gt;get('email'));\n        $this-&gt;commandBus-&gt;dispatch($command);\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#92-etape-2-creer-les-ports","title":"9.2 \u00c9tape 2 : Cr\u00e9er les Ports","text":"<pre><code>// Domain/Port\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n}\n</code></pre>"},{"location":"ARCHITECTURE/#93-etape-3-creer-les-adapters","title":"9.3 \u00c9tape 3 : Cr\u00e9er les Adapters","text":"<pre><code>// Infrastructure\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#10-ressources","title":"10. Ressources","text":"<ul> <li>Hexagonal Architecture par Alistair Cockburn</li> <li>Clean Architecture par Robert C. Martin</li> <li>DDD par Eric Evans</li> <li>CQRS Pattern</li> </ul> <p>Ce bundle vous aide \u00e0 mettre en \u0153uvre ces principes facilement avec Symfony !</p>"},{"location":"BILINGUAL_DOCS/","title":"Bilingual Documentation System","text":""},{"location":"BILINGUAL_DOCS/#overview","title":"Overview","text":"<p>The Hexagonal Maker Bundle documentation is available in two languages: - \ud83c\uddec\ud83c\udde7 English (default) - \ud83c\uddeb\ud83c\uddf7 French</p>"},{"location":"BILINGUAL_DOCS/#language-switcher","title":"Language Switcher","text":"<p>A language switcher is available in the top-right corner of every documentation page, allowing users to seamlessly switch between languages.</p>"},{"location":"BILINGUAL_DOCS/#structure","title":"Structure","text":"<pre><code>docs/\n\u251c\u2500\u2500 index.md                     # English home page\n\u251c\u2500\u2500 fr/\n\u2502   \u2514\u2500\u2500 index.md                 # French home page\n\u251c\u2500\u2500 advanced/                    # English advanced guides\n\u2502   \u251c\u2500\u2500 domain-vs-application.md\n\u2502   \u251c\u2500\u2500 request-response-flow.md\n\u2502   \u251c\u2500\u2500 port-design-principles.md\n\u2502   \u251c\u2500\u2500 primary-secondary-adapters.md\n\u2502   \u251c\u2500\u2500 cqrs-cost-benefit.md\n\u2502   \u251c\u2500\u2500 dependency-injection-guide.md\n\u2502   \u251c\u2500\u2500 factory-pattern-guide.md\n\u2502   \u251c\u2500\u2500 error-handling-strategy.md\n\u2502   \u2514\u2500\u2500 anti-patterns-pitfalls.md\n\u251c\u2500\u2500 ARCHITECTURE.md              # Available in French\n\u251c\u2500\u2500 WHY-HEXAGONAL.md            # English\n\u251c\u2500\u2500 SOLID.md                    # English\n\u2514\u2500\u2500 _includes/\n    \u2514\u2500\u2500 language-switcher.html  # Language switcher component\n</code></pre>"},{"location":"BILINGUAL_DOCS/#how-it-works","title":"How It Works","text":""},{"location":"BILINGUAL_DOCS/#1-layout-template","title":"1. Layout Template","text":"<p>The <code>default_with_lang</code> layout includes the language switcher:</p> <pre><code>---\nlayout: default_with_lang\ntitle: Your Page Title\nlang: en  # or 'fr'\nlang_ref: fr/page.md  # Optional: reference to translated version\n---\n</code></pre>"},{"location":"BILINGUAL_DOCS/#2-language-attributes","title":"2. Language Attributes","text":"<p>Each page with bilingual support should include:</p> <ul> <li><code>lang</code>: Current language (<code>en</code> or <code>fr</code>)</li> <li><code>lang_ref</code>: Relative path to the translated version (optional)</li> </ul> <p>Example (English page):</p> <pre><code>---\nlayout: default_with_lang\ntitle: Home\nlang: en\nlang_ref: fr/index.md\n---\n</code></pre> <p>Example (French page):</p> <pre><code>---\nlayout: default_with_lang\ntitle: Accueil\nlang: fr\nlang_ref: index.md\n---\n</code></pre>"},{"location":"BILINGUAL_DOCS/#3-language-switcher-component","title":"3. Language Switcher Component","text":"<p>The <code>_includes/language-switcher.html</code> component: - Shows current language as text - Shows link to alternate language - Uses flags (\ud83c\uddec\ud83c\udde7/\ud83c\uddeb\ud83c\uddf7) for visual identification - Fixed position in top-right corner - Responsive (moves to static position on mobile)</p>"},{"location":"BILINGUAL_DOCS/#adding-a-new-bilingual-page","title":"Adding a New Bilingual Page","text":""},{"location":"BILINGUAL_DOCS/#step-1-create-english-version","title":"Step 1: Create English Version","text":"<pre><code>---\nlayout: default_with_lang\ntitle: My New Page\nparent: Advanced Topics\nnav_order: 20\nlang: en\nlang_ref: fr/advanced/my-new-page.md\n---\n\n# My New Page\n\nContent in English...\n</code></pre>"},{"location":"BILINGUAL_DOCS/#step-2-create-french-version","title":"Step 2: Create French Version","text":"<pre><code>---\nlayout: default_with_lang\ntitle: Ma Nouvelle Page\nparent: Sujets Avanc\u00e9s\nnav_order: 20\nlang: fr\nlang_ref: advanced/my-new-page.md\n---\n\n# Ma Nouvelle Page\n\nContenu en fran\u00e7ais...\n</code></pre>"},{"location":"BILINGUAL_DOCS/#step-3-update-navigation-if-needed","title":"Step 3: Update Navigation (if needed)","text":"<p>For French-only navigation sections, create <code>fr/advanced/index.md</code>:</p> <pre><code>---\nlayout: default_with_lang\ntitle: Sujets Avanc\u00e9s\nnav_order: 3\nhas_children: true\nlang: fr\n---\n</code></pre>"},{"location":"BILINGUAL_DOCS/#current-translation-status","title":"Current Translation Status","text":""},{"location":"BILINGUAL_DOCS/#fully-translated","title":"\u2705 Fully Translated","text":"<ul> <li>Home page (<code>index.md</code> \u2194 <code>fr/index.md</code>)</li> </ul>"},{"location":"BILINGUAL_DOCS/#partially-translated","title":"\ud83d\udd04 Partially Translated","text":"<ul> <li>Architecture Guide (<code>ARCHITECTURE.md</code> - has French version)</li> </ul>"},{"location":"BILINGUAL_DOCS/#not-yet-translated","title":"\u274c Not Yet Translated","text":"<ul> <li>Advanced Topics (9 guides) - currently English only</li> <li>Getting Started guides</li> <li>Maker Commands reference</li> <li>Examples</li> <li>WHY-HEXAGONAL.md</li> <li>SOLID.md</li> </ul>"},{"location":"BILINGUAL_DOCS/#translation-workflow","title":"Translation Workflow","text":""},{"location":"BILINGUAL_DOCS/#priority-order","title":"Priority Order","text":"<ol> <li>High Priority (User-facing):</li> <li>Home page \u2705</li> <li>Quick Start guide</li> <li> <p>Architecture Guide (partial \u2705)</p> </li> <li> <p>Medium Priority (Conceptual):</p> </li> <li>Why Hexagonal</li> <li>SOLID Principles</li> <li> <p>Advanced Topics (9 guides)</p> </li> <li> <p>Low Priority (Reference):</p> </li> <li>Maker Commands</li> <li>Examples</li> <li>Contributing guides</li> </ol>"},{"location":"BILINGUAL_DOCS/#translation-guidelines","title":"Translation Guidelines","text":"<ol> <li>Consistency: Use consistent terminology</li> <li>\"Port\" \u2192 \"Port\" (keep in French too)</li> <li>\"Adapter\" \u2192 \"Adaptateur\"</li> <li>\"Domain\" \u2192 \"Domaine\"</li> <li> <p>\"Handler\" \u2192 \"Handler\" (keep English term)</p> </li> <li> <p>Code Examples: Keep code in English (variable names, comments in English)</p> </li> <li> <p>Technical Terms: Keep well-established English terms when appropriate</p> </li> <li>CQRS (don't translate)</li> <li>Factory Pattern \u2192 \"Pattern Factory\"</li> <li> <p>Dependency Injection \u2192 \"Injection de D\u00e9pendances\"</p> </li> <li> <p>File Names:</p> </li> <li>French content goes in <code>fr/</code> subdirectories</li> <li>Keep original English file names for consistency</li> </ol>"},{"location":"BILINGUAL_DOCS/#maintenance","title":"Maintenance","text":""},{"location":"BILINGUAL_DOCS/#when-adding-new-content","title":"When Adding New Content","text":"<ol> <li>Create English version first (default)</li> <li>Add <code>layout: default_with_lang</code> and <code>lang: en</code></li> <li>Add <code>lang_ref</code> if French version exists or planned</li> <li>Create French version in <code>fr/</code> subdirectory</li> <li>Update both index pages to reference new content</li> </ol>"},{"location":"BILINGUAL_DOCS/#when-updating-content","title":"When Updating Content","text":"<ol> <li>Update English version</li> <li>Update French version (if exists)</li> <li>If major changes, add note about translation status</li> </ol>"},{"location":"BILINGUAL_DOCS/#styling","title":"Styling","text":"<p>The language switcher uses: - Fixed positioning (top-right) - White background with border - Hover effects on links - Emoji flags for visual recognition - Responsive design for mobile</p> <p>Custom CSS in <code>language-switcher.html</code> ensures: - Proper z-index (1000) to stay on top - No interference with main navigation - Accessibility considerations</p>"},{"location":"BILINGUAL_DOCS/#future-enhancements","title":"Future Enhancements","text":"<p>Potential improvements: 1. Add more languages (ES, DE, etc.) 2. Automatic language detection based on browser 3. Translation progress indicator 4. Crowdin integration for community translations 5. Search within specific language 6. Language-specific navigation sidebar</p>"},{"location":"BILINGUAL_DOCS/#contributing-translations","title":"Contributing Translations","text":"<p>To contribute a translation:</p> <ol> <li>Fork the repository</li> <li>Create translations in <code>docs/fr/</code> (or other language folder)</li> <li>Add <code>lang</code> and <code>lang_ref</code> metadata</li> <li>Test locally with Jekyll</li> <li>Submit pull request</li> </ol>"},{"location":"BILINGUAL_DOCS/#testing","title":"Testing","text":""},{"location":"BILINGUAL_DOCS/#local-testing","title":"Local Testing","text":"<pre><code>cd docs\nbundle install\nbundle exec jekyll serve\n\n# Visit http://localhost:4000\n# Test language switcher functionality\n# Verify both EN and FR versions\n</code></pre>"},{"location":"BILINGUAL_DOCS/#checklist","title":"Checklist","text":"<ul> <li> Language switcher appears on all pages</li> <li> Clicking switcher navigates to correct language</li> <li> Navigation works in both languages</li> <li> Search works in both languages</li> <li> Mobile responsive design works</li> <li> No broken links between language versions</li> </ul> <p>Documentation Structure by: Ahmed EBEN HASSINE Last Updated: 2024-01-15</p>"},{"location":"GITHUB_PAGES_SETUP/","title":"GitHub Pages Setup Guide","text":"<p>This guide explains how to set up GitHub Pages for this Jekyll documentation site.</p>"},{"location":"GITHUB_PAGES_SETUP/#prerequisites","title":"Prerequisites","text":"<ul> <li>Repository hosted on GitHub</li> <li>Admin access to the repository</li> </ul>"},{"location":"GITHUB_PAGES_SETUP/#setup-steps","title":"Setup Steps","text":""},{"location":"GITHUB_PAGES_SETUP/#1-enable-github-pages","title":"1. Enable GitHub Pages","text":"<ol> <li>Go to your repository on GitHub</li> <li>Click on Settings tab</li> <li>In the left sidebar, click on Pages</li> <li>Under Build and deployment:</li> <li>Source: Select \"GitHub Actions\"</li> <li>Click Save</li> </ol>"},{"location":"GITHUB_PAGES_SETUP/#2-configure-repository-permissions","title":"2. Configure Repository Permissions","text":"<p>The GitHub Actions workflow needs specific permissions to deploy to GitHub Pages.</p> <ol> <li>Go to Settings \u2192 Actions \u2192 General</li> <li>Scroll down to Workflow permissions</li> <li>Select Read and write permissions</li> <li>Check Allow GitHub Actions to create and approve pull requests</li> <li>Click Save</li> </ol>"},{"location":"GITHUB_PAGES_SETUP/#3-verify-configuration","title":"3. Verify Configuration","text":"<p>The repository already includes: - <code>.github/workflows/docs.yml</code> - GitHub Actions workflow - <code>docs/_config.yml</code> - Jekyll configuration - <code>docs/Gemfile</code> - Ruby dependencies</p>"},{"location":"GITHUB_PAGES_SETUP/#4-deploy","title":"4. Deploy","text":"<p>Push changes to the <code>main</code> branch:</p> <pre><code>git add .\ngit commit -m \"docs: setup Jekyll with Just the Docs theme\"\ngit push origin main\n</code></pre> <p>The GitHub Actions workflow will automatically: 1. Build the Jekyll site 2. Deploy to GitHub Pages</p>"},{"location":"GITHUB_PAGES_SETUP/#5-check-deployment-status","title":"5. Check Deployment Status","text":"<ol> <li>Go to the Actions tab in your repository</li> <li>Check the \"Deploy Documentation\" workflow</li> <li>Wait for the workflow to complete (usually 1-2 minutes)</li> </ol>"},{"location":"GITHUB_PAGES_SETUP/#6-access-your-documentation","title":"6. Access Your Documentation","text":"<p>Once deployed, your documentation will be available at:</p> <pre><code>https://[username].github.io/[repository-name]/\n</code></pre> <p>For this repository: <pre><code>https://ahmed-bhs.github.io/hexagonal-maker-bundle/\n</code></pre></p>"},{"location":"GITHUB_PAGES_SETUP/#workflow-details","title":"Workflow Details","text":"<p>The GitHub Actions workflow (<code>.github/workflows/docs.yml</code>) is triggered: - On every push to <code>main</code> branch that modifies files in <code>docs/</code> - Manually via the Actions tab</p>"},{"location":"GITHUB_PAGES_SETUP/#workflow-steps","title":"Workflow Steps","text":"<ol> <li>Checkout: Clones the repository</li> <li>Setup Ruby: Installs Ruby and dependencies</li> <li>Setup Pages: Configures GitHub Pages</li> <li>Build with Jekyll: Builds the static site</li> <li>Upload artifact: Uploads the built site</li> <li>Deploy: Deploys to GitHub Pages</li> </ol>"},{"location":"GITHUB_PAGES_SETUP/#troubleshooting","title":"Troubleshooting","text":""},{"location":"GITHUB_PAGES_SETUP/#workflow-fails-with-permission-error","title":"Workflow Fails with Permission Error","text":"<p>Error: <code>Error: HttpError: Resource not accessible by integration</code></p> <p>Solution: Enable workflow permissions (see Step 2 above)</p>"},{"location":"GITHUB_PAGES_SETUP/#site-not-updating","title":"Site Not Updating","text":"<ol> <li>Check the Actions tab for failed workflows</li> <li>Clear browser cache</li> <li>Wait a few minutes for CDN to update</li> </ol>"},{"location":"GITHUB_PAGES_SETUP/#rubybundle-errors","title":"Ruby/Bundle Errors","text":"<p>The workflow uses: - Ruby 3.1 - Bundler cache for faster builds</p> <p>If you get dependency errors, check <code>docs/Gemfile</code> is up to date.</p>"},{"location":"GITHUB_PAGES_SETUP/#base-url-issues","title":"Base URL Issues","text":"<p>The <code>_config.yml</code> has: <pre><code>baseurl: \"/hexagonal-maker-bundle\"\nurl: \"https://ahmed-bhs.github.io\"\n</code></pre></p> <p>Make sure these match your repository settings.</p>"},{"location":"GITHUB_PAGES_SETUP/#updating-the-documentation","title":"Updating the Documentation","text":""},{"location":"GITHUB_PAGES_SETUP/#making-changes","title":"Making Changes","text":"<ol> <li>Edit markdown files in <code>docs/</code></li> <li>Commit and push to <code>main</code> branch</li> <li>Workflow automatically deploys changes</li> </ol>"},{"location":"GITHUB_PAGES_SETUP/#testing-locally","title":"Testing Locally","text":"<p>See <code>docs/README.md</code> for local development instructions.</p>"},{"location":"GITHUB_PAGES_SETUP/#adding-new-pages","title":"Adding New Pages","text":"<ol> <li>Create <code>.md</code> file in appropriate directory</li> <li>Add YAML front matter: <pre><code>---\nlayout: default\ntitle: Page Title\nparent: Parent Page\nnav_order: 1\n---\n</code></pre></li> <li>Commit and push</li> </ol>"},{"location":"GITHUB_PAGES_SETUP/#configuration-files","title":"Configuration Files","text":""},{"location":"GITHUB_PAGES_SETUP/#_configyml","title":"<code>_config.yml</code>","text":"<p>Main Jekyll configuration: - Site metadata - Theme settings - Navigation - Search configuration</p>"},{"location":"GITHUB_PAGES_SETUP/#gemfile","title":"<code>Gemfile</code>","text":"<p>Ruby dependencies: - <code>github-pages</code> gem - <code>just-the-docs</code> theme - Jekyll plugins</p>"},{"location":"GITHUB_PAGES_SETUP/#githubworkflowsdocsyml","title":"<code>.github/workflows/docs.yml</code>","text":"<p>GitHub Actions workflow for automated deployment.</p>"},{"location":"GITHUB_PAGES_SETUP/#resources","title":"Resources","text":"<ul> <li>GitHub Pages Documentation</li> <li>Jekyll Documentation</li> <li>Just the Docs Theme</li> </ul>"},{"location":"GITHUB_PAGES_SETUP/#support","title":"Support","text":"<p>For issues with: - Jekyll/Theme: Check Just the Docs issues - GitHub Pages: Check GitHub Pages status - This documentation: Open an issue in this repository</p>"},{"location":"SOLID/","title":"Architecture Hexagonale &amp; Principes SOLID","text":"<p>Ce document explique en d\u00e9tail comment l'architecture hexagonale respecte les principes SOLID, ses avantages par rapport \u00e0 une architecture en couches traditionnelle, et les risques d'une mauvaise architecture.</p>"},{"location":"SOLID/#table-des-matieres","title":"Table des mati\u00e8res","text":"<ol> <li>Les Principes SOLID</li> <li>Architecture Hexagonale vs Architecture en Couches</li> <li>Comment l'Hexagonal Respecte SOLID</li> <li>Les Risques d'une Mauvaise Architecture</li> <li>Cas Concrets et Exemples</li> </ol>"},{"location":"SOLID/#1-les-principes-solid","title":"1. Les Principes SOLID","text":""},{"location":"SOLID/#11-single-responsibility-principle-srp","title":"1.1 Single Responsibility Principle (SRP)","text":"<p>\"Une classe ne devrait avoir qu'une seule raison de changer\"</p>"},{"location":"SOLID/#violation-architecture-traditionnelle","title":"Violation (Architecture traditionnelle)","text":"<pre><code>class UserController\n{\n    public function register(Request $request): Response\n    {\n        // 1. Validation\n        if (!filter_var($request-&gt;get('email'), FILTER_VALIDATE_EMAIL)) {\n            throw new Exception('Invalid email');\n        }\n\n        // 2. Logique m\u00e9tier\n        $user = new User();\n        $user-&gt;setEmail($request-&gt;get('email'));\n        $user-&gt;setPassword(password_hash($request-&gt;get('password'), PASSWORD_BCRYPT));\n\n        // 3. Persistance\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n\n        // 4. Envoi email\n        $this-&gt;mailer-&gt;send(new WelcomeEmail($user));\n\n        return new JsonResponse(['status' =&gt; 'ok']);\n    }\n}\n</code></pre> <p>Probl\u00e8mes: - Le contr\u00f4leur a 4 responsabilit\u00e9s diff\u00e9rentes - Si la validation change \u2192 modification du contr\u00f4leur - Si la base de donn\u00e9es change \u2192 modification du contr\u00f4leur - Si l'email change \u2192 modification du contr\u00f4leur - Impossible \u00e0 tester unitairement</p>"},{"location":"SOLID/#avec-architecture-hexagonale","title":"Avec Architecture Hexagonale","text":"<pre><code>// Controller (UI Layer) - Responsabilit\u00e9: Traduire HTTP en Command\nclass UserController\n{\n    public function register(Request $request): Response\n    {\n        $command = new RegisterCommand(\n            email: $request-&gt;get('email'),\n            password: $request-&gt;get('password')\n        );\n\n        $this-&gt;commandBus-&gt;dispatch($command);\n\n        return new JsonResponse(['status' =&gt; 'ok']);\n    }\n}\n\n// Command Handler (Application Layer) - Responsabilit\u00e9: Orchestrer\n#[AsMessageHandler]\nclass RegisterCommandHandler\n{\n    public function __invoke(RegisterCommand $command): void\n    {\n        $user = $this-&gt;factory-&gt;create($command);\n        $this-&gt;repository-&gt;save($user);\n        $this-&gt;eventDispatcher-&gt;dispatch(new UserRegistered($user));\n    }\n}\n\n// Entity (Domain Layer) - Responsabilit\u00e9: Logique m\u00e9tier\nclass User\n{\n    public function __construct(\n        private Email $email,    // Value Object avec validation\n        private HashedPassword $password\n    ) {}\n}\n\n// Repository Adapter (Infrastructure) - Responsabilit\u00e9: Persistance\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n    }\n}\n</code></pre> <p>Avantages: - Chaque classe a UNE SEULE responsabilit\u00e9 - Facile \u00e0 tester ind\u00e9pendamment - Changement isol\u00e9 \u00e0 un seul endroit</p>"},{"location":"SOLID/#12-openclosed-principle-ocp","title":"1.2 Open/Closed Principle (OCP)","text":"<p>\"Ouvert \u00e0 l'extension, ferm\u00e9 \u00e0 la modification\"</p>"},{"location":"SOLID/#violation","title":"Violation","text":"<pre><code>class NotificationService\n{\n    public function send(User $user, string $type): void\n    {\n        if ($type === 'email') {\n            // Logique email\n            $this-&gt;mailer-&gt;send(...);\n        } elseif ($type === 'sms') {\n            // Logique SMS\n            $this-&gt;smsClient-&gt;send(...);\n        } elseif ($type === 'push') {\n            // Logique Push\n            $this-&gt;pushService-&gt;send(...);\n        }\n        // Si on ajoute Slack, il faut MODIFIER cette classe !\n    }\n}\n</code></pre> <p>Probl\u00e8me: Pour ajouter un nouveau canal, on doit modifier le code existant.</p>"},{"location":"SOLID/#avec-architecture-hexagonale-ports-adapters","title":"Avec Architecture Hexagonale (Ports &amp; Adapters)","text":"<pre><code>// Port (Domain) - Interface stable\ninterface NotificationSenderInterface\n{\n    public function send(Notification $notification): void;\n    public function supports(NotificationChannel $channel): bool;\n}\n\n// Adapter 1 - Email\nclass EmailNotificationSender implements NotificationSenderInterface\n{\n    public function send(Notification $notification): void\n    {\n        $this-&gt;mailer-&gt;send(...);\n    }\n\n    public function supports(NotificationChannel $channel): bool\n    {\n        return $channel === NotificationChannel::EMAIL;\n    }\n}\n\n// Adapter 2 - SMS\nclass SmsNotificationSender implements NotificationSenderInterface\n{\n    public function send(Notification $notification): void\n    {\n        $this-&gt;smsClient-&gt;send(...);\n    }\n\n    public function supports(NotificationChannel $channel): bool\n    {\n        return $channel === NotificationChannel::SMS;\n    }\n}\n\n// Adapter 3 - Slack (NOUVEAU - sans modifier le code existant!)\nclass SlackNotificationSender implements NotificationSenderInterface\n{\n    public function send(Notification $notification): void\n    {\n        $this-&gt;slackClient-&gt;send(...);\n    }\n\n    public function supports(NotificationChannel $channel): bool\n    {\n        return $channel === NotificationChannel::SLACK;\n    }\n}\n\n// Application Layer - Utilise les adapters\nclass SendNotificationHandler\n{\n    /** @param NotificationSenderInterface[] $senders */\n    public function __construct(private iterable $senders) {}\n\n    public function __invoke(SendNotificationCommand $cmd): void\n    {\n        foreach ($this-&gt;senders as $sender) {\n            if ($sender-&gt;supports($cmd-&gt;channel)) {\n                $sender-&gt;send($notification);\n                return;\n            }\n        }\n    }\n}\n</code></pre> <p>Avantages: - Ajouter Slack = cr\u00e9er une nouvelle classe, aucune modification du code existant - Chaque adapter est ind\u00e9pendant - Pas de risque de r\u00e9gression</p>"},{"location":"SOLID/#13-liskov-substitution-principle-lsp","title":"1.3 Liskov Substitution Principle (LSP)","text":"<p>\"Les objets doivent pouvoir \u00eatre remplac\u00e9s par des instances de leurs sous-types sans alt\u00e9rer le comportement\"</p>"},{"location":"SOLID/#avec-architecture-hexagonale_1","title":"Avec Architecture Hexagonale","text":"<pre><code>// Port (contrat stable)\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n}\n\n// Adapter 1 - Production (Doctrine)\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n    }\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;em-&gt;find(User::class, $id-&gt;value);\n    }\n}\n\n// Adapter 2 - Tests (In Memory)\nclass InMemoryUserRepository implements UserRepositoryInterface\n{\n    private array $users = [];\n\n    public function save(User $user): void\n    {\n        $this-&gt;users[$user-&gt;getId()-&gt;value] = $user;\n    }\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;users[$id-&gt;value] ?? null;\n    }\n}\n\n// Adapter 3 - Cache\nclass CachedUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private UserRepositoryInterface $decorated,\n        private CacheInterface $cache\n    ) {}\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;cache-&gt;get(\n            'user_' . $id-&gt;value,\n            fn() =&gt; $this-&gt;decorated-&gt;findById($id)\n        );\n    }\n\n    public function save(User $user): void\n    {\n        $this-&gt;decorated-&gt;save($user);\n        $this-&gt;cache-&gt;delete('user_' . $user-&gt;getId()-&gt;value);\n    }\n}\n\n// Application - Fonctionne avec N'IMPORTE quel adapter\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $repository // Peut \u00eatre n'importe quelle impl\u00e9mentation\n    ) {}\n\n    public function __invoke(RegisterCommand $cmd): void\n    {\n        $user = new User(...);\n        $this-&gt;repository-&gt;save($user); // Fonctionne avec les 3 adapters !\n    }\n}\n</code></pre> <p>Avantages: - Interchangeabilit\u00e9 totale des adapters - Tests avec <code>InMemoryUserRepository</code> (rapide, pas de DB) - Production avec <code>DoctrineUserRepository</code> - Cache transparent avec <code>CachedUserRepository</code> - Le handler ne sait pas et ne doit pas savoir quel adapter est utilis\u00e9</p>"},{"location":"SOLID/#14-interface-segregation-principle-isp","title":"1.4 Interface Segregation Principle (ISP)","text":"<p>\"Ne pas forcer un client \u00e0 d\u00e9pendre d'interfaces qu'il n'utilise pas\"</p>"},{"location":"SOLID/#violation_1","title":"Violation","text":"<pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(int $id): ?User;\n    public function findAll(): array;\n    public function search(array $criteria): array;\n    public function count(): int;\n    public function export(string $format): string;\n    public function import(string $data): void;\n    public function backup(): void;\n    public function restore(string $backup): void;\n}\n\n// Un handler qui veut juste sauvegarder doit d\u00e9pendre de 9 m\u00e9thodes !\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $repository // Trop de m\u00e9thodes inutiles\n    ) {}\n\n    public function __invoke(RegisterCommand $cmd): void\n    {\n        $user = new User(...);\n        $this-&gt;repository-&gt;save($user); // Utilise seulement 1/9 des m\u00e9thodes\n    }\n}\n</code></pre>"},{"location":"SOLID/#avec-architecture-hexagonale-ports-specialises","title":"Avec Architecture Hexagonale (Ports sp\u00e9cialis\u00e9s)","text":"<pre><code>// Port 1 - Pour l'\u00e9criture\ninterface UserWriterInterface\n{\n    public function save(User $user): void;\n}\n\n// Port 2 - Pour la lecture simple\ninterface UserReaderInterface\n{\n    public function findById(UserId $id): ?User;\n}\n\n// Port 3 - Pour la recherche\ninterface UserSearchInterface\n{\n    public function search(UserSearchCriteria $criteria): array;\n}\n\n// Handlers utilisent UNIQUEMENT ce dont ils ont besoin\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserWriterInterface $writer // Seulement 1 m\u00e9thode\n    ) {}\n}\n\nclass FindUserHandler\n{\n    public function __construct(\n        private UserReaderInterface $reader // Seulement 1 m\u00e9thode\n    ) {}\n}\n\nclass SearchUsersHandler\n{\n    public function __construct(\n        private UserSearchInterface $searcher // M\u00e9thodes de recherche uniquement\n    ) {}\n}\n\n// Un adapter peut impl\u00e9menter plusieurs ports\nclass DoctrineUserRepository implements\n    UserWriterInterface,\n    UserReaderInterface,\n    UserSearchInterface\n{\n    public function save(User $user): void { ... }\n    public function findById(UserId $id): ?User { ... }\n    public function search(UserSearchCriteria $criteria): array { ... }\n}\n</code></pre> <p>Avantages: - Chaque handler d\u00e9pend uniquement de ce qu'il utilise - Interfaces petites et coh\u00e9rentes - Facile \u00e0 mocker pour les tests</p>"},{"location":"SOLID/#15-dependency-inversion-principle-dip","title":"1.5 Dependency Inversion Principle (DIP)","text":"<p>\"D\u00e9pendre d'abstractions, pas d'impl\u00e9mentations concr\u00e8tes\"</p> <p>C'est le principe central de l'architecture hexagonale !</p>"},{"location":"SOLID/#violation-1-dependance-a-des-classes-concretes","title":"Violation 1 - D\u00e9pendance \u00e0 des classes concr\u00e8tes","text":"<pre><code>// Violation DIRECTE du DIP - D\u00e9pend de classes concr\u00e8tes\nclass RegisterUserService\n{\n    public function __construct(\n        private EntityManager $em,              // Classe concr\u00e8te Doctrine\n        private Mailer $mailer,                 // Classe concr\u00e8te Symfony\n        private FileLogger $logger              // Classe concr\u00e8te\n    ) {}\n\n    public function register(string $email, string $password): void\n    {\n        $user = new User();\n        $user-&gt;setEmail($email);\n\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n\n        $this-&gt;mailer-&gt;send(...);\n    }\n}\n</code></pre> <p>Probl\u00e8mes: - D\u00e9pend de classes concr\u00e8tes au lieu d'abstractions - Impossible de mocker pour les tests - Impossible de changer l'impl\u00e9mentation</p>"},{"location":"SOLID/#violation-2-abstractions-definies-par-linfrastructure-plus-subtil","title":"Violation 2 - Abstractions d\u00e9finies par l'infrastructure (plus subtil)","text":"<pre><code>// Violation ARCHITECTURALE du DIP - Utilise des interfaces,\n// MAIS d\u00e9finies par l'infrastructure, pas par le Domain\nclass RegisterUserService\n{\n    public function __construct(\n        private EntityManagerInterface $em,        // Interface d\u00e9finie par Doctrine\n        private MailerInterface $mailer,           // Interface d\u00e9finie par Symfony\n        private LoggerInterface $logger            // Interface d\u00e9finie par PSR\n    ) {}\n\n    public function register(string $email, string $password): void\n    {\n        $user = new User();\n        $user-&gt;setEmail($email);\n\n        $this-&gt;em-&gt;persist($user);   // API Doctrine (persist/flush)\n        $this-&gt;em-&gt;flush();\n\n        $this-&gt;mailer-&gt;send(...);    // API Symfony Mailer\n    }\n}\n</code></pre> <p>Probl\u00e8me subtil mais critique: - Bon point: Utilise des interfaces (mieux que des classes concr\u00e8tes) - MAIS: Ces interfaces sont d\u00e9finies par l'infrastructure (Doctrine/Symfony), pas par votre Domain - Votre Application d\u00e9pend de l'infrastructure pour conna\u00eetre les contrats - Direction de d\u00e9pendance incorrecte: Application \u2192 Infrastructure - L'Application utilise le vocabulaire technique de Doctrine (<code>persist()</code>, <code>flush()</code>) au lieu du vocabulaire m\u00e9tier (<code>save()</code>) - Changer de Doctrine \u00e0 autre chose n\u00e9cessite de modifier tout le code qui utilise <code>persist()/flush()</code></p> <p>Pourquoi c'est une violation du DIP: <pre><code>\ud83d\udce6 Domain/Application (haut niveau)\n        \u2193 d\u00e9pend de\n\ud83d\udd0c Infrastructure (bas niveau)\n</code></pre></p> <p>Le DIP dit: Les modules de haut niveau ne doivent PAS d\u00e9pendre des modules de bas niveau. Les deux doivent d\u00e9pendre d'abstractions.</p> <p>Ici, votre Application (haut niveau) d\u00e9pend de Doctrine/Symfony (bas niveau) pour d\u00e9finir les contrats.</p>"},{"location":"SOLID/#avec-architecture-hexagonale-dip-correct","title":"Avec Architecture Hexagonale (DIP Correct)","text":"<pre><code>// 1\ufe0f\u20e3 Domain Layer - D\u00c9FINIT ses propres abstractions (PORTS)\nnamespace App\\User\\Domain\\Port;\n\ninterface UserRepositoryInterface  // Interface d\u00e9finie par le DOMAIN\n{\n    public function save(User $user): void;           // Vocabulaire m\u00e9tier\n    public function ofId(UserId $id): ?User;          // Vocabulaire m\u00e9tier\n}\n\ninterface EmailSenderInterface     // Interface d\u00e9finie par le DOMAIN\n{\n    public function sendWelcomeEmail(User $user): void;  // Vocabulaire m\u00e9tier\n}\n\n// 2\ufe0f\u20e3 Application Layer - D\u00e9pend UNIQUEMENT des abstractions du Domain\nnamespace App\\User\\Application;\n\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $repository,  // Port du Domain\n        private EmailSenderInterface $emailSender     // Port du Domain\n    ) {}\n\n    public function __invoke(RegisterCommand $cmd): void\n    {\n        $user = User::register(\n            new Email($cmd-&gt;email),\n            HashedPassword::fromPlain($cmd-&gt;password)\n        );\n\n        $this-&gt;repository-&gt;save($user);              // Vocabulaire m\u00e9tier\n        $this-&gt;emailSender-&gt;sendWelcomeEmail($user); // Vocabulaire m\u00e9tier\n    }\n}\n\n// 3\ufe0f\u20e3 Infrastructure Layer - IMPL\u00c9MENTE les abstractions du Domain\nnamespace App\\User\\Infrastructure\\Persistence;\n\nclass DoctrineUserRepository implements UserRepositoryInterface  // Impl\u00e9mente le port\n{\n    public function __construct(\n        private EntityManagerInterface $em  // Doctrine utilis\u00e9 ICI seulement\n    ) {}\n\n    public function save(User $user): void\n    {\n        $this-&gt;em-&gt;persist($user);   // D\u00e9tails techniques cach\u00e9s ici\n        $this-&gt;em-&gt;flush();\n    }\n\n    public function ofId(UserId $id): ?User\n    {\n        return $this-&gt;em-&gt;find(User::class, $id-&gt;value());\n    }\n}\n\nnamespace App\\User\\Infrastructure\\Messaging;\n\nclass SymfonyEmailSender implements EmailSenderInterface  // Impl\u00e9mente le port\n{\n    public function __construct(\n        private MailerInterface $mailer  // Symfony Mailer utilis\u00e9 ICI seulement\n    ) {}\n\n    public function sendWelcomeEmail(User $user): void\n    {\n        $email = (new Email())\n            -&gt;to($user-&gt;email()-&gt;value())\n            -&gt;subject('Welcome!')\n            -&gt;html('...');\n\n        $this-&gt;mailer-&gt;send($email);  // D\u00e9tails techniques cach\u00e9s ici\n    }\n}\n</code></pre> <p>Direction des d\u00e9pendances (CORRECTE): <pre><code>\ud83d\udd0c Infrastructure (DoctrineUserRepository, SymfonyEmailSender)\n        \u2193 implements\n\ud83d\udd17 Domain Ports (UserRepositoryInterface, EmailSenderInterface)\n        \u2191 uses\n\u2699\ufe0f Application (RegisterUserHandler)\n        \u2191 uses\n\ud83d\udc8e Domain (User, Email, HashedPassword)\n</code></pre></p> <p>Tous les modules d\u00e9pendent du Domain, pas l'inverse !</p> <p>Flux de d\u00e9pendances:</p> <pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'15px'}}}%%\ngraph BT\n    Infra[\"\ud83d\udd0c Infrastructure Adapters&lt;br/&gt;&lt;small&gt;DoctrineUserRepository&lt;/small&gt;\"]\n    Port[\"\ud83d\udd17 Domain Ports&lt;br/&gt;&lt;small&gt;UserRepositoryInterface&lt;/small&gt;\"]\n    App[\"\u2699\ufe0f Application&lt;br/&gt;&lt;small&gt;RegisterUserHandler&lt;/small&gt;\"]\n\n    Infra -.-&gt;|\"\ud83c\udfaf implements\"| Port\n    App ==&gt;|\"uses\"| Port\n\n    style Port fill:#FFF9C4,stroke:#F57F17,stroke-width:3px,color:#000\n    style App fill:#B3E5FC,stroke:#0277BD,stroke-width:3px,color:#000\n    style Infra fill:#F8BBD0,stroke:#C2185B,stroke-width:3px,color:#000</code></pre> <p>L'Infrastructure d\u00e9pend du Domain, PAS l'inverse !</p> <p>Avantages: - Le Domain ne d\u00e9pend de RIEN (z\u00e9ro d\u00e9pendance externe) - L'Application d\u00e9pend uniquement du Domain (pas de l'infrastructure) - L'Infrastructure d\u00e9pend du Domain et impl\u00e9mente ses ports - Les interfaces sont d\u00e9finies par le Domain (votre m\u00e9tier), pas par Doctrine/Symfony - Le code utilise le vocabulaire m\u00e9tier (<code>save()</code>, <code>ofId()</code>) au lieu du vocabulaire technique (<code>persist()</code>, <code>flush()</code>) - Changement d'infrastructure = cr\u00e9er un nouvel adapter, z\u00e9ro modification du Domain/Application</p> <p>Comparaison concr\u00e8te:</p> Aspect Violation DIP Hexagonal (DIP Correct) Qui d\u00e9finit l'interface? Doctrine/Symfony Votre Domain Direction d\u00e9pendance App \u2192 Infrastructure Infrastructure \u2192 Domain Vocabulaire utilis\u00e9 Technique (<code>persist</code>, <code>flush</code>) M\u00e9tier (<code>save</code>, <code>ofId</code>) Changer Doctrine Modifier tout le code Cr\u00e9er nouvel adapter Tests D\u00e9pend de Doctrine In-memory (rapide) Framework upgrade Casse l'application Modifier adapters seulement"},{"location":"SOLID/#2-architecture-hexagonale-vs-architecture-en-couches","title":"2. Architecture Hexagonale vs Architecture en Couches","text":""},{"location":"SOLID/#architecture-en-couches-traditionnelle-layered","title":"Architecture en Couches Traditionnelle (Layered)","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'15px'}}}%%\ngraph TD\n    Presentation[\"\ud83c\udfae Presentation Layer&lt;br/&gt;&lt;small&gt;Controllers&lt;/small&gt;\"]\n    Business[\"\u2699\ufe0f Business Layer&lt;br/&gt;&lt;small&gt;Services&lt;/small&gt;\"]\n    DataAccess[\"\ud83d\uddc4\ufe0f Data Access Layer&lt;br/&gt;&lt;small&gt;Repositories, ORM&lt;/small&gt;\"]\n    Database[\"\ud83d\udcbe Database\"]\n\n    Presentation ==&gt;|\"\ud83c\udf2a\ufe0f depends on\"| Business\n    Business ==&gt;|\"\ud83c\udf2a\ufe0f depends on\"| DataAccess\n    DataAccess ==&gt;|\"\ud83c\udf2a\ufe0f depends on\"| Database\n\n    style Presentation fill:#E1BEE7,stroke:#6A1B9A,stroke-width:3px,color:#000\n    style Business fill:#FFF9C4,stroke:#F57C00,stroke-width:3px,color:#000\n    style DataAccess fill:#FFCCBC,stroke:#D84315,stroke-width:3px,color:#000\n    style Database fill:#FFCDD2,stroke:#C62828,stroke-width:4px,color:#000</code></pre>"},{"location":"SOLID/#211-problemes-de-larchitecture-en-couches","title":"2.1.1 Probl\u00e8mes de l'Architecture en Couches","text":"<p>1. D\u00e9pendance vers le bas (Database Centric) <pre><code>// Business Layer d\u00e9pend de la Data Layer\nclass UserService\n{\n    public function __construct(\n        private EntityManagerInterface $em  // Coupl\u00e9 \u00e0 Doctrine\n    ) {}\n\n    public function registerUser(string $email): void\n    {\n        $user = new User();  // Entity Doctrine avec annotations\n        $user-&gt;setEmail($email);\n\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n    }\n}\n</code></pre></p> <p>Cons\u00e9quences: - Impossible de tester sans base de donn\u00e9es - Changement de base de donn\u00e9es = r\u00e9\u00e9criture du Business Layer - La logique m\u00e9tier est coupl\u00e9e \u00e0 la technologie de persistance - Les Entities contiennent des annotations Doctrine (pas de Domain pur)</p> <p>2. Logique m\u00e9tier dilu\u00e9e <pre><code>// Entity avec annotations Doctrine - PAS un vrai Domain Model\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[ORM\\Table(name: 'users')]\nclass User\n{\n    #[ORM\\Id]\n    #[ORM\\GeneratedValue]\n    #[ORM\\Column(type: 'integer')]\n    private int $id;\n\n    #[ORM\\Column(type: 'string')]\n    private string $email;\n\n    // Getters/Setters - PAS de logique m\u00e9tier\n    public function setEmail(string $email): void\n    {\n        $this-&gt;email = $email;  // Pas de validation\n    }\n}\n\n// Service contient toute la logique\nclass UserService\n{\n    public function registerUser(string $email): void\n    {\n        // Validation dans le service (devrait \u00eatre dans le domain)\n        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n            throw new Exception('Invalid email');\n        }\n\n        $user = new User();\n        $user-&gt;setEmail($email);  // Entity = simple conteneur de donn\u00e9es\n\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n    }\n}\n</code></pre></p> <p>Cons\u00e9quences: - Entity = conteneur de donn\u00e9es sans logique (Anemic Domain Model) - Logique m\u00e9tier \u00e9parpill\u00e9e dans les Services - Difficile de comprendre les r\u00e8gles m\u00e9tier - Duplication de la validation dans plusieurs services</p> <p>3. Difficile \u00e0 tester <pre><code>class UserServiceTest extends TestCase\n{\n    public function testRegisterUser(): void\n    {\n        // Besoin d'une vraie base de donn\u00e9es\n        $entityManager = $this-&gt;createEntityManager();\n\n        // Besoin de fixtures\n        $this-&gt;loadFixtures();\n\n        $service = new UserService($entityManager);\n        $service-&gt;registerUser('test@example.com');\n\n        // Test lent (I/O database)\n        $user = $entityManager-&gt;find(User::class, 1);\n        $this-&gt;assertEquals('test@example.com', $user-&gt;getEmail());\n    }\n}\n</code></pre></p>"},{"location":"SOLID/#architecture-hexagonale-ports-adapters","title":"Architecture Hexagonale (Ports &amp; Adapters)","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph TB\n    subgraph UI[\"\ud83c\udfae UI - Primary Adapters\"]\n        HTTP[\"\ud83c\udf10 HTTP Controllers\"]\n        CLI[\"\u2328\ufe0f CLI Commands\"]\n        GraphQL[\"\ud83d\udcca GraphQL API\"]\n        gRPC[\"\ud83d\udd04 gRPC Service\"]\n    end\n\n    subgraph APP[\"\u2699\ufe0f Application Layer\"]\n        UseCases[\"\ud83d\udce8 Use Cases&lt;br/&gt;&lt;small&gt;Command Handlers&lt;br/&gt;Query Handlers&lt;/small&gt;\"]\n    end\n\n    subgraph DOMAIN[\"\ud83d\udc8e Domain Layer - CORE\"]\n        Entities[\"\ud83d\udce6 Entities\"]\n        VOs[\"\ud83c\udfaf Value Objects\"]\n        Ports[\"\ud83d\udd17 Ports&lt;br/&gt;&lt;small&gt;Interfaces&lt;/small&gt;\"]\n    end\n\n    subgraph INFRA[\"\ud83d\udd0c Infrastructure - Secondary Adapters\"]\n        Doctrine[\"\ud83d\uddc4\ufe0f Doctrine ORM\"]\n        Redis[\"\u26a1 Redis Cache\"]\n        API[\"\ud83c\udf0d External APIs\"]\n    end\n\n    UI ==&gt;|\"uses\"| APP\n    APP ==&gt;|\"\ud83c\udfaf depends on\"| DOMAIN\n    INFRA -.-&gt;|\"\ud83c\udfaf implements\"| Ports\n\n    style DOMAIN fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px,color:#000\n    style APP fill:#B3E5FC,stroke:#0277BD,stroke-width:3px,color:#000\n    style UI fill:#E1BEE7,stroke:#6A1B9A,stroke-width:3px,color:#000\n    style INFRA fill:#F8BBD0,stroke:#C2185B,stroke-width:3px,color:#000</code></pre>"},{"location":"SOLID/#221-avantages-de-larchitecture-hexagonale","title":"2.2.1 Avantages de l'Architecture Hexagonale","text":"<p>1. Domain ind\u00e9pendant (Domain Centric) <pre><code>// Domain Layer - Pur PHP, AUCUNE d\u00e9pendance\nnamespace App\\User\\Domain\\Model;\n\nfinal class User\n{\n    public function __construct(\n        private UserId $id,\n        private Email $email,  // Value Object avec validation\n        private bool $isActive = false\n    ) {}\n\n    // Logique m\u00e9tier dans le domain\n    public function activate(): void\n    {\n        if ($this-&gt;isActive) {\n            throw new UserAlreadyActiveException();\n        }\n\n        $this-&gt;isActive = true;\n    }\n\n    public function changeEmail(Email $newEmail): void\n    {\n        // R\u00e8gle m\u00e9tier: email doit \u00eatre diff\u00e9rent\n        if ($this-&gt;email-&gt;equals($newEmail)) {\n            throw new SameEmailException();\n        }\n\n        $this-&gt;email = $newEmail;\n    }\n}\n\n// Value Object avec validation\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n    }\n\n    public function equals(self $other): bool\n    {\n        return $this-&gt;value === $other-&gt;value;\n    }\n}\n</code></pre></p> <p>Avantages: - Logique m\u00e9tier centralis\u00e9e dans le Domain - Z\u00e9ro d\u00e9pendance externe (pas d'annotations) - Validation encapsul\u00e9e dans les Value Objects - R\u00e8gles m\u00e9tier explicites et testables</p> <p>2. Testabilit\u00e9 <pre><code>// Test du Domain - Ultra rapide, aucune d\u00e9pendance\nclass UserTest extends TestCase\n{\n    public function testUserCanBeActivated(): void\n    {\n        $user = new User(\n            id: UserId::generate(),\n            email: new Email('test@example.com')\n        );\n\n        $user-&gt;activate();\n\n        $this-&gt;assertTrue($user-&gt;isActive());\n    }\n\n    public function testCannotActivateTwice(): void\n    {\n        $user = new User(\n            id: UserId::generate(),\n            email: new Email('test@example.com')\n        );\n\n        $user-&gt;activate();\n\n        $this-&gt;expectException(UserAlreadyActiveException::class);\n        $user-&gt;activate();  // Should throw\n    }\n}\n\n// Test du Handler avec In-Memory repository\nclass RegisterUserHandlerTest extends TestCase\n{\n    public function testUserIsRegistered(): void\n    {\n        $repository = new InMemoryUserRepository();  // Pas de DB\n        $handler = new RegisterUserHandler($repository);\n\n        $command = new RegisterCommand('test@example.com', 'password');\n        $handler($command);\n\n        $this-&gt;assertCount(1, $repository-&gt;all());\n    }\n}\n</code></pre></p> <p>Avantages: - Tests ultra-rapides (pas d'I/O) - Tests isol\u00e9s (pas de DB, pas de fixtures) - Tests du domain sans framework</p> <p>3. Flexibilit\u00e9 technologique <pre><code>// En d\u00e9veloppement: In-Memory\n$container-&gt;set(UserRepositoryInterface::class, InMemoryUserRepository::class);\n\n// En production: Doctrine\n$container-&gt;set(UserRepositoryInterface::class, DoctrineUserRepository::class);\n\n// En production avec cache: Decorator\n$container-&gt;set(UserRepositoryInterface::class, CachedUserRepository::class);\n</code></pre></p> <p>Avantages: - Changement de technologie sans toucher au code m\u00e9tier - Plusieurs impl\u00e9mentations possibles - Stack technology evolutive</p>"},{"location":"SOLID/#3-les-risques-dune-mauvaise-architecture","title":"3. Les Risques d'une Mauvaise Architecture","text":""},{"location":"SOLID/#1-le-modele-anemique-anemic-domain-model","title":"1. Le Mod\u00e8le An\u00e9mique (Anemic Domain Model)","text":""},{"location":"SOLID/#311-anti-pattern","title":"3.1.1 Anti-pattern","text":"<pre><code>// Entity = simple conteneur de donn\u00e9es\nclass Order\n{\n    private int $id;\n    private string $status;\n    private float $total;\n\n    // Getters/Setters uniquement\n    public function setStatus(string $status): void\n    {\n        $this-&gt;status = $status;  // Aucune validation\n    }\n\n    public function setTotal(float $total): void\n    {\n        $this-&gt;total = $total;  // Peut \u00eatre n\u00e9gatif\n    }\n}\n\n// Service contient toute la logique\nclass OrderService\n{\n    public function placeOrder(Order $order): void\n    {\n        // Validation \u00e9parpill\u00e9e dans le service\n        if ($order-&gt;getTotal() &lt; 0) {\n            throw new Exception('Invalid total');\n        }\n\n        $order-&gt;setStatus('confirmed');  // String magic\n\n        $this-&gt;em-&gt;persist($order);\n        $this-&gt;em-&gt;flush();\n    }\n\n    public function cancelOrder(Order $order): void\n    {\n        // Duplication de la logique de validation\n        if ($order-&gt;getStatus() === 'shipped') {\n            throw new Exception('Cannot cancel shipped order');\n        }\n\n        $order-&gt;setStatus('cancelled');\n\n        $this-&gt;em-&gt;flush();\n    }\n}\n</code></pre> <p>Risques: - Duplication de la logique dans plusieurs services - Incoh\u00e9rence (diff\u00e9rents services peuvent avoir des r\u00e8gles diff\u00e9rentes) - Bugs difficiles \u00e0 trouver (pas de validation centralis\u00e9e) - Maintenance cauchemardesque (logique \u00e9parpill\u00e9e)</p>"},{"location":"SOLID/#312-rich-domain-model-hexagonal","title":"3.1.2 Rich Domain Model (Hexagonal)","text":"<pre><code>enum OrderStatus: string\n{\n    case PENDING = 'pending';\n    case CONFIRMED = 'confirmed';\n    case SHIPPED = 'shipped';\n    case CANCELLED = 'cancelled';\n}\n\nfinal class Order\n{\n    public function __construct(\n        private OrderId $id,\n        private Money $total,\n        private OrderStatus $status = OrderStatus::PENDING\n    ) {\n        if ($total-&gt;amount &lt;= 0) {\n            throw new InvalidOrderTotalException();\n        }\n    }\n\n    // Logique m\u00e9tier encapsul\u00e9e\n    public function confirm(): void\n    {\n        if ($this-&gt;status !== OrderStatus::PENDING) {\n            throw new OrderCannotBeConfirmedException($this-&gt;status);\n        }\n\n        $this-&gt;status = OrderStatus::CONFIRMED;\n    }\n\n    public function cancel(): void\n    {\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new ShippedOrderCannotBeCancelledException();\n        }\n\n        $this-&gt;status = OrderStatus::CANCELLED;\n    }\n\n    public function ship(): void\n    {\n        if ($this-&gt;status !== OrderStatus::CONFIRMED) {\n            throw new OrderMustBeConfirmedBeforeShippingException();\n        }\n\n        $this-&gt;status = OrderStatus::SHIPPED;\n    }\n}\n\n// Handler = simple orchestration\nclass ConfirmOrderHandler\n{\n    public function __invoke(ConfirmOrderCommand $cmd): void\n    {\n        $order = $this-&gt;repository-&gt;findById($cmd-&gt;orderId);\n        $order-&gt;confirm();  // Logique dans le domain\n        $this-&gt;repository-&gt;save($order);\n    }\n}\n</code></pre> <p>Avantages: - Logique centralis\u00e9e dans l'entity - Impossible de mettre l'objet dans un \u00e9tat invalide - Type-safe (enum au lieu de string) - R\u00e8gles m\u00e9tier explicites</p>"},{"location":"SOLID/#2-le-couplage-fort-tight-coupling","title":"2. Le Couplage Fort (Tight Coupling)","text":""},{"location":"SOLID/#321-couplage-fort","title":"3.2.1 Couplage fort","text":"<pre><code>class UserService\n{\n    public function __construct(\n        private EntityManagerInterface $em,\n        private Swift_Mailer $mailer,  // Coupl\u00e9 \u00e0 SwiftMailer\n        private MonologLogger $logger   // Coupl\u00e9 \u00e0 Monolog\n    ) {}\n\n    public function register(string $email): void\n    {\n        $user = new User();\n        $user-&gt;setEmail($email);\n\n        $this-&gt;em-&gt;persist($user);\n        $this-&gt;em-&gt;flush();\n\n        // Si on veut changer de mailer, il faut modifier tout \u00e7a\n        $message = (new Swift_Message('Welcome'))\n            -&gt;setTo($email)\n            -&gt;setBody('Welcome!');\n\n        $this-&gt;mailer-&gt;send($message);\n    }\n}\n</code></pre> <p>Risques: - Impossible de changer SwiftMailer sans r\u00e9\u00e9crire le code - Tests difficiles (besoin de vraies d\u00e9pendances) - Migration framework impossible (couplage fort)</p>"},{"location":"SOLID/#322-faible-couplage-hexagonal","title":"3.2.2 Faible couplage (Hexagonal)","text":"<pre><code>// Port\ninterface EmailSenderInterface\n{\n    public function send(Email $email): void;\n}\n\n// Domain\nfinal readonly class WelcomeEmail\n{\n    public function __construct(\n        public string $to,\n        public string $subject,\n        public string $body\n    ) {}\n}\n\n// Handler\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $repository,\n        private EmailSenderInterface $emailSender  // Abstraction\n    ) {}\n\n    public function __invoke(RegisterCommand $cmd): void\n    {\n        $user = new User(...);\n        $this-&gt;repository-&gt;save($user);\n\n        $email = new WelcomeEmail(\n            to: $user-&gt;getEmail()-&gt;value,\n            subject: 'Welcome',\n            body: 'Welcome to our platform!'\n        );\n\n        $this-&gt;emailSender-&gt;send($email);  // Ne sait pas comment\n    }\n}\n\n// Adapter 1 - SwiftMailer\nclass SwiftMailerAdapter implements EmailSenderInterface\n{\n    public function send(Email $email): void\n    {\n        $message = (new Swift_Message($email-&gt;subject))\n            -&gt;setTo($email-&gt;to)\n            -&gt;setBody($email-&gt;body);\n\n        $this-&gt;mailer-&gt;send($message);\n    }\n}\n\n// Adapter 2 - Symfony Mailer (migration facile!)\nclass SymfonyMailerAdapter implements EmailSenderInterface\n{\n    public function send(Email $email): void\n    {\n        $message = (new Email())\n            -&gt;to($email-&gt;to)\n            -&gt;subject($email-&gt;subject)\n            -&gt;text($email-&gt;body);\n\n        $this-&gt;mailer-&gt;send($message);\n    }\n}\n</code></pre> <p>Avantages: - Migration SwiftMailer \u2192 Symfony Mailer sans toucher au handler - Tests avec <code>FakeEmailSender</code> - Peut avoir plusieurs adapters (email + SMS)</p>"},{"location":"SOLID/#3-le-big-ball-of-mud","title":"3. Le Big Ball of Mud","text":""},{"location":"SOLID/#331-sans-architecture","title":"3.3.1 Sans architecture","text":"<pre><code>// Tout est m\u00e9lang\u00e9 dans le controller\nclass OrderController\n{\n    public function create(Request $request): Response\n    {\n        // Validation\n        if (empty($request-&gt;get('items'))) {\n            return new JsonResponse(['error' =&gt; 'No items'], 400);\n        }\n\n        // Calcul m\u00e9tier\n        $total = 0;\n        foreach ($request-&gt;get('items') as $item) {\n            $product = $this-&gt;em-&gt;find(Product::class, $item['id']);\n            $total += $product-&gt;getPrice() * $item['quantity'];\n        }\n\n        // Cr\u00e9ation\n        $order = new Order();\n        $order-&gt;setTotal($total);\n        $order-&gt;setStatus('pending');\n\n        // Persistance\n        $this-&gt;em-&gt;persist($order);\n        $this-&gt;em-&gt;flush();\n\n        // Email\n        $this-&gt;mailer-&gt;send(...);\n\n        // Log\n        $this-&gt;logger-&gt;info('Order created: ' . $order-&gt;getId());\n\n        // Envoi \u00e9v\u00e9nement\n        $this-&gt;eventBus-&gt;dispatch(new OrderCreated($order));\n\n        return new JsonResponse(['id' =&gt; $order-&gt;getId()]);\n    }\n}\n</code></pre> <p>Risques: - Impossible \u00e0 tester (trop de d\u00e9pendances) - Impossible \u00e0 maintenir (tout est m\u00e9lang\u00e9) - Impossible \u00e0 r\u00e9utiliser (coupl\u00e9 au HTTP) - Impossible d'ajouter une API GraphQL (logique dans le controller)</p>"},{"location":"SOLID/#332-avec-hexagonal","title":"3.3.2 Avec Hexagonal","text":"<pre><code>// Controller = adapter HTTP\nclass OrderController\n{\n    public function create(Request $request): Response\n    {\n        $command = new CreateOrderCommand(\n            items: $request-&gt;get('items'),\n            customerId: $request-&gt;get('customer_id')\n        );\n\n        $orderId = $this-&gt;commandBus-&gt;dispatch($command);\n\n        return new JsonResponse(['id' =&gt; $orderId]);\n    }\n}\n\n// GraphQL = adapter GraphQL (r\u00e9utilise la m\u00eame logique!)\nclass OrderMutation\n{\n    public function createOrder(array $items, string $customerId): string\n    {\n        $command = new CreateOrderCommand($items, $customerId);\n        return $this-&gt;commandBus-&gt;dispatch($command);\n    }\n}\n\n// CLI = adapter CLI (m\u00eame logique!)\nclass CreateOrderCommand extends Command\n{\n    protected function execute(InputInterface $input, OutputInterface $output): int\n    {\n        $command = new CreateOrderCommand(\n            items: json_decode($input-&gt;getArgument('items'), true),\n            customerId: $input-&gt;getArgument('customer-id')\n        );\n\n        $this-&gt;commandBus-&gt;dispatch($command);\n\n        return Command::SUCCESS;\n    }\n}\n</code></pre> <p>Avantages: - Une seule impl\u00e9mentation r\u00e9utilis\u00e9e par HTTP, GraphQL, CLI - Testable ind\u00e9pendamment - \u00c9volutif (ajouter gRPC = nouvel adapter)</p>"},{"location":"SOLID/#4-tableau-comparatif","title":"4. Tableau Comparatif","text":"Aspect Architecture Layered Architecture Hexagonale D\u00e9pendances Vers le bas (DB-centric) Vers le centre (Domain-centric) Testabilit\u00e9 Tests lents (DB requise) Tests rapides (in-memory) Logique m\u00e9tier \u00c9parpill\u00e9e dans services Centralis\u00e9e dans Domain Couplage Fort (framework, ORM) Faible (ports/adapters) Changement techno R\u00e9\u00e9criture massive Nouveau adapter R\u00e9utilisabilit\u00e9 Difficile Facile (m\u00eame use case, plusieurs adapters) Principe SOLID Violations fr\u00e9quentes Respect total Complexit\u00e9 initiale Faible Moyenne Maintenabilit\u00e9 long terme Difficile Excellente"},{"location":"SOLID/#5-conclusion","title":"5. Conclusion","text":""},{"location":"SOLID/#quand-utiliser-larchitecture-hexagonale","title":"Quand utiliser l'Architecture Hexagonale ?","text":"<p>Utiliser Hexagonal si: - Projet complexe avec beaucoup de logique m\u00e9tier - Projet long terme (maintenance sur plusieurs ann\u00e9es) - \u00c9quipe qui grandit - Besoin de plusieurs interfaces (API REST, GraphQL, CLI) - Tests automatis\u00e9s critiques - Stack technologique susceptible d'\u00e9voluer</p> <p>Ne pas utiliser si: - Prototype rapide - CRUD simple sans logique m\u00e9tier - Projet jetable (&lt; 6 mois) - \u00c9quipe tr\u00e8s junior (courbe d'apprentissage)</p>"},{"location":"SOLID/#principes-solid-fondation-de-lhexagonal","title":"Principes SOLID = Fondation de l'Hexagonal","text":"<p>L'architecture hexagonale n'est pas \"en plus\" de SOLID, c'est l'application concr\u00e8te des principes SOLID \u00e0 l'\u00e9chelle d'une application :</p> <pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph TB\n    subgraph SOLID[\"\ud83d\udcda Principes SOLID\"]\n        SRP[\"\ud83c\udfaf Single Responsibility&lt;br/&gt;&lt;small&gt;Une responsabilit\u00e9 par classe&lt;/small&gt;\"]\n        OCP[\"\ud83d\udd13 Open/Closed&lt;br/&gt;&lt;small&gt;Ouvert extension, ferm\u00e9 modification&lt;/small&gt;\"]\n        LSP[\"\ud83d\udd04 Liskov Substitution&lt;br/&gt;&lt;small&gt;Contrats respect\u00e9s&lt;/small&gt;\"]\n        ISP[\"\u2702\ufe0f Interface Segregation&lt;br/&gt;&lt;small&gt;Interfaces sp\u00e9cialis\u00e9es&lt;/small&gt;\"]\n        DIP[\"\u2b06\ufe0f Dependency Inversion&lt;br/&gt;&lt;small&gt;D\u00e9pendre d'abstractions&lt;/small&gt;\"]\n    end\n\n    subgraph HEX[\"\ud83c\udfdb\ufe0f Architecture Hexagonale\"]\n        Layers[\"\ud83d\udcca S\u00e9paration en couches\"]\n        Ports[\"\ud83d\udd17 Ports - Interfaces\"]\n        Adapters[\"\ud83d\udd0c Adapters - Impl\u00e9mentations\"]\n        Core[\"\ud83d\udc8e Domain - C\u0153ur isol\u00e9\"]\n    end\n\n    SRP ==&gt;|\"appliqu\u00e9 \u00e0\"| Layers\n    OCP ==&gt;|\"permis par\"| Adapters\n    LSP ==&gt;|\"garanti par\"| Adapters\n    ISP ==&gt;|\"impl\u00e9ment\u00e9 via\"| Ports\n    DIP ==&gt;|\"mat\u00e9rialis\u00e9 par\"| Core\n\n    style SOLID fill:#B3E5FC,stroke:#0277BD,stroke-width:3px,color:#000\n    style HEX fill:#C8E6C9,stroke:#2E7D32,stroke-width:3px,color:#000\n    style Core fill:#FFF9C4,stroke:#F57F17,stroke-width:3px,color:#000</code></pre> <p>Correspondances:</p> <ul> <li>SRP \u2192 Chaque couche a une responsabilit\u00e9</li> <li>OCP \u2192 Nouveaux adapters sans modifier le code existant</li> <li>LSP \u2192 Adapters interchangeables</li> <li>ISP \u2192 Ports sp\u00e9cialis\u00e9s</li> <li>DIP \u2192 Domain ne d\u00e9pend de rien, Infrastructure d\u00e9pend du Domain</li> </ul> <p>Rappel: Ce bundle vous aide \u00e0 respecter ces principes automatiquement en g\u00e9n\u00e9rant la bonne structure.</p>"},{"location":"WHY-HEXAGONAL/","title":"Why Hexagonal Architecture","text":""},{"location":"WHY-HEXAGONAL/#table-of-contents","title":"Table of Contents","text":"<ul> <li>2.1 The Fundamental Question</li> <li>2.2 Traditional Layered Architecture: The Critical Problems</li> <li>2.3 Hexagonal Architecture: Inverting the Dependency Chain</li> <li>2.4 Real-World Scenarios</li> <li>2.5 Benefits Comparison</li> <li>2.6 Cost Predictability: The \"5-Day Rule\"</li> <li>2.7 Database Migration: The Ultimate Test</li> <li>2.8 Decision Guide</li> <li>2.9 Summary</li> <li>2.10 Hexagonal Architecture &amp; Core Design Principles</li> <li>2.11 Complete Decision Tree</li> </ul>"},{"location":"WHY-HEXAGONAL/#21-the-fundamental-question","title":"2.1 The Fundamental Question","text":"<p>Everything is coupled anyway, so why bother?</p> <p>Your code will always call other code. Repositories, services, databases\u2014everything is connected. The question is not about eliminating coupling (impossible), but about controlling the direction of coupling.</p>"},{"location":"WHY-HEXAGONAL/#22-traditional-layered-architecture-the-critical-problems","title":"2.2 Traditional Layered Architecture: The Critical Problems","text":"<p>In a traditional layered architecture, business logic (Services) depends directly on infrastructure (Database, Framework, Libraries). This creates a dangerous dependency chain with the following critical problems:</p>"},{"location":"WHY-HEXAGONAL/#221-framework-prison","title":"2.2.1 Framework Prison","text":"<ul> <li>Business logic is tightly coupled to Doctrine, Symfony, or any framework</li> <li>Switching from MySQL to MongoDB requires rewriting everything</li> <li>Framework update breaking APIs stops the entire application</li> <li>Real cost: Weeks of rewriting for technology changes</li> </ul>"},{"location":"WHY-HEXAGONAL/#222-testing-complexity","title":"2.2.2 Testing Complexity","text":"<ul> <li>Every test requires a real database, containers, and fixtures</li> <li>Test suite takes 10 minutes instead of 10 seconds</li> <li>Cannot test business rules without booting the entire framework</li> <li>Real cost: Developers wait, lose focus, tests get skipped</li> </ul>"},{"location":"WHY-HEXAGONAL/#223-lost-business-rules","title":"2.2.3 Lost Business Rules","text":"<ul> <li>Rules scattered across controllers, services, entities, templates</li> <li>Question: \"Can we cancel a shipped order?\" requires searching multiple locations</li> <li>Same rule duplicated in 5 different places with slight variations</li> <li>Real cost: Bugs, inconsistencies, impossible maintenance</li> </ul>"},{"location":"WHY-HEXAGONAL/#224-cannot-evolve","title":"2.2.4 Cannot Evolve","text":"<ul> <li>Adding GraphQL API requires duplicating all logic</li> <li>Adding CLI commands requires copy-pasting controllers</li> <li>Planning gRPC requires starting from scratch</li> <li>Real cost: Code duplication, diverging implementations</li> </ul>"},{"location":"WHY-HEXAGONAL/#225-death-by-thousand-cuts","title":"2.2.5 Death by Thousand Cuts","text":"<ul> <li>\"Just one quick change\" touches 20 files</li> <li>Simple features become 3-day tasks</li> <li>Fear of refactoring because everything is interconnected</li> <li>Real cost: Technical debt accumulates until rewrite is the only option</li> </ul>"},{"location":"WHY-HEXAGONAL/#23-hexagonal-architecture-inverting-the-dependency-chain","title":"2.3 Hexagonal Architecture: Inverting the Dependency Chain","text":"<p>Core Principle: Make business logic independent by inverting who depends on whom.</p>"},{"location":"WHY-HEXAGONAL/#230-the-laptop-analogy","title":"2.3.0 The Laptop Analogy \ud83d\udcbb\ud83d\udd0c","text":"<p>Before diving into technical details, let's use a simple, everyday analogy:</p> <p>Your Laptop and USB Devices</p> <p>Think about your laptop and how it connects to external devices:</p> <ul> <li>Your laptop is the core (business logic)</li> <li>Your laptop has USB ports (interfaces/contracts)</li> <li>You can plug in different devices (adapters):</li> <li>USB mouse</li> <li>USB keyboard</li> <li>USB external hard drive</li> <li>USB printer</li> <li>USB phone charger</li> </ul> <p>Key Insight: Your laptop doesn't care WHAT you plug in, as long as it respects the USB standard (interface).</p> <p>What if USB didn't exist? - Every laptop would need a specific Sony mouse port, HP keyboard port, Samsung phone port - Want to change your mouse brand? Buy a new laptop! - This is exactly how traditional layered architecture works \ud83c\udf2a\ufe0f</p> <p>With USB (Ports &amp; Adapters): - Your laptop defines: \"I need a USB port\" - Devices provide: \"I implement USB\" - Change devices anytime without changing the laptop - This is Hexagonal Architecture \ud83c\udfaf</p> <p>Mapping to Software:</p> Real World Software \ud83d\udcbb Laptop Domain (Business Logic) \ud83d\udd0c USB Port Port Interface (Contract) \ud83d\uddb1\ufe0f USB Mouse Doctrine Adapter \u2328\ufe0f USB Keyboard MongoDB Adapter \ud83d\udda8\ufe0f USB Printer Redis Adapter \ud83d\udcf1 USB Phone InMemory Adapter (for tests) <p>The Power: - Your laptop (domain) doesn't know if a mouse, keyboard, or hard drive is plugged in - It just knows: \"Something respecting USB is connected\" - Your domain doesn't know if MySQL, MongoDB, or Redis is used - It just knows: \"Something respecting <code>UserRepositoryInterface</code> is connected\"</p> <p>Real Example in Code:</p> <pre><code>// \ud83c\udf2a\ufe0f Traditional: Domain depends on concrete MySQL\nclass OrderService {\n    public function __construct(\n        private DoctrineRepository $repo  // Tightly coupled!\n    ) {}\n}\n// Problem: Want MongoDB? Rewrite OrderService!\n\n// \ud83c\udfaf Hexagonal: Domain depends on interface (USB port)\nclass PlaceOrderHandler {\n    public function __construct(\n        private OrderRepositoryInterface $repo  // Just a port!\n    ) {}\n}\n// Solution: Want MongoDB? Create MongoOrderRepository implementing the interface!\n</code></pre> <p>Why This Matters:</p> <p>Just like you can use your mouse on any laptop (Windows, Mac, Linux) because they all have USB ports, your business logic works with any database (MySQL, MongoDB, Redis) because they all implement your port interfaces.</p> <p>You control the \"USB standard\" (interface), not the device manufacturers (infrastructure libraries).</p>"},{"location":"WHY-HEXAGONAL/#231-dependency-direction","title":"2.3.1 Dependency Direction","text":"<p>Traditional (Dependencies flow DOWN):</p> <pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'16px'}}}%%\ngraph TD\n    A[\"\ud83c\udfae Controllers&lt;br/&gt;&lt;small&gt;UI Layer&lt;/small&gt;\"]\n    B[\"\u2699\ufe0f Services&lt;br/&gt;&lt;small&gt;Business Logic&lt;/small&gt;\"]\n    C[\"\ud83d\udcbe Infrastructure&lt;br/&gt;&lt;small&gt;Doctrine/Database&lt;/small&gt;\"]\n\n    A ==&gt;|\"\ud83c\udf2a\ufe0f depends on\"| B\n    B ==&gt;|\"\ud83c\udf2a\ufe0f depends on\"| C\n\n    style A fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#000\n    style B fill:#FFF9C4,stroke:#F57C00,stroke-width:3px,color:#000\n    style C fill:#FFCDD2,stroke:#C62828,stroke-width:3px,color:#000\n\n    classDef problemArrow stroke:#C62828,stroke-width:3px</code></pre> <p>Problem: Change database = rewrite business logic \ud83c\udf2a\ufe0f</p> <p>Hexagonal (Dependencies flow INWARD):</p> <pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'16px'}}}%%\ngraph BT\n    C[\"\ud83d\udd0c Infrastructure&lt;br/&gt;&lt;small&gt;Doctrine/Database&lt;/small&gt;\"]\n    B[\"\ud83d\udd17 Ports&lt;br/&gt;&lt;small&gt;Interfaces&lt;/small&gt;\"]\n    A[\"\ud83d\udc8e Domain&lt;br/&gt;&lt;small&gt;Business Logic - CORE&lt;/small&gt;\"]\n\n    C -.-&gt;|\"\ud83c\udfaf implements\"| B\n    B ==&gt;|\"\ud83c\udfaf defined by\"| A\n\n    style A fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px,color:#000,rx:10,ry:10\n    style B fill:#FFF9C4,stroke:#F9A825,stroke-width:3px,color:#000\n    style C fill:#F8BBD0,stroke:#C2185B,stroke-width:3px,color:#000</code></pre> <p>Solution: Change database = new adapter, business logic untouched \ud83c\udfaf</p>"},{"location":"WHY-HEXAGONAL/#232-practical-implications","title":"2.3.2 Practical Implications","text":"<p>Traditional: <code>Order</code> entity has Doctrine annotations. Remove Doctrine? Domain breaks. - \ud83d\udd34 Like having a laptop with a hardwired Sony mouse - want a Logitech? Buy a new laptop!</p> <p>Hexagonal: <code>Order</code> is pure PHP with business rules. Infrastructure adapts to it. Remove Doctrine? Create a new adapter. - \ud83d\udfe2 Like having a laptop with USB ports - want a different mouse? Just plug it in!</p> <p>Key insight: Business logic doesn't know (and doesn't care) if data is stored in MySQL, MongoDB, Redis, or a text file. It defines WHAT it needs (interfaces/ports), and infrastructure provides HOW (adapters).</p> <p>Back to the Laptop Analogy: - Your laptop doesn't have \"Logitech mouse code\" or \"HP printer code\" inside - It has generic USB port logic: \"Accept anything that implements USB\" - Similarly, your domain doesn't have \"Doctrine code\" or \"MongoDB code\" inside - It has generic port logic: \"Accept anything that implements <code>OrderRepositoryInterface</code>\"</p> <p>The Freedom This Gives You: - \ud83d\udd04 Switch databases like swapping USB devices - \ud83e\uddea Test with in-memory storage (like testing laptop without plugging real devices) - \ud83d\ude80 Deploy with different storage per environment (dev/staging/prod) - \ud83d\udd0c Add new storage types without touching business logic</p>"},{"location":"WHY-HEXAGONAL/#24-real-world-scenarios","title":"2.4 Real-World Scenarios","text":""},{"location":"WHY-HEXAGONAL/#241-framework-update-symfony-4-to-7","title":"2.4.1 Framework Update (Symfony 4 to 7)","text":"<p>Layered Architecture Impact: - Business services depend on Symfony APIs (TokenStorage, Session, etc.) - Framework APIs changed? Business logic needs rewriting - Risk: Breaking changes cascade through entire application - Time: Days to weeks fixing compatibility issues</p> <p>Hexagonal Architecture Impact: - Business handlers depend only on your own interfaces - Framework APIs changed? Update adapters, handlers stay untouched - Risk: Isolated to infrastructure layer - Time: Hours updating specific adapters</p>"},{"location":"WHY-HEXAGONAL/#242-testing-speed-comparison","title":"2.4.2 Testing Speed Comparison","text":"<p>Layered Architecture Reality: - Boot Symfony kernel for every test - Connect to database, load fixtures - Run test with full I/O operations - Time per test: 2-3 seconds - Result: 100 tests = 5 minutes (developers skip tests)</p> <p>Hexagonal Architecture Reality: - Instantiate handler with in-memory repository - Test pure PHP logic with zero I/O - Time per test: 0.001 seconds - Result: 1000 tests = 1 second (developers run tests constantly)</p> <p>Impact: You can run 1000 hexagonal tests in the time layered runs 10 tests.</p> <p>Laptop Analogy for Testing: - \ud83d\udd34 Traditional: Testing laptop functionality requires plugging in real mouse, keyboard, printer, etc.   - Takes forever to set up   - Need physical devices for every test   - If printer is broken, can't test laptop!</p> <ul> <li>\ud83d\udfe2 Hexagonal: Testing laptop functionality with \"mock USB devices\"</li> <li>Instant setup (no physical devices needed)</li> <li>Test laptop logic in isolation</li> <li>Real devices can be broken, laptop tests still pass!</li> </ul> <p>This is exactly what in-memory repositories do - they're \"mock USB devices\" for your tests!</p>"},{"location":"WHY-HEXAGONAL/#243-lost-business-rules","title":"2.4.3 Lost Business Rules","text":"<p>The Question: \"Can we cancel a shipped order?\"</p> <p>Layered Architecture: Rule scattered across: - Controller (validation: <code>if ($status === 'shipped') return error;</code>) - Service (business logic with different check) - Template (UI hiding/showing cancel button with yet another condition) - Repository (queries filtering \"cancelable\" orders)</p> <p>Result: 4 different implementations, slight variations, which one is correct? Nobody knows.</p> <p>Hexagonal Architecture: One method in Domain: <pre><code>Order-&gt;cancel() throws exception if status is SHIPPED\n</code></pre></p> <p>Result: ONE source of truth. Crystal clear. Impossible to miss.</p>"},{"location":"WHY-HEXAGONAL/#244-adding-new-interface-graphql","title":"2.4.4 Adding New Interface (GraphQL)","text":"<p>Layered Architecture Problem: - Business logic mixed in REST controllers - Want GraphQL? Must copy-paste logic - Result: Same business rules duplicated in 2+ places - Maintenance nightmare: change rule = update everywhere</p> <p>Hexagonal Architecture Solution: - Business logic in handler (once) - REST controller dispatches command - GraphQL resolver dispatches same command - CLI command dispatches same command - Result: Write once, use everywhere</p> <p>Laptop Analogy for Multiple Interfaces: - \ud83d\udd34 Traditional: Want to use mouse with desktop, laptop, and tablet?   - Need to buy 3 different mice (one for each device)   - Each mouse has custom logic for its device   - Update mouse firmware? Do it 3 times!</p> <ul> <li>\ud83d\udfe2 Hexagonal: One USB mouse works with ALL devices</li> <li>Same mouse plugs into desktop, laptop, tablet</li> <li>Mouse logic written once</li> <li>Update firmware once, works everywhere!</li> </ul> <p>Your business logic is the \"mouse\" - write it once, plug it into REST/GraphQL/CLI/gRPC!</p>"},{"location":"WHY-HEXAGONAL/#25-benefits-comparison","title":"2.5 Benefits Comparison","text":"Benefit Concrete Impact Time Saved Direction Control Change database, framework, or any infrastructure without touching business logic Weeks to Days Single Source of Truth Business rules in ONE place (Domain), not scattered across 10 files 50% less bugs Lightning Tests 1000x faster (in-memory vs database I/O) 10 min to 10 sec Technology Freedom Swap MySQL to MongoDB, Doctrine to Another ORM in days not months 80% effort reduction Reusability Same business logic for REST, GraphQL, CLI, gRPC, message queue Write once, use everywhere Team Scalability Juniors on adapters (infrastructure), Seniors on domain (business) Clear separation of skill levels Long-term Viability Code survives framework updates, technology shifts, team changes 10 years vs 10 months"},{"location":"WHY-HEXAGONAL/#26-cost-predictability-the-5-day-rule","title":"2.6 Cost Predictability: The \"5-Day Rule\"","text":"<p>In traditional layered architecture, components are tightly coupled. When you add feature \"X\" after two years into the project, you must navigate code where business logic is mixed with database concerns and framework dependencies. Each modification risks breaking hidden dependencies.</p>"},{"location":"WHY-HEXAGONAL/#261-the-layered-architecture-fail","title":"2.6.1 The Layered Architecture \"Fail\"","text":"<p>The Problem: Time spent is no longer dedicated to coding the feature itself, but to: - Doing archaeology in the codebase - Understanding tangled dependencies - Fixing side effects and cascading breakages - Working around technical debt accumulated over time</p> <p>Real Impact: A feature that should take 5 days now takes 15 days because: - 3 days understanding existing code - 5 days implementing the feature - 7 days fixing broken tests and side effects</p>"},{"location":"WHY-HEXAGONAL/#262-the-hexagonal-architecture-advantage","title":"2.6.2 The Hexagonal Architecture Advantage","text":"<p>The Solution: Because the domain is isolated, adding business feature \"X\" happens in a protected environment (the core). Technical complexity (ports and adapters) is pushed to the periphery.</p> <p>Result: Similar features always cost approximately 5 days, because technical \"friction\" doesn't increase with business complexity growth.</p> <p>Why This Works: - \ud83d\udce6 Isolated Domain: Business logic lives in its own protected space - \ud83d\udd0c Peripheral Complexity: Technical concerns stay at the edges - \ud83d\udccf Predictable Costs: No hidden dependencies to unravel - \ud83c\udfaf Focus: Developers code features, not fix technical debt</p>"},{"location":"WHY-HEXAGONAL/#263-tests-the-safety-net-that-accelerates-development","title":"2.6.3 Tests: The Safety Net That Accelerates Development","text":"<p>This is the most powerful technical argument for maintaining the 5-day velocity:</p> <p>High-Fidelity, Fast Tests: - Write unit tests for your domain covering 100% of business rules - Never need to start a database or server - Tests run in milliseconds, not seconds</p> <p>Immediate Feedback: - Developer knows in 10 seconds if new feature \"X\" broke something - In traditional architecture, database-dependent tests are slow or skipped - Bugs discovered later cost 10x-100x more to fix</p> <p>Example: <pre><code>// \ud83c\udfaf Hexagonal: Test in 10ms\n$handler = new PlaceOrderHandler(new InMemoryOrderRepository());\n$result = $handler-&gt;handle($command);\n$this-&gt;assertTrue($result-&gt;isSuccess());\n\n// \ud83c\udf2a\ufe0f Traditional: Test in 2-3 seconds\n// - Boot Symfony kernel\n// - Connect to database\n// - Load fixtures\n// - Execute test\n// - Rollback transaction\n</code></pre></p>"},{"location":"WHY-HEXAGONAL/#264-the-investment-vs-credit-analogy","title":"2.6.4 The Investment vs. Credit Analogy","text":"<p>Layered Architecture is Consumer Credit: - \u2728 Easy and fast at the beginning - \ud83d\udcb8 But interest (technical debt) compounds - \ud83d\udd12 Eventually, debt strangles you - \ud83d\udcb0 Every feature becomes exponentially more expensive</p> <p>Hexagonal Architecture is Investment: - \ud83d\udcaa Pay a bit more upfront (learning curve, initial structure) - \ud83d\udcc8 Each future feature costs its real price - \ud83d\udeab No additional complexity tax - \ud83d\udc8e Value grows over time instead of degrading</p>"},{"location":"WHY-HEXAGONAL/#265-the-long-term-math","title":"2.6.5 The Long-Term Math","text":"<p>Year 1: Both architectures similar speed</p> <p>Year 2: - Layered: Features take 2x longer (archaeology + side effects) - Hexagonal: Features still take baseline time</p> <p>Year 3: - Layered: Features take 3-5x longer (massive technical debt) - Hexagonal: Features still take baseline time</p> <p>Year 5: - Layered: Major refactoring or rewrite required - Hexagonal: Still delivering features at predictable pace</p> <p>The \"5-Day Rule\" in Practice: - Traditional: \"Similar\" feature in Year 3 = 15-25 days - Hexagonal: \"Similar\" feature in Year 3 = 5-7 days - Savings: 10-20 days per feature \u00d7 50 features/year = 500-1000 days saved</p>"},{"location":"WHY-HEXAGONAL/#27-database-migration-the-ultimate-test","title":"2.7 Database Migration: The Ultimate Test","text":"<p>Challenge: Change from MySQL (Doctrine ORM) to MongoDB (Document Database)</p> <p>Laptop Analogy: - \ud83d\udd34 Traditional: Laptop hardwired to Sony mouse - want Logitech? Buy new laptop and reinstall all your software! - \ud83d\udfe2 Hexagonal: Laptop with USB port - want different mouse? Unplug Sony, plug Logitech. Laptop works instantly!</p> <p>This is database migration in a nutshell. Let's see the real impact:</p>"},{"location":"WHY-HEXAGONAL/#layered-architecture-impact","title":"Layered Architecture Impact:","text":"<p>What must change: 1. All Entities with <code>@ORM</code> annotations must be rewritten as documents 2. All Repositories using Doctrine API must be rewritten for MongoDB driver 3. All Services depending on EntityManager must refactor dependencies 4. All Tests with database fixtures must be rewritten for MongoDB 5. All Query Builder usage must be rewritten as MongoDB queries</p> <p>Estimated effort: 2-4 weeks of full-team work Risk level: HIGH - touching 60-80% of codebase Regression probability: Very high - every query must be rewritten and retested</p>"},{"location":"WHY-HEXAGONAL/#hexagonal-architecture-impact","title":"Hexagonal Architecture Impact:","text":"<p>What must change: 1. Create <code>MongoUserRepository implements UserRepositoryInterface</code> 2. Create <code>MongoOrderRepository implements OrderRepositoryInterface</code> 3. Update dependency injection configuration 4. Done.</p> <p>What stays the same: - All Domain entities (pure PHP, no annotations) - All Application handlers (depend on interfaces, not implementations) - All Business rules (in Domain, framework-agnostic) - All Unit tests (use in-memory repositories)</p> <p>Estimated effort: 1-2 days Risk level: LOW - only infrastructure adapters change Regression probability: Minimal - business logic untouched</p> <p>The Math: Hexagonal saves you 10-20x the effort on technology changes.</p>"},{"location":"WHY-HEXAGONAL/#28-decision-guide","title":"2.8 Decision Guide","text":""},{"location":"WHY-HEXAGONAL/#281-choose-hexagonal-architecture-when","title":"2.8.1 Choose Hexagonal Architecture When:","text":"Criterion Why It Matters Long-term project (&gt; 2 years) Architecture ROI pays off over time as tech evolves Growing team (&gt; 3 devs) Clear boundaries help multiple developers work in parallel Complex business rules Need single source of truth for domain logic Multiple interfaces REST + GraphQL + CLI + Events = reusable handlers Tech might change Framework updates, database migrations, cloud migrations Testing is critical Fast, reliable tests enable continuous deployment Enterprise/production Business continuity requires technology independence"},{"location":"WHY-HEXAGONAL/#282-stick-with-simpler-architecture-when","title":"2.8.2 Stick with Simpler Architecture When:","text":"Situation Better Approach Quick prototype (&lt; 3 months) Speed matters more than structure Simple CRUD Little to no business logic = overkill Solo dev, tiny project Overhead not justified Stack 100% frozen If you're SURE nothing will ever change (rarely true)"},{"location":"WHY-HEXAGONAL/#283-the-core-truth-about-decoupling","title":"2.8.3 The Core Truth About Decoupling","text":"<p>What People Think Decoupling Means:</p> <p>\"My code doesn't depend on anything! Zero coupling!\"</p> <p>Reality: Impossible. Your code will always call other code. That's programming.</p> <p>What Decoupling ACTUALLY Means:</p> <p>\"My business logic defines WHAT it needs (interfaces). Infrastructure provides HOW (implementations).\"</p>"},{"location":"WHY-HEXAGONAL/#the-fundamental-shift","title":"The Fundamental Shift","text":"<p>Traditional Mindset:</p> <pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'15px'}}}%%\ngraph LR\n    A[\"\ud83e\udd14 What can we do with&lt;br/&gt;the tools we have?\"]\n    B[\"\ud83d\udd12 Business logic limited&lt;br/&gt;by database capabilities\"]\n    C[\"\ud83d\udc40 Rules adapt to&lt;br/&gt;framework constraints\"]\n    D[\"\ud83c\udf2a\ufe0f Domain serves&lt;br/&gt;infrastructure\"]\n\n    A ==&gt; B ==&gt; C ==&gt; D\n\n    style A fill:#FFEBEE,stroke:#C62828,stroke-width:3px,color:#000\n    style B fill:#FFF3E0,stroke:#E65100,stroke-width:3px,color:#000\n    style C fill:#FFF3E0,stroke:#E65100,stroke-width:3px,color:#000\n    style D fill:#FFEBEE,stroke:#C62828,stroke-width:4px,color:#000</code></pre> <p>Hexagonal Mindset:</p> <pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'15px'}}}%%\ngraph LR\n    A[\"\ud83d\udca1 What does the&lt;br/&gt;business need?\"]\n    B[\"\ud83d\udccb Define domain&lt;br/&gt;rules first\"]\n    C[\"\ud83d\udd27 Infrastructure adapts&lt;br/&gt;to serve those rules\"]\n    D[\"\ud83c\udfaf Infrastructure&lt;br/&gt;serves domain\"]\n\n    A ==&gt; B ==&gt; C ==&gt; D\n\n    style A fill:#E8F5E9,stroke:#2E7D32,stroke-width:3px,color:#000\n    style B fill:#E8F5E9,stroke:#2E7D32,stroke-width:3px,color:#000\n    style C fill:#E1F5FE,stroke:#0277BD,stroke-width:3px,color:#000\n    style D fill:#E8F5E9,stroke:#2E7D32,stroke-width:4px,color:#000</code></pre>"},{"location":"WHY-HEXAGONAL/#29-summary","title":"2.9 Summary","text":"<p>Hexagonal architecture is not about: - Eliminating all coupling - Making code more complex - Following a trendy pattern</p> <p>Hexagonal architecture IS about: - Direction Control: Your business logic depends on abstractions, infrastructure depends on your business - Stability: Business rules stable while technology changes around them - Clarity: One place for each business rule, impossible to miss - Freedom: Change tech stack in days, not months - Speed: Test suite runs in seconds, not minutes</p> <p>The Question to Ask:</p> <p>\"If we need to change databases, frameworks, or add new interfaces next year, do I want to spend 2 weeks or 2 days?\"</p> <p>If your answer is \"2 days,\" hexagonal architecture is your solution.</p> <p>Remember: The coupling doesn't go away. You're still calling repositories and services. What changes is who is in charge\u2014your business logic or your database.</p>"},{"location":"WHY-HEXAGONAL/#210-hexagonal-architecture-core-design-principles","title":"2.10 Hexagonal Architecture &amp; Core Design Principles","text":"<p>Hexagonal Architecture isn't just a pattern\u2014it's the natural embodiment of fundamental software engineering principles. Here's how it adheres to and enforces the most important design principles:</p>"},{"location":"WHY-HEXAGONAL/#2101-dry-dont-repeat-yourself","title":"2.10.1 DRY (Don't Repeat Yourself)","text":"<p>The Principle: Every piece of knowledge should have a single, unambiguous representation in your system.</p> <p>How Hexagonal Enforces DRY:</p> <p>Traditional Layered Architecture - DRY Violations: <pre><code>// Controller\nif ($order-&gt;getStatus() === 'shipped') {\n    throw new Exception('Cannot cancel shipped order');\n}\n\n// Service\nif ($order-&gt;getStatus() === 'shipped') {\n    return false; // Same rule, different implementation\n}\n\n// Template\n{% if order.status != 'shipped' %}\n    &lt;button&gt;Cancel&lt;/button&gt;  {# Same rule, third place #}\n{% endif %}\n</code></pre></p> <p>Hexagonal Architecture - Single Source of Truth: <pre><code>// Domain/Entity/Order.php - ONE place\npublic function cancel(): void\n{\n    if ($this-&gt;status-&gt;isShipped()) {\n        throw new CannotCancelShippedOrder();\n    }\n    $this-&gt;status = OrderStatus::cancelled();\n}\n\n// Everywhere else just calls: $order-&gt;cancel()\n</code></pre></p> <p>Impact: - Business rules written once in the Domain - Controllers, CLI commands, GraphQL resolvers all use the same logic - Change rule once, applies everywhere - No diverging implementations</p>"},{"location":"WHY-HEXAGONAL/#2102-kiss-keep-it-simple-stupid","title":"2.10.2 KISS (Keep It Simple, Stupid)","text":"<p>The Principle: Simplicity should be a key goal; unnecessary complexity should be avoided.</p> <p>How Hexagonal Enforces KISS:</p> <p>The Clarity: - Domain entities are pure PHP (no annotations, no framework magic) - Handlers do one thing (single responsibility) - Ports are simple interfaces (clear contracts) - Each layer has one purpose (no mixed concerns)</p> <p>Example - Simple Domain Entity: <pre><code>// Simple, readable, no framework coupling\nfinal class Order\n{\n    private OrderId $id;\n    private OrderStatus $status;\n    private Money $total;\n\n    public function place(): void\n    {\n        if ($this-&gt;total-&gt;isZero()) {\n            throw new EmptyOrderException();\n        }\n        $this-&gt;status = OrderStatus::placed();\n    }\n}\n</code></pre></p> <p>What Makes It KISS: - No annotations cluttering the code - No framework dependencies to understand - Pure business logic, nothing else - Junior developers can read and understand immediately</p> <p>Contrast with Traditional: <pre><code>// Complex: ORM annotations, framework coupling, mixed concerns\n/**\n * @ORM\\Entity(repositoryClass=\"OrderRepository\")\n * @ORM\\Table(name=\"orders\", indexes={...})\n * @ORM\\HasLifecycleCallbacks\n */\nclass Order\n{\n    /** @ORM\\Column(type=\"decimal\", precision=10, scale=2) */\n    private $total;\n\n    /** @ORM\\PrePersist */\n    public function validate() { ... }\n}\n</code></pre></p>"},{"location":"WHY-HEXAGONAL/#2103-yagni-you-arent-gonna-need-it","title":"2.10.3 YAGNI (You Aren't Gonna Need It)","text":"<p>The Principle: Don't add functionality until it's necessary.</p> <p>How Hexagonal Enforces YAGNI:</p> <p>The Protection: Hexagonal architecture prevents over-engineering by forcing you to focus on what the business needs right now, not hypothetical future scenarios.</p> <p>Example - Creating Exactly What You Need:</p> <p>Bad (YAGNI Violation): <pre><code>// Creating generic repository with 50 methods \"just in case\"\ninterface RepositoryInterface\n{\n    public function find($id);\n    public function findAll();\n    public function findBy(array $criteria);\n    public function findOneBy(array $criteria);\n    public function save($entity);\n    public function remove($entity);\n    public function count(array $criteria);\n    public function paginate($page, $limit);\n    // ... 42 more methods you don't use\n}\n</code></pre></p> <p>Good (YAGNI Compliant - Hexagonal Way): <pre><code>// Only create methods you actually need TODAY\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function ofId(UserId $id): ?User;\n    // That's it! Create new interfaces when needed.\n}\n</code></pre></p> <p>How Hexagonal Helps: - Ports (interfaces) force you to define only what you need - Small, focused interfaces prevent premature generalization - Easy to add methods later when requirements emerge - No framework base classes forcing unused methods on you</p>"},{"location":"WHY-HEXAGONAL/#2104-soc-separation-of-concerns","title":"2.10.4 SoC (Separation of Concerns)","text":"<p>The Principle: Different concerns should be handled by different parts of the system.</p> <p>How Hexagonal Enforces SoC:</p> <p>Hexagonal Architecture is fundamentally about SoC\u2014it's built into the structure.</p> <p>The Four Concerns, Clearly Separated:</p> Concern Layer Responsibility Example Business Rules Domain \"What can/cannot happen?\" <code>Order-&gt;cancel()</code> Use Cases Application \"How to orchestrate?\" <code>PlaceOrderHandler</code> User Interface UI \"How to present/receive?\" <code>OrderController</code>, <code>CLI Command</code> External World Infrastructure \"How to persist/send?\" <code>DoctrineOrderRepository</code> <p>Real Example:</p> <p>Traditional - Mixed Concerns: <pre><code>// Controller doing EVERYTHING (UI + Business + Infrastructure)\nclass OrderController\n{\n    public function cancel(Request $request, EntityManager $em)\n    {\n        // UI concern\n        $orderId = $request-&gt;get('id');\n\n        // Infrastructure concern\n        $order = $em-&gt;getRepository(Order::class)-&gt;find($orderId);\n\n        // Business concern\n        if ($order-&gt;getStatus() === 'shipped') {\n            throw new Exception('Cannot cancel');\n        }\n        $order-&gt;setStatus('cancelled');\n\n        // Infrastructure concern\n        $em-&gt;persist($order);\n        $em-&gt;flush();\n\n        // UI concern\n        return new JsonResponse(['success' =&gt; true]);\n    }\n}\n</code></pre></p> <p>Hexagonal - Separated Concerns: <pre><code>// UI Layer - Only handles HTTP\nclass OrderController\n{\n    public function __construct(private MessageBusInterface $bus) {}\n\n    public function cancel(Request $request): JsonResponse\n    {\n        $command = new CancelOrder($request-&gt;get('id'));\n        $this-&gt;bus-&gt;dispatch($command);\n        return new JsonResponse(['success' =&gt; true]);\n    }\n}\n\n// Application Layer - Orchestration\nclass CancelOrderHandler\n{\n    public function __construct(private OrderRepositoryInterface $orders) {}\n\n    public function __invoke(CancelOrder $command): void\n    {\n        $order = $this-&gt;orders-&gt;ofId(new OrderId($command-&gt;orderId));\n        $order-&gt;cancel(); // Business logic in Domain\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n\n// Domain Layer - Business Rules\nclass Order\n{\n    public function cancel(): void\n    {\n        if ($this-&gt;status-&gt;isShipped()) {\n            throw new CannotCancelShippedOrder();\n        }\n        $this-&gt;status = OrderStatus::cancelled();\n    }\n}\n\n// Infrastructure Layer - Persistence\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void { ... }\n    public function ofId(OrderId $id): ?Order { ... }\n}\n</code></pre></p> <p>The Benefits: - Change UI: Swap REST for GraphQL without touching business logic - Change Database: Swap MySQL for MongoDB without touching business logic - Change Business Rules: Modify domain without touching infrastructure or UI - Test in Isolation: Test each concern separately</p>"},{"location":"WHY-HEXAGONAL/#2105-dependency-injection-di","title":"2.10.5 Dependency Injection (DI)","text":"<p>The Principle: Depend on abstractions, not concretions. Inject dependencies rather than creating them.</p> <p>How Hexagonal Enforces DI:</p> <p>Hexagonal Architecture is fundamentally built on Dependency Injection\u2014it's impossible to implement it without DI.</p> <p>The Pattern: - Handlers depend on interfaces (ports), not concrete implementations - Dependencies are injected via constructor - Framework handles wiring via dependency injection container - Inversion of Control is mandatory, not optional</p> <p>Example:</p> <p>Without DI (Tightly Coupled): <pre><code>// Handler creates its own dependencies - IMPOSSIBLE to test or swap\nclass PlaceOrderHandler\n{\n    public function __invoke(PlaceOrder $command): void\n    {\n        // Creating concrete implementation inside!\n        $repository = new DoctrineOrderRepository();\n        $emailer = new SmtpEmailSender();\n\n        // Now stuck with Doctrine and SMTP forever\n        $order = Order::create($command-&gt;userId, $command-&gt;items);\n        $repository-&gt;save($order);\n        $emailer-&gt;send($order-&gt;userEmail(), 'Order placed');\n    }\n}\n</code></pre></p> <p>With DI (Hexagonal Way): <pre><code>// Handler receives dependencies via constructor - testable and swappable\nclass PlaceOrderHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orders,      // Port (abstraction)\n        private EmailSenderInterface $emailer          // Port (abstraction)\n    ) {}\n\n    public function __invoke(PlaceOrder $command): void\n    {\n        $order = Order::create($command-&gt;userId, $command-&gt;items);\n        $this-&gt;orders-&gt;save($order);\n        $this-&gt;emailer-&gt;send($order-&gt;userEmail(), 'Order placed');\n    }\n}\n\n// In tests: inject in-memory implementations\n// In production: inject Doctrine + SMTP\n// In staging: inject Doctrine + SendGrid\n</code></pre></p> <p>Why This Matters: - Testability: Inject in-memory fakes for lightning-fast tests - Flexibility: Swap implementations without changing handler code - Clarity: Dependencies are explicit in constructor - Framework Agnostic: Handler doesn't know about Symfony/Laravel/etc.</p>"},{"location":"WHY-HEXAGONAL/#2106-factory-pattern","title":"2.10.6 Factory Pattern","text":"<p>The Principle: Encapsulate complex object creation logic in dedicated factories.</p> <p>How Hexagonal Promotes Factory Pattern:</p> <p>Domain entities often have complex creation rules. Hexagonal Architecture promotes factories to keep entities clean and focused on business logic. Factories work hand-in-hand with the CQRS pattern - Command Handlers use factories to create entities from Commands, ensuring consistent object creation across all entry points (HTTP, CLI, GraphQL).</p> <p>The Pattern: - Factory handles complex entity creation - Entity constructor stays simple (just assignment) - Business rules for creation live in factory - Validation happens during creation - CQRS integration: Command Handlers delegate creation to factories</p> <p>Example:</p> <p>Without Factory (Entity Does Everything): <pre><code>// Entity constructor bloated with creation logic\nclass Order\n{\n    public function __construct(\n        UserId $userId,\n        array $items,\n        ShippingAddress $address,\n        PaymentMethod $payment\n    ) {\n        // Validation logic in constructor!\n        if (empty($items)) {\n            throw new EmptyOrderException();\n        }\n\n        // Business rules in constructor!\n        if (count($items) &gt; 100) {\n            throw new TooManyItemsException();\n        }\n\n        // Calculation in constructor!\n        $this-&gt;total = $this-&gt;calculateTotal($items);\n        $this-&gt;tax = $this-&gt;calculateTax($this-&gt;total, $address);\n\n        // Assignment\n        $this-&gt;id = OrderId::generate();\n        $this-&gt;userId = $userId;\n        $this-&gt;items = $items;\n        // ...\n    }\n}\n</code></pre></p> <p>With Factory (Clean Separation): <pre><code>// Entity: Simple, focused on behavior\nclass Order\n{\n    private function __construct(\n        private OrderId $id,\n        private UserId $userId,\n        private OrderItems $items,\n        private Money $total,\n        private OrderStatus $status\n    ) {}\n\n    // Behavior methods\n    public function cancel(): void { ... }\n    public function ship(): void { ... }\n}\n\n// Factory: Handles complex creation\nclass OrderFactory\n{\n    public function __construct(\n        private TaxCalculator $taxCalculator,\n        private DiscountCalculator $discountCalculator\n    ) {}\n\n    public function create(\n        UserId $userId,\n        array $rawItems,\n        ShippingAddress $address,\n        PaymentMethod $payment\n    ): Order {\n        // Validation\n        if (empty($rawItems)) {\n            throw new EmptyOrderException();\n        }\n\n        // Complex construction logic\n        $items = OrderItems::fromArray($rawItems);\n        $subtotal = $items-&gt;calculateTotal();\n        $discount = $this-&gt;discountCalculator-&gt;calculate($userId, $subtotal);\n        $tax = $this-&gt;taxCalculator-&gt;calculate($subtotal, $address);\n        $total = $subtotal-&gt;subtract($discount)-&gt;add($tax);\n\n        // Clean creation\n        return new Order(\n            OrderId::generate(),\n            $userId,\n            $items,\n            $total,\n            OrderStatus::pending()\n        );\n    }\n}\n\n// Usage in handler\nclass PlaceOrderHandler\n{\n    public function __construct(\n        private OrderFactory $factory,\n        private OrderRepositoryInterface $orders\n    ) {}\n\n    public function __invoke(PlaceOrder $command): void\n    {\n        $order = $this-&gt;factory-&gt;create(\n            $command-&gt;userId,\n            $command-&gt;items,\n            $command-&gt;address,\n            $command-&gt;payment\n        );\n\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre></p> <p>Benefits: - Entity Stays Clean: Focused on business behavior, not creation - Testable Creation: Test factory logic independently - Reusable: Same factory used by multiple handlers - Complex Logic Isolated: Tax, discounts, validation in one place</p>"},{"location":"WHY-HEXAGONAL/#2107-dto-pattern-data-transfer-objects","title":"2.10.7 DTO Pattern (Data Transfer Objects)","text":"<p>The Principle: Use simple data structures to transfer data between layers without coupling to business logic.</p> <p>How Hexagonal Promotes DTOs:</p> <p>Hexagonal Architecture uses DTOs extensively to maintain layer boundaries and prevent coupling.</p> <p>The Three Main DTO Types:</p> <p>1. Commands &amp; Queries (Application Layer Input): <pre><code>// Command DTO - Input to write operations\nfinal readonly class PlaceOrder\n{\n    public function __construct(\n        public string $userId,\n        public array $items,\n        public string $shippingAddress,\n        public string $paymentMethod\n    ) {}\n}\n\n// Query DTO - Input to read operations\nfinal readonly class FindOrderById\n{\n    public function __construct(\n        public string $orderId\n    ) {}\n}\n</code></pre></p> <p>2. Response DTOs (Application Layer Output): <pre><code>// Response DTO - Output from queries\nfinal readonly class OrderView\n{\n    public function __construct(\n        public string $id,\n        public string $status,\n        public float $total,\n        public array $items,\n        public string $createdAt\n    ) {}\n\n    public static function fromEntity(Order $order): self\n    {\n        return new self(\n            $order-&gt;id()-&gt;value(),\n            $order-&gt;status()-&gt;value(),\n            $order-&gt;total()-&gt;amount(),\n            $order-&gt;items()-&gt;toArray(),\n            $order-&gt;createdAt()-&gt;format('Y-m-d H:i:s')\n        );\n    }\n}\n</code></pre></p> <p>3. Input DTOs (UI Layer to Application): <pre><code>// Input DTO - From forms/API to commands\nfinal readonly class CreateUserInput\n{\n    public function __construct(\n        public string $email,\n        public string $password,\n        public string $firstName,\n        public string $lastName\n    ) {}\n\n    public function toCommand(): RegisterUser\n    {\n        return new RegisterUser(\n            $this-&gt;email,\n            $this-&gt;password,\n            $this-&gt;firstName,\n            $this-&gt;lastName\n        );\n    }\n}\n</code></pre></p> <p>Why DTOs Matter in Hexagonal:</p> <pre><code>// WITHOUT DTOs - Tight Coupling\nclass OrderController\n{\n    public function create(Request $request)\n    {\n        // Domain entity exposed to UI layer!\n        $order = new Order(\n            new UserId($request-&gt;get('user_id')),\n            $request-&gt;get('items'),\n            // ...\n        );\n\n        // UI knows about domain internals - BAD!\n    }\n}\n\n// WITH DTOs - Proper Decoupling\nclass OrderController\n{\n    public function __construct(private MessageBusInterface $bus) {}\n\n    public function create(Request $request): JsonResponse\n    {\n        // DTO: Simple data structure\n        $command = new PlaceOrder(\n            $request-&gt;get('user_id'),\n            $request-&gt;get('items'),\n            $request-&gt;get('shipping_address'),\n            $request-&gt;get('payment_method')\n        );\n\n        // Dispatch to application layer\n        $this-&gt;bus-&gt;dispatch($command);\n\n        return new JsonResponse(['success' =&gt; true]);\n    }\n}\n</code></pre> <p>Benefits: - Layer Independence: UI doesn't know about Domain entities - Versioning: Change DTOs without breaking domain - Serialization: Easy to serialize/deserialize for APIs - Validation: Validate at boundaries before reaching domain - Documentation: DTOs serve as API contracts</p>"},{"location":"WHY-HEXAGONAL/#2108-event-sourcing-pattern","title":"2.10.8 Event Sourcing Pattern","text":"<p>The Principle: Store state changes as a sequence of events rather than current state.</p> <p>How Hexagonal Promotes Event Sourcing:</p> <p>Hexagonal Architecture's separation of concerns makes Event Sourcing a natural fit. Domain events are first-class citizens.</p> <p>The Pattern: - Domain Events record what happened - Event Store persists event stream - Event Handlers react to events - Projections rebuild state from events</p> <p>Example:</p> <p>Traditional State Storage: <pre><code>// Only current state stored\nclass Order\n{\n    private OrderStatus $status = OrderStatus::PENDING;\n\n    public function place(): void\n    {\n        $this-&gt;status = OrderStatus::PLACED;\n        // Lost: WHEN it was placed, WHO placed it\n    }\n\n    public function ship(): void\n    {\n        $this-&gt;status = OrderStatus::SHIPPED;\n        // Lost: WHEN it shipped, tracking number, carrier\n    }\n}\n\n// Database stores: { status: \"SHIPPED\" }\n// History lost forever!\n</code></pre></p> <p>Event Sourcing in Hexagonal: <pre><code>// Domain Event (immutable DTO)\nfinal readonly class OrderPlaced\n{\n    public function __construct(\n        public OrderId $orderId,\n        public UserId $userId,\n        public Money $total,\n        public DateTimeImmutable $occurredAt\n    ) {}\n}\n\nfinal readonly class OrderShipped\n{\n    public function __construct(\n        public OrderId $orderId,\n        public string $trackingNumber,\n        public string $carrier,\n        public DateTimeImmutable $occurredAt\n    ) {}\n}\n\n// Entity that emits events\nclass Order\n{\n    private array $recordedEvents = [];\n    private OrderStatus $status;\n\n    public function place(): void\n    {\n        if (!$this-&gt;status-&gt;isPending()) {\n            throw new OrderAlreadyPlacedException();\n        }\n\n        $this-&gt;status = OrderStatus::placed();\n\n        // Record what happened\n        $this-&gt;recordedEvents[] = new OrderPlaced(\n            $this-&gt;id,\n            $this-&gt;userId,\n            $this-&gt;total,\n            new DateTimeImmutable()\n        );\n    }\n\n    public function ship(string $trackingNumber, string $carrier): void\n    {\n        if (!$this-&gt;status-&gt;isPlaced()) {\n            throw new CannotShipUnplacedOrderException();\n        }\n\n        $this-&gt;status = OrderStatus::shipped();\n\n        // Record what happened\n        $this-&gt;recordedEvents[] = new OrderShipped(\n            $this-&gt;id,\n            $trackingNumber,\n            $carrier,\n            new DateTimeImmutable()\n        );\n    }\n\n    public function pullEvents(): array\n    {\n        $events = $this-&gt;recordedEvents;\n        $this-&gt;recordedEvents = [];\n        return $events;\n    }\n}\n\n// Handler publishes events\nclass PlaceOrderHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orders,\n        private EventBusInterface $eventBus\n    ) {}\n\n    public function __invoke(PlaceOrder $command): void\n    {\n        $order = Order::create($command-&gt;userId, $command-&gt;items);\n        $order-&gt;place();\n\n        $this-&gt;orders-&gt;save($order);\n\n        // Publish all domain events\n        foreach ($order-&gt;pullEvents() as $event) {\n            $this-&gt;eventBus-&gt;publish($event);\n        }\n    }\n}\n\n// Event Subscriber reacts to events\nclass SendOrderConfirmationEmail\n{\n    public function __construct(private EmailSenderInterface $emailer) {}\n\n    public function __invoke(OrderPlaced $event): void\n    {\n        $this-&gt;emailer-&gt;send(\n            $event-&gt;userId,\n            'Order Confirmation',\n            \"Your order #{$event-&gt;orderId-&gt;value()} has been placed!\"\n        );\n    }\n}\n\n// Event Store (if doing full event sourcing)\ninterface EventStoreInterface\n{\n    public function append(OrderId $orderId, array $events): void;\n    public function loadEvents(OrderId $orderId): array;\n}\n\n// Rebuild entity from events\nclass OrderEventSourcedRepository implements OrderRepositoryInterface\n{\n    public function __construct(private EventStoreInterface $eventStore) {}\n\n    public function ofId(OrderId $id): ?Order\n    {\n        $events = $this-&gt;eventStore-&gt;loadEvents($id);\n\n        if (empty($events)) {\n            return null;\n        }\n\n        // Replay events to rebuild state\n        return Order::fromEvents($events);\n    }\n}\n</code></pre></p> <p>Why Event Sourcing Fits Hexagonal:</p> Hexagonal Concept Event Sourcing Benefit Domain Events Natural part of domain model Ports Easy to swap event store implementations Adapters Event subscribers in infrastructure layer SoC Events separate \"what happened\" from \"what to do\" Testability Test event emission without infrastructure <p>Benefits: - Complete Audit Trail: Know WHEN, WHO, WHAT for everything - Time Travel: Reconstruct state at any point in time - Business Intelligence: Analyze event streams for insights - Debugging: Replay events to reproduce bugs - CQRS Ready: Events naturally separate writes from reads</p>"},{"location":"WHY-HEXAGONAL/#2109-strategy-pattern","title":"2.10.9 Strategy Pattern","text":"<p>The Principle: Define a family of algorithms, encapsulate each one, and make them interchangeable.</p> <p>How Hexagonal Promotes Strategy Pattern:</p> <p>Hexagonal Architecture's use of ports (interfaces) is essentially the Strategy pattern at the architectural level. Every port is a strategy contract.</p> <p>The Pattern: - Port Interface defines the strategy contract - Multiple Adapters implement different strategies - Dependency Injection selects which strategy to use - Runtime Switching possible via configuration or business logic</p> <p>Example 1: Payment Processing Strategies</p> <pre><code>// Port - Strategy Interface\ninterface PaymentProcessorInterface\n{\n    public function charge(Money $amount, PaymentDetails $details): PaymentResult;\n    public function refund(TransactionId $transactionId, Money $amount): RefundResult;\n}\n\n// Strategy 1: Stripe Adapter\nclass StripePaymentProcessor implements PaymentProcessorInterface\n{\n    public function __construct(private StripeClient $client) {}\n\n    public function charge(Money $amount, PaymentDetails $details): PaymentResult\n    {\n        $charge = $this-&gt;client-&gt;charges-&gt;create([\n            'amount' =&gt; $amount-&gt;cents(),\n            'currency' =&gt; $amount-&gt;currency(),\n            'source' =&gt; $details-&gt;token()\n        ]);\n\n        return PaymentResult::success($charge-&gt;id);\n    }\n\n    public function refund(TransactionId $transactionId, Money $amount): RefundResult\n    {\n        // Stripe-specific refund logic\n    }\n}\n\n// Strategy 2: PayPal Adapter\nclass PayPalPaymentProcessor implements PaymentProcessorInterface\n{\n    public function __construct(private PayPalClient $client) {}\n\n    public function charge(Money $amount, PaymentDetails $details): PaymentResult\n    {\n        $payment = $this-&gt;client-&gt;createPayment([\n            'amount' =&gt; $amount-&gt;cents(),\n            'currency_code' =&gt; $amount-&gt;currency(),\n            'payment_method_token' =&gt; $details-&gt;token()\n        ]);\n\n        return PaymentResult::success($payment-&gt;id);\n    }\n\n    public function refund(TransactionId $transactionId, Money $amount): RefundResult\n    {\n        // PayPal-specific refund logic\n    }\n}\n\n// Strategy 3: Test/Mock Adapter\nclass InMemoryPaymentProcessor implements PaymentProcessorInterface\n{\n    private array $transactions = [];\n\n    public function charge(Money $amount, PaymentDetails $details): PaymentResult\n    {\n        $id = uniqid('txn_');\n        $this-&gt;transactions[$id] = ['amount' =&gt; $amount, 'status' =&gt; 'charged'];\n        return PaymentResult::success($id);\n    }\n\n    public function refund(TransactionId $transactionId, Money $amount): RefundResult\n    {\n        $this-&gt;transactions[$transactionId-&gt;value()]['status'] = 'refunded';\n        return RefundResult::success();\n    }\n}\n\n// Handler - Strategy Consumer\nclass ProcessPaymentHandler\n{\n    public function __construct(\n        private PaymentProcessorInterface $processor  // Strategy injected!\n    ) {}\n\n    public function __invoke(ProcessPayment $command): void\n    {\n        // Business logic doesn't know WHICH processor is used\n        $result = $this-&gt;processor-&gt;charge(\n            new Money($command-&gt;amount, $command-&gt;currency),\n            new PaymentDetails($command-&gt;paymentToken)\n        );\n\n        if ($result-&gt;failed()) {\n            throw new PaymentFailedException($result-&gt;error());\n        }\n    }\n}\n\n// Configuration - Strategy Selection\n// config/services.yaml\nservices:\n    # Production: Use Stripe\n    PaymentProcessorInterface:\n        class: StripePaymentProcessor\n\n    # Or PayPal for specific regions\n    # PaymentProcessorInterface:\n    #     class: PayPalPaymentProcessor\n\n    # Or in-memory for tests\n    # PaymentProcessorInterface:\n    #     class: InMemoryPaymentProcessor\n</code></pre> <p>Example 2: Dynamic Strategy Selection Based on Business Rules</p> <pre><code>// Multiple notification strategies\ninterface NotificationSenderInterface\n{\n    public function send(UserId $userId, string $message): void;\n    public function supports(NotificationPreference $preference): bool;\n}\n\nclass EmailNotificationSender implements NotificationSenderInterface\n{\n    public function send(UserId $userId, string $message): void\n    {\n        // Send email\n    }\n\n    public function supports(NotificationPreference $preference): bool\n    {\n        return $preference-&gt;isEmail();\n    }\n}\n\nclass SmsNotificationSender implements NotificationSenderInterface\n{\n    public function send(UserId $userId, string $message): void\n    {\n        // Send SMS\n    }\n\n    public function supports(NotificationPreference $preference): bool\n    {\n        return $preference-&gt;isSms();\n    }\n}\n\nclass PushNotificationSender implements NotificationSenderInterface\n{\n    public function send(UserId $userId, string $message): void\n    {\n        // Send push notification\n    }\n\n    public function supports(NotificationPreference $preference): bool\n    {\n        return $preference-&gt;isPush();\n    }\n}\n\n// Strategy Selector (Chain of Responsibility + Strategy)\nclass NotificationService\n{\n    /** @param NotificationSenderInterface[] $senders */\n    public function __construct(\n        private iterable $senders,\n        private UserRepositoryInterface $users\n    ) {}\n\n    public function notify(UserId $userId, string $message): void\n    {\n        $user = $this-&gt;users-&gt;ofId($userId);\n        $preference = $user-&gt;notificationPreference();\n\n        // Select strategy based on business rules\n        foreach ($this-&gt;senders as $sender) {\n            if ($sender-&gt;supports($preference)) {\n                $sender-&gt;send($userId, $message);\n                return;\n            }\n        }\n\n        throw new NoSupportedNotificationMethodException();\n    }\n}\n\n// Configuration - Register all strategies\n// config/services.yaml\nservices:\n    EmailNotificationSender:\n        tags: ['notification.sender']\n\n    SmsNotificationSender:\n        tags: ['notification.sender']\n\n    PushNotificationSender:\n        tags: ['notification.sender']\n\n    NotificationService:\n        arguments:\n            $senders: !tagged_iterator notification.sender\n</code></pre> <p>Example 3: Storage Strategy</p> <pre><code>// Port - Storage Strategy\ninterface FileStorageInterface\n{\n    public function store(string $path, string $contents): void;\n    public function retrieve(string $path): string;\n    public function delete(string $path): void;\n}\n\n// Strategy 1: Local Filesystem\nclass LocalFileStorage implements FileStorageInterface\n{\n    public function __construct(private string $basePath) {}\n\n    public function store(string $path, string $contents): void\n    {\n        file_put_contents($this-&gt;basePath . '/' . $path, $contents);\n    }\n\n    public function retrieve(string $path): string\n    {\n        return file_get_contents($this-&gt;basePath . '/' . $path);\n    }\n\n    public function delete(string $path): void\n    {\n        unlink($this-&gt;basePath . '/' . $path);\n    }\n}\n\n// Strategy 2: AWS S3\nclass S3FileStorage implements FileStorageInterface\n{\n    public function __construct(private S3Client $client, private string $bucket) {}\n\n    public function store(string $path, string $contents): void\n    {\n        $this-&gt;client-&gt;putObject([\n            'Bucket' =&gt; $this-&gt;bucket,\n            'Key' =&gt; $path,\n            'Body' =&gt; $contents\n        ]);\n    }\n\n    public function retrieve(string $path): string\n    {\n        $result = $this-&gt;client-&gt;getObject([\n            'Bucket' =&gt; $this-&gt;bucket,\n            'Key' =&gt; $path\n        ]);\n        return $result['Body']-&gt;getContents();\n    }\n\n    public function delete(string $path): void\n    {\n        $this-&gt;client-&gt;deleteObject([\n            'Bucket' =&gt; $this-&gt;bucket,\n            'Key' =&gt; $path\n        ]);\n    }\n}\n\n// Strategy 3: In-Memory (for tests)\nclass InMemoryFileStorage implements FileStorageInterface\n{\n    private array $files = [];\n\n    public function store(string $path, string $contents): void\n    {\n        $this-&gt;files[$path] = $contents;\n    }\n\n    public function retrieve(string $path): string\n    {\n        return $this-&gt;files[$path] ?? throw new FileNotFoundException();\n    }\n\n    public function delete(string $path): void\n    {\n        unset($this-&gt;files[$path]);\n    }\n}\n\n// Usage in domain\nclass UploadDocumentHandler\n{\n    public function __construct(\n        private FileStorageInterface $storage,  // Strategy!\n        private DocumentRepositoryInterface $documents\n    ) {}\n\n    public function __invoke(UploadDocument $command): void\n    {\n        // Business logic doesn't know WHERE files are stored\n        $this-&gt;storage-&gt;store(\n            $command-&gt;filePath,\n            $command-&gt;fileContents\n        );\n\n        $document = Document::create($command-&gt;filePath, $command-&gt;fileName);\n        $this-&gt;documents-&gt;save($document);\n    }\n}\n</code></pre> <p>Why Strategy Pattern Fits Hexagonal:</p> Hexagonal Concept Strategy Benefit Ports Strategy interfaces (contracts) Adapters Strategy implementations (algorithms) DI Runtime strategy selection Testability Inject test strategies easily Flexibility Swap strategies per environment <p>Real-World Scenarios:</p> <pre><code>// Development environment\nFileStorageInterface -&gt; LocalFileStorage\n\n// Staging environment\nFileStorageInterface -&gt; S3FileStorage (staging bucket)\n\n// Production environment\nFileStorageInterface -&gt; S3FileStorage (production bucket)\n\n// Tests\nFileStorageInterface -&gt; InMemoryFileStorage\n</code></pre> <p>Benefits: - Algorithm Flexibility: Change algorithms without changing business logic - Configuration-Based: Select strategy via config, not code changes - Environment-Specific: Different strategies per environment (dev/staging/prod) - A/B Testing: Switch strategies to compare performance - Gradual Migration: Run old and new strategies in parallel - Open/Closed Principle: Add new strategies without modifying existing code</p> <p>The Power:</p> <p>Traditional approach requires code changes: <pre><code>// BAD: Hard-coded strategy\nclass PaymentHandler\n{\n    public function process()\n    {\n        $stripe = new StripeClient();  // Changing to PayPal? Rewrite!\n        $stripe-&gt;charge(...);\n    }\n}\n</code></pre></p> <p>Hexagonal with Strategy pattern: <pre><code>// GOOD: Strategy injected\nclass PaymentHandler\n{\n    public function __construct(private PaymentProcessorInterface $processor) {}\n\n    public function process()\n    {\n        $this-&gt;processor-&gt;charge(...);  // Changing to PayPal? Change config!\n    }\n}\n</code></pre></p> <p>Key Insight: In Hexagonal Architecture, every port is a potential strategy. The pattern is baked into the architecture itself.</p>"},{"location":"WHY-HEXAGONAL/#21010-why-these-patterns-matter-together","title":"2.10.10 Why These Patterns Matter Together","text":"<p>Hexagonal Architecture doesn't just allow these patterns\u2014it naturally promotes them:</p> <pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'12px'}}}%%\ngraph TD\n    A[\"\ud83c\udfaf Hexagonal&lt;br/&gt;Architecture\"]\n    B[\"\u2705 DRY&lt;br/&gt;Single source of truth\"]\n    C[\"\u2705 KISS&lt;br/&gt;Pure, simple code\"]\n    D[\"\u2705 YAGNI&lt;br/&gt;Build what you need\"]\n    E[\"\u2705 SoC&lt;br/&gt;Clear layer boundaries\"]\n    F[\"\ud83d\udd0c Dependency Injection&lt;br/&gt;Inject ports, not implementations\"]\n    G[\"\ud83c\udfed Factory Pattern&lt;br/&gt;Clean entity creation\"]\n    H[\"\ud83d\udce6 DTO Pattern&lt;br/&gt;Layer decoupling\"]\n    I[\"\ud83d\udcc5 Event Sourcing&lt;br/&gt;Domain events as first-class\"]\n    J[\"\u26a1 Strategy Pattern&lt;br/&gt;Swappable algorithms\"]\n\n    A ==&gt; B\n    A ==&gt; C\n    A ==&gt; D\n    A ==&gt; E\n    A ==&gt; F\n    A ==&gt; G\n    A ==&gt; H\n    A ==&gt; I\n    A ==&gt; J\n\n    style A fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px,color:#000\n    style B fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#000\n    style C fill:#FFF9C4,stroke:#F57C00,stroke-width:2px,color:#000\n    style D fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,color:#000\n    style E fill:#FFE0B2,stroke:#E65100,stroke-width:2px,color:#000\n    style F fill:#E1F5FE,stroke:#0277BD,stroke-width:2px,color:#000\n    style G fill:#FCE4EC,stroke:#C2185B,stroke-width:2px,color:#000\n    style H fill:#F3E5F5,stroke:#6A1B9A,stroke-width:2px,color:#000\n    style I fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#000\n    style J fill:#FFF3E0,stroke:#EF6C00,stroke-width:2px,color:#000</code></pre> <p>The Synergy:</p> Principle/Pattern How Hexagonal Enforces It DRY Business rules in Domain, used everywhere via handlers KISS Pure entities, simple interfaces, focused handlers YAGNI Minimal ports, add methods only when needed SoC Strict layer boundaries, clear responsibilities DI Mandatory for ports/adapters, enables testing Factory Complex creation isolated from entity behavior DTO Commands, Queries, Responses decouple layers Event Sourcing Domain events natural, easy to implement Strategy Every port is a strategy, swap via config/DI <p>The Result: - Code that's easy to understand (KISS + DTOs) - Code that's easy to maintain (DRY + SoC) - Code that's easy to test (DI + Factories + Strategy) - Code that's easy to evolve (YAGNI + Event Sourcing) - Code that's flexible (Strategy + DI for runtime swapping) - Code that survives technology changes (SoC + Ports/Adapters)</p> <p>Real-World Impact: - Change database? DI + Strategy makes it trivial (inject different repository) - Change payment provider? Strategy pattern (Stripe \u2192 PayPal via config) - Add new feature? Factory + DTOs keep it clean - Track user actions? Event Sourcing gives complete audit trail - Understand business rules? DRY means one place to look - Test complex scenarios? DI + DTOs + Strategy make tests lightning fast - A/B test algorithms? Strategy enables runtime switching</p>"},{"location":"WHY-HEXAGONAL/#211-complete-decision-tree-what-to-create-and-how","title":"2.11 Complete Decision Tree: What to Create and How \ud83c\udf33","text":"<p>This comprehensive decision tree covers ALL possible scenarios when building with hexagonal architecture. Follow the flow to know exactly what to create, how to create it, and whether you need an interface.</p>"},{"location":"WHY-HEXAGONAL/#the-master-decision-tree","title":"\ud83c\udfaf The Master Decision Tree","text":"<pre><code>What do you need to create?\n\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 \ud83d\udce6 DOMAIN LAYER (Core Business Logic - Pure PHP)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502\n\u251c\u2500 1\ufe0f\u20e3 Entity (User, Order, Product)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:entity user/account User [--with-repository] [--with-id-vo]\n\u2502     Generates: Entity + YAML mapping\n\u2502     Options:\n\u2502       --with-repository \u2192 adds Port interface + Doctrine adapter\n\u2502       --with-id-vo \u2192 adds UserId value object\n\u2502\n\u251c\u2500 2\ufe0f\u20e3 Value Object (Email, Money, Address)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:value-object user/account Email\n\u2502\n\u251c\u2500 3\ufe0f\u20e3 Domain Exception (InvalidEmail, InsufficientFunds)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:exception user/account InvalidEmailException\n\u2502\n\u251c\u2500 4\ufe0f\u20e3 Domain Event (OrderPlaced, UserRegistered)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:domain-event order/payment OrderPlaced [--with-subscriber]\n\u2502     Options:\n\u2502       --with-subscriber \u2192 adds event subscriber in Application layer\n\u2502\n\u251c\u2500 5\ufe0f\u20e3 Domain Service (PriceCalculator, IdGenerator)?\n\u2502  \u2514\u2500 \ud83c\udfaf Create manually - Concrete class in Domain/Service/\n\u2502     No interface needed (pure business logic)\n\u2502\n\u251c\u2500 6\ufe0f\u20e3 Repository (data access)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:repository user/account User\n\u2502     Generates: Port interface + Doctrine adapter\n\u2502\n\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 \u2699\ufe0f APPLICATION LAYER (Use Cases &amp; Orchestration)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502\n\u251c\u2500 7\ufe0f\u20e3 Command (write operation)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:command user/account register [--factory] [--with-tests]\n\u2502     Options:\n\u2502       --factory \u2192 adds entity factory\n\u2502       --with-tests \u2192 adds unit + integration tests\n\u2502\n\u251c\u2500 8\ufe0f\u20e3 Query (read operation)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:query user/account find-by-id\n\u2502     Generates: Query + Handler + Response\n\u2502\n\u251c\u2500 9\ufe0f\u20e3 UseCase?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:use-case user/account CreateUser [--with-test]\n\u2502     Options:\n\u2502       --with-test \u2192 adds test (KernelTestCase)\n\u2502\n\u251c\u2500 \ud83d\udd1f Input DTO?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:input user/account CreateUserInput\n\u2502\n\u251c\u2500 1\ufe0f\u20e31\ufe0f\u20e3 Event Subscriber (business workflow)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:event-subscriber order/payment OrderPlaced --layer=application\n\u2502\n\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 \ud83c\udfae UI LAYER (Primary Adapters - User Interfaces)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502\n\u251c\u2500 1\ufe0f\u20e32\ufe0f\u20e3 Controller?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:controller user/account CreateUser /users/create [--with-workflow]\n\u2502     Options:\n\u2502       --with-workflow \u2192 adds Form + UseCase + Command + Input (6 files!)\n\u2502\n\u251c\u2500 1\ufe0f\u20e33\ufe0f\u20e3 Form?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:form user/account User [--with-command --action=Create]\n\u2502     Options:\n\u2502       --with-command \u2192 adds Command + Input\n\u2502\n\u251c\u2500 1\ufe0f\u20e34\ufe0f\u20e3 CLI Command?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:cli-command user/account CreateUser app:user:create [--with-use-case]\n\u2502     Options:\n\u2502       --with-use-case \u2192 adds UseCase + Command + Input\n\u2502\n\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 \ud83d\udd0c INFRASTRUCTURE LAYER (Secondary Adapters - External Services)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502\n\u251c\u2500 1\ufe0f\u20e35\ufe0f\u20e3 External Service (Email, FileStorage, Payment, Cache, Notification, etc.)?\n\u2502  \u2514\u2500 \ud83c\udfaf Create manually - Port + Adapter pattern\n\u2502     Step 1: Create interface in Domain/Port/{Service}Interface.php\n\u2502     Step 2: Create adapter in Infrastructure/Service/{Service}Adapter.php\n\u2502     Step 3: Configure binding in config/services.yaml\n\u2502     Examples: EmailSender, FileStorage, PaymentGateway, CacheService, HttpClient\n\u2502\n\u251c\u2500 1\ufe0f\u20e36\ufe0f\u20e3 Framework Bridge (Filesystem, Mailer wrapper)?\n\u2502  \u2514\u2500 \ud83c\udfaf Create manually - Concrete class (no interface)\n\u2502     Location: Infrastructure/Bridge/{Service}Handler.php\n\u2502     Use: Simplify framework component usage\n\u2502\n\u251c\u2500 1\ufe0f\u20e37\ufe0f\u20e3 Event Subscriber (technical concerns)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:event-subscriber shared/logging Exception --layer=infrastructure\n\u2502\n\u251c\u2500 1\ufe0f\u20e38\ufe0f\u20e3 Async Message Handler (background jobs, emails, workers)?\n\u2502  \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:message-handler user/account SendWelcomeEmail [--with-message]\n\u2502     Generates: Infrastructure/Messaging/Handler/{Name}Handler.php\n\u2502     Use for: Async emails, background jobs, queue processing\n\u2502\n\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 \ud83e\uddea TESTING (Test Coverage)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502\n\u251c\u2500 1\ufe0f\u20e39\ufe0f\u20e3 Tests?\n\u2502  \u251c\u2500 UseCase test: bin/console make:hexagonal:use-case-test blog/post CreatePost\n\u2502  \u251c\u2500 Controller test: bin/console make:hexagonal:controller-test blog/post CreatePost /posts/create\n\u2502  \u251c\u2500 CLI test: bin/console make:hexagonal:cli-command-test blog/post CreatePost app:post:create\n\u2502  \u2514\u2500 Test config: bin/console make:hexagonal:test-config\n\u2502\n\u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502 \ud83d\ude80 RAPID DEVELOPMENT (Scaffolding)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502\n\u2514\u2500 2\ufe0f\u20e30\ufe0f\u20e3 Complete CRUD (all layers)?\n   \u2514\u2500 \ud83c\udfaf bin/console make:hexagonal:crud blog/post Post [--with-tests] [--with-id-vo]\n      Generates 20+ files: Entity + Repository + 5 UseCases + 5 Controllers + Form + Tests\n</code></pre>"},{"location":"WHY-HEXAGONAL/#quick-reference-interface-decision-matrix","title":"\ud83d\udcca Quick Reference: Interface Decision Matrix","text":"What you're creating Need Interface? Why? Domain Entity \ud83c\udf2a\ufe0f NO Concrete business concept Value Object \ud83c\udf2a\ufe0f NO Immutable value Domain Exception \ud83c\udf2a\ufe0f NO Exception class Domain Event \ud83c\udf2a\ufe0f NO Immutable DTO Domain Service (pure logic) \ud83c\udf2a\ufe0f NO No external dependencies Repository \ud83c\udfaf YES Database can be swapped Command/Query Handler \ud83c\udf2a\ufe0f NO Decoupled via Messenger UseCase \ud83c\udf2a\ufe0f NO Concrete orchestrator Input DTO \ud83c\udf2a\ufe0f NO Data structure Controller \ud83c\udf2a\ufe0f NO UI adapter Form \ud83c\udf2a\ufe0f NO UI component CLI Command \ud83c\udf2a\ufe0f NO UI adapter EmailSender \ud83c\udfaf YES Can swap SMTP/SendGrid/etc FileStorage \ud83c\udfaf YES Can swap Local/S3/Cloud PaymentGateway \ud83c\udfaf YES Can swap Stripe/PayPal/etc Cache \ud83c\udfaf YES Can swap Redis/Memcached/etc HTTP Client \ud83c\udfaf YES Can swap implementations Notification \ud83c\udfaf YES Can swap SMS/Push/Email Framework Bridge \ud83c\udf2a\ufe0f NO Internal utility Parser/Serializer \ud83c\udf2a\ufe0f NO (usually) Internal utility"},{"location":"WHY-HEXAGONAL/#golden-rule-for-interfaces","title":"\ud83c\udfaf Golden Rule for Interfaces","text":"<p>Create an interface (Port) if and ONLY if: 1. \ud83c\udfaf It's an external dependency (database, API, file, email, etc.) 2. \ud83c\udfaf You want to swap implementations (MySQL \u2192 MongoDB, Local \u2192 S3) 3. \ud83c\udfaf You want to easily mock in tests (in-memory repository)</p> <p>Otherwise, use a concrete class!</p>"},{"location":"WHY-HEXAGONAL/#common-scenarios","title":"\ud83d\udca1 Common Scenarios","text":"<p>User Registration: <pre><code>bin/console make:hexagonal:entity user/account User --with-repository --with-id-vo\nbin/console make:hexagonal:command user/account register --factory\nbin/console make:hexagonal:controller user/account Register /register --with-workflow\n</code></pre></p> <p>Complete CRUD: <pre><code>bin/console make:hexagonal:crud product/catalog Product --with-tests --with-id-vo\n</code></pre></p> <p>This decision tree covers 100% of scenarios you'll encounter when building with hexagonal architecture! \ud83c\udf89</p>"},{"location":"about/","title":"About","text":"<p>Information about Hexagonal Maker Bundle.</p>"},{"location":"about/#resources","title":"Resources","text":"<ul> <li>Changelog - Version history and changes</li> <li>FAQ - Frequently asked questions</li> <li>License - MIT License</li> </ul>"},{"location":"about/#project-information","title":"Project Information","text":"<p>Author: Ahmed EBEN HASSINE Repository: github.com/ahmed-bhs/hexagonal-maker-bundle Package: packagist.org/packages/ahmed-bhs/hexagonal-maker-bundle</p>"},{"location":"about/#support","title":"Support","text":"<p>If you find this bundle helpful, consider: - Starring the repository on GitHub - Sharing it with others - Contributing improvements - Reporting issues</p> <p>Thank you for using Hexagonal Maker Bundle!</p>"},{"location":"about/changelog/","title":"Changelog","text":"<p>All notable changes to Hexagonal Maker Bundle are documented here.</p>"},{"location":"about/changelog/#unreleased","title":"[Unreleased]","text":""},{"location":"about/changelog/#added","title":"Added","text":"<ul> <li>Complete documentation site with MkDocs Material</li> <li>Comprehensive FAQ</li> <li>Step-by-step tutorials</li> </ul>"},{"location":"about/changelog/#200-2025-01-xx","title":"[2.0.0] - 2025-01-XX","text":""},{"location":"about/changelog/#added_1","title":"Added","text":"<ul> <li>NEW: <code>make:hexagonal:crud</code> - Generate complete CRUD module (30+ files)</li> <li>NEW: <code>make:hexagonal:domain-event</code> - Generate domain events</li> <li>NEW: <code>make:hexagonal:event-subscriber</code> - Generate event subscribers</li> <li>NEW: <code>make:hexagonal:message-handler</code> - Generate async message handlers</li> <li>NEW: <code>make:hexagonal:use-case-test</code> - Generate use case tests</li> <li>NEW: <code>make:hexagonal:controller-test</code> - Generate controller tests</li> <li>NEW: <code>make:hexagonal:cli-command-test</code> - Generate CLI command tests</li> <li>NEW: <code>make:hexagonal:test-config</code> - Generate test configuration</li> <li><code>--with-tests</code> option for all makers</li> <li><code>--with-factory</code> option for command maker</li> <li><code>--with-use-case</code> option for CLI command maker</li> <li><code>--with-workflow</code> option for controller maker</li> <li><code>--with-id-vo</code> option for entity and CRUD makers</li> <li>Symfony 7.x support</li> </ul>"},{"location":"about/changelog/#changed","title":"Changed","text":"<ul> <li>Improved YAML mapping templates</li> <li>Enhanced Doctrine integration guide</li> <li>Better error messages and validation</li> <li>Updated documentation structure</li> </ul>"},{"location":"about/changelog/#fixed","title":"Fixed","text":"<ul> <li>Repository interface namespace resolution</li> <li>YAML mapping indentation</li> <li>Service autowiring configuration</li> </ul>"},{"location":"about/changelog/#100-2024-xx-xx","title":"[1.0.0] - 2024-XX-XX","text":""},{"location":"about/changelog/#added_2","title":"Added","text":"<ul> <li>Initial release</li> <li>11 core maker commands:</li> <li><code>make:hexagonal:entity</code></li> <li><code>make:hexagonal:value-object</code></li> <li><code>make:hexagonal:exception</code></li> <li><code>make:hexagonal:repository</code></li> <li><code>make:hexagonal:command</code></li> <li><code>make:hexagonal:query</code></li> <li><code>make:hexagonal:use-case</code></li> <li><code>make:hexagonal:controller</code></li> <li><code>make:hexagonal:form</code></li> <li><code>make:hexagonal:cli-command</code></li> <li><code>make:hexagonal:input</code></li> <li>YAML mapping for pure domain entities</li> <li>CQRS pattern support</li> <li>Symfony 6.4+ support</li> <li>PHP 8.1+ requirement</li> </ul>"},{"location":"about/changelog/#version-history","title":"Version History","text":"Version Release Date Highlights 2.0.0 2025-01 CRUD maker, Tests, Events 1.0.0 2024-XX Initial release"},{"location":"about/changelog/#upgrade-guides","title":"Upgrade Guides","text":""},{"location":"about/changelog/#upgrading-to-20","title":"Upgrading to 2.0","text":"<p>No breaking changes! All 1.x code continues to work.</p> <p>New features: - Try <code>make:hexagonal:crud</code> for rapid development - Add <code>--with-tests</code> to generate tests automatically - Use domain events with <code>make:hexagonal:domain-event</code></p>"},{"location":"about/changelog/#upgrading-to-10","title":"Upgrading to 1.0","text":"<p>Initial release - no upgrade needed.</p>"},{"location":"about/changelog/#roadmap","title":"Roadmap","text":""},{"location":"about/changelog/#planned-features","title":"Planned Features","text":""},{"location":"about/changelog/#v21-q1-2025","title":"v2.1 (Q1 2025)","text":"<ul> <li> GraphQL adapter generator</li> <li> API Platform integration</li> <li> Custom validation rules generator</li> <li> Specification pattern support</li> </ul>"},{"location":"about/changelog/#v22-q2-2025","title":"v2.2 (Q2 2025)","text":"<ul> <li> Microservices support (gRPC, REST)</li> <li> Event Sourcing generators</li> <li> SAGA pattern support</li> <li> Multi-tenancy templates</li> </ul>"},{"location":"about/changelog/#v30-future","title":"v3.0 (Future)","text":"<ul> <li> Visual module designer</li> <li> AI-powered code suggestions</li> <li> Performance analyzers</li> <li> Architecture validation tools</li> </ul>"},{"location":"about/changelog/#contributing","title":"Contributing","text":"<p>Want to help shape the future? See Contributing Guide.</p>"},{"location":"about/changelog/#release-notes","title":"Release Notes","text":""},{"location":"about/changelog/#how-we-version","title":"How We Version","text":"<p>We follow Semantic Versioning:</p> <ul> <li>MAJOR (X.0.0) - Breaking changes</li> <li>MINOR (x.X.0) - New features (backward compatible)</li> <li>PATCH (x.x.X) - Bug fixes</li> </ul>"},{"location":"about/changelog/#support-policy","title":"Support Policy","text":"Version PHP Symfony Support Status 2.x 8.1+ 6.4+, 7.x \u2705 Active 1.x 8.1+ 6.4+ \u26a0\ufe0f Security only"},{"location":"about/changelog/#changelog-guidelines","title":"Changelog Guidelines","text":"<p>When contributing, please add entries under <code>[Unreleased]</code> section following this format:</p> <pre><code>### Added\n- New feature description\n\n### Changed\n- Changed feature description\n\n### Fixed\n- Bug fix description\n\n### Deprecated\n- Deprecated feature description\n\n### Removed\n- Removed feature description\n</code></pre> <p>Full changelog: GitHub Releases</p>"},{"location":"about/faq/","title":"FAQ - Frequently Asked Questions","text":"<p>Quick answers to common questions about Hexagonal Maker Bundle.</p>"},{"location":"about/faq/#installation-setup","title":"Installation &amp; Setup","text":""},{"location":"about/faq/#how-do-i-install-the-bundle","title":"How do I install the bundle?","text":"<pre><code>composer require ahmed-bhs/hexagonal-maker-bundle --dev\n</code></pre> <p>The bundle auto-registers with Symfony Flex.</p>"},{"location":"about/faq/#what-are-the-requirements","title":"What are the requirements?","text":"<ul> <li>PHP 8.1+</li> <li>Symfony 6.4+ or 7.x</li> <li>Doctrine ORM (for persistence)</li> </ul>"},{"location":"about/faq/#do-i-need-to-configure-anything","title":"Do I need to configure anything?","text":"<p>Yes! You must configure Doctrine YAML mappings for each module. See Installation Guide.</p>"},{"location":"about/faq/#usage","title":"Usage","text":""},{"location":"about/faq/#how-do-i-generate-my-first-module","title":"How do I generate my first module?","text":"<pre><code>bin/console make:hexagonal:entity user/account User\nbin/console make:hexagonal:repository user/account User\nbin/console make:hexagonal:command user/account create\n</code></pre> <p>See Quick Start \u2192</p>"},{"location":"about/faq/#can-i-generate-a-complete-crud-module","title":"Can I generate a complete CRUD module?","text":"<p>Yes! Use the CRUD maker:</p> <pre><code>bin/console make:hexagonal:crud blog/post Post --with-tests\n</code></pre> <p>This generates 30+ files including all layers, use cases, controllers, and tests.</p>"},{"location":"about/faq/#how-many-maker-commands-are-available","title":"How many maker commands are available?","text":"<p>19 specialized makers covering all hexagonal layers:</p> <ul> <li>Domain (Entity, ValueObject, Exception)</li> <li>Application (Command, Query, UseCase)</li> <li>Infrastructure (Repository, MessageHandler)</li> <li>UI (Controller, Form, CLI Command)</li> <li>Tests (UseCase Test, Controller Test)</li> <li>Rapid (CRUD)</li> </ul> <p>See all commands \u2192</p>"},{"location":"about/faq/#architecture","title":"Architecture","text":""},{"location":"about/faq/#why-use-hexagonal-architecture","title":"Why use hexagonal architecture?","text":"<p>Benefits:</p> <ul> <li>Pure Domain - Business logic independent of frameworks</li> <li>Easy Testing - Unit tests run 1000x faster (no database)</li> <li>Technology Freedom - Swap databases/frameworks easily</li> <li>Maintainability - Clear separation of concerns</li> </ul> <p>Read full guide \u2192</p>"},{"location":"about/faq/#whats-the-difference-between-hexagonal-and-clean-architecture","title":"What's the difference between hexagonal and clean architecture?","text":"<p>They're very similar: - Hexagonal (Alistair Cockburn) - Focuses on ports &amp; adapters - Clean (Uncle Bob) - Emphasizes dependency rule</p> <p>Both achieve the same goal: domain independence.</p>"},{"location":"about/faq/#why-yaml-mapping-instead-of-annotations","title":"Why YAML mapping instead of annotations?","text":"<p>Pure domain principle:</p> <p>Annotations pollute domain entities with infrastructure concerns (Doctrine). YAML keeps domain 100% pure PHP.</p> <pre><code>// \u2705 Pure domain - no dependencies\nfinal class User\n{\n    private string $id;\n    private string $email;\n}\n</code></pre> <p>vs</p> <pre><code>// \u274c Domain depends on Doctrine\n#[ORM\\Entity]\nfinal class User\n{\n    #[ORM\\Id]\n    private string $id;\n}\n</code></pre>"},{"location":"about/faq/#cqrs","title":"CQRS","text":""},{"location":"about/faq/#what-is-cqrs","title":"What is CQRS?","text":"<p>**C**ommand **Q**uery **R**esponsibility **S**egregation</p> <ul> <li>Commands - Change state (Create, Update, Delete)</li> <li>Queries - Read data (Find, List)</li> </ul> <p>Benefits: - Clear separation of write/read logic - Easier to optimize queries - Better scalability</p>"},{"location":"about/faq/#when-should-i-use-commands-vs-usecases","title":"When should I use Commands vs UseCases?","text":"<p>Commands (CQRS): - When using Symfony Messenger - For async processing - When you want message-based architecture</p> <p>UseCases: - Simple synchronous operations - Direct service calls - When you don't need messaging</p> <p>Both are valid! Choose based on your needs.</p>"},{"location":"about/faq/#how-do-commands-work-with-messenger","title":"How do Commands work with Messenger?","text":"<p>Commands are dispatched via Symfony Messenger:</p> <pre><code>// 1. Define command (DTO)\nfinal readonly class CreateUserCommand\n{\n    public function __construct(\n        public string $email,\n        public string $password,\n    ) {}\n}\n\n// 2. Handle with #[AsMessageHandler]\n#[AsMessageHandler]\nfinal readonly class CreateUserCommandHandler\n{\n    public function __invoke(CreateUserCommand $command): void\n    {\n        // Business logic here\n    }\n}\n\n// 3. Dispatch from controller\n$this-&gt;messageBus-&gt;dispatch(new CreateUserCommand($email, $password));\n</code></pre>"},{"location":"about/faq/#doctrine-integration","title":"Doctrine Integration","text":""},{"location":"about/faq/#where-do-i-configure-yaml-mappings","title":"Where do I configure YAML mappings?","text":"<p>In <code>config/packages/doctrine.yaml</code>:</p> <pre><code>doctrine:\n    orm:\n        mappings:\n            UserAccount:\n                type: yml\n                dir: '%kernel.project_dir%/src/User/Account/Infrastructure/Persistence/Doctrine/Orm/Mapping'\n                prefix: 'App\\User\\Account\\Domain\\Model'\n</code></pre> <p>Add one mapping per module.</p>"},{"location":"about/faq/#can-i-use-annotations-instead-of-yaml","title":"Can I use annotations instead of YAML?","text":"<p>Technically yes, but not recommended. It breaks the pure domain principle.</p>"},{"location":"about/faq/#how-do-i-handle-value-objects-in-doctrine","title":"How do I handle Value Objects in Doctrine?","text":"<p>Use <code>embedded</code> in YAML mapping:</p> <pre><code># Email.orm.yml\nApp\\Domain\\ValueObject\\Email:\n    type: embeddable\n    fields:\n        value:\n            type: string\n            length: 180\n\n# User.orm.yml\nApp\\Domain\\Model\\User:\n    embedded:\n        email:\n            class: App\\Domain\\ValueObject\\Email\n            columnPrefix: email_\n</code></pre>"},{"location":"about/faq/#can-i-use-gedmo-extensions-timestampable-sluggable","title":"Can I use Gedmo extensions (Timestampable, Sluggable)?","text":"<p>Yes! Configure them in YAML to keep domain pure:</p> <pre><code>fields:\n    createdAt:\n        type: datetime_immutable\n        gedmo:\n            timestampable:\n                on: create\n</code></pre> <p>See Gedmo guide \u2192</p>"},{"location":"about/faq/#testing","title":"Testing","text":""},{"location":"about/faq/#how-do-i-test-use-cases","title":"How do I test use cases?","text":"<p>Generate tests with <code>--with-tests</code>:</p> <pre><code>bin/console make:hexagonal:command blog/post create --with-tests\n</code></pre> <p>Or use the test maker:</p> <pre><code>bin/console make:hexagonal:use-case-test blog/post CreatePost\n</code></pre>"},{"location":"about/faq/#unit-tests-vs-integration-tests","title":"Unit tests vs Integration tests?","text":"<p>Unit Tests: - Test business logic in isolation - Use mocks for dependencies - Run extremely fast (milliseconds)</p> <p>Integration Tests: - Test full stack with real database - Use real Symfony container - Slower but more realistic</p> <p>Both are generated!</p>"},{"location":"about/faq/#how-do-i-run-tests","title":"How do I run tests?","text":"<pre><code># All tests\nvendor/bin/phpunit\n\n# Specific test\nvendor/bin/phpunit tests/Blog/Post/Application/CreatePost/CreatePostTest.php\n\n# With coverage\nXDEBUG_MODE=coverage vendor/bin/phpunit --coverage-html coverage\n</code></pre>"},{"location":"about/faq/#customization","title":"Customization","text":""},{"location":"about/faq/#can-i-customize-generated-templates","title":"Can I customize generated templates?","text":"<p>Yes! Create custom templates in <code>config/skeleton/</code>:</p> <pre><code># config/packages/hexagonal_maker.yaml\nhexagonal_maker:\n    skeleton_dir: '%kernel.project_dir%/config/skeleton'\n</code></pre> <p>See templates guide \u2192</p>"},{"location":"about/faq/#can-i-change-the-root-namespace","title":"Can I change the root namespace?","text":"<p>Yes, in configuration:</p> <pre><code>hexagonal_maker:\n    root_namespace: 'MyApp'\n</code></pre>"},{"location":"about/faq/#can-i-organize-modules-differently","title":"Can I organize modules differently?","text":"<p>Yes! Use the module path parameter:</p> <pre><code># Default: src/Blog/Post/\nbin/console make:hexagonal:entity blog/post Post\n\n# Custom: src/Module/Blog/Post/\nbin/console make:hexagonal:entity module/blog/post Post\n\n# Flat: src/BlogPost/\nbin/console make:hexagonal:entity blog-post Post\n</code></pre>"},{"location":"about/faq/#advanced","title":"Advanced","text":""},{"location":"about/faq/#how-do-i-implement-domain-events","title":"How do I implement Domain Events?","text":"<pre><code># Generate event + subscriber\nbin/console make:hexagonal:domain-event order/payment OrderPlaced --with-subscriber\n</code></pre> <p>Dispatch from entity:</p> <pre><code>class Order\n{\n    private array $events = [];\n\n    public function place(): void\n    {\n        $this-&gt;status = 'placed';\n        $this-&gt;events[] = new OrderPlacedEvent($this-&gt;id);\n    }\n\n    public function pullDomainEvents(): array\n    {\n        $events = $this-&gt;events;\n        $this-&gt;events = [];\n        return $events;\n    }\n}\n</code></pre>"},{"location":"about/faq/#can-i-use-async-processing","title":"Can I use async processing?","text":"<p>Yes! Generate message handlers:</p> <pre><code>bin/console make:hexagonal:message-handler user/account SendWelcomeEmail --with-message\n</code></pre> <p>Configure in <code>messenger.yaml</code>:</p> <pre><code>framework:\n    messenger:\n        routing:\n            'App\\User\\Account\\Application\\Message\\*': async\n</code></pre>"},{"location":"about/faq/#how-do-i-implement-multi-tenancy","title":"How do I implement multi-tenancy?","text":"<p>Use Shared Kernel for tenant-aware repositories:</p> <pre><code>// Shared/Domain/ValueObject/TenantId.php\nfinal readonly class TenantId\n{\n    public function __construct(public string $value) {}\n}\n\n// Each repository filters by tenant\ninterface UserRepositoryInterface\n{\n    public function findByTenant(TenantId $tenantId): array;\n}\n</code></pre>"},{"location":"about/faq/#comparison","title":"Comparison","text":""},{"location":"about/faq/#vs-symfony-maker-bundle","title":"vs Symfony Maker Bundle?","text":"Feature Symfony Maker Hexagonal Maker Architecture Traditional layers Hexagonal/DDD Domain Purity \u274c Coupled to Doctrine \u2705 Pure PHP CQRS \u274c No \u2705 Yes Modular \u274c Single namespace \u2705 Modules/Contexts Testing Basic \u2705 Unit + Integration <p>Use both! Hexagonal Maker extends Symfony Maker.</p>"},{"location":"about/faq/#vs-manual-architecture","title":"vs Manual Architecture?","text":"Aspect Manual Hexagonal Maker Speed Hours per module Minutes Consistency Varies by developer Enforced patterns Best Practices Requires expertise Built-in Learning Curve Steep Guided <p>Hexagonal Maker = Manual quality at automated speed</p>"},{"location":"about/faq/#troubleshooting","title":"Troubleshooting","text":""},{"location":"about/faq/#generated-files-have-wrong-namespace","title":"Generated files have wrong namespace","text":"<p>Solution: Check configuration in <code>hexagonal_maker.yaml</code>:</p> <pre><code>hexagonal_maker:\n    root_namespace: 'App'  # Must match your composer.json\n</code></pre>"},{"location":"about/faq/#doctrine-cant-find-my-entity","title":"Doctrine can't find my entity","text":"<p>Error: <code>Class \"X\" is not a valid entity or mapped super class</code></p> <p>Solution: Add YAML mapping in <code>doctrine.yaml</code> for your module.</p>"},{"location":"about/faq/#repository-autowiring-fails","title":"Repository autowiring fails","text":"<p>Error: <code>Cannot autowire... no such service exists</code></p> <p>Solution: Add interface binding in <code>services.yaml</code>:</p> <pre><code>services:\n    App\\Blog\\Post\\Domain\\Port\\PostRepositoryInterface:\n        class: App\\Blog\\Post\\Infrastructure\\Persistence\\Doctrine\\DoctrinePostRepository\n</code></pre>"},{"location":"about/faq/#tests-cant-find-classes","title":"Tests can't find classes","text":"<p>Solution: Regenerate autoload:</p> <pre><code>composer dump-autoload\n</code></pre>"},{"location":"about/faq/#contributing","title":"Contributing","text":""},{"location":"about/faq/#how-can-i-contribute","title":"How can I contribute?","text":"<p>See Contributing Guide. Ways to help:</p> <ul> <li>Report bugs</li> <li>Request features</li> <li>Submit PRs</li> <li>Improve documentation</li> <li>Share examples</li> </ul>"},{"location":"about/faq/#where-do-i-report-bugs","title":"Where do I report bugs?","text":"<p>GitHub Issues</p>"},{"location":"about/faq/#license","title":"License","text":""},{"location":"about/faq/#can-i-use-it-commercially","title":"Can I use it commercially?","text":"<p>Yes! MIT License - free for commercial use.</p>"},{"location":"about/faq/#can-i-modify-the-generated-code","title":"Can I modify the generated code?","text":"<p>Yes! Generated code is yours. No restrictions.</p> <p>Still have questions? Open a discussion</p>"},{"location":"about/license/","title":"License","text":"<p>Hexagonal Maker Bundle is open-source software licensed under the MIT License.</p>"},{"location":"about/license/#mit-license","title":"MIT License","text":"<p>Copyright \u00a9 2024-2026 Ahmed EBEN HASSINE</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>"},{"location":"about/license/#what-this-means","title":"What This Means","text":""},{"location":"about/license/#you-can","title":"\u2705 You CAN:","text":"<ul> <li>Use commercially - Use in commercial projects</li> <li>Modify - Change the code as you wish</li> <li>Distribute - Share with others</li> <li>Sublicense - Include in your own projects</li> <li>Private use - Use privately without sharing</li> </ul>"},{"location":"about/license/#you-cannot","title":"\u274c You CANNOT:","text":"<ul> <li>Hold liable - Author is not responsible for any damages</li> <li>Use trademark - Without explicit permission</li> </ul>"},{"location":"about/license/#you-must","title":"\ud83d\udccb You MUST:","text":"<ul> <li>Include license - Include original license and copyright notice</li> <li>Include copyright - Credit the original author</li> </ul>"},{"location":"about/license/#third-party-licenses","title":"Third-Party Licenses","text":"<p>This bundle depends on:</p> <ul> <li>Symfony Components - MIT License</li> <li>Doctrine ORM - MIT License</li> </ul> <p>All dependencies retain their original licenses.</p>"},{"location":"about/license/#contributing","title":"Contributing","text":"<p>By contributing to this project, you agree that your contributions will be licensed under the MIT License.</p> <p>See Contributing Guide for details.</p>"},{"location":"about/license/#questions","title":"Questions?","text":"<p>For licensing questions, contact:</p> <ul> <li>Email: ahmedbhs123@gmail.com</li> <li>GitHub: @ahmed-bhs</li> </ul>"},{"location":"advanced/","title":"Advanced Topics","text":"<p>Deep dive into advanced hexagonal architecture patterns and techniques.</p>"},{"location":"advanced/#topics-covered","title":"Topics Covered","text":"<ul> <li>Architecture patterns and best practices</li> <li>Doctrine configuration and YAML mapping</li> <li>Repository pattern and why not to use EntityManager directly</li> <li>Testing strategies (unit, integration, functional)</li> <li>Event-driven architecture with domain events</li> <li>CQRS implementation patterns with Query Functions</li> <li>Value objects and immutability</li> <li>Shared kernel organization</li> </ul>"},{"location":"advanced/#architecture-guides","title":"Architecture Guides","text":"<ul> <li>WHY-HEXAGONAL - Business case and benefits</li> <li>ARCHITECTURE - Complete architecture guide (French)</li> <li>SOLID Principles - SOLID in hexagonal architecture (French)</li> </ul> <p>These guides provide comprehensive explanations of hexagonal architecture concepts, patterns, and best practices.</p>"},{"location":"advanced/anti-patterns-pitfalls/","title":"Anti-Patterns and Pitfalls in Hexagonal Architecture","text":""},{"location":"advanced/anti-patterns-pitfalls/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Anemic Domain Model</li> <li>God Objects</li> <li>Leaky Abstractions</li> <li>Repository as Service Locator</li> <li>Transaction Management Issues</li> <li>Cascade Delete Problems</li> <li>Over-Engineering</li> <li>Testing Anti-Patterns</li> </ol>"},{"location":"advanced/anti-patterns-pitfalls/#anemic-domain-model","title":"Anemic Domain Model","text":""},{"location":"advanced/anti-patterns-pitfalls/#the-problem","title":"The Problem","text":"<p>Anemic Domain Model: Entities are just data containers with getters/setters, all logic is in handlers.</p> <pre><code>// \u274c BAD: Anemic entity\nclass Order\n{\n    private OrderStatus $status;\n    private Money $total;\n    private \\DateTimeImmutable $shippedAt;\n\n    // Only getters and setters, no behavior\n    public function getStatus(): OrderStatus { return $this-&gt;status; }\n    public function setStatus(OrderStatus $status): void { $this-&gt;status = $status; }\n\n    public function getTotal(): Money { return $this-&gt;total; }\n    public function setTotal(Money $total): void { $this-&gt;total = $total; }\n\n    public function getShippedAt(): ?\\DateTimeImmutable { return $this-&gt;shippedAt; }\n    public function setShippedAt(\\DateTimeImmutable $shippedAt): void { $this-&gt;shippedAt = $shippedAt; }\n}\n\n// \u274c BAD: All business logic in handler\nclass ShipOrderHandler\n{\n    public function __invoke(ShipOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        // Business logic in handler (should be in entity!)\n        if ($order-&gt;getStatus() === OrderStatus::CANCELLED) {\n            throw new CannotShipCancelledOrderException();\n        }\n\n        if ($order-&gt;getStatus() === OrderStatus::SHIPPED) {\n            throw new OrderAlreadyShippedException();\n        }\n\n        $order-&gt;setStatus(OrderStatus::SHIPPED);\n        $order-&gt;setShippedAt(new \\DateTimeImmutable());\n\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre> <p>Problems: - Business rules scattered in handlers - Hard to test (need handler to test business logic) - Cannot reuse logic elsewhere - Entity is just a data bag</p>"},{"location":"advanced/anti-patterns-pitfalls/#the-solution-rich-domain-model","title":"The Solution: Rich Domain Model","text":"<pre><code>// \u2705 GOOD: Rich entity with behavior\nclass Order\n{\n    private OrderStatus $status;\n    private Money $total;\n    private ?\\DateTimeImmutable $shippedAt = null;\n\n    // Business logic encapsulated in entity\n    public function ship(): void\n    {\n        if ($this-&gt;status === OrderStatus::CANCELLED) {\n            throw new CannotShipCancelledOrderException();\n        }\n\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new OrderAlreadyShippedException();\n        }\n\n        $this-&gt;status = OrderStatus::SHIPPED;\n        $this-&gt;shippedAt = new \\DateTimeImmutable();\n    }\n\n    public function cancel(): void\n    {\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new CannotCancelShippedOrderException();\n        }\n\n        $this-&gt;status = OrderStatus::CANCELLED;\n    }\n\n    // Getters only (no setters!)\n    public function getStatus(): OrderStatus { return $this-&gt;status; }\n    public function getTotal(): Money { return $this-&gt;total; }\n    public function getShippedAt(): ?\\DateTimeImmutable { return $this-&gt;shippedAt; }\n}\n\n// \u2705 GOOD: Thin handler, just orchestration\nclass ShipOrderHandler\n{\n    public function __invoke(ShipOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        $order-&gt;ship(); // Business logic in entity\n\n        $this-&gt;orders-&gt;save($order);\n        $this-&gt;eventDispatcher-&gt;dispatch(new OrderShippedEvent($order-&gt;getId()));\n    }\n}\n</code></pre> <p>Benefits: - Business logic in domain where it belongs - Easy to test (<code>$order-&gt;ship()</code> can be tested without handler) - Reusable across use cases - Entity protects its invariants</p>"},{"location":"advanced/anti-patterns-pitfalls/#god-objects","title":"God Objects","text":""},{"location":"advanced/anti-patterns-pitfalls/#the-problem-fat-handlers","title":"The Problem: Fat Handlers","text":"<p>God Object: Handler does everything (validation, business logic, orchestration, error handling).</p> <pre><code>// \u274c BAD: God handler (200+ lines)\nclass ProcessOrderHandler\n{\n    public function __invoke(ProcessOrderCommand $command): void\n    {\n        // Input validation\n        if (empty($command-&gt;items)) {\n            throw new InvalidOrderException(\"Order must have items\");\n        }\n\n        // Check customer\n        $customer = $this-&gt;customers-&gt;findById($command-&gt;customerId);\n        if (!$customer) {\n            throw new CustomerNotFoundException($command-&gt;customerId);\n        }\n\n        if (!$customer-&gt;isActive()) {\n            throw new InactiveCustomerException();\n        }\n\n        // Check inventory for each item\n        foreach ($command-&gt;items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;productId);\n            if (!$product) {\n                throw new ProductNotFoundException($item-&gt;productId);\n            }\n\n            if ($product-&gt;getStock() &lt; $item-&gt;quantity) {\n                throw new InsufficientStockException($item-&gt;productId);\n            }\n        }\n\n        // Calculate pricing\n        $subtotal = 0;\n        foreach ($command-&gt;items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;productId);\n            $subtotal += $product-&gt;getPrice() * $item-&gt;quantity;\n        }\n\n        $tax = $subtotal * $this-&gt;taxCalculator-&gt;getTaxRate($command-&gt;shippingAddress);\n        $shipping = $this-&gt;shippingCalculator-&gt;calculate($command-&gt;shippingAddress, $command-&gt;items);\n        $total = $subtotal + $tax + $shipping;\n\n        // Create order\n        $order = new Order(\n            OrderId::generate(),\n            $command-&gt;customerId,\n            $command-&gt;items,\n            $subtotal,\n            $tax,\n            $shipping,\n            $total,\n            OrderStatus::PENDING,\n            new \\DateTimeImmutable()\n        );\n\n        // Reserve stock\n        foreach ($command-&gt;items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;productId);\n            $product-&gt;reserveStock($item-&gt;quantity);\n            $this-&gt;products-&gt;save($product);\n        }\n\n        // Save order\n        $this-&gt;orders-&gt;save($order);\n\n        // Send notifications\n        $this-&gt;emailSender-&gt;send(new OrderConfirmationEmail($order));\n        $this-&gt;eventDispatcher-&gt;dispatch(new OrderCreatedEvent($order-&gt;getId()));\n\n        // ... 100 more lines\n    }\n}\n</code></pre> <p>Problems: - Too many responsibilities - Hard to test - Hard to maintain - Hard to understand</p>"},{"location":"advanced/anti-patterns-pitfalls/#the-solution-decompose-responsibilities","title":"The Solution: Decompose Responsibilities","text":"<pre><code>// \u2705 GOOD: Split into multiple handlers/services\n\n// 1. Handler: orchestration only\nclass ProcessOrderHandler\n{\n    public function __construct(\n        private OrderFactory $orderFactory,\n        private OrderRepositoryInterface $orders,\n        private InventoryService $inventory,\n        private EventDispatcherInterface $events,\n    ) {}\n\n    public function __invoke(ProcessOrderCommand $command): void\n    {\n        // Factory handles creation + validation\n        $order = $this-&gt;orderFactory-&gt;create(\n            customerId: $command-&gt;customerId,\n            items: $command-&gt;items,\n            shippingAddress: $command-&gt;shippingAddress\n        );\n\n        // Domain service handles inventory\n        $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n\n        // Repository handles persistence\n        $this-&gt;orders-&gt;save($order);\n\n        // Event dispatcher handles notifications\n        $this-&gt;events-&gt;dispatch(new OrderCreatedEvent($order-&gt;getId()));\n    }\n}\n\n// 2. Factory: handles complex creation logic\nclass OrderFactory\n{\n    public function create(\n        CustomerId $customerId,\n        array $items,\n        ShippingAddress $address\n    ): Order {\n        $this-&gt;validateCustomer($customerId);\n        $this-&gt;validateItems($items);\n\n        $subtotal = $this-&gt;calculateSubtotal($items);\n        $tax = $this-&gt;taxCalculator-&gt;calculate($subtotal, $address);\n        $shipping = $this-&gt;shippingCalculator-&gt;calculate($address, $items);\n\n        return new Order(\n            id: OrderId::generate(),\n            customerId: $customerId,\n            items: $items,\n            subtotal: $subtotal,\n            tax: $tax,\n            shipping: $shipping,\n            total: $subtotal-&gt;add($tax)-&gt;add($shipping),\n            status: OrderStatus::PENDING,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    private function validateCustomer(CustomerId $customerId): void { /* ... */ }\n    private function validateItems(array $items): void { /* ... */ }\n    private function calculateSubtotal(array $items): Money { /* ... */ }\n}\n\n// 3. Domain service: handles cross-entity operations\nclass InventoryService\n{\n    public function reserveStock(array $items): void\n    {\n        foreach ($items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;getProductId());\n\n            if ($product-&gt;getStock() &lt; $item-&gt;getQuantity()) {\n                throw new InsufficientStockException($item-&gt;getProductId());\n            }\n\n            $product-&gt;reserveStock($item-&gt;getQuantity());\n            $this-&gt;products-&gt;save($product);\n        }\n    }\n}\n</code></pre> <p>Benefits: - Single Responsibility Principle - Easy to test each component - Easy to understand - Reusable components</p>"},{"location":"advanced/anti-patterns-pitfalls/#leaky-abstractions","title":"Leaky Abstractions","text":""},{"location":"advanced/anti-patterns-pitfalls/#the-problem-port-exposes-implementation-details","title":"The Problem: Port Exposes Implementation Details","text":"<pre><code>// \u274c BAD: Port leaks Doctrine details\nnamespace App\\User\\Domain\\Port;\n\nuse Doctrine\\ORM\\QueryBuilder;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n\n    // \u274c Exposes Doctrine QueryBuilder!\n    public function createQueryBuilder(): QueryBuilder;\n\n    // \u274c Exposes Doctrine-specific method!\n    public function findBy(array $criteria, ?array $orderBy = null): array;\n}\n</code></pre> <p>Problem: Domain now depends on Doctrine. Cannot change to MongoDB without changing domain.</p>"},{"location":"advanced/anti-patterns-pitfalls/#the-solution-domain-centric-port","title":"The Solution: Domain-Centric Port","text":"<pre><code>// \u2705 GOOD: Port uses domain language only\nnamespace App\\User\\Domain\\Port;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findByEmail(Email $email): ?User;\n    public function findActiveUsers(): array; // array&lt;User&gt;\n}\n\n// Adapter implements port with Doctrine\nnamespace App\\User\\Infrastructure\\Persistence;\n\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function findActiveUsers(): array\n    {\n        // Doctrine details hidden in adapter\n        return $this-&gt;entityManager\n            -&gt;createQueryBuilder()\n            -&gt;select('u')\n            -&gt;from(User::class, 'u')\n            -&gt;where('u.isActive = :active')\n            -&gt;setParameter('active', true)\n            -&gt;getQuery()\n            -&gt;getResult();\n    }\n}\n</code></pre> <p>Benefits: - Domain independent of infrastructure - Can change database without touching domain - Clear, domain-specific API</p>"},{"location":"advanced/anti-patterns-pitfalls/#repository-as-service-locator","title":"Repository as Service Locator","text":""},{"location":"advanced/anti-patterns-pitfalls/#the-problem-repository-fetches-unrelated-entities","title":"The Problem: Repository Fetches Unrelated Entities","text":"<pre><code>// \u274c BAD: Order repository fetches customers and products\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void\n    {\n        // Fetch customer (unrelated to order persistence!)\n        $customer = $this-&gt;entityManager-&gt;find(Customer::class, $order-&gt;getCustomerId());\n\n        // Fetch products (unrelated to order persistence!)\n        foreach ($order-&gt;getItems() as $item) {\n            $product = $this-&gt;entityManager-&gt;find(Product::class, $item-&gt;getProductId());\n        }\n\n        $this-&gt;entityManager-&gt;persist($order);\n        $this-&gt;entityManager-&gt;flush();\n    }\n}\n</code></pre> <p>Problem: Repository becomes service locator, violates Single Responsibility.</p>"},{"location":"advanced/anti-patterns-pitfalls/#the-solution-repository-only-manages-its-aggregate","title":"The Solution: Repository Only Manages Its Aggregate","text":"<pre><code>// \u2705 GOOD: Order repository only manages orders\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void\n    {\n        $this-&gt;entityManager-&gt;persist($order);\n        $this-&gt;entityManager-&gt;flush();\n        // That's it! No fetching other entities\n    }\n\n    public function findById(OrderId $id): ?Order\n    {\n        return $this-&gt;entityManager-&gt;find(Order::class, $id-&gt;toString());\n    }\n}\n\n// Handler coordinates multiple repositories\nclass CreateOrderHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orders,\n        private CustomerRepositoryInterface $customers, // Separate repository\n        private ProductRepositoryInterface $products,   // Separate repository\n    ) {}\n\n    public function __invoke(CreateOrderCommand $command): void\n    {\n        // Handler fetches entities from their own repositories\n        $customer = $this-&gt;customers-&gt;findById($command-&gt;customerId);\n        // Validate customer...\n\n        foreach ($command-&gt;items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;productId);\n            // Validate product...\n        }\n\n        $order = OrderFactory::create($customer, $command-&gt;items);\n        $this-&gt;orders-&gt;save($order); // Order repository only saves orders\n    }\n}\n</code></pre>"},{"location":"advanced/anti-patterns-pitfalls/#transaction-management-issues","title":"Transaction Management Issues","text":""},{"location":"advanced/anti-patterns-pitfalls/#the-problem-nested-transactions-or-implicit-commits","title":"The Problem: Nested Transactions or Implicit Commits","text":"<pre><code>// \u274c BAD: Handler starts transaction, but repository also flushes\nclass CheckoutOrderHandler\n{\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n            $order-&gt;confirm();\n\n            $this-&gt;orders-&gt;save($order); // \u274c Calls flush() inside transaction!\n\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems()); // \u274c Also flushes!\n\n            $this-&gt;entityManager-&gt;commit(); // May commit already-flushed data\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback(); // May not rollback everything!\n            throw $e;\n        }\n    }\n}\n\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void\n    {\n        $this-&gt;entityManager-&gt;persist($order);\n        $this-&gt;entityManager-&gt;flush(); // \u274c Flushes immediately!\n    }\n}\n</code></pre> <p>Problem: Intermediate flushes prevent proper rollback.</p>"},{"location":"advanced/anti-patterns-pitfalls/#the-solution-explicit-transaction-control","title":"The Solution: Explicit Transaction Control","text":"<pre><code>// \u2705 GOOD: Handler controls transaction, repositories don't flush\nclass CheckoutOrderHandler\n{\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n            $order-&gt;confirm();\n\n            $this-&gt;orders-&gt;persist($order); // Just persist, don't flush\n\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems()); // Just persist\n\n            $this-&gt;entityManager-&gt;flush(); // Flush all changes at once\n            $this-&gt;entityManager-&gt;commit();\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n            throw $e;\n        }\n    }\n}\n\n// Repository: persist() method (no flush)\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function persist(Order $order): void\n    {\n        $this-&gt;entityManager-&gt;persist($order);\n        // No flush! Let handler control transaction\n    }\n\n    public function flush(): void\n    {\n        $this-&gt;entityManager-&gt;flush();\n    }\n}\n</code></pre> <p>Alternative: Use Doctrine's transactional wrapper</p> <pre><code>// \u2705 GOOD: Use transactional helper\nclass CheckoutOrderHandler\n{\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;wrapInTransaction(function() use ($command) {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n            $order-&gt;confirm();\n\n            $this-&gt;orders-&gt;persist($order);\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n\n            // Automatically flushes and commits, or rollbacks on exception\n        });\n    }\n}\n</code></pre>"},{"location":"advanced/anti-patterns-pitfalls/#cascade-delete-problems","title":"Cascade Delete Problems","text":""},{"location":"advanced/anti-patterns-pitfalls/#the-problem-accidental-cascade-deletes","title":"The Problem: Accidental Cascade Deletes","text":"<pre><code>// \u274c BAD: Deleting order deletes customer!\n#[ORM\\Entity]\nclass Order\n{\n    #[ORM\\ManyToOne(targetEntity: Customer::class, cascade: ['remove'])] // \u274c Wrong!\n    private Customer $customer;\n}\n\n// Deleting order accidentally deletes customer\n$this-&gt;orders-&gt;delete($order); // \u274c Customer also deleted!\n</code></pre> <p>Problem: Cascade operations can have unintended side effects.</p>"},{"location":"advanced/anti-patterns-pitfalls/#the-solution-explicit-aggregate-boundaries","title":"The Solution: Explicit Aggregate Boundaries","text":"<pre><code>// \u2705 GOOD: No cascade, explicit deletion\n#[ORM\\Entity]\nclass Order\n{\n    #[ORM\\ManyToOne(targetEntity: Customer::class)]\n    private Customer $customer; // No cascade\n}\n\n// Handler explicitly controls what gets deleted\nclass DeleteOrderHandler\n{\n    public function __invoke(DeleteOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        // Only delete order, not customer\n        $this-&gt;orders-&gt;delete($order);\n\n        // If needed, handle customer separately\n        // $this-&gt;customers-&gt;delete($order-&gt;getCustomer());\n    }\n}\n</code></pre> <p>Rule: Only cascade within aggregate boundaries.</p> <pre><code>// \u2705 GOOD: Cascade within aggregate\n#[ORM\\Entity]\nclass Order\n{\n    #[ORM\\OneToMany(\n        targetEntity: OrderItem::class,\n        mappedBy: 'order',\n        cascade: ['persist', 'remove'] // \u2705 OK: OrderItem is part of Order aggregate\n    )]\n    private array $items;\n}\n</code></pre>"},{"location":"advanced/anti-patterns-pitfalls/#over-engineering","title":"Over-Engineering","text":""},{"location":"advanced/anti-patterns-pitfalls/#the-problem-premature-abstraction","title":"The Problem: Premature Abstraction","text":"<pre><code>// \u274c BAD: Over-engineered for simple CRUD\ninterface UserCreatorInterface { /* ... */ }\ninterface UserUpdaterInterface { /* ... */ }\ninterface UserDeleterInterface { /* ... */ }\ninterface UserFinderInterface { /* ... */ }\ninterface UserValidatorInterface { /* ... */ }\ninterface UserFactoryInterface { /* ... */ }\ninterface UserMapperInterface { /* ... */ }\n\nclass UserCreator implements UserCreatorInterface { /* ... */ }\nclass UserUpdater implements UserUpdaterInterface { /* ... */ }\n// ... 10 more classes for simple user management\n</code></pre> <p>Problem: Too many abstractions for simple operations.</p>"},{"location":"advanced/anti-patterns-pitfalls/#the-solution-start-simple-refactor-when-needed","title":"The Solution: Start Simple, Refactor When Needed","text":"<pre><code>// \u2705 GOOD: Simple interface for simple needs\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findByEmail(Email $email): ?User;\n    public function delete(User $user): void;\n}\n\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    // Simple implementation\n}\n\n// Refactor into separate interfaces ONLY when:\n// - Multiple implementations needed\n// - Interface becomes too large\n// - Different clients need different methods\n</code></pre> <p>Rule: YAGNI (You Ain't Gonna Need It) - Don't add complexity until it's needed.</p>"},{"location":"advanced/anti-patterns-pitfalls/#testing-anti-patterns","title":"Testing Anti-Patterns","text":""},{"location":"advanced/anti-patterns-pitfalls/#anti-pattern-1-testing-implementation-details","title":"Anti-Pattern 1: Testing Implementation Details","text":"<pre><code>// \u274c BAD: Testing internal state instead of behavior\nclass OrderTest extends TestCase\n{\n    public function test_ship_order(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::CONFIRMED);\n\n        $order-&gt;ship();\n\n        // \u274c Testing private property directly (using reflection)\n        $reflection = new \\ReflectionClass($order);\n        $property = $reflection-&gt;getProperty('status');\n        $property-&gt;setAccessible(true);\n\n        $this-&gt;assertEquals(OrderStatus::SHIPPED, $property-&gt;getValue($order));\n    }\n}\n</code></pre> <p>Problem: Test is coupled to implementation, breaks when refactoring.</p>"},{"location":"advanced/anti-patterns-pitfalls/#solution-test-behavior-not-state","title":"Solution: Test Behavior, Not State","text":"<pre><code>// \u2705 GOOD: Test public behavior\nclass OrderTest extends TestCase\n{\n    public function test_ship_order(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::CONFIRMED);\n\n        $order-&gt;ship();\n\n        // Test public method\n        $this-&gt;assertEquals(OrderStatus::SHIPPED, $order-&gt;getStatus());\n        $this-&gt;assertNotNull($order-&gt;getShippedAt());\n    }\n\n    public function test_cannot_ship_cancelled_order(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::CANCELLED);\n\n        $this-&gt;expectException(CannotShipCancelledOrderException::class);\n\n        $order-&gt;ship();\n    }\n}\n</code></pre>"},{"location":"advanced/anti-patterns-pitfalls/#anti-pattern-2-mocking-everything","title":"Anti-Pattern 2: Mocking Everything","text":"<pre><code>// \u274c BAD: Mocking value objects and entities\nclass RegisterUserHandlerTest extends TestCase\n{\n    public function test_registers_user(): void\n    {\n        $user = $this-&gt;createMock(User::class); // \u274c Mocking entity\n        $email = $this-&gt;createMock(Email::class); // \u274c Mocking value object\n\n        $factory = $this-&gt;createMock(UserFactory::class);\n        $factory-&gt;method('create')-&gt;willReturn($user);\n\n        $repository = $this-&gt;createMock(UserRepositoryInterface::class);\n        $repository-&gt;expects($this-&gt;once())-&gt;method('save')-&gt;with($user);\n\n        $handler = new RegisterUserHandler($factory, $repository);\n        $handler(new RegisterUserCommand('test@example.com', 'password'));\n    }\n}\n</code></pre> <p>Problem: Mocking domain objects defeats the purpose of testing.</p>"},{"location":"advanced/anti-patterns-pitfalls/#solution-use-real-domain-objects-mock-only-infrastructure","title":"Solution: Use Real Domain Objects, Mock Only Infrastructure","text":"<pre><code>// \u2705 GOOD: Real domain objects, mock infrastructure\nclass RegisterUserHandlerTest extends TestCase\n{\n    public function test_registers_user(): void\n    {\n        // Real factory and entities\n        $repository = new InMemoryUserRepository(); // Fake infrastructure\n\n        $handler = new RegisterUserHandler($repository);\n\n        $handler(new RegisterUserCommand('test@example.com', 'ValidPass123'));\n\n        // Verify using real repository\n        $this-&gt;assertTrue($repository-&gt;existsByEmail('test@example.com'));\n\n        $user = $repository-&gt;findByEmail('test@example.com');\n        $this-&gt;assertFalse($user-&gt;isActive());\n    }\n}\n</code></pre>"},{"location":"advanced/anti-patterns-pitfalls/#anti-pattern-3-not-testing-error-cases","title":"Anti-Pattern 3: Not Testing Error Cases","text":"<pre><code>// \u274c BAD: Only testing happy path\nclass OrderTest extends TestCase\n{\n    public function test_create_order(): void\n    {\n        $order = OrderFactory::create($customerId, $items);\n\n        $this-&gt;assertInstanceOf(Order::class, $order);\n    }\n\n    // \u274c Missing: test empty items, invalid customer, etc.\n}\n</code></pre>"},{"location":"advanced/anti-patterns-pitfalls/#solution-test-error-cases-thoroughly","title":"Solution: Test Error Cases Thoroughly","text":"<pre><code>// \u2705 GOOD: Test both success and failure\nclass OrderTest extends TestCase\n{\n    public function test_create_order_with_valid_data(): void\n    {\n        $order = OrderFactory::create($customerId, $items);\n        $this-&gt;assertInstanceOf(Order::class, $order);\n    }\n\n    public function test_throws_when_no_items(): void\n    {\n        $this-&gt;expectException(OrderMustHaveItemsException::class);\n        OrderFactory::create($customerId, []);\n    }\n\n    public function test_throws_when_total_below_minimum(): void\n    {\n        $this-&gt;expectException(OrderBelowMinimumException::class);\n        OrderFactory::create($customerId, $cheapItems);\n    }\n\n    public function test_cannot_ship_cancelled_order(): void\n    {\n        $this-&gt;expectException(CannotShipCancelledOrderException::class);\n        $order = new Order(OrderId::generate(), OrderStatus::CANCELLED);\n        $order-&gt;ship();\n    }\n}\n</code></pre>"},{"location":"advanced/anti-patterns-pitfalls/#summary-checklist","title":"Summary Checklist","text":""},{"location":"advanced/anti-patterns-pitfalls/#avoid-these-anti-patterns","title":"\u2705 Avoid These Anti-Patterns","text":"<ul> <li> Anemic Domain Model - Entities should have behavior, not just getters/setters</li> <li> God Objects - Handlers should orchestrate, not implement everything</li> <li> Leaky Abstractions - Ports should use domain language, not expose infrastructure</li> <li> Repository as Service Locator - Repositories manage one aggregate only</li> <li> Transaction Management Issues - Control transactions explicitly in handlers</li> <li> Cascade Delete Problems - Only cascade within aggregate boundaries</li> <li> Over-Engineering - Start simple, refactor when needed (YAGNI)</li> <li> Testing Implementation Details - Test behavior, not internal state</li> <li> Mocking Everything - Use real domain objects, mock only infrastructure</li> <li> Not Testing Error Cases - Test failure scenarios thoroughly</li> </ul>"},{"location":"advanced/anti-patterns-pitfalls/#quick-reference-good-vs-bad","title":"Quick Reference: Good vs Bad","text":"Anti-Pattern Good Practice Getters/setters everywhere Entity methods expressing behavior 500-line handler Decomposed into handler + factory + services Port returns QueryBuilder Port returns domain objects Repository fetches other entities Handler coordinates multiple repositories Repository calls flush() Handler controls transactions Cascade delete everywhere Explicit deletes, cascade only within aggregates Interface for everything Start simple, refactor when needed Test private properties Test public behavior Mock entities Use real entities, mock infrastructure Only test happy path Test errors and edge cases <p>That's it! You now have a complete guide to avoiding common pitfalls in hexagonal architecture. Good luck! \ud83c\udf89</p>"},{"location":"advanced/cqrs-cost-benefit/","title":"CQRS: When to Use It, When to Avoid It","text":""},{"location":"advanced/cqrs-cost-benefit/#table-of-contents","title":"Table of Contents","text":"<ol> <li>What is CQRS?</li> <li>The Core Problem CQRS Solves</li> <li>Cost-Benefit Analysis</li> <li>When to Use CQRS</li> <li>When NOT to Use CQRS</li> <li>Implementation Levels</li> <li>Real-World Decision Examples</li> <li>Migration Strategy</li> </ol>"},{"location":"advanced/cqrs-cost-benefit/#what-is-cqrs","title":"What is CQRS?","text":"<p>CQRS = Command Query Responsibility Segregation</p> <p>Separate the model that writes data (Commands) from the model that reads data (Queries).</p>"},{"location":"advanced/cqrs-cost-benefit/#traditional-approach-single-model","title":"Traditional Approach (Single Model)","text":"<pre><code>// One repository handles both reads and writes\ninterface UserRepositoryInterface\n{\n    // Writes\n    public function save(User $user): void;\n    public function delete(User $user): void;\n\n    // Reads\n    public function findById(UserId $id): ?User;\n    public function findAll(): array;\n    public function findActiveUsers(): array;\n}\n</code></pre>"},{"location":"advanced/cqrs-cost-benefit/#cqrs-approach-separate-models","title":"CQRS Approach (Separate Models)","text":"<pre><code>// Write model (Commands)\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function delete(User $user): void;\n}\n\n// Read model (Queries)\ninterface UserQueryInterface\n{\n    public function findById(UserId $id): ?UserDTO;\n    public function findAll(): array; // array&lt;UserDTO&gt;\n    public function findActiveUsers(): array;\n}\n</code></pre>"},{"location":"advanced/cqrs-cost-benefit/#the-core-problem-cqrs-solves","title":"The Core Problem CQRS Solves","text":""},{"location":"advanced/cqrs-cost-benefit/#problem-1-read-and-write-have-different-needs","title":"Problem 1: Read and Write Have Different Needs","text":"Concern Writes (Commands) Reads (Queries) Focus Business rules, consistency Speed, denormalization Model Rich domain entities Simple DTOs Validation Complex business logic None (already validated) Performance Can be slower (transactional) Must be fast (cached) Complexity Complex object graphs Flat projections <p>Example: E-Commerce Order</p> <pre><code>// WRITE: Complex entity with business logic\nclass Order\n{\n    private OrderId $id;\n    private CustomerId $customerId;\n    private array $items; // OrderItem[]\n    private Money $totalAmount;\n    private OrderStatus $status;\n\n    public function addItem(Product $product, int $quantity): void\n    {\n        // Complex business rules\n        if ($this-&gt;status !== OrderStatus::DRAFT) {\n            throw new CannotModifyConfirmedOrderException();\n        }\n\n        if ($quantity &lt;= 0) {\n            throw new InvalidQuantityException();\n        }\n\n        $this-&gt;items[] = new OrderItem($product, $quantity);\n        $this-&gt;recalculateTotal();\n    }\n}\n\n// READ: Simple DTO for display\nfinal readonly class OrderListDTO\n{\n    public function __construct(\n        public string $orderId,\n        public string $customerName,\n        public int $totalAmountCents,\n        public string $status,\n        public string $createdAt,\n    ) {}\n}\n</code></pre> <p>Why separation helps: - Write model can be complex (business logic) - Read model can be simple (just data for display) - Each optimized for its purpose</p>"},{"location":"advanced/cqrs-cost-benefit/#problem-2-conflicting-query-patterns","title":"Problem 2: Conflicting Query Patterns","text":"<p>Write queries need: - Entity relationships preserved - Transactional consistency - Full object graphs</p> <p>Read queries need: - Denormalized data (joins avoided) - Aggressive caching - Pagination, filtering, sorting</p> <pre><code>// \u274c Trying to serve both needs with one model leads to compromise\n\n// Write: needs full entity\n$order = $this-&gt;orders-&gt;findById($orderId); // Loads Order with all relationships\n$order-&gt;addItem($product, 2);\n$this-&gt;orders-&gt;save($order);\n\n// Read: needs flat data for display\n$orders = $this-&gt;orders-&gt;findAllOrders(); // Same repository!\n// But we don't need full entities with business logic for display...\n// We load too much data, waste memory, and it's slow\n</code></pre> <p>CQRS solution: Different models for different needs.</p>"},{"location":"advanced/cqrs-cost-benefit/#cost-benefit-analysis","title":"Cost-Benefit Analysis","text":""},{"location":"advanced/cqrs-cost-benefit/#benefits-of-cqrs","title":"\u2705 Benefits of CQRS","text":""},{"location":"advanced/cqrs-cost-benefit/#1-optimized-performance","title":"1. Optimized Performance","text":"<p>Write side: <pre><code>// Complex entity with business logic\n$order-&gt;confirm(); // Rich domain logic\n$this-&gt;orders-&gt;save($order);\n</code></pre></p> <p>Read side: <pre><code>// Optimized SQL query, returns flat DTO\n$orders = $this-&gt;queryBus-&gt;dispatch(new FindOrdersQuery());\n// SELECT o.id, o.status, c.name AS customer_name, ...\n// FROM orders o JOIN customers c ON ...\n// Flat result, no hydration overhead\n</code></pre></p> <p>Benefit: Reads can be aggressively optimized (denormalization, caching) without affecting write model.</p>"},{"location":"advanced/cqrs-cost-benefit/#2-simplified-read-logic","title":"2. Simplified Read Logic","text":"<pre><code>// \u274c Without CQRS: read uses complex entity\n$user = $this-&gt;users-&gt;findById($userId); // Returns full User entity\nreturn new UserResponse(\n    id: $user-&gt;getId()-&gt;toString(),\n    email: $user-&gt;getEmail()-&gt;value,\n    name: $user-&gt;getName(),\n    // Extract data from complex entity\n);\n\n// \u2705 With CQRS: read returns DTO directly\n$userDTO = $this-&gt;queries-&gt;findById($userId); // Returns UserDTO\nreturn $userDTO; // Already in the right format\n</code></pre>"},{"location":"advanced/cqrs-cost-benefit/#3-scalability-independent-scaling","title":"3. Scalability: Independent Scaling","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Write DB    \u2502         \u2502  Read DB    \u2502\n\u2502 (Master)    \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502  (Replicas) \u2502\n\u2502             \u2502  Sync   \u2502             \u2502\n\u2502 1 instance  \u2502         \u2502 10 replicas \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2191                       \u2191\n   10% traffic            90% traffic\n</code></pre> <p>Benefit: Scale read and write sides independently based on load.</p>"},{"location":"advanced/cqrs-cost-benefit/#4-eventual-consistency-when-acceptable","title":"4. Eventual Consistency (When Acceptable)","text":"<pre><code>// Command: Write immediately\n$this-&gt;commandBus-&gt;dispatch(new CreateOrderCommand(...));\n// Order saved to write DB\n\n// Query: Read from replica (might be slightly delayed)\n$orders = $this-&gt;queryBus-&gt;dispatch(new FindOrdersQuery());\n// Reads from read replica (eventual consistency)\n</code></pre> <p>Benefit: Accept slight delay in reads to achieve better write throughput.</p>"},{"location":"advanced/cqrs-cost-benefit/#5-better-security-read-only-views","title":"5. Better Security: Read-Only Views","text":"<pre><code>// Read model: expose only safe data\ninterface PublicUserQueryInterface\n{\n    public function findByUsername(string $username): ?PublicUserDTO;\n    // Returns: username, bio, avatar (safe fields)\n}\n\n// Write model: contains sensitive data\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    // User entity contains password hash, email (sensitive)\n}\n</code></pre> <p>Benefit: Read models can expose different projections for different users (public vs admin).</p>"},{"location":"advanced/cqrs-cost-benefit/#costs-of-cqrs","title":"\u274c Costs of CQRS","text":""},{"location":"advanced/cqrs-cost-benefit/#1-increased-complexity","title":"1. Increased Complexity","text":"<p>Without CQRS (simple): <pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n}\n\n// 1 interface, 1 implementation, 1 model\n</code></pre></p> <p>With CQRS (complex): <pre><code>interface UserRepositoryInterface { /* write methods */ }\ninterface UserQueryInterface { /* read methods */ }\n\nclass DoctrineUserRepository implements UserRepositoryInterface { /* ... */ }\nclass DoctrineUserQuery implements UserQueryInterface { /* ... */ }\n\n// 2 interfaces, 2 implementations, 2 models (entity + DTO)\n</code></pre></p> <p>Cost: Double the code, double the maintenance.</p>"},{"location":"advanced/cqrs-cost-benefit/#2-synchronization-overhead","title":"2. Synchronization Overhead","text":"<p>If write and read databases are separate:</p> <pre><code>// Write to write DB\n$this-&gt;commandBus-&gt;dispatch(new CreateUserCommand(...));\n\n// Must sync to read DB\n$this-&gt;eventBus-&gt;dispatch(new UserCreatedEvent(...));\n\n// Event handler updates read DB\nclass UserCreatedEventHandler\n{\n    public function __invoke(UserCreatedEvent $event): void\n    {\n        $this-&gt;readDatabase-&gt;insertUser(...); // Sync!\n    }\n}\n</code></pre> <p>Cost: Extra infrastructure (message queues, event handlers, sync logic).</p>"},{"location":"advanced/cqrs-cost-benefit/#3-eventual-consistency-issues","title":"3. Eventual Consistency Issues","text":"<pre><code>// User creates account\n$this-&gt;commandBus-&gt;dispatch(new RegisterUserCommand(...));\n\n// Immediately tries to log in\n$user = $this-&gt;queries-&gt;findByEmail($email);\n// \u274c Might return null if read DB not yet synced!\n</code></pre> <p>Cost: Must handle \"read your own writes\" problem, adding complexity.</p>"},{"location":"advanced/cqrs-cost-benefit/#4-development-time","title":"4. Development Time","text":"Task Without CQRS With CQRS Add new entity 1 repository 1 repository + 1 query interface + sync Add new read operation Add method to repository Add method to query interface Add new write operation Add method to repository Add method + event + sync handler Testing Test repository Test repository + query + sync + eventual consistency <p>Cost: 30-50% more development time for CRUD operations.</p>"},{"location":"advanced/cqrs-cost-benefit/#5-team-learning-curve","title":"5. Team Learning Curve","text":"<ul> <li>Developers must understand:</li> <li>Command vs Query separation</li> <li>Event-driven architecture</li> <li>Eventual consistency</li> <li>Message queues</li> <li>Read model synchronization</li> </ul> <p>Cost: Training time, mistakes during learning phase.</p>"},{"location":"advanced/cqrs-cost-benefit/#when-to-use-cqrs","title":"When to Use CQRS","text":""},{"location":"advanced/cqrs-cost-benefit/#good-use-cases","title":"\u2705 Good Use Cases","text":""},{"location":"advanced/cqrs-cost-benefit/#1-high-readwrite-ratio-90-reads","title":"1. High Read/Write Ratio (90%+ reads)","text":"<p>Example: Analytics Dashboard</p> <pre><code>// Writes: rare (once per hour, background job)\n$this-&gt;commandBus-&gt;dispatch(new GenerateReportCommand(...));\n\n// Reads: frequent (thousands per second)\n$report = $this-&gt;queries-&gt;getReport($reportId);\n</code></pre> <p>Why CQRS helps: Optimize read side aggressively (caching, denormalization) without impacting rare writes.</p>"},{"location":"advanced/cqrs-cost-benefit/#2-complex-reporting-requirements","title":"2. Complex Reporting Requirements","text":"<p>Example: E-Commerce Admin Dashboard</p> <pre><code>// Write model: normalized entities\nOrder -&gt; OrderItem -&gt; Product\nCustomer -&gt; Address\n\n// Read model: denormalized view\ninterface AdminDashboardQueryInterface\n{\n    public function getOrderSummary(): OrderSummaryDTO;\n    // Returns: total orders, revenue, avg order value, top products\n    // All denormalized in a single optimized query\n}\n</code></pre> <p>Why CQRS helps: Read model can be denormalized for fast reporting without polluting write model.</p>"},{"location":"advanced/cqrs-cost-benefit/#3-multiple-read-representations","title":"3. Multiple Read Representations","text":"<p>Example: Product Catalog</p> <pre><code>// Write model: single Product entity\nclass Product { /* business logic */ }\n\n// Read models: multiple projections\ninterface ProductListQueryInterface\n{\n    public function findAll(): array; // Simple list\n}\n\ninterface ProductDetailQueryInterface\n{\n    public function findById(ProductId $id): ProductDetailDTO; // Full details\n}\n\ninterface ProductSearchQueryInterface\n{\n    public function search(string $query): array; // Elasticsearch\n}\n</code></pre> <p>Why CQRS helps: Different read models for different use cases without coupling.</p>"},{"location":"advanced/cqrs-cost-benefit/#4-different-consistency-requirements","title":"4. Different Consistency Requirements","text":"<pre><code>// Write: must be strongly consistent\n$this-&gt;orderRepository-&gt;save($order); // Immediate consistency\n\n// Read: can be eventually consistent\n$orders = $this-&gt;orderQuery-&gt;findRecent(); // Slight delay OK\n</code></pre> <p>Why CQRS helps: Accept eventual consistency on reads to improve write throughput.</p>"},{"location":"advanced/cqrs-cost-benefit/#5-audit-trail-event-sourcing","title":"5. Audit Trail / Event Sourcing","text":"<pre><code>// Write: events stored\n$this-&gt;commandBus-&gt;dispatch(new UpdatePriceCommand(...));\n// Produces: PriceUpdatedEvent stored in event store\n\n// Read: materialized view from events\n$product = $this-&gt;queries-&gt;findById($productId);\n// Rebuilt from events or cached projection\n</code></pre> <p>Why CQRS helps: Natural fit with event sourcing (events = write model, projections = read model).</p>"},{"location":"advanced/cqrs-cost-benefit/#when-not-to-use-cqrs","title":"When NOT to Use CQRS","text":""},{"location":"advanced/cqrs-cost-benefit/#bad-use-cases","title":"\u274c Bad Use Cases","text":""},{"location":"advanced/cqrs-cost-benefit/#1-simple-crud-applications","title":"1. Simple CRUD Applications","text":"<pre><code>// Just create, read, update, delete users\n// \u274c CQRS is overkill here\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findAll(): array;\n    public function delete(User $user): void;\n}\n\n// \u2705 Single repository is enough\n</code></pre> <p>Why avoid CQRS: No performance bottleneck, no complex queries, unnecessary complexity.</p>"},{"location":"advanced/cqrs-cost-benefit/#2-strong-consistency-required-everywhere","title":"2. Strong Consistency Required Everywhere","text":"<pre><code>// Banking: user checks balance, then withdraws\n$balance = $this-&gt;accountQuery-&gt;getBalance($accountId);\n// \u274c If read DB is out of sync, shows wrong balance!\n\n$this-&gt;commandBus-&gt;dispatch(new WithdrawCommand($accountId, $amount));\n// \u274c Might allow overdraft due to stale read\n</code></pre> <p>Why avoid CQRS: Eventual consistency can cause bugs in scenarios requiring strong consistency.</p>"},{"location":"advanced/cqrs-cost-benefit/#3-small-team-tight-deadlines","title":"3. Small Team, Tight Deadlines","text":"<ul> <li>2-3 developers</li> <li>3-month deadline</li> <li>Simple web app</li> </ul> <p>Why avoid CQRS: Overhead not worth it, will slow down delivery.</p>"},{"location":"advanced/cqrs-cost-benefit/#4-low-traffic","title":"4. Low Traffic","text":"<ul> <li>100 users per day</li> <li>10 requests per minute</li> </ul> <p>Why avoid CQRS: No performance problem to solve, premature optimization.</p>"},{"location":"advanced/cqrs-cost-benefit/#5-write-heavy-systems","title":"5. Write-Heavy Systems","text":"<ul> <li>Logging system (writes &gt;&gt; reads)</li> <li>Data ingestion pipeline</li> </ul> <p>Why avoid CQRS: CQRS optimizes reads, but this system is write-heavy.</p>"},{"location":"advanced/cqrs-cost-benefit/#implementation-levels","title":"Implementation Levels","text":""},{"location":"advanced/cqrs-cost-benefit/#level-0-single-model-no-cqrs","title":"Level 0: Single Model (No CQRS)","text":"<pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n}\n</code></pre> <p>Complexity: Low When to use: Small apps, simple CRUD</p>"},{"location":"advanced/cqrs-cost-benefit/#level-1-separate-interfaces-same-database","title":"Level 1: Separate Interfaces, Same Database","text":"<pre><code>// Write interface\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n}\n\n// Read interface\ninterface UserQueryInterface\n{\n    public function findById(UserId $id): ?UserDTO;\n}\n\n// Both use same database, different interfaces\n</code></pre> <p>Complexity: Medium When to use: Logical separation, same DB</p>"},{"location":"advanced/cqrs-cost-benefit/#level-2-separate-models-same-database","title":"Level 2: Separate Models, Same Database","text":"<pre><code>// Write: uses entities\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void { /* ORM */ }\n}\n\n// Read: uses raw SQL\nclass SqlUserQuery implements UserQueryInterface\n{\n    public function findById(UserId $id): ?UserDTO\n    {\n        // Raw SQL optimized for reads\n        $stmt = $this-&gt;connection-&gt;executeQuery('SELECT ...');\n        return $this-&gt;hydrateDTO($stmt-&gt;fetchAssociative());\n    }\n}\n</code></pre> <p>Complexity: Medium-High When to use: Optimize reads, still single DB</p>"},{"location":"advanced/cqrs-cost-benefit/#level-3-separate-databases-full-cqrs","title":"Level 3: Separate Databases (Full CQRS)","text":"<pre><code>// Write: Master DB\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        $this-&gt;entityManager-&gt;persist($user); // Write DB\n        $this-&gt;eventBus-&gt;dispatch(new UserSavedEvent($user)); // Trigger sync\n    }\n}\n\n// Read: Replica DB\nclass ReplicaUserQuery implements UserQueryInterface\n{\n    public function findById(UserId $id): ?UserDTO\n    {\n        return $this-&gt;replicaConnection-&gt;fetchOne(...); // Read DB\n    }\n}\n\n// Event handler syncs write \u2192 read\nclass UserSavedEventHandler\n{\n    public function __invoke(UserSavedEvent $event): void\n    {\n        $this-&gt;readDatabase-&gt;upsertUser(...); // Sync\n    }\n}\n</code></pre> <p>Complexity: High When to use: High scale, independent scaling needed</p>"},{"location":"advanced/cqrs-cost-benefit/#real-world-decision-examples","title":"Real-World Decision Examples","text":""},{"location":"advanced/cqrs-cost-benefit/#example-1-blog-platform","title":"Example 1: Blog Platform","text":"<p>Scenario: - 10,000 articles - 1M page views/month - 50 new articles/day</p> <p>Reads: Viewing articles (99% of traffic) Writes: Publishing articles (1% of traffic)</p> <p>Decision: \u2705 Use CQRS Level 1</p> <pre><code>// Write: entity with business logic\ninterface ArticleRepositoryInterface\n{\n    public function save(Article $article): void;\n}\n\n// Read: optimized DTOs\ninterface ArticleQueryInterface\n{\n    public function findPublished(int $limit, int $offset): array;\n    public function findBySlug(string $slug): ?ArticleDetailDTO;\n}\n</code></pre> <p>Reason: High read/write ratio, same DB is fine, logical separation helps.</p>"},{"location":"advanced/cqrs-cost-benefit/#example-2-simple-todo-app","title":"Example 2: Simple Todo App","text":"<p>Scenario: - 1,000 users - Simple CRUD (create, read, update, delete tasks) - Low traffic</p> <p>Decision: \u274c Don't use CQRS</p> <pre><code>// Single repository is enough\ninterface TaskRepositoryInterface\n{\n    public function save(Task $task): void;\n    public function findById(TaskId $id): ?Task;\n    public function findByUser(UserId $userId): array;\n    public function delete(Task $task): void;\n}\n</code></pre> <p>Reason: No performance issue, no complex queries, CQRS adds unnecessary complexity.</p>"},{"location":"advanced/cqrs-cost-benefit/#example-3-e-commerce-platform","title":"Example 3: E-Commerce Platform","text":"<p>Scenario: - 100,000 products - 10,000 orders/day - Complex admin dashboard (sales reports, inventory, analytics)</p> <p>Decision: \u2705 Use CQRS Level 2-3</p> <pre><code>// Write: normalized entities\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n}\n\n// Read: denormalized projections\ninterface AdminDashboardQueryInterface\n{\n    public function getSalesReport(): SalesReportDTO;\n    public function getInventoryStatus(): InventoryDTO;\n}\n\ninterface OrderQueryInterface\n{\n    public function findRecent(int $limit): array;\n}\n</code></pre> <p>Reason: Complex reporting, high read volume, eventual consistency acceptable for dashboards.</p>"},{"location":"advanced/cqrs-cost-benefit/#example-4-banking-system","title":"Example 4: Banking System","text":"<p>Scenario: - Account balances must be accurate - Transactions must be strongly consistent</p> <p>Decision: \u274c Don't use CQRS (or use Level 1 only)</p> <pre><code>// Single model, strong consistency\ninterface AccountRepositoryInterface\n{\n    public function save(Account $account): void;\n    public function findById(AccountId $id): ?Account;\n    // Same DB, immediate consistency\n}\n</code></pre> <p>Reason: Strong consistency required, eventual consistency unacceptable.</p>"},{"location":"advanced/cqrs-cost-benefit/#migration-strategy","title":"Migration Strategy","text":""},{"location":"advanced/cqrs-cost-benefit/#step-1-identify-candidates","title":"Step 1: Identify Candidates","text":"<p>Look for: - \u2705 High read/write ratio - \u2705 Complex queries - \u2705 Performance bottlenecks on reads</p>"},{"location":"advanced/cqrs-cost-benefit/#step-2-start-with-level-1-same-db-separate-interfaces","title":"Step 2: Start with Level 1 (Same DB, Separate Interfaces)","text":"<pre><code>// Split repository into write + read\n// Before:\ninterface UserRepositoryInterface { /* all methods */ }\n\n// After:\ninterface UserRepositoryInterface { /* write methods */ }\ninterface UserQueryInterface { /* read methods */ }\n</code></pre> <p>Benefit: Logical separation, low risk.</p>"},{"location":"advanced/cqrs-cost-benefit/#step-3-optimize-read-queries","title":"Step 3: Optimize Read Queries","text":"<pre><code>// Read interface uses raw SQL instead of ORM\nclass SqlUserQuery implements UserQueryInterface\n{\n    public function findAll(): array\n    {\n        // Optimized SQL with caching\n        return $this-&gt;cache-&gt;remember('users.all', function() {\n            return $this-&gt;connection-&gt;fetchAllAssociative('SELECT ...');\n        });\n    }\n}\n</code></pre>"},{"location":"advanced/cqrs-cost-benefit/#step-4-consider-separate-read-db-if-needed","title":"Step 4: Consider Separate Read DB (If Needed)","text":"<p>Only if: - Read load is too high for single DB - Need independent scaling</p>"},{"location":"advanced/cqrs-cost-benefit/#decision-flowchart","title":"Decision Flowchart","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'12px'}}}%%\ngraph TD\n    Start[Need to separate reads/writes?] --&gt; Q1{Simple CRUD?}\n\n    Q1 --&gt;|Yes| NoCQRS[\u274c DON'T use CQRS&lt;br/&gt;Single repository is fine]\n    Q1 --&gt;|No| Q2{High read/write ratio?&lt;br/&gt;90%+ reads?}\n\n    Q2 --&gt;|No| Q3{Complex reporting?}\n    Q2 --&gt;|Yes| Level1[\u2705 Use CQRS Level 1&lt;br/&gt;Separate interfaces, same DB]\n\n    Q3 --&gt;|No| Q4{Strong consistency&lt;br/&gt;required everywhere?}\n    Q3 --&gt;|Yes| Level1\n\n    Q4 --&gt;|Yes| NoCQRS\n    Q4 --&gt;|No| Q5{Performance&lt;br/&gt;bottleneck on reads?}\n\n    Q5 --&gt;|No| NoCQRS\n    Q5 --&gt;|Yes| Q6{Need separate&lt;br/&gt;read database?}\n\n    Q6 --&gt;|No| Level2[\u2705 Use CQRS Level 2&lt;br/&gt;Separate models, same DB]\n    Q6 --&gt;|Yes| Level3[\u2705 Use CQRS Level 3&lt;br/&gt;Separate databases]\n\n    style NoCQRS fill:#FFCDD2,stroke:#C62828,stroke-width:2px\n    style Level1 fill:#C8E6C9,stroke:#2E7D32,stroke-width:2px\n    style Level2 fill:#FFF9C4,stroke:#F57F17,stroke-width:2px\n    style Level3 fill:#B3E5FC,stroke:#0277BD,stroke-width:2px</code></pre>"},{"location":"advanced/cqrs-cost-benefit/#summary","title":"Summary","text":""},{"location":"advanced/cqrs-cost-benefit/#use-cqrs-when","title":"\u2705 Use CQRS When:","text":"<ol> <li>High read/write ratio (90%+ reads)</li> <li>Complex reporting requirements</li> <li>Different consistency requirements (eventual consistency acceptable)</li> <li>Performance bottleneck on reads</li> <li>Multiple read representations needed</li> </ol>"},{"location":"advanced/cqrs-cost-benefit/#avoid-cqrs-when","title":"\u274c Avoid CQRS When:","text":"<ol> <li>Simple CRUD application</li> <li>Strong consistency required everywhere</li> <li>Small team, tight deadlines</li> <li>Low traffic, no performance issues</li> <li>Write-heavy system</li> </ol>"},{"location":"advanced/cqrs-cost-benefit/#golden-rule","title":"\ud83c\udfaf Golden Rule:","text":"<p>Don't use CQRS by default. Add it when you have a proven performance problem or complex read requirements.</p> <p>Next: Dependency Injection Configuration \u2192</p>"},{"location":"advanced/dependency-injection-guide/","title":"Dependency Injection Configuration Guide","text":""},{"location":"advanced/dependency-injection-guide/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Overview</li> <li>Symfony Autowiring Basics</li> <li>Binding Ports to Adapters</li> <li>Environment-Specific Bindings</li> <li>Tagged Services</li> <li>Service Decoration</li> <li>Complete Configuration Examples</li> <li>Troubleshooting</li> </ol>"},{"location":"advanced/dependency-injection-guide/#overview","title":"Overview","text":"<p>In hexagonal architecture, Dependency Injection (DI) is critical for binding ports (interfaces) to adapters (implementations). Symfony's DI container handles this wiring automatically with proper configuration.</p>"},{"location":"advanced/dependency-injection-guide/#the-problem-di-solves","title":"The Problem DI Solves","text":"<pre><code>// \u274c Without DI: Hard-coded dependency\nclass RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        $repository = new DoctrineUserRepository(); // \u274c Tight coupling!\n        // ...\n    }\n}\n\n// \u2705 With DI: Injected dependency\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users // \u2705 Interface, not implementation\n    ) {}\n\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        $this-&gt;users-&gt;save(...); // Uses whatever implementation is configured\n    }\n}\n</code></pre> <p>DI Container Configuration: Tells Symfony \"when someone needs <code>UserRepositoryInterface</code>, give them <code>DoctrineUserRepository</code>\".</p>"},{"location":"advanced/dependency-injection-guide/#symfony-autowiring-basics","title":"Symfony Autowiring Basics","text":""},{"location":"advanced/dependency-injection-guide/#what-is-autowiring","title":"What is Autowiring?","text":"<p>Autowiring: Symfony automatically resolves constructor dependencies by looking at type hints.</p> <pre><code>// Handler with type-hinted dependencies\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users,      // Autowired\n        private EmailSenderInterface $emailSender,   // Autowired\n        private EventDispatcherInterface $events,    // Autowired\n    ) {}\n}\n</code></pre> <p>Symfony sees these type hints and automatically provides the correct services.</p>"},{"location":"advanced/dependency-injection-guide/#enabling-autowiring","title":"Enabling Autowiring","text":"<p>In <code>config/services.yaml</code>:</p> <pre><code>services:\n    _defaults:\n        autowire: true      # Enable autowiring\n        autoconfigure: true # Automatically configure services (tags, etc.)\n        public: false       # Services are private by default\n\n    # Auto-register all classes in src/ as services\n    App\\:\n        resource: '../src/'\n        exclude:\n            - '../src/DependencyInjection/'\n            - '../src/*/Domain/Model/'      # Exclude entities\n            - '../src/*/Domain/ValueObject/' # Exclude value objects\n            - '../src/Kernel.php'\n</code></pre> <p>How it works: 1. Symfony scans <code>src/</code> directory 2. Registers each class as a service 3. Autowires constructor dependencies</p>"},{"location":"advanced/dependency-injection-guide/#binding-ports-to-adapters","title":"Binding Ports to Adapters","text":""},{"location":"advanced/dependency-injection-guide/#the-core-configuration","title":"The Core Configuration","text":"<p>Problem: Interface cannot be instantiated\u2014Symfony needs to know which implementation to use.</p> <pre><code>// Handler needs UserRepositoryInterface\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users // \u274c Interface, cannot be instantiated!\n    ) {}\n}\n</code></pre> <p>Solution: Bind interface to implementation in <code>services.yaml</code>.</p>"},{"location":"advanced/dependency-injection-guide/#method-1-direct-binding-simplest","title":"Method 1: Direct Binding (Simplest)","text":"<pre><code>services:\n    # Bind interface \u2192 implementation\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        class: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre> <p>Explanation: - When someone needs <code>UserRepositoryInterface</code> - Symfony provides <code>DoctrineUserRepository</code></p>"},{"location":"advanced/dependency-injection-guide/#method-2-alias-recommended","title":"Method 2: Alias (Recommended)","text":"<pre><code>services:\n    # Implementation\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n        # Autowired by default\n\n    # Alias: interface \u2192 implementation\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre> <p>Benefits: - More explicit - Easier to change implementations</p>"},{"location":"advanced/dependency-injection-guide/#method-3-bind-for-all-services","title":"Method 3: Bind for All Services","text":"<pre><code>services:\n    _defaults:\n        bind:\n            # Automatically bind this interface to this implementation\n            # for ALL services\n            App\\User\\Domain\\Port\\UserRepositoryInterface: '@App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository'\n</code></pre> <p>When to use: Interface used in many places, avoid repeating configuration.</p>"},{"location":"advanced/dependency-injection-guide/#environment-specific-bindings","title":"Environment-Specific Bindings","text":""},{"location":"advanced/dependency-injection-guide/#the-problem-different-implementations-for-different-environments","title":"The Problem: Different Implementations for Different Environments","text":"<ul> <li>Development: Use in-memory repository (fast tests)</li> <li>Test: Use in-memory repository</li> <li>Production: Use Doctrine repository (real database)</li> </ul>"},{"location":"advanced/dependency-injection-guide/#solution-environment-specific-configuration","title":"Solution: Environment-Specific Configuration","text":""},{"location":"advanced/dependency-injection-guide/#1-main-configuration-configservicesyaml","title":"1. Main Configuration (<code>config/services.yaml</code>)","text":"<pre><code>services:\n    _defaults:\n        autowire: true\n        autoconfigure: true\n\n    # Register all implementations\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n    App\\User\\Infrastructure\\Persistence\\InMemoryUserRepository:\n\n    # Default binding (production)\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#2-test-configuration-configservices_testyaml","title":"2. Test Configuration (<code>config/services_test.yaml</code>)","text":"<pre><code>services:\n    # Override binding for test environment\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\InMemoryUserRepository\n</code></pre> <p>Result: - <code>bin/phpunit</code> \u2192 uses <code>InMemoryUserRepository</code> - Production \u2192 uses <code>DoctrineUserRepository</code></p>"},{"location":"advanced/dependency-injection-guide/#3-development-configuration-configservices_devyaml","title":"3. Development Configuration (<code>config/services_dev.yaml</code>)","text":"<pre><code># Optional: use in-memory for fast dev feedback\nservices:\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\InMemoryUserRepository\n\n    # Or enable debug logging\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n        decorates: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n        arguments:\n            $decorated: '@.inner'\n            $logger: '@logger'\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#complete-example-email-sender","title":"Complete Example: Email Sender","text":"<pre><code># config/services.yaml (default: production)\nservices:\n    # Production: real SMTP\n    App\\Notification\\Domain\\Port\\EmailSenderInterface:\n        alias: App\\Notification\\Infrastructure\\Email\\SymfonyEmailSender\n\n# config/services_test.yaml\nservices:\n    # Test: in-memory fake\n    App\\Notification\\Domain\\Port\\EmailSenderInterface:\n        alias: App\\Notification\\Infrastructure\\Email\\InMemoryEmailSender\n\n# config/services_dev.yaml\nservices:\n    # Dev: log emails instead of sending\n    App\\Notification\\Domain\\Port\\EmailSenderInterface:\n        alias: App\\Notification\\Infrastructure\\Email\\LoggingEmailSender\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#tagged-services","title":"Tagged Services","text":""},{"location":"advanced/dependency-injection-guide/#the-problem-multiple-implementations-of-same-interface","title":"The Problem: Multiple Implementations of Same Interface","text":"<p>Example: Multiple event subscribers for the same event.</p> <pre><code>interface EventSubscriberInterface\n{\n    public function handle(DomainEvent $event): void;\n}\n\nclass SendEmailSubscriber implements EventSubscriberInterface { /* ... */ }\nclass LogEventSubscriber implements EventSubscriberInterface { /* ... */ }\nclass UpdateCacheSubscriber implements EventSubscriberInterface { /* ... */ }\n</code></pre> <p>Need: Inject all implementations, not just one.</p>"},{"location":"advanced/dependency-injection-guide/#solution-tagged-services","title":"Solution: Tagged Services","text":""},{"location":"advanced/dependency-injection-guide/#1-tag-all-implementations","title":"1. Tag All Implementations","text":"<pre><code>services:\n    # Tag each implementation\n    App\\Notification\\Infrastructure\\Event\\SendEmailSubscriber:\n        tags: ['app.event_subscriber']\n\n    App\\Notification\\Infrastructure\\Event\\LogEventSubscriber:\n        tags: ['app.event_subscriber']\n\n    App\\Notification\\Infrastructure\\Event\\UpdateCacheSubscriber:\n        tags: ['app.event_subscriber']\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#2-inject-all-tagged-services","title":"2. Inject All Tagged Services","text":"<pre><code>services:\n    # Event dispatcher receives all subscribers\n    App\\Shared\\Infrastructure\\Event\\EventDispatcher:\n        arguments:\n            $subscribers: !tagged_iterator app.event_subscriber\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#3-use-in-service","title":"3. Use in Service","text":"<pre><code>use Symfony\\Component\\DependencyInjection\\Attribute\\TaggedIterator;\n\nclass EventDispatcher implements EventDispatcherInterface\n{\n    public function __construct(\n        #[TaggedIterator('app.event_subscriber')]\n        private iterable $subscribers // All tagged services injected here\n    ) {}\n\n    public function dispatch(DomainEvent $event): void\n    {\n        foreach ($this-&gt;subscribers as $subscriber) {\n            $subscriber-&gt;handle($event);\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#auto-tagging-with-interfaces","title":"Auto-Tagging with Interfaces","text":"<p>Automatic tagging: Tag all classes implementing an interface.</p> <pre><code>services:\n    _instanceof:\n        # Automatically tag all classes implementing EventSubscriberInterface\n        App\\Shared\\Domain\\Event\\EventSubscriberInterface:\n            tags: ['app.event_subscriber']\n</code></pre> <p>Now you don't need to manually tag each implementation!</p>"},{"location":"advanced/dependency-injection-guide/#complete-example-query-bus-with-multiple-handlers","title":"Complete Example: Query Bus with Multiple Handlers","text":"<pre><code>services:\n    _instanceof:\n        # Auto-tag all query handlers\n        App\\Shared\\Application\\Query\\QueryHandlerInterface:\n            tags: ['app.query_handler']\n\n    # Query bus receives all handlers\n    App\\Shared\\Infrastructure\\Query\\QueryBus:\n        arguments:\n            $handlers: !tagged_iterator app.query_handler\n</code></pre> <pre><code>class QueryBus\n{\n    public function __construct(\n        #[TaggedIterator('app.query_handler')]\n        private iterable $handlers\n    ) {}\n\n    public function dispatch(Query $query): mixed\n    {\n        foreach ($this-&gt;handlers as $handler) {\n            if ($handler-&gt;supports($query)) {\n                return $handler-&gt;handle($query);\n            }\n        }\n\n        throw new NoHandlerFoundException();\n    }\n}\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#service-decoration","title":"Service Decoration","text":""},{"location":"advanced/dependency-injection-guide/#the-problem-add-functionality-without-modifying-code","title":"The Problem: Add Functionality Without Modifying Code","text":"<p>Example: Add caching to repository without changing repository code.</p>"},{"location":"advanced/dependency-injection-guide/#solution-decorator-pattern-with-di","title":"Solution: Decorator Pattern with DI","text":""},{"location":"advanced/dependency-injection-guide/#1-create-decorator","title":"1. Create Decorator","text":"<pre><code>namespace App\\User\\Infrastructure\\Persistence;\n\nfinal readonly class CachedUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private UserRepositoryInterface $decorated, // Original repository\n        private CacheInterface $cache,\n    ) {}\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;cache-&gt;get(\n            \"user:{$id}\",\n            fn() =&gt; $this-&gt;decorated-&gt;findById($id) // Delegate to original\n        );\n    }\n\n    public function save(User $user): void\n    {\n        $this-&gt;decorated-&gt;save($user);\n        $this-&gt;cache-&gt;delete(\"user:{$user-&gt;getId()}\"); // Invalidate cache\n    }\n}\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#2-configure-decoration","title":"2. Configure Decoration","text":"<pre><code>services:\n    # Original repository\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n\n    # Decorator wraps original\n    App\\User\\Infrastructure\\Persistence\\CachedUserRepository:\n        decorates: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n        arguments:\n            $decorated: '@.inner' # @.inner = the decorated service\n</code></pre> <p>Result: - Anyone requesting <code>DoctrineUserRepository</code> gets <code>CachedUserRepository</code> - <code>CachedUserRepository</code> wraps <code>DoctrineUserRepository</code> - Caching added transparently</p>"},{"location":"advanced/dependency-injection-guide/#decoration-priority","title":"Decoration Priority","text":"<p>Multiple decorators:</p> <pre><code>services:\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n\n    # First decorator: caching\n    App\\User\\Infrastructure\\Persistence\\CachedUserRepository:\n        decorates: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n        decoration_priority: 10 # Higher priority = outer layer\n        arguments:\n            $decorated: '@.inner'\n\n    # Second decorator: logging\n    App\\User\\Infrastructure\\Persistence\\LoggingUserRepository:\n        decorates: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n        decoration_priority: 5 # Lower priority = inner layer\n        arguments:\n            $decorated: '@.inner'\n</code></pre> <p>Call chain: <pre><code>Handler \u2192 LoggingUserRepository \u2192 CachedUserRepository \u2192 DoctrineUserRepository \u2192 Database\n</code></pre></p>"},{"location":"advanced/dependency-injection-guide/#complete-configuration-examples","title":"Complete Configuration Examples","text":""},{"location":"advanced/dependency-injection-guide/#example-1-user-module","title":"Example 1: User Module","text":"<pre><code># config/services.yaml\nservices:\n    _defaults:\n        autowire: true\n        autoconfigure: true\n\n    # Auto-register all services\n    App\\:\n        resource: '../src/'\n        exclude:\n            - '../src/*/Domain/Model/'\n            - '../src/*/Domain/ValueObject/'\n            - '../src/Kernel.php'\n\n    # Bind ports to adapters\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n\n    App\\User\\Domain\\Port\\PasswordHasherInterface:\n        alias: App\\User\\Infrastructure\\Security\\SymfonyPasswordHasher\n\n    App\\Shared\\Domain\\Port\\EmailSenderInterface:\n        alias: App\\Shared\\Infrastructure\\Email\\SymfonyEmailSender\n\n    App\\Shared\\Domain\\Port\\EventDispatcherInterface:\n        alias: App\\Shared\\Infrastructure\\Event\\SymfonyEventDispatcher\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#example-2-order-module-with-cqrs","title":"Example 2: Order Module with CQRS","text":"<pre><code>services:\n    # Write side\n    App\\Order\\Domain\\Port\\OrderRepositoryInterface:\n        alias: App\\Order\\Infrastructure\\Persistence\\DoctrineOrderRepository\n\n    # Read side (CQRS)\n    App\\Order\\Application\\Query\\OrderQueryInterface:\n        alias: App\\Order\\Infrastructure\\Query\\SqlOrderQuery\n\n    # External services\n    App\\Order\\Domain\\Port\\PaymentProcessorInterface:\n        alias: App\\Order\\Infrastructure\\Payment\\StripePaymentProcessor\n\n    App\\Order\\Domain\\Port\\InventoryServiceInterface:\n        alias: App\\Order\\Infrastructure\\Inventory\\HttpInventoryService\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#example-3-multi-tenant-application","title":"Example 3: Multi-Tenant Application","text":"<pre><code>services:\n    # Tenant resolver\n    App\\Shared\\Infrastructure\\Tenancy\\TenantResolver:\n\n    # Tenant-aware repository\n    App\\User\\Infrastructure\\Persistence\\TenantAwareUserRepository:\n        arguments:\n            $tenantResolver: '@App\\Shared\\Infrastructure\\Tenancy\\TenantResolver'\n\n    # Bind interface to tenant-aware implementation\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\TenantAwareUserRepository\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#example-4-decorated-repository-with-caching-logging","title":"Example 4: Decorated Repository with Caching &amp; Logging","text":"<pre><code>services:\n    # Base repository\n    App\\Product\\Infrastructure\\Persistence\\DoctrineProductRepository:\n\n    # Decorator: caching\n    App\\Product\\Infrastructure\\Persistence\\CachedProductRepository:\n        decorates: App\\Product\\Infrastructure\\Persistence\\DoctrineProductRepository\n        decoration_priority: 10\n        arguments:\n            $decorated: '@.inner'\n            $cache: '@cache.app'\n\n    # Decorator: logging\n    App\\Product\\Infrastructure\\Persistence\\LoggingProductRepository:\n        decorates: App\\Product\\Infrastructure\\Persistence\\DoctrineProductRepository\n        decoration_priority: 5\n        arguments:\n            $decorated: '@.inner'\n            $logger: '@logger'\n\n    # Bind interface to base (decorators wrap it automatically)\n    App\\Product\\Domain\\Port\\ProductRepositoryInterface:\n        alias: App\\Product\\Infrastructure\\Persistence\\DoctrineProductRepository\n</code></pre> <p>Call chain: <code>Handler \u2192 Logging \u2192 Caching \u2192 Doctrine \u2192 DB</code></p>"},{"location":"advanced/dependency-injection-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"advanced/dependency-injection-guide/#issue-1-cannot-autowire-service-argument-is-type-hinted-with-interface","title":"Issue 1: \"Cannot autowire service: argument is type-hinted with interface\"","text":"<p>Error: <pre><code>Cannot autowire service \"App\\User\\Application\\Handler\\RegisterUserHandler\":\nargument \"$users\" of method \"__construct()\" is type-hinted with the interface\n\"App\\User\\Domain\\Port\\UserRepositoryInterface\" but no implementation is registered.\n</code></pre></p> <p>Solution: Bind interface to implementation.</p> <pre><code>services:\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#issue-2-service-not-found","title":"Issue 2: \"Service not found\"","text":"<p>Error: <pre><code>Service \"App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\" not found.\n</code></pre></p> <p>Solution: Check that directory is not excluded in <code>services.yaml</code>.</p> <pre><code>services:\n    App\\:\n        resource: '../src/'\n        exclude:\n            - '../src/*/Domain/Model/'  # \u2705 Exclude entities\n            # \u274c Don't exclude Infrastructure!\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#issue-3-circular-reference-detected","title":"Issue 3: \"Circular reference detected\"","text":"<p>Error: <pre><code>Circular reference detected for service \"App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\".\n</code></pre></p> <p>Solution: Refactor to remove circular dependency or use setter injection.</p> <pre><code>services:\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n        calls:\n            - setLogger: ['@logger'] # Setter injection instead of constructor\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#issue-4-wrong-implementation-injected-in-tests","title":"Issue 4: \"Wrong implementation injected in tests\"","text":"<p>Problem: Test uses production implementation instead of fake.</p> <p>Solution: Create <code>config/services_test.yaml</code> and override binding.</p> <pre><code># config/services_test.yaml\nservices:\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\InMemoryUserRepository\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#issue-5-tagged-services-not-injected","title":"Issue 5: Tagged services not injected","text":"<p>Error: <code>$subscribers</code> is empty even though services are tagged.</p> <p>Solution: Check tag name matches.</p> <pre><code>services:\n    # Tag definition\n    _instanceof:\n        App\\Shared\\Domain\\Event\\EventSubscriberInterface:\n            tags: ['app.event_subscriber'] # Tag name\n\n    # Injection (must match!)\n    App\\Shared\\Infrastructure\\Event\\EventDispatcher:\n        arguments:\n            $subscribers: !tagged_iterator app.event_subscriber # Same tag name\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#best-practices","title":"Best Practices","text":""},{"location":"advanced/dependency-injection-guide/#1-use-aliases-for-port-bindings","title":"1. Use Aliases for Port Bindings","text":"<p>\u2705 GOOD: <pre><code>App\\User\\Domain\\Port\\UserRepositoryInterface:\n    alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre></p> <p>\u274c AVOID: <pre><code>App\\User\\Domain\\Port\\UserRepositoryInterface:\n    class: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre></p> <p>Reason: Aliases are clearer and easier to override.</p>"},{"location":"advanced/dependency-injection-guide/#2-environment-specific-configuration-files","title":"2. Environment-Specific Configuration Files","text":"<pre><code>config/\n\u251c\u2500\u2500 services.yaml          # Default (production)\n\u251c\u2500\u2500 services_dev.yaml      # Development overrides\n\u251c\u2500\u2500 services_test.yaml     # Test overrides\n\u2514\u2500\u2500 services_prod.yaml     # Production-specific (optional)\n</code></pre>"},{"location":"advanced/dependency-injection-guide/#3-use-_instanceof-for-auto-tagging","title":"3. Use <code>_instanceof</code> for Auto-Tagging","text":"<p>\u2705 GOOD: <pre><code>_instanceof:\n    App\\Shared\\Application\\Query\\QueryHandlerInterface:\n        tags: ['app.query_handler']\n</code></pre></p> <p>\u274c AVOID: <pre><code>App\\User\\Application\\Query\\FindUserQueryHandler:\n    tags: ['app.query_handler']\n\nApp\\Order\\Application\\Query\\FindOrderQueryHandler:\n    tags: ['app.query_handler']\n\n# ... manually tag each one\n</code></pre></p>"},{"location":"advanced/dependency-injection-guide/#4-exclude-non-service-classes","title":"4. Exclude Non-Service Classes","text":"<pre><code>App\\:\n    resource: '../src/'\n    exclude:\n        - '../src/*/Domain/Model/'       # Entities\n        - '../src/*/Domain/ValueObject/' # Value objects\n        - '../src/*/Application/Command/' # DTOs\n        - '../src/*/Application/Query/'   # DTOs\n        - '../src/Kernel.php'\n</code></pre> <p>Reason: Only services should be registered, not data objects.</p>"},{"location":"advanced/dependency-injection-guide/#summary-cheat-sheet","title":"Summary Cheat Sheet","text":"Task Configuration Bind port to adapter <code>alias: App\\...\\Implementation</code> Inject all tagged services <code>!tagged_iterator tag_name</code> Auto-tag by interface <code>_instanceof: { Interface: tags: [...] }</code> Override for test Create <code>services_test.yaml</code> Decorate service <code>decorates: OriginalService</code> + <code>$decorated: '@.inner'</code> Exclude directory <code>exclude: ['../src/Path/']</code> <p>Next: Factory Pattern Implementation \u2192</p>"},{"location":"advanced/doctrine/","title":"Doctrine Integration","text":"<p>Advanced Doctrine integration patterns for hexagonal architecture.</p>"},{"location":"advanced/doctrine/#pure-domain-with-yaml-mapping","title":"Pure Domain with YAML Mapping","text":"<p>Keep domain entities pure (no annotations) using YAML mapping.</p>"},{"location":"advanced/doctrine/#entity-pure-php","title":"Entity (Pure PHP)","text":"<pre><code>&lt;?php\n// src/Blog/Post/Domain/Model/Post.php\n\nnamespace App\\Blog\\Post\\Domain\\Model;\n\nfinal class Post\n{\n    private string $id;\n    private string $title;\n    private \\DateTimeImmutable $createdAt;\n\n    public function __construct(string $id, string $title)\n    {\n        $this-&gt;id = $id;\n        $this-&gt;title = $title;\n        $this-&gt;createdAt = new \\DateTimeImmutable();\n    }\n}\n</code></pre>"},{"location":"advanced/doctrine/#yaml-mapping-infrastructure","title":"YAML Mapping (Infrastructure)","text":"<pre><code># src/Blog/Post/Infrastructure/Persistence/Doctrine/Orm/Mapping/Post.orm.yml\n\nApp\\Blog\\Post\\Domain\\Model\\Post:\n    type: entity\n    table: post\n\n    id:\n        id:\n            type: string\n            length: 36\n\n    fields:\n        title:\n            type: string\n            length: 255\n\n        createdAt:\n            type: datetime_immutable\n            column: created_at\n</code></pre>"},{"location":"advanced/doctrine/#value-objects-as-embeddables","title":"Value Objects as Embeddables","text":"<pre><code># Email.orm.yml\nApp\\Domain\\ValueObject\\Email:\n    type: embeddable\n    fields:\n        value:\n            type: string\n            length: 180\n\n# User.orm.yml\nembedded:\n    email:\n        class: App\\Domain\\ValueObject\\Email\n        columnPrefix: email_\n</code></pre>"},{"location":"advanced/doctrine/#gedmo-extensions","title":"Gedmo Extensions","text":"<p>Use Gedmo with YAML to keep domain pure:</p> <pre><code>fields:\n    createdAt:\n        type: datetime_immutable\n        gedmo:\n            timestampable:\n                on: create\n\n    slug:\n        type: string\n        gedmo:\n            slug:\n                fields: [title]\n</code></pre> <p>For complete Gedmo guide, see README.md.</p>"},{"location":"advanced/domain-vs-application/","title":"Domain vs Application Logic: Decision Guide","text":""},{"location":"advanced/domain-vs-application/#table-of-contents","title":"Table of Contents","text":"<ol> <li>The Core Question</li> <li>Quick Decision Flowchart</li> <li>The Golden Rule</li> <li>Domain Layer Responsibilities</li> <li>Application Layer Responsibilities</li> <li>Real-World Examples</li> <li>Common Mistakes</li> <li>Testing As Validation</li> </ol>"},{"location":"advanced/domain-vs-application/#the-core-question","title":"The Core Question","text":"<p>Where should this logic live: in the Domain (Entity/Value Object) or in the Application (Handler)?</p> <p>This is THE most common question when implementing hexagonal architecture. The boundary between Domain and Application is often unclear, leading to either: - Anemic Domain Model - Entities become data containers, handlers contain all logic - Fat Handlers - Application layer has business rules that should be in domain</p>"},{"location":"advanced/domain-vs-application/#quick-decision-flowchart","title":"Quick Decision Flowchart","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph TD\n    Start[Logic to implement] --&gt; Q1{Is it a business rule&lt;br/&gt;or invariant?}\n\n    Q1 --&gt;|Yes| Q2{Does it involve&lt;br/&gt;a single entity?}\n    Q1 --&gt;|No| Application[APPLICATION LAYER&lt;br/&gt;Handler/Service]\n\n    Q2 --&gt;|Yes| Domain1[DOMAIN LAYER&lt;br/&gt;Entity Method]\n    Q2 --&gt;|No| Q3{Does it involve&lt;br/&gt;multiple entities&lt;br/&gt;from same aggregate?}\n\n    Q3 --&gt;|Yes| Domain2[DOMAIN LAYER&lt;br/&gt;Aggregate Root Method]\n    Q3 --&gt;|No| Q4{Does it involve&lt;br/&gt;multiple aggregates&lt;br/&gt;or external services?}\n\n    Q4 --&gt;|Yes| Application\n    Q4 --&gt;|No| Q5{Is it workflow&lt;br/&gt;orchestration?}\n\n    Q5 --&gt;|Yes| Application\n    Q5 --&gt;|No| Q6{Can it be expressed&lt;br/&gt;without infrastructure?}\n\n    Q6 --&gt;|Yes| Domain3[DOMAIN LAYER&lt;br/&gt;Domain Service]\n    Q6 --&gt;|No| Application\n\n    style Domain1 fill:#C8E6C9,stroke:#2E7D32,stroke-width:3px\n    style Domain2 fill:#C8E6C9,stroke:#2E7D32,stroke-width:3px\n    style Domain3 fill:#C8E6C9,stroke:#2E7D32,stroke-width:3px\n    style Application fill:#B3E5FC,stroke:#0277BD,stroke-width:3px</code></pre>"},{"location":"advanced/domain-vs-application/#the-golden-rule","title":"The Golden Rule","text":"<p>If a business expert would describe it as a rule, it belongs in the Domain.</p> <p>If a business expert would describe it as a process/workflow, it belongs in Application.</p>"},{"location":"advanced/domain-vs-application/#examples","title":"Examples:","text":"<ul> <li>\u274c \"When a user registers, send them an email\" \u2192 Application (workflow/orchestration)</li> <li>\u2705 \"A user cannot be activated if already active\" \u2192 Domain (business invariant)</li> <li>\u274c \"Save the user, then log the event, then notify admins\" \u2192 Application (orchestration)</li> <li>\u2705 \"An order total must equal sum of line items\" \u2192 Domain (business rule)</li> </ul>"},{"location":"advanced/domain-vs-application/#domain-layer-responsibilities","title":"Domain Layer Responsibilities","text":""},{"location":"advanced/domain-vs-application/#domain-should-contain","title":"\u2705 DOMAIN Should Contain:","text":""},{"location":"advanced/domain-vs-application/#1-business-invariants","title":"1. Business Invariants","text":"<p>Rules that MUST ALWAYS be true, regardless of how the entity is used.</p> <pre><code>// \u2705 GOOD: Domain enforces invariant\nclass Order\n{\n    private OrderStatus $status;\n    private \\DateTimeImmutable $shippedAt;\n\n    public function ship(): void\n    {\n        if ($this-&gt;status === OrderStatus::CANCELLED) {\n            throw new CannotShipCancelledOrderException();\n        }\n\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new OrderAlreadyShippedException();\n        }\n\n        $this-&gt;status = OrderStatus::SHIPPED;\n        $this-&gt;shippedAt = new \\DateTimeImmutable();\n    }\n}\n</code></pre> <p>Why Domain? The rule \"cancelled orders cannot be shipped\" is a business invariant. No matter where <code>Order</code> is used (CLI, API, background job), this rule applies.</p>"},{"location":"advanced/domain-vs-application/#2-state-transitions","title":"2. State Transitions","text":"<p>Logic governing how an entity moves between states.</p> <pre><code>// \u2705 GOOD: Domain controls state machine\nclass Invoice\n{\n    private InvoiceStatus $status;\n\n    public function markAsPaid(Money $amount): void\n    {\n        if (!$this-&gt;status-&gt;canTransitionTo(InvoiceStatus::PAID)) {\n            throw new InvalidInvoiceStatusTransitionException(\n                $this-&gt;status,\n                InvoiceStatus::PAID\n            );\n        }\n\n        if (!$amount-&gt;equals($this-&gt;totalAmount)) {\n            throw new InvalidPaymentAmountException($amount, $this-&gt;totalAmount);\n        }\n\n        $this-&gt;status = InvoiceStatus::PAID;\n        $this-&gt;paidAt = new \\DateTimeImmutable();\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#3-value-object-validation","title":"3. Value Object Validation","text":"<p>Validation that ensures a value makes sense in the business domain.</p> <pre><code>// \u2705 GOOD: Domain validates business constraints\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n\n        // Business rule: corporate domain only\n        if (!str_ends_with($value, '@company.com')) {\n            throw new InvalidEmailDomainException($value);\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#4-calculations-based-on-entity-data","title":"4. Calculations Based on Entity Data","text":"<p>Pure calculations using entity properties.</p> <pre><code>// \u2705 GOOD: Domain calculates business values\nclass Order\n{\n    private array $items; // OrderItem[]\n    private Money $shippingCost;\n    private Discount $discount;\n\n    public function calculateTotal(): Money\n    {\n        $subtotal = array_reduce(\n            $this-&gt;items,\n            fn(Money $sum, OrderItem $item) =&gt; $sum-&gt;add($item-&gt;getTotal()),\n            Money::zero()\n        );\n\n        $afterDiscount = $this-&gt;discount-&gt;apply($subtotal);\n\n        return $afterDiscount-&gt;add($this-&gt;shippingCost);\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#5-business-logic-methods","title":"5. Business Logic Methods","text":"<p>Methods that express business operations.</p> <pre><code>// \u2705 GOOD: Domain expresses business concepts\nclass Subscription\n{\n    private \\DateTimeImmutable $expiresAt;\n\n    public function isExpired(): bool\n    {\n        return $this-&gt;expiresAt &lt; new \\DateTimeImmutable();\n    }\n\n    public function renew(Period $period): void\n    {\n        if ($this-&gt;isExpired()) {\n            throw new CannotRenewExpiredSubscriptionException();\n        }\n\n        $this-&gt;expiresAt = $period-&gt;addTo($this-&gt;expiresAt);\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#application-layer-responsibilities","title":"Application Layer Responsibilities","text":""},{"location":"advanced/domain-vs-application/#application-should-contain","title":"\u2705 APPLICATION Should Contain:","text":""},{"location":"advanced/domain-vs-application/#1-orchestration-workflow","title":"1. Orchestration &amp; Workflow","text":"<p>Coordinating multiple operations in sequence.</p> <pre><code>// \u2705 GOOD: Application orchestrates workflow\nfinal readonly class RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users,\n        private EmailSenderInterface $emailSender,\n        private EventDispatcherInterface $eventDispatcher,\n    ) {}\n\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // 1. Create domain entity (domain logic inside factory)\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        // 2. Persist (infrastructure concern)\n        $this-&gt;users-&gt;save($user);\n\n        // 3. Send email (infrastructure concern)\n        $this-&gt;emailSender-&gt;send(\n            new WelcomeEmail($user-&gt;getEmail())\n        );\n\n        // 4. Dispatch event (infrastructure concern)\n        $this-&gt;eventDispatcher-&gt;dispatch(\n            new UserRegisteredEvent($user-&gt;getId())\n        );\n    }\n}\n</code></pre> <p>Why Application? This is a workflow: \"do this, then this, then this\". It coordinates multiple infrastructure concerns.</p>"},{"location":"advanced/domain-vs-application/#2-cross-aggregate-operations","title":"2. Cross-Aggregate Operations","text":"<p>Operations involving multiple aggregate roots.</p> <pre><code>// \u2705 GOOD: Application coordinates multiple aggregates\nfinal readonly class TransferMoneyHandler\n{\n    public function __construct(\n        private AccountRepositoryInterface $accounts,\n        private TransactionRepositoryInterface $transactions,\n    ) {}\n\n    public function __invoke(TransferMoneyCommand $command): void\n    {\n        $sourceAccount = $this-&gt;accounts-&gt;findById($command-&gt;sourceAccountId);\n        $destinationAccount = $this-&gt;accounts-&gt;findById($command-&gt;destinationAccountId);\n\n        // Domain logic: each account validates its own rules\n        $sourceAccount-&gt;withdraw($command-&gt;amount);\n        $destinationAccount-&gt;deposit($command-&gt;amount);\n\n        // Application logic: coordinate persistence of both aggregates\n        $this-&gt;accounts-&gt;save($sourceAccount);\n        $this-&gt;accounts-&gt;save($destinationAccount);\n\n        // Application logic: create transaction record\n        $transaction = new Transaction(\n            TransactionId::generate(),\n            $sourceAccount-&gt;getId(),\n            $destinationAccount-&gt;getId(),\n            $command-&gt;amount\n        );\n        $this-&gt;transactions-&gt;save($transaction);\n    }\n}\n</code></pre> <p>Why Application? Modifying two different aggregates requires coordination at application level.</p>"},{"location":"advanced/domain-vs-application/#3-infrastructure-coordination","title":"3. Infrastructure Coordination","text":"<p>Dealing with repositories, email, messaging, etc.</p> <pre><code>// \u2705 GOOD: Application handles infrastructure\nfinal readonly class PublishArticleHandler\n{\n    public function __construct(\n        private ArticleRepositoryInterface $articles,\n        private SearchIndexInterface $searchIndex,\n        private CacheInterface $cache,\n    ) {}\n\n    public function __invoke(PublishArticleCommand $command): void\n    {\n        $article = $this-&gt;articles-&gt;findById($command-&gt;articleId);\n\n        // Domain logic\n        $article-&gt;publish();\n\n        // Infrastructure coordination\n        $this-&gt;articles-&gt;save($article);\n        $this-&gt;searchIndex-&gt;index($article);\n        $this-&gt;cache-&gt;invalidate(\"article:{$article-&gt;getId()}\");\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#4-transaction-management","title":"4. Transaction Management","text":"<p>Managing database transactions across operations.</p> <pre><code>// \u2705 GOOD: Application manages transactions\nfinal readonly class CheckoutOrderHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orders,\n        private InventoryServiceInterface $inventory,\n        private EntityManagerInterface $entityManager, // Doctrine\n    ) {}\n\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n            // Domain logic\n            $order-&gt;confirm();\n\n            // Infrastructure operations within transaction\n            $this-&gt;orders-&gt;save($order);\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n\n            $this-&gt;entityManager-&gt;commit();\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n            throw $e;\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#5-input-validation-transformation","title":"5. Input Validation &amp; Transformation","text":"<p>Validating external input and transforming to domain objects.</p> <pre><code>// \u2705 GOOD: Application validates input\nfinal readonly class CreateProductHandler\n{\n    public function __construct(\n        private ProductRepositoryInterface $products,\n        private ValidatorInterface $validator,\n    ) {}\n\n    public function __invoke(CreateProductCommand $command): void\n    {\n        // Application: validate command structure\n        $errors = $this-&gt;validator-&gt;validate($command);\n        if (count($errors) &gt; 0) {\n            throw new ValidationException($errors);\n        }\n\n        // Application: check business constraints requiring repository\n        if ($this-&gt;products-&gt;existsByName($command-&gt;name)) {\n            throw new ProductNameAlreadyExistsException($command-&gt;name);\n        }\n\n        // Domain: factory contains entity creation logic\n        $product = ProductFactory::create(\n            name: $command-&gt;name,\n            price: Money::fromCents($command-&gt;priceInCents),\n            stock: $command-&gt;initialStock\n        );\n\n        // Application: persist\n        $this-&gt;products-&gt;save($product);\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#real-world-examples","title":"Real-World Examples","text":""},{"location":"advanced/domain-vs-application/#example-1-order-cancellation","title":"Example 1: Order Cancellation","text":""},{"location":"advanced/domain-vs-application/#bad-business-logic-in-handler","title":"\u274c BAD: Business Logic in Handler","text":"<pre><code>// \u274c WRONG: Handler contains business rules\nfinal readonly class CancelOrderHandler\n{\n    public function __invoke(CancelOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        // Business logic leaked into handler!\n        if ($order-&gt;getStatus() === OrderStatus::SHIPPED) {\n            throw new CannotCancelShippedOrderException();\n        }\n\n        if ($order-&gt;getStatus() === OrderStatus::DELIVERED) {\n            throw new CannotCancelDeliveredOrderException();\n        }\n\n        $order-&gt;setStatus(OrderStatus::CANCELLED);\n        $order-&gt;setCancelledAt(new \\DateTimeImmutable());\n\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre> <p>Problems: - Business rules scattered in handler - Cannot reuse cancellation logic elsewhere - Hard to test cancellation rules without handler - <code>Order</code> is just a data bag (anemic model)</p>"},{"location":"advanced/domain-vs-application/#good-business-logic-in-domain","title":"\u2705 GOOD: Business Logic in Domain","text":"<pre><code>// \u2705 CORRECT: Entity enforces business rules\nclass Order\n{\n    public function cancel(): void\n    {\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new CannotCancelShippedOrderException();\n        }\n\n        if ($this-&gt;status === OrderStatus::DELIVERED) {\n            throw new CannotCancelDeliveredOrderException();\n        }\n\n        $this-&gt;status = OrderStatus::CANCELLED;\n        $this-&gt;cancelledAt = new \\DateTimeImmutable();\n    }\n}\n\n// Handler becomes thin orchestrator\nfinal readonly class CancelOrderHandler\n{\n    public function __invoke(CancelOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        $order-&gt;cancel(); // Domain enforces rules\n\n        $this-&gt;orders-&gt;save($order);\n        $this-&gt;eventDispatcher-&gt;dispatch(new OrderCancelledEvent($order-&gt;getId()));\n    }\n}\n</code></pre> <p>Benefits: - Business rules encapsulated in domain - Reusable across any use case (API, CLI, batch job) - Easy to test in isolation - Handler is thin orchestrator</p>"},{"location":"advanced/domain-vs-application/#example-2-user-registration","title":"Example 2: User Registration","text":""},{"location":"advanced/domain-vs-application/#bad-everything-in-handler","title":"\u274c BAD: Everything in Handler","text":"<pre><code>// \u274c WRONG: Mixing domain and application concerns\nfinal readonly class RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // Input validation (OK in application)\n        if (empty($command-&gt;email)) {\n            throw new InvalidArgumentException('Email required');\n        }\n\n        // Business validation (should be in domain!)\n        if (!filter_var($command-&gt;email, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException();\n        }\n\n        // Business rule (should be in domain!)\n        if (strlen($command-&gt;password) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        // Business rule check (OK, needs repository)\n        if ($this-&gt;users-&gt;existsByEmail($command-&gt;email)) {\n            throw new EmailAlreadyExistsException();\n        }\n\n        // Entity creation (should be factory!)\n        $user = new User(\n            UserId::generate(),\n            new Email($command-&gt;email),\n            new HashedPassword($command-&gt;password),\n            false\n        );\n\n        $this-&gt;users-&gt;save($user);\n        $this-&gt;emailSender-&gt;send(new WelcomeEmail($user-&gt;getEmail()));\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#good-separated-concerns","title":"\u2705 GOOD: Separated Concerns","text":"<pre><code>// Domain: Value Object with validation\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n    }\n}\n\n// Domain: Value Object with validation\nfinal readonly class Password\n{\n    public function __construct(public string $value)\n    {\n        if (strlen($value) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n    }\n}\n\n// Domain: Factory encapsulates creation logic\nfinal class UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            UserId::generate(),\n            new Email($email), // Validates in constructor\n            HashedPassword::fromPlaintext($password), // Hashes + validates\n            isActive: false\n        );\n    }\n}\n\n// Application: Thin orchestrator\nfinal readonly class RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // Application: check uniqueness (requires repository)\n        if ($this-&gt;users-&gt;existsByEmail($command-&gt;email)) {\n            throw new EmailAlreadyExistsException($command-&gt;email);\n        }\n\n        // Domain: factory handles creation + validation\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        // Application: orchestrate infrastructure\n        $this-&gt;users-&gt;save($user);\n        $this-&gt;emailSender-&gt;send(new WelcomeEmail($user-&gt;getEmail()));\n        $this-&gt;eventDispatcher-&gt;dispatch(new UserRegisteredEvent($user-&gt;getId()));\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#common-mistakes","title":"Common Mistakes","text":""},{"location":"advanced/domain-vs-application/#mistake-1-anemic-domain-model","title":"Mistake 1: Anemic Domain Model","text":"<p>Symptom: Entities are just data containers with getters/setters, all logic in handlers.</p> <pre><code>// \u274c Anemic entity\nclass Order\n{\n    private OrderStatus $status;\n\n    public function getStatus(): OrderStatus { return $this-&gt;status; }\n    public function setStatus(OrderStatus $status): void { $this-&gt;status = $status; }\n}\n\n// \u274c Handler with business logic\nclass ShipOrderHandler\n{\n    public function __invoke(ShipOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        if ($order-&gt;getStatus() !== OrderStatus::CONFIRMED) {\n            throw new InvalidOrderStatusException();\n        }\n\n        $order-&gt;setStatus(OrderStatus::SHIPPED);\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre> <p>Fix: Move business logic into entity methods.</p> <pre><code>// \u2705 Rich domain model\nclass Order\n{\n    private OrderStatus $status;\n\n    public function ship(): void\n    {\n        if ($this-&gt;status !== OrderStatus::CONFIRMED) {\n            throw new CannotShipUnconfirmedOrderException();\n        }\n\n        $this-&gt;status = OrderStatus::SHIPPED;\n        $this-&gt;shippedAt = new \\DateTimeImmutable();\n    }\n}\n\n// \u2705 Thin handler\nclass ShipOrderHandler\n{\n    public function __invoke(ShipOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n        $order-&gt;ship(); // Domain handles the rules\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#mistake-2-fat-handlers-god-objects","title":"Mistake 2: Fat Handlers (God Objects)","text":"<p>Symptom: Handlers contain hundreds of lines, multiple responsibilities.</p> <pre><code>// \u274c Fat handler with too much responsibility\nclass ProcessOrderHandler\n{\n    public function __invoke(ProcessOrderCommand $command): void\n    {\n        // 200 lines of validation, calculation, orchestration...\n        // Business rules mixed with infrastructure\n        // Hard to test, hard to understand\n    }\n}\n</code></pre> <p>Fix: Extract business logic to domain, keep handler focused on orchestration.</p>"},{"location":"advanced/domain-vs-application/#mistake-3-business-logic-requiring-repository","title":"Mistake 3: Business Logic Requiring Repository","text":"<p>Symptom: Trying to put logic needing external data in domain.</p> <pre><code>// \u274c WRONG: Entity cannot access repository\nclass User\n{\n    public function changeEmail(Email $newEmail, UserRepositoryInterface $users): void\n    {\n        // Cannot inject repository into entity!\n        if ($users-&gt;existsByEmail($newEmail)) {\n            throw new EmailAlreadyExistsException();\n        }\n\n        $this-&gt;email = $newEmail;\n    }\n}\n</code></pre> <p>Fix: Put the check in application layer.</p> <pre><code>// \u2705 CORRECT: Application checks, domain updates\nclass ChangeUserEmailHandler\n{\n    public function __invoke(ChangeUserEmailCommand $command): void\n    {\n        $user = $this-&gt;users-&gt;findById($command-&gt;userId);\n\n        // Application: uniqueness check requires repository\n        if ($this-&gt;users-&gt;existsByEmail($command-&gt;newEmail)) {\n            throw new EmailAlreadyExistsException($command-&gt;newEmail);\n        }\n\n        // Domain: simple update with validation\n        $user-&gt;changeEmail(new Email($command-&gt;newEmail));\n\n        $this-&gt;users-&gt;save($user);\n    }\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#testing-as-validation","title":"Testing As Validation","text":"<p>Good separation means easy testing:</p>"},{"location":"advanced/domain-vs-application/#domain-testing-no-infrastructure","title":"Domain Testing (No Infrastructure)","text":"<pre><code>// \u2705 Test domain logic without any infrastructure\nclass OrderTest extends TestCase\n{\n    public function test_cannot_ship_cancelled_order(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::CANCELLED);\n\n        $this-&gt;expectException(CannotShipCancelledOrderException::class);\n\n        $order-&gt;ship();\n    }\n\n    // No database, no framework, pure PHP testing\n}\n</code></pre>"},{"location":"advanced/domain-vs-application/#application-testing-with-test-doubles","title":"Application Testing (With Test Doubles)","text":"<pre><code>// \u2705 Test handler orchestration with in-memory repository\nclass ShipOrderHandlerTest extends TestCase\n{\n    public function test_ships_order_and_dispatches_event(): void\n    {\n        $orders = new InMemoryOrderRepository();\n        $events = new InMemoryEventDispatcher();\n        $handler = new ShipOrderHandler($orders, $events);\n\n        $order = new Order(OrderId::generate(), OrderStatus::CONFIRMED);\n        $orders-&gt;save($order);\n\n        $handler(new ShipOrderCommand($order-&gt;getId()));\n\n        $this-&gt;assertEquals(OrderStatus::SHIPPED, $order-&gt;getStatus());\n        $this-&gt;assertTrue($events-&gt;wasDispatched(OrderShippedEvent::class));\n    }\n}\n</code></pre> <p>If you cannot test domain logic without infrastructure, your separation is wrong.</p>"},{"location":"advanced/domain-vs-application/#summary-decision-matrix","title":"Summary Decision Matrix","text":"Question Domain Application Is it a business invariant? \u2705 \u274c Involves single entity? \u2705 \u274c State transition logic? \u2705 \u274c Value object validation? \u2705 \u274c Calculations on entity data? \u2705 \u274c Needs repository/infrastructure? \u274c \u2705 Orchestrates multiple operations? \u274c \u2705 Involves multiple aggregates? \u274c \u2705 Transaction management? \u274c \u2705 External service calls? \u274c \u2705 Input validation? \u274c \u2705"},{"location":"advanced/domain-vs-application/#key-takeaways","title":"Key Takeaways","text":"<ol> <li>Domain = \"WHAT are the business rules?\"</li> <li>Application = \"HOW do we orchestrate those rules?\"</li> <li>When in doubt: Can a business expert explain it without mentioning technology? \u2192 Domain</li> <li>Test smell: If you need a database to test a business rule \u2192 Wrong layer</li> <li>Rich domain &gt; Anemic domain: Entities should have behavior, not just data</li> <li>Thin handlers &gt; Fat handlers: Handlers orchestrate, don't implement business rules</li> </ol> <p>Next: Port Interface Design Principles \u2192</p>"},{"location":"advanced/error-handling-strategy/","title":"Error Handling Strategy in Hexagonal Architecture","text":""},{"location":"advanced/error-handling-strategy/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Exception Hierarchy</li> <li>Domain vs Infrastructure Exceptions</li> <li>Exception Translation at Boundaries</li> <li>Handling Exceptions in Handlers</li> <li>Controller Exception Handling</li> <li>Testing Error Scenarios</li> <li>Complete Real-World Examples</li> </ol>"},{"location":"advanced/error-handling-strategy/#exception-hierarchy","title":"Exception Hierarchy","text":""},{"location":"advanced/error-handling-strategy/#recommended-structure","title":"Recommended Structure","text":"<pre><code>Exception (PHP)\n\u251c\u2500\u2500 DomainException (Custom base)\n\u2502   \u251c\u2500\u2500 ValidationException\n\u2502   \u2502   \u251c\u2500\u2500 InvalidEmailException\n\u2502   \u2502   \u251c\u2500\u2500 PasswordTooShortException\n\u2502   \u2502   \u2514\u2500\u2500 InvalidQuantityException\n\u2502   \u251c\u2500\u2500 BusinessRuleException\n\u2502   \u2502   \u251c\u2500\u2500 OrderAlreadyShippedException\n\u2502   \u2502   \u251c\u2500\u2500 InsufficientStockException\n\u2502   \u2502   \u2514\u2500\u2500 CannotCancelShippedOrderException\n\u2502   \u2514\u2500\u2500 NotFoundException\n\u2502       \u251c\u2500\u2500 UserNotFoundException\n\u2502       \u251c\u2500\u2500 OrderNotFoundException\n\u2502       \u2514\u2500\u2500 ProductNotFoundException\n\u2514\u2500\u2500 InfrastructureException (Custom base)\n    \u251c\u2500\u2500 PersistenceException\n    \u2502   \u251c\u2500\u2500 DatabaseConnectionException\n    \u2502   \u2514\u2500\u2500 UniqueConstraintViolationException\n    \u251c\u2500\u2500 ExternalServiceException\n    \u2502   \u251c\u2500\u2500 PaymentGatewayException\n    \u2502   \u2514\u2500\u2500 EmailSendingException\n    \u2514\u2500\u2500 CacheException\n</code></pre>"},{"location":"advanced/error-handling-strategy/#base-exception-classes","title":"Base Exception Classes","text":"<pre><code>namespace App\\Shared\\Domain\\Exception;\n\n// Base for all domain exceptions\nabstract class DomainException extends \\Exception\n{\n    public function __construct(\n        string $message = '',\n        int $code = 0,\n        ?\\Throwable $previous = null\n    ) {\n        parent::__construct($message, $code, $previous);\n    }\n}\n\n// Domain validation failures\nabstract class ValidationException extends DomainException {}\n\n// Business rule violations\nabstract class BusinessRuleException extends DomainException {}\n\n// Entity not found\nabstract class NotFoundException extends DomainException\n{\n    public function __construct(string $entityName, string $identifier)\n    {\n        parent::__construct(\"$entityName with identifier '$identifier' not found\");\n    }\n}\n</code></pre> <pre><code>namespace App\\Shared\\Infrastructure\\Exception;\n\n// Base for all infrastructure exceptions\nabstract class InfrastructureException extends \\Exception {}\n\n// Database/persistence failures\nabstract class PersistenceException extends InfrastructureException {}\n\n// External service failures\nabstract class ExternalServiceException extends InfrastructureException {}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#domain-vs-infrastructure-exceptions","title":"Domain vs Infrastructure Exceptions","text":""},{"location":"advanced/error-handling-strategy/#domain-exceptions","title":"Domain Exceptions","text":"<p>Purpose: Represent business rule violations or domain-specific errors.</p> <p>Characteristics: - Thrown by domain layer (entities, value objects, domain services) - Express business concepts - Should be caught and handled by application layer - May propagate to controller for user feedback</p>"},{"location":"advanced/error-handling-strategy/#example-domain-validation-exceptions","title":"Example: Domain Validation Exceptions","text":"<pre><code>namespace App\\User\\Domain\\Exception;\n\nfinal class InvalidEmailException extends ValidationException\n{\n    public function __construct(string $email)\n    {\n        parent::__construct(\"Email '$email' is not valid\");\n    }\n}\n\nfinal class PasswordTooShortException extends ValidationException\n{\n    public function __construct()\n    {\n        parent::__construct(\"Password must be at least 8 characters\");\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#example-business-rule-exceptions","title":"Example: Business Rule Exceptions","text":"<pre><code>namespace App\\Order\\Domain\\Exception;\n\nfinal class CannotShipCancelledOrderException extends BusinessRuleException\n{\n    public function __construct()\n    {\n        parent::__construct(\"Cannot ship an order that has been cancelled\");\n    }\n}\n\nfinal class OrderAlreadyShippedException extends BusinessRuleException\n{\n    public function __construct(OrderId $orderId)\n    {\n        parent::__construct(\"Order {$orderId} has already been shipped\");\n    }\n}\n\nfinal class InsufficientStockException extends BusinessRuleException\n{\n    public function __construct(ProductId $productId, int $requested, int $available)\n    {\n        parent::__construct(\n            \"Insufficient stock for product {$productId}: requested $requested, available $available\"\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#example-not-found-exceptions","title":"Example: Not Found Exceptions","text":"<pre><code>namespace App\\User\\Domain\\Exception;\n\nfinal class UserNotFoundException extends NotFoundException\n{\n    public function __construct(UserId $userId)\n    {\n        parent::__construct('User', $userId-&gt;toString());\n    }\n\n    public static function byEmail(string $email): self\n    {\n        $exception = new self(UserId::generate()); // Dummy ID\n        $exception-&gt;message = \"User with email '$email' not found\";\n        return $exception;\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#infrastructure-exceptions","title":"Infrastructure Exceptions","text":"<p>Purpose: Represent technical failures (database, network, external services).</p> <p>Characteristics: - Thrown by infrastructure layer (repositories, adapters) - Express technical problems - Should be caught by application layer and translated to domain exceptions or logged - Generally should NOT propagate to domain layer</p>"},{"location":"advanced/error-handling-strategy/#example-persistence-exceptions","title":"Example: Persistence Exceptions","text":"<pre><code>namespace App\\Shared\\Infrastructure\\Exception;\n\nfinal class DatabaseConnectionException extends PersistenceException\n{\n    public function __construct(string $message, ?\\Throwable $previous = null)\n    {\n        parent::__construct(\"Database connection failed: $message\", 0, $previous);\n    }\n}\n\nfinal class UniqueConstraintViolationException extends PersistenceException\n{\n    public function __construct(string $field, string $value, ?\\Throwable $previous = null)\n    {\n        parent::__construct(\n            \"Unique constraint violation on field '$field' with value '$value'\",\n            0,\n            $previous\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#example-external-service-exceptions","title":"Example: External Service Exceptions","text":"<pre><code>namespace App\\Payment\\Infrastructure\\Exception;\n\nfinal class PaymentGatewayException extends ExternalServiceException\n{\n    public function __construct(string $message, ?\\Throwable $previous = null)\n    {\n        parent::__construct(\"Payment gateway error: $message\", 0, $previous);\n    }\n\n    public static function timeout(): self\n    {\n        return new self(\"Payment gateway request timed out\");\n    }\n\n    public static function invalidResponse(string $details): self\n    {\n        return new self(\"Invalid response from payment gateway: $details\");\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#exception-translation-at-boundaries","title":"Exception Translation at Boundaries","text":""},{"location":"advanced/error-handling-strategy/#the-problem-infrastructure-exceptions-in-domain","title":"The Problem: Infrastructure Exceptions in Domain","text":"<pre><code>// \u274c BAD: Infrastructure exception leaks to handler\nclass RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        try {\n            $this-&gt;users-&gt;save($user);\n        } catch (UniqueConstraintViolationException $e) {\n            // \u274c Catching infrastructure exception in application layer\n            throw new EmailAlreadyExistsException($command-&gt;email);\n        }\n    }\n}\n</code></pre> <p>Problem: Application layer shouldn't know about <code>UniqueConstraintViolationException</code> (infrastructure detail).</p>"},{"location":"advanced/error-handling-strategy/#solution-translate-in-repository-adapter","title":"Solution: Translate in Repository (Adapter)","text":"<pre><code>// \u2705 GOOD: Repository translates infrastructure \u2192 domain\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        try {\n            $this-&gt;entityManager-&gt;persist($user);\n            $this-&gt;entityManager-&gt;flush();\n        } catch (UniqueConstraintViolationException $e) {\n            // Check which field violated constraint\n            if (str_contains($e-&gt;getMessage(), 'email')) {\n                throw new EmailAlreadyExistsException($user-&gt;getEmail()-&gt;value);\n            }\n\n            // Re-throw as generic persistence exception\n            throw new PersistenceException(\"Failed to save user\", previous: $e);\n        } catch (DriverException $e) {\n            throw new DatabaseConnectionException($e-&gt;getMessage(), previous: $e);\n        }\n    }\n}\n\n// \u2705 GOOD: Handler only deals with domain exceptions\nclass RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        $this-&gt;users-&gt;save($user); // May throw EmailAlreadyExistsException (domain)\n    }\n}\n</code></pre> <p>Benefits: - Application layer only knows about domain exceptions - Infrastructure details hidden - Easy to change database without affecting application</p>"},{"location":"advanced/error-handling-strategy/#translation-pattern","title":"Translation Pattern","text":"<pre><code>// Repository translates infrastructure \u2192 domain\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void\n    {\n        try {\n            $this-&gt;entityManager-&gt;persist($order);\n            $this-&gt;entityManager-&gt;flush();\n        } catch (\\Doctrine\\DBAL\\Exception\\UniqueConstraintViolationException $e) {\n            // Translate to domain exception\n            throw new OrderAlreadyExistsException($order-&gt;getId());\n        } catch (\\Doctrine\\DBAL\\Exception\\ConnectionException $e) {\n            // Translate to infrastructure exception\n            throw new DatabaseConnectionException($e-&gt;getMessage(), $e);\n        } catch (\\Exception $e) {\n            // Catch-all: wrap in generic exception\n            throw new PersistenceException(\"Failed to save order\", previous: $e);\n        }\n    }\n\n    public function findById(OrderId $id): ?Order\n    {\n        try {\n            $order = $this-&gt;entityManager-&gt;find(Order::class, $id-&gt;toString());\n\n            if ($order === null) {\n                throw new OrderNotFoundException($id);\n            }\n\n            return $order;\n        } catch (\\Doctrine\\DBAL\\Exception\\ConnectionException $e) {\n            throw new DatabaseConnectionException($e-&gt;getMessage(), $e);\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#handling-exceptions-in-handlers","title":"Handling Exceptions in Handlers","text":""},{"location":"advanced/error-handling-strategy/#strategy-1-let-domain-exceptions-propagate","title":"Strategy 1: Let Domain Exceptions Propagate","text":"<pre><code>// \u2705 GOOD: Let domain exceptions bubble up\nclass CancelOrderHandler\n{\n    public function __invoke(CancelOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n        // May throw OrderNotFoundException\n\n        $order-&gt;cancel();\n        // May throw CannotCancelShippedOrderException\n\n        $this-&gt;orders-&gt;save($order);\n        // May throw PersistenceException\n    }\n}\n</code></pre> <p>When to use: Domain exceptions should reach the controller for proper HTTP response.</p>"},{"location":"advanced/error-handling-strategy/#strategy-2-catch-and-transform","title":"Strategy 2: Catch and Transform","text":"<pre><code>// \u2705 GOOD: Catch specific exception and provide context\nclass ProcessPaymentHandler\n{\n    public function __invoke(ProcessPaymentCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        try {\n            $result = $this-&gt;paymentProcessor-&gt;charge($order-&gt;getTotal());\n        } catch (PaymentGatewayException $e) {\n            // Transform to domain exception with context\n            throw new PaymentFailedException(\n                orderId: $order-&gt;getId(),\n                amount: $order-&gt;getTotal(),\n                reason: $e-&gt;getMessage(),\n                previous: $e\n            );\n        }\n\n        $order-&gt;markAsPaid($result-&gt;transactionId);\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre> <p>When to use: Add business context to infrastructure exceptions.</p>"},{"location":"advanced/error-handling-strategy/#strategy-3-catch-and-recover","title":"Strategy 3: Catch and Recover","text":"<pre><code>// \u2705 GOOD: Catch exception and attempt recovery\nclass SendOrderConfirmationHandler\n{\n    public function __invoke(SendOrderConfirmationCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        try {\n            $this-&gt;emailSender-&gt;send(new OrderConfirmationEmail($order));\n        } catch (EmailSendingException $e) {\n            // Log error but don't fail the whole operation\n            $this-&gt;logger-&gt;error(\"Failed to send order confirmation\", [\n                'orderId' =&gt; $order-&gt;getId(),\n                'error' =&gt; $e-&gt;getMessage()\n            ]);\n\n            // Queue for retry later\n            $this-&gt;retryQueue-&gt;add(new RetryEmailJob($order-&gt;getId()));\n\n            // Don't throw - order is still confirmed even if email failed\n        }\n    }\n}\n</code></pre> <p>When to use: Non-critical operations that shouldn't fail the entire use case.</p>"},{"location":"advanced/error-handling-strategy/#strategy-4-wrap-multiple-operations-in-transaction","title":"Strategy 4: Wrap Multiple Operations in Transaction","text":"<pre><code>// \u2705 GOOD: Rollback on any exception\nclass CheckoutOrderHandler\n{\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n            // May throw InsufficientStockException\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n\n            // May throw PaymentFailedException\n            $payment = $this-&gt;paymentProcessor-&gt;charge($order-&gt;getTotal());\n\n            $order-&gt;confirm($payment-&gt;transactionId);\n            $this-&gt;orders-&gt;save($order);\n\n            $this-&gt;entityManager-&gt;commit();\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n            throw $e; // Re-throw to controller\n        }\n    }\n}\n</code></pre> <p>When to use: Multiple operations that must succeed together (ACID transaction).</p>"},{"location":"advanced/error-handling-strategy/#controller-exception-handling","title":"Controller Exception Handling","text":""},{"location":"advanced/error-handling-strategy/#strategy-1-global-exception-handler-recommended","title":"Strategy 1: Global Exception Handler (Recommended)","text":"<pre><code>namespace App\\Shared\\Infrastructure\\Http;\n\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\Event\\ExceptionEvent;\nuse Symfony\\Component\\HttpKernel\\Exception\\HttpExceptionInterface;\n\nfinal class ExceptionListener\n{\n    public function __construct(\n        private LoggerInterface $logger,\n        private bool $debug = false,\n    ) {}\n\n    public function onKernelException(ExceptionEvent $event): void\n    {\n        $exception = $event-&gt;getThrowable();\n\n        // Log all exceptions\n        $this-&gt;logger-&gt;error($exception-&gt;getMessage(), [\n            'exception' =&gt; get_class($exception),\n            'trace' =&gt; $exception-&gt;getTraceAsString(),\n        ]);\n\n        // Map exception to HTTP response\n        $response = $this-&gt;createResponse($exception);\n\n        $event-&gt;setResponse($response);\n    }\n\n    private function createResponse(\\Throwable $exception): JsonResponse\n    {\n        // Domain exceptions\n        if ($exception instanceof ValidationException) {\n            return new JsonResponse([\n                'error' =&gt; 'Validation failed',\n                'message' =&gt; $exception-&gt;getMessage(),\n            ], Response::HTTP_BAD_REQUEST);\n        }\n\n        if ($exception instanceof BusinessRuleException) {\n            return new JsonResponse([\n                'error' =&gt; 'Business rule violation',\n                'message' =&gt; $exception-&gt;getMessage(),\n            ], Response::HTTP_UNPROCESSABLE_ENTITY);\n        }\n\n        if ($exception instanceof NotFoundException) {\n            return new JsonResponse([\n                'error' =&gt; 'Resource not found',\n                'message' =&gt; $exception-&gt;getMessage(),\n            ], Response::HTTP_NOT_FOUND);\n        }\n\n        // Infrastructure exceptions\n        if ($exception instanceof InfrastructureException) {\n            return new JsonResponse([\n                'error' =&gt; 'Internal server error',\n                'message' =&gt; $this-&gt;debug ? $exception-&gt;getMessage() : 'An error occurred',\n            ], Response::HTTP_INTERNAL_SERVER_ERROR);\n        }\n\n        // HTTP exceptions (Symfony)\n        if ($exception instanceof HttpExceptionInterface) {\n            return new JsonResponse([\n                'error' =&gt; $exception-&gt;getMessage(),\n            ], $exception-&gt;getStatusCode());\n        }\n\n        // Unknown exceptions\n        return new JsonResponse([\n            'error' =&gt; 'Internal server error',\n            'message' =&gt; $this-&gt;debug ? $exception-&gt;getMessage() : 'An unexpected error occurred',\n        ], Response::HTTP_INTERNAL_SERVER_ERROR);\n    }\n}\n</code></pre> <p>Configuration (services.yaml):</p> <pre><code>services:\n    App\\Shared\\Infrastructure\\Http\\ExceptionListener:\n        arguments:\n            $debug: '%kernel.debug%'\n        tags:\n            - { name: kernel.event_listener, event: kernel.exception }\n</code></pre>"},{"location":"advanced/error-handling-strategy/#strategy-2-try-catch-in-controller-less-recommended","title":"Strategy 2: Try-Catch in Controller (Less Recommended)","text":"<pre><code>#[Route('/api/users', methods: ['POST'])]\nfinal class RegisterUserController\n{\n    public function __invoke(Request $request): JsonResponse\n    {\n        try {\n            $command = new RegisterUserCommand(\n                email: $request-&gt;request-&gt;get('email'),\n                password: $request-&gt;request-&gt;get('password')\n            );\n\n            $this-&gt;messageBus-&gt;dispatch($command);\n\n            return new JsonResponse(['status' =&gt; 'created'], Response::HTTP_CREATED);\n        } catch (InvalidEmailException $e) {\n            return new JsonResponse([\n                'error' =&gt; $e-&gt;getMessage()\n            ], Response::HTTP_BAD_REQUEST);\n        } catch (PasswordTooShortException $e) {\n            return new JsonResponse([\n                'error' =&gt; $e-&gt;getMessage()\n            ], Response::HTTP_BAD_REQUEST);\n        } catch (EmailAlreadyExistsException $e) {\n            return new JsonResponse([\n                'error' =&gt; $e-&gt;getMessage()\n            ], Response::HTTP_CONFLICT);\n        } catch (\\Exception $e) {\n            $this-&gt;logger-&gt;error($e-&gt;getMessage());\n\n            return new JsonResponse([\n                'error' =&gt; 'Internal server error'\n            ], Response::HTTP_INTERNAL_SERVER_ERROR);\n        }\n    }\n}\n</code></pre> <p>Drawback: Repetitive, error-prone, hard to maintain.</p>"},{"location":"advanced/error-handling-strategy/#testing-error-scenarios","title":"Testing Error Scenarios","text":""},{"location":"advanced/error-handling-strategy/#test-1-domain-exception-thrown","title":"Test 1: Domain Exception Thrown","text":"<pre><code>class CancelOrderHandlerTest extends TestCase\n{\n    public function test_throws_when_order_already_shipped(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::SHIPPED);\n        $orders = new InMemoryOrderRepository();\n        $orders-&gt;save($order);\n\n        $handler = new CancelOrderHandler($orders);\n        $command = new CancelOrderCommand($order-&gt;getId());\n\n        $this-&gt;expectException(CannotCancelShippedOrderException::class);\n\n        $handler($command);\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#test-2-infrastructure-exception-translated","title":"Test 2: Infrastructure Exception Translated","text":"<pre><code>class DoctrineUserRepositoryTest extends KernelTestCase\n{\n    public function test_throws_domain_exception_on_duplicate_email(): void\n    {\n        $repository = $this-&gt;getContainer()-&gt;get(UserRepositoryInterface::class);\n\n        $user1 = UserFactory::create('test@example.com', 'password123');\n        $repository-&gt;save($user1);\n\n        $user2 = UserFactory::create('test@example.com', 'password456');\n\n        $this-&gt;expectException(EmailAlreadyExistsException::class);\n\n        $repository-&gt;save($user2); // Duplicate email\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#test-3-controller-exception-handling","title":"Test 3: Controller Exception Handling","text":"<pre><code>class RegisterUserControllerTest extends WebTestCase\n{\n    public function test_returns_400_on_invalid_email(): void\n    {\n        $client = static::createClient();\n\n        $client-&gt;request('POST', '/api/users', [], [], [\n            'CONTENT_TYPE' =&gt; 'application/json',\n        ], json_encode([\n            'email' =&gt; 'not-an-email',\n            'password' =&gt; 'ValidPass123',\n        ]));\n\n        $this-&gt;assertResponseStatusCodeSame(Response::HTTP_BAD_REQUEST);\n        $this-&gt;assertJsonContains(['error' =&gt; 'Validation failed']);\n    }\n\n    public function test_returns_409_on_duplicate_email(): void\n    {\n        $client = static::createClient();\n\n        // Create first user\n        $client-&gt;request('POST', '/api/users', [], [], [\n            'CONTENT_TYPE' =&gt; 'application/json',\n        ], json_encode([\n            'email' =&gt; 'test@example.com',\n            'password' =&gt; 'ValidPass123',\n        ]));\n\n        // Try to create duplicate\n        $client-&gt;request('POST', '/api/users', [], [], [\n            'CONTENT_TYPE' =&gt; 'application/json',\n        ], json_encode([\n            'email' =&gt; 'test@example.com',\n            'password' =&gt; 'AnotherPass456',\n        ]));\n\n        $this-&gt;assertResponseStatusCodeSame(Response::HTTP_CONFLICT);\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#complete-real-world-examples","title":"Complete Real-World Examples","text":""},{"location":"advanced/error-handling-strategy/#example-1-order-processing-with-multiple-exceptions","title":"Example 1: Order Processing with Multiple Exceptions","text":"<pre><code>// Domain exceptions\nnamespace App\\Order\\Domain\\Exception;\n\nfinal class InsufficientStockException extends BusinessRuleException\n{\n    public function __construct(ProductId $productId, int $requested, int $available)\n    {\n        parent::__construct(\n            \"Product {$productId} has insufficient stock: requested $requested, available $available\"\n        );\n    }\n}\n\nfinal class PaymentFailedException extends BusinessRuleException\n{\n    public function __construct(\n        public readonly OrderId $orderId,\n        public readonly Money $amount,\n        public readonly string $reason,\n        ?\\Throwable $previous = null\n    ) {\n        parent::__construct(\n            \"Payment failed for order {$orderId}: $reason\",\n            previous: $previous\n        );\n    }\n}\n\n// Handler with exception handling\nfinal readonly class CheckoutOrderHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orders,\n        private InventoryServiceInterface $inventory,\n        private PaymentProcessorInterface $payment,\n        private EntityManagerInterface $entityManager,\n        private LoggerInterface $logger,\n    ) {}\n\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n            // May throw OrderNotFoundException\n\n            // Reserve inventory\n            try {\n                $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n            } catch (InsufficientStockException $e) {\n                $this-&gt;logger-&gt;warning(\"Insufficient stock\", [\n                    'orderId' =&gt; $order-&gt;getId(),\n                    'error' =&gt; $e-&gt;getMessage()\n                ]);\n                throw $e; // Re-throw to rollback transaction\n            }\n\n            // Process payment\n            try {\n                $payment = $this-&gt;payment-&gt;charge(new PaymentRequest(\n                    amount: $order-&gt;getTotal(),\n                    currency: Currency::USD,\n                    orderId: $order-&gt;getId()\n                ));\n            } catch (PaymentGatewayException $e) {\n                // Release reserved stock\n                $this-&gt;inventory-&gt;releaseStock($order-&gt;getItems());\n\n                throw new PaymentFailedException(\n                    orderId: $order-&gt;getId(),\n                    amount: $order-&gt;getTotal(),\n                    reason: $e-&gt;getMessage(),\n                    previous: $e\n                );\n            }\n\n            // Confirm order\n            $order-&gt;confirm($payment-&gt;transactionId);\n            $this-&gt;orders-&gt;save($order);\n\n            $this-&gt;entityManager-&gt;commit();\n\n            $this-&gt;logger-&gt;info(\"Order checked out successfully\", [\n                'orderId' =&gt; $order-&gt;getId()\n            ]);\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n\n            $this-&gt;logger-&gt;error(\"Checkout failed\", [\n                'orderId' =&gt; $command-&gt;orderId,\n                'error' =&gt; $e-&gt;getMessage()\n            ]);\n\n            throw $e;\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/error-handling-strategy/#summary","title":"Summary","text":"Exception Type Where Thrown Where Caught Example Validation Value objects Controller (via global handler) <code>InvalidEmailException</code> Business Rule Entities, domain services Controller (via global handler) <code>CannotCancelShippedOrderException</code> Not Found Repositories Controller (via global handler) <code>OrderNotFoundException</code> Infrastructure Adapters Translated in adapters to domain exceptions <code>DatabaseConnectionException</code> External Service Adapters Handler (catch &amp; transform or recover) <code>PaymentGatewayException</code>"},{"location":"advanced/error-handling-strategy/#key-principles","title":"Key Principles","text":"<ol> <li>Domain exceptions express business concepts - Use clear, meaningful names</li> <li>Infrastructure exceptions should be translated - Don't leak to application/domain</li> <li>Use global exception handler - Centralize HTTP response mapping</li> <li>Log all exceptions - Essential for debugging production issues</li> <li>Test exception scenarios - Ensure proper handling and responses</li> </ol> <p>Next: Anti-Patterns and Pitfalls \u2192</p>"},{"location":"advanced/factory-pattern-guide/","title":"Factory Pattern: Complete Implementation Guide","text":""},{"location":"advanced/factory-pattern-guide/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Why Use Factories?</li> <li>Factory vs Constructor</li> <li>Types of Factories</li> <li>Input Validation in Factories</li> <li>Error Handling</li> <li>Factories with Value Objects</li> <li>Factory with Dependencies</li> <li>Testing Factories</li> <li>Complete Real-World Examples</li> </ol>"},{"location":"advanced/factory-pattern-guide/#why-use-factories","title":"Why Use Factories?","text":""},{"location":"advanced/factory-pattern-guide/#the-problem-complex-entity-creation","title":"The Problem: Complex Entity Creation","text":"<pre><code>// \u274c Creating entity directly: complex and error-prone\n$user = new User(\n    id: UserId::generate(),\n    email: new Email($request-&gt;email),\n    password: HashedPassword::fromPlaintext($request-&gt;password),\n    roles: [Role::USER],\n    isActive: false,\n    createdAt: new \\DateTimeImmutable(),\n    updatedAt: new \\DateTimeImmutable()\n);\n\n// What if email validation throws?\n// What if password is too short?\n// What if we forget to set createdAt?\n</code></pre> <p>Problems: - Complex instantiation logic scattered everywhere - Easy to forget required fields - Hard to maintain (change in one place = change everywhere) - Business rules duplicated</p>"},{"location":"advanced/factory-pattern-guide/#the-solution-factory-pattern","title":"The Solution: Factory Pattern","text":"<pre><code>// \u2705 Using factory: simple and consistent\n$user = UserFactory::create(\n    email: $request-&gt;email,\n    password: $request-&gt;password\n);\n\n// Factory handles:\n// - ID generation\n// - Email validation\n// - Password hashing\n// - Default roles\n// - Timestamps\n// - Business rules\n</code></pre> <p>Benefits: - Encapsulates complex creation logic - Enforces business rules - Provides sensible defaults - Single place to change creation logic - Clear API for creating entities</p>"},{"location":"advanced/factory-pattern-guide/#factory-vs-constructor","title":"Factory vs Constructor","text":""},{"location":"advanced/factory-pattern-guide/#when-to-use-constructor","title":"When to Use Constructor","text":"<p>\u2705 Use constructor when: - Creation is simple (no logic) - All fields required, no defaults - Reconstructing from database (hydration)</p> <pre><code>// Simple value object: constructor is fine\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n    }\n}\n\n// Usage\n$email = new Email('user@example.com'); // Simple, clear\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#when-to-use-factory","title":"When to Use Factory","text":"<p>\u2705 Use factory when: - Complex initialization logic - Multiple creation methods needed - Need to generate IDs or timestamps - Business rules apply - Multiple steps involved</p> <pre><code>// Complex entity: factory is better\nclass UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),              // Generated\n            email: new Email($email),            // Validated\n            password: HashedPassword::fromPlaintext($password), // Hashed\n            roles: [Role::USER],                 // Default\n            isActive: false,                     // Default\n            createdAt: new \\DateTimeImmutable(), // Auto\n            updatedAt: new \\DateTimeImmutable()  // Auto\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#types-of-factories","title":"Types of Factories","text":""},{"location":"advanced/factory-pattern-guide/#type-1-static-factory-methods","title":"Type 1: Static Factory Methods","text":"<p>Best for: Simple factories without dependencies.</p> <pre><code>class UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password),\n            roles: [Role::USER],\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    public static function createAdmin(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password),\n            roles: [Role::USER, Role::ADMIN], // Different default\n            isActive: true,                   // Different default\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n}\n\n// Usage\n$user = UserFactory::create('user@example.com', 'password123');\n$admin = UserFactory::createAdmin('admin@example.com', 'admin123');\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#type-2-instance-factory-with-dependencies","title":"Type 2: Instance Factory with Dependencies","text":"<p>Best for: Factories needing services (e.g., ID generator, clock).</p> <pre><code>final readonly class OrderFactory\n{\n    public function __construct(\n        private OrderNumberGenerator $numberGenerator,\n        private ClockInterface $clock,\n    ) {}\n\n    public function create(CustomerId $customerId, array $items): Order\n    {\n        return new Order(\n            id: OrderId::generate(),\n            orderNumber: $this-&gt;numberGenerator-&gt;next(), // Uses service\n            customerId: $customerId,\n            items: $items,\n            status: OrderStatus::PENDING,\n            createdAt: $this-&gt;clock-&gt;now() // Uses service\n        );\n    }\n}\n\n// Usage (via DI)\nclass CreateOrderHandler\n{\n    public function __construct(\n        private OrderFactory $orderFactory,\n        private OrderRepositoryInterface $orders,\n    ) {}\n\n    public function __invoke(CreateOrderCommand $command): void\n    {\n        $order = $this-&gt;orderFactory-&gt;create(\n            customerId: $command-&gt;customerId,\n            items: $command-&gt;items\n        );\n\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#type-3-named-constructors-alternative-to-factory","title":"Type 3: Named Constructors (Alternative to Factory)","text":"<p>Best for: Value objects with multiple creation methods.</p> <pre><code>final readonly class Money\n{\n    private function __construct(\n        public int $amountInCents,\n        public Currency $currency,\n    ) {}\n\n    // Named constructor: from cents\n    public static function fromCents(int $cents, Currency $currency): self\n    {\n        return new self($cents, $currency);\n    }\n\n    // Named constructor: from float\n    public static function fromFloat(float $amount, Currency $currency): self\n    {\n        return new self((int) round($amount * 100), $currency);\n    }\n\n    // Named constructor: zero amount\n    public static function zero(Currency $currency): self\n    {\n        return new self(0, $currency);\n    }\n}\n\n// Usage\n$price1 = Money::fromCents(1999, Currency::USD);     // $19.99\n$price2 = Money::fromFloat(19.99, Currency::USD);    // $19.99\n$balance = Money::zero(Currency::USD);                // $0.00\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#input-validation-in-factories","title":"Input Validation in Factories","text":""},{"location":"advanced/factory-pattern-guide/#where-to-validate","title":"Where to Validate?","text":"<p>Rule: Validate in value objects first, then check business rules in factory.</p>"},{"location":"advanced/factory-pattern-guide/#example-user-registration","title":"Example: User Registration","text":"<pre><code>// 1. Value object validates format\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        // Technical validation: email format\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n\n        // Business validation: domain restriction\n        if (!str_ends_with($value, '@company.com')) {\n            throw new InvalidEmailDomainException($value);\n        }\n    }\n}\n\nfinal readonly class Password\n{\n    public function __construct(public string $value)\n    {\n        // Business validation: minimum length\n        if (strlen($value) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        // Business validation: complexity\n        if (!preg_match('/[A-Z]/', $value)) {\n            throw new PasswordNeedsUppercaseException();\n        }\n\n        if (!preg_match('/[0-9]/', $value)) {\n            throw new PasswordNeedsNumberException();\n        }\n    }\n}\n\n// 2. Factory handles creation logic\nclass UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        // Value objects validate themselves on construction\n        $emailVO = new Email($email); // Throws if invalid\n        $passwordVO = new Password($password); // Throws if invalid\n\n        // Factory handles additional logic\n        return new User(\n            id: UserId::generate(),\n            email: $emailVO,\n            password: HashedPassword::fromPassword($passwordVO),\n            roles: [Role::USER],\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n}\n</code></pre> <p>Separation of concerns: - Value objects: Technical + basic business validation - Factory: Orchestration + defaults + complex business rules</p>"},{"location":"advanced/factory-pattern-guide/#example-order-with-business-rules","title":"Example: Order with Business Rules","text":"<pre><code>class OrderFactory\n{\n    public function create(\n        CustomerId $customerId,\n        array $items, // OrderItem[]\n        ShippingAddress $address\n    ): Order {\n        // Business rule: must have at least one item\n        if (empty($items)) {\n            throw new OrderMustHaveItemsException();\n        }\n\n        // Business rule: total must be above minimum\n        $total = $this-&gt;calculateTotal($items);\n        if ($total-&gt;isLessThan(Money::fromCents(500, Currency::USD))) {\n            throw new OrderBelowMinimumException($total);\n        }\n\n        // Business rule: validate shipping to country\n        if (!$this-&gt;canShipToCountry($address-&gt;country)) {\n            throw new CannotShipToCountryException($address-&gt;country);\n        }\n\n        return new Order(\n            id: OrderId::generate(),\n            customerId: $customerId,\n            items: $items,\n            shippingAddress: $address,\n            status: OrderStatus::PENDING,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    private function calculateTotal(array $items): Money\n    {\n        return array_reduce(\n            $items,\n            fn(Money $sum, OrderItem $item) =&gt; $sum-&gt;add($item-&gt;getTotal()),\n            Money::zero(Currency::USD)\n        );\n    }\n\n    private function canShipToCountry(Country $country): bool\n    {\n        return in_array($country, [Country::US, Country::CA, Country::UK]);\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#error-handling","title":"Error Handling","text":""},{"location":"advanced/factory-pattern-guide/#strategy-1-throw-domain-exceptions","title":"Strategy 1: Throw Domain Exceptions","text":"<pre><code>class UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        try {\n            $emailVO = new Email($email);\n        } catch (InvalidEmailException $e) {\n            throw new UserCreationFailedException(\n                \"Invalid email: {$e-&gt;getMessage()}\",\n                previous: $e\n            );\n        }\n\n        try {\n            $passwordVO = HashedPassword::fromPlaintext($password);\n        } catch (PasswordTooShortException $e) {\n            throw new UserCreationFailedException(\n                \"Invalid password: {$e-&gt;getMessage()}\",\n                previous: $e\n            );\n        }\n\n        return new User(\n            id: UserId::generate(),\n            email: $emailVO,\n            password: $passwordVO,\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n}\n</code></pre> <p>Benefits: - Domain exceptions propagate naturally - Caller handles errors - Clear error messages</p>"},{"location":"advanced/factory-pattern-guide/#strategy-2-return-result-object-railway-oriented","title":"Strategy 2: Return Result Object (Railway-Oriented)","text":"<pre><code>// Result wrapper\nfinal readonly class Result\n{\n    private function __construct(\n        public bool $success,\n        public mixed $value = null,\n        public ?string $error = null,\n    ) {}\n\n    public static function ok(mixed $value): self\n    {\n        return new self(true, $value);\n    }\n\n    public static function fail(string $error): self\n    {\n        return new self(false, error: $error);\n    }\n}\n\n// Factory returns Result\nclass UserFactory\n{\n    public static function create(string $email, string $password): Result\n    {\n        try {\n            $emailVO = new Email($email);\n        } catch (InvalidEmailException $e) {\n            return Result::fail(\"Invalid email: {$e-&gt;getMessage()}\");\n        }\n\n        try {\n            $passwordVO = HashedPassword::fromPlaintext($password);\n        } catch (\\Exception $e) {\n            return Result::fail(\"Invalid password: {$e-&gt;getMessage()}\");\n        }\n\n        $user = new User(\n            id: UserId::generate(),\n            email: $emailVO,\n            password: $passwordVO,\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n\n        return Result::ok($user);\n    }\n}\n\n// Usage\n$result = UserFactory::create($email, $password);\n\nif (!$result-&gt;success) {\n    return new JsonResponse(['error' =&gt; $result-&gt;error], 400);\n}\n\n$user = $result-&gt;value;\n</code></pre> <p>Benefits: - Errors are values, not exceptions - Explicit error handling - Functional programming style</p>"},{"location":"advanced/factory-pattern-guide/#factories-with-value-objects","title":"Factories with Value Objects","text":""},{"location":"advanced/factory-pattern-guide/#pattern-factory-uses-value-object-factories","title":"Pattern: Factory Uses Value Object Factories","text":"<pre><code>// Value object with its own factory\nfinal readonly class HashedPassword\n{\n    private function __construct(public string $hash) {}\n\n    // Value object factory\n    public static function fromPlaintext(string $plaintext): self\n    {\n        if (strlen($plaintext) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        $hash = password_hash($plaintext, PASSWORD_ARGON2ID);\n\n        return new self($hash);\n    }\n\n    public static function fromHash(string $hash): self\n    {\n        return new self($hash);\n    }\n}\n\n// Entity factory uses value object factory\nclass UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password), // Uses VO factory\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    // Reconstruct from database (different VO factory method)\n    public static function reconstitute(\n        string $id,\n        string $email,\n        string $passwordHash,\n        bool $isActive,\n        string $createdAt\n    ): User {\n        return new User(\n            id: UserId::fromString($id),\n            email: new Email($email),\n            password: HashedPassword::fromHash($passwordHash), // Different VO factory\n            isActive: $isActive,\n            createdAt: new \\DateTimeImmutable($createdAt)\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#factory-with-dependencies","title":"Factory with Dependencies","text":""},{"location":"advanced/factory-pattern-guide/#example-order-factory-with-services","title":"Example: Order Factory with Services","text":"<pre><code>final readonly class OrderFactory\n{\n    public function __construct(\n        private OrderNumberGenerator $numberGenerator,\n        private TaxCalculator $taxCalculator,\n        private ShippingCalculator $shippingCalculator,\n        private ClockInterface $clock,\n    ) {}\n\n    public function create(\n        CustomerId $customerId,\n        array $items,\n        ShippingAddress $address\n    ): Order {\n        // Use injected services\n        $orderNumber = $this-&gt;numberGenerator-&gt;next();\n        $subtotal = $this-&gt;calculateSubtotal($items);\n        $tax = $this-&gt;taxCalculator-&gt;calculate($subtotal, $address-&gt;country);\n        $shipping = $this-&gt;shippingCalculator-&gt;calculate($address, $items);\n        $total = $subtotal-&gt;add($tax)-&gt;add($shipping);\n\n        return new Order(\n            id: OrderId::generate(),\n            orderNumber: $orderNumber,\n            customerId: $customerId,\n            items: $items,\n            subtotal: $subtotal,\n            tax: $tax,\n            shipping: $shipping,\n            total: $total,\n            status: OrderStatus::PENDING,\n            createdAt: $this-&gt;clock-&gt;now()\n        );\n    }\n\n    private function calculateSubtotal(array $items): Money\n    {\n        return array_reduce(\n            $items,\n            fn(Money $sum, OrderItem $item) =&gt; $sum-&gt;add($item-&gt;getTotal()),\n            Money::zero(Currency::USD)\n        );\n    }\n}\n</code></pre> <p>Configuration (services.yaml):</p> <pre><code>services:\n    App\\Order\\Domain\\Factory\\OrderFactory:\n        arguments:\n            $numberGenerator: '@App\\Order\\Infrastructure\\OrderNumberGenerator'\n            $taxCalculator: '@App\\Order\\Domain\\Service\\TaxCalculator'\n            $shippingCalculator: '@App\\Order\\Domain\\Service\\ShippingCalculator'\n            $clock: '@App\\Shared\\Infrastructure\\Clock\\SystemClock'\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#testing-factories","title":"Testing Factories","text":""},{"location":"advanced/factory-pattern-guide/#test-1-successful-creation","title":"Test 1: Successful Creation","text":"<pre><code>class UserFactoryTest extends TestCase\n{\n    public function test_creates_user_with_valid_data(): void\n    {\n        $user = UserFactory::create(\n            email: 'user@example.com',\n            password: 'ValidPass123'\n        );\n\n        $this-&gt;assertInstanceOf(User::class, $user);\n        $this-&gt;assertEquals('user@example.com', $user-&gt;getEmail()-&gt;value);\n        $this-&gt;assertFalse($user-&gt;isActive());\n        $this-&gt;assertContains(Role::USER, $user-&gt;getRoles());\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#test-2-validation-failures","title":"Test 2: Validation Failures","text":"<pre><code>class UserFactoryTest extends TestCase\n{\n    public function test_throws_on_invalid_email(): void\n    {\n        $this-&gt;expectException(InvalidEmailException::class);\n\n        UserFactory::create(\n            email: 'not-an-email',\n            password: 'ValidPass123'\n        );\n    }\n\n    public function test_throws_on_short_password(): void\n    {\n        $this-&gt;expectException(PasswordTooShortException::class);\n\n        UserFactory::create(\n            email: 'user@example.com',\n            password: 'short'\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#test-3-factory-with-dependencies","title":"Test 3: Factory with Dependencies","text":"<pre><code>class OrderFactoryTest extends TestCase\n{\n    public function test_creates_order_with_calculated_totals(): void\n    {\n        $numberGenerator = $this-&gt;createMock(OrderNumberGenerator::class);\n        $numberGenerator-&gt;method('next')-&gt;willReturn(new OrderNumber('ORD-001'));\n\n        $taxCalculator = $this-&gt;createMock(TaxCalculator::class);\n        $taxCalculator-&gt;method('calculate')-&gt;willReturn(Money::fromCents(200, Currency::USD));\n\n        $shippingCalculator = $this-&gt;createMock(ShippingCalculator::class);\n        $shippingCalculator-&gt;method('calculate')-&gt;willReturn(Money::fromCents(500, Currency::USD));\n\n        $clock = new FixedClock(new \\DateTimeImmutable('2024-01-15 10:00:00'));\n\n        $factory = new OrderFactory($numberGenerator, $taxCalculator, $shippingCalculator, $clock);\n\n        $order = $factory-&gt;create(\n            customerId: CustomerId::generate(),\n            items: [new OrderItem(ProductId::generate(), 2, Money::fromCents(1000, Currency::USD))],\n            address: new ShippingAddress(/* ... */)\n        );\n\n        $this-&gt;assertEquals('ORD-001', $order-&gt;getOrderNumber()-&gt;value);\n        $this-&gt;assertEquals(2700, $order-&gt;getTotal()-&gt;amountInCents); // 2000 + 200 + 500\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#complete-real-world-examples","title":"Complete Real-World Examples","text":""},{"location":"advanced/factory-pattern-guide/#example-1-product-factory","title":"Example 1: Product Factory","text":"<pre><code>namespace App\\Catalog\\Domain\\Factory;\n\nfinal class ProductFactory\n{\n    public static function create(\n        string $name,\n        string $description,\n        int $priceInCents,\n        int $initialStock\n    ): Product {\n        // Validation\n        if (empty($name)) {\n            throw new ProductNameCannotBeEmptyException();\n        }\n\n        if ($priceInCents &lt; 0) {\n            throw new ProductPriceCannotBeNegativeException();\n        }\n\n        if ($initialStock &lt; 0) {\n            throw new ProductStockCannotBeNegativeException();\n        }\n\n        // Create value objects\n        $price = Money::fromCents($priceInCents, Currency::USD);\n        $stock = new Stock($initialStock);\n\n        // Create entity\n        return new Product(\n            id: ProductId::generate(),\n            name: $name,\n            description: $description,\n            price: $price,\n            stock: $stock,\n            isActive: true,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    public static function createOutOfStock(string $name, string $description, int $priceInCents): Product\n    {\n        $product = self::create($name, $description, $priceInCents, 0);\n        $product-&gt;deactivate(); // Out of stock products are inactive\n        return $product;\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#example-2-invoice-factory-with-line-items","title":"Example 2: Invoice Factory with Line Items","text":"<pre><code>namespace App\\Billing\\Domain\\Factory;\n\nfinal readonly class InvoiceFactory\n{\n    public function __construct(\n        private InvoiceNumberGenerator $numberGenerator,\n        private ClockInterface $clock,\n    ) {}\n\n    public function create(\n        CustomerId $customerId,\n        array $lineItems, // InvoiceLineItem[]\n        ?DateTimeImmutable $dueDate = null\n    ): Invoice {\n        // Validation\n        if (empty($lineItems)) {\n            throw new InvoiceMustHaveLineItemsException();\n        }\n\n        // Calculate total\n        $total = array_reduce(\n            $lineItems,\n            fn(Money $sum, InvoiceLineItem $item) =&gt; $sum-&gt;add($item-&gt;getTotal()),\n            Money::zero(Currency::USD)\n        );\n\n        // Default due date: 30 days from now\n        $dueDate ??= $this-&gt;clock-&gt;now()-&gt;modify('+30 days');\n\n        // Generate invoice number\n        $invoiceNumber = $this-&gt;numberGenerator-&gt;next();\n\n        return new Invoice(\n            id: InvoiceId::generate(),\n            invoiceNumber: $invoiceNumber,\n            customerId: $customerId,\n            lineItems: $lineItems,\n            total: $total,\n            status: InvoiceStatus::DRAFT,\n            issuedAt: $this-&gt;clock-&gt;now(),\n            dueDate: $dueDate\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#example-3-complex-user-factory-with-multiple-methods","title":"Example 3: Complex User Factory with Multiple Methods","text":"<pre><code>namespace App\\User\\Domain\\Factory;\n\nfinal class UserFactory\n{\n    // Regular user registration\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password),\n            roles: [Role::USER],\n            isActive: false, // Requires email verification\n            isEmailVerified: false,\n            createdAt: new \\DateTimeImmutable(),\n            updatedAt: new \\DateTimeImmutable()\n        );\n    }\n\n    // Admin user (no verification needed)\n    public static function createAdmin(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password),\n            roles: [Role::USER, Role::ADMIN],\n            isActive: true,\n            isEmailVerified: true,\n            createdAt: new \\DateTimeImmutable(),\n            updatedAt: new \\DateTimeImmutable()\n        );\n    }\n\n    // OAuth user (no password)\n    public static function createFromOAuth(string $email, OAuthProvider $provider, string $providerId): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: null, // No password for OAuth users\n            roles: [Role::USER],\n            isActive: true,\n            isEmailVerified: true, // Trust OAuth provider\n            oauthProvider: $provider,\n            oauthProviderId: $providerId,\n            createdAt: new \\DateTimeImmutable(),\n            updatedAt: new \\DateTimeImmutable()\n        );\n    }\n\n    // Reconstitute from database\n    public static function reconstitute(array $data): User\n    {\n        return new User(\n            id: UserId::fromString($data['id']),\n            email: new Email($data['email']),\n            password: $data['password'] ? HashedPassword::fromHash($data['password']) : null,\n            roles: array_map(fn($role) =&gt; Role::from($role), $data['roles']),\n            isActive: $data['is_active'],\n            isEmailVerified: $data['is_email_verified'],\n            oauthProvider: $data['oauth_provider'] ? OAuthProvider::from($data['oauth_provider']) : null,\n            oauthProviderId: $data['oauth_provider_id'],\n            createdAt: new \\DateTimeImmutable($data['created_at']),\n            updatedAt: new \\DateTimeImmutable($data['updated_at'])\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/factory-pattern-guide/#key-takeaways","title":"Key Takeaways","text":"<ol> <li>Use factories for complex entity creation - Encapsulate logic in one place</li> <li>Validate in value objects first - Then check business rules in factory</li> <li>Provide multiple creation methods - Different use cases need different factories</li> <li>Handle errors with domain exceptions - Clear, meaningful error messages</li> <li>Inject dependencies when needed - Use instance factories for services</li> <li>Test factories thoroughly - Ensure validation and defaults work correctly</li> </ol> <p>Next: Error Handling Strategy \u2192</p>"},{"location":"advanced/port-design-principles/","title":"Port Interface Design Principles","text":""},{"location":"advanced/port-design-principles/#table-of-contents","title":"Table of Contents","text":"<ol> <li>What is a Port?</li> <li>Naming Conventions</li> <li>Interface Segregation Principle (ISP)</li> <li>Method Design Guidelines</li> <li>Common Port Patterns</li> <li>Anti-Patterns to Avoid</li> <li>Real-World Examples</li> </ol>"},{"location":"advanced/port-design-principles/#what-is-a-port","title":"What is a Port?","text":"<p>A Port is an interface defined in the Domain layer that declares what the domain needs from the outside world.</p> <pre><code>Domain defines:   \"I need to save users\"  \u2192 UserRepositoryInterface (Port)\nInfrastructure provides:  \"Here's how\"    \u2192 DoctrineUserRepository (Adapter)\n</code></pre>"},{"location":"advanced/port-design-principles/#key-characteristics","title":"Key Characteristics","text":"<ul> <li>Defined in Domain - Lives in <code>Domain/Port/</code></li> <li>Implemented by Infrastructure - Adapters in <code>Infrastructure/</code></li> <li>Expresses Business Intent - Uses domain language, not technical language</li> <li>No Implementation Details - No mention of Doctrine, MySQL, HTTP, etc.</li> </ul>"},{"location":"advanced/port-design-principles/#naming-conventions","title":"Naming Conventions","text":""},{"location":"advanced/port-design-principles/#repository-ports","title":"Repository Ports","text":"<p>\u2705 GOOD: <pre><code>interface UserRepositoryInterface       // Clear: manages User entities\ninterface OrderRepositoryInterface      // Clear: manages Order entities\ninterface ProductRepositoryInterface    // Clear: manages Product entities\n</code></pre></p> <p>\u274c BAD: <pre><code>interface UserDAO                       // Technical term (Data Access Object)\ninterface UserPersistence               // Vague\ninterface IUserRepository               // Hungarian notation (avoid \"I\" prefix)\ninterface UserRepositoryPort            // Redundant suffix\n</code></pre></p>"},{"location":"advanced/port-design-principles/#service-ports","title":"Service Ports","text":"<p>\u2705 GOOD: <pre><code>interface EmailSenderInterface          // Clear capability\ninterface PaymentProcessorInterface     // Clear responsibility\ninterface NotificationServiceInterface  // Clear purpose\n</code></pre></p> <p>\u274c BAD: <pre><code>interface EmailService                  // Too vague\ninterface IEmailSender                  // Hungarian notation\ninterface SMTPEmailSender               // Implementation detail leaked!\n</code></pre></p>"},{"location":"advanced/port-design-principles/#query-ports-cqrs","title":"Query Ports (CQRS)","text":"<p>\u2705 GOOD: <pre><code>interface UserQueryInterface            // Clear: read operations for Users\ninterface OrderQueryInterface           // Clear: read operations for Orders\ninterface ProductCatalogQueryInterface  // Clear: specific read concern\n</code></pre></p> <p>\u274c BAD: <pre><code>interface UserReader                    // Unclear\ninterface GetUserQuery                  // Not a capability, but an action\n</code></pre></p>"},{"location":"advanced/port-design-principles/#interface-segregation-principle-isp","title":"Interface Segregation Principle (ISP)","text":"<p>\"Clients should not be forced to depend on methods they do not use.\"</p>"},{"location":"advanced/port-design-principles/#the-problem-fat-interfaces","title":"The Problem: Fat Interfaces","text":"<p>\u274c BAD: God Interface</p> <pre><code>interface UserRepositoryInterface\n{\n    // Read methods\n    public function findById(UserId $id): ?User;\n    public function findByEmail(string $email): ?User;\n    public function findAll(): array;\n    public function findActiveUsers(): array;\n    public function findUsersByRole(string $role): array;\n    public function searchUsers(string $query): array;\n\n    // Write methods\n    public function save(User $user): void;\n    public function delete(User $user): void;\n\n    // Statistics methods\n    public function countUsers(): int;\n    public function countActiveUsers(): int;\n\n    // Admin methods\n    public function purgeInactiveUsers(): void;\n    public function exportUsersToCSV(): string;\n\n    // Notification methods\n    public function findUsersToNotify(): array;\n}\n</code></pre> <p>Problems: - Handler that only saves users depends on 15 methods it doesn't need - Hard to test (must mock 15 methods) - Hard to implement (adapter must implement everything) - Violates Single Responsibility Principle</p>"},{"location":"advanced/port-design-principles/#the-solution-segregated-interfaces","title":"The Solution: Segregated Interfaces","text":"<p>\u2705 GOOD: Segregated by Responsibility</p> <pre><code>// Write operations\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function delete(User $user): void;\n    public function existsByEmail(string $email): bool;\n}\n\n// Read operations (CQRS pattern)\ninterface UserQueryInterface\n{\n    public function findById(UserId $id): ?User;\n    public function findByEmail(string $email): ?User;\n    public function findActiveUsers(): array;\n}\n\n// Admin operations\ninterface UserAdminInterface\n{\n    public function purgeInactiveUsers(): void;\n    public function countUsers(): int;\n}\n\n// Notification operations\ninterface UserNotificationQueryInterface\n{\n    public function findUsersToNotify(): array;\n}\n</code></pre> <p>Benefits: - Handlers depend only on what they need - Easy to test (mock only relevant methods) - Easy to implement (adapter implements one responsibility at a time) - Clear separation of concerns</p>"},{"location":"advanced/port-design-principles/#when-to-split-vs-keep-together","title":"When to Split vs Keep Together","text":"<p>\u2705 Keep together when methods are always used together:</p> <pre><code>// GOOD: These methods logically belong together\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function delete(Order $order): void;\n}\n</code></pre> <p>\u274c Split when methods serve different use cases:</p> <pre><code>// BAD: findPendingOrders is specific to a background job\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function findPendingOrders(): array; // \u274c Different concern!\n}\n\n// GOOD: Separate query interface\ninterface OrderQueryInterface\n{\n    public function findPendingOrders(): array;\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#method-design-guidelines","title":"Method Design Guidelines","text":""},{"location":"advanced/port-design-principles/#1-use-domain-language-not-technical-language","title":"1. Use Domain Language, Not Technical Language","text":"<p>\u2705 GOOD: Domain Language</p> <pre><code>interface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function findPendingOrders(): array; // Business concept\n}\n</code></pre> <p>\u274c BAD: Technical Language</p> <pre><code>interface OrderRepositoryInterface\n{\n    public function persist(Order $order): void; // Technical (SQL term)\n    public function selectById(OrderId $id): ?Order; // Technical (SQL term)\n    public function queryByStatusPending(): array; // Technical implementation detail\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#2-return-domain-objects-not-primitives","title":"2. Return Domain Objects, Not Primitives","text":"<p>\u2705 GOOD: Domain Objects</p> <pre><code>interface UserRepositoryInterface\n{\n    public function findById(UserId $id): ?User;\n    public function findActiveUsers(): array; // array&lt;User&gt;\n}\n</code></pre> <p>\u274c BAD: Primitives</p> <pre><code>interface UserRepositoryInterface\n{\n    public function findById(string $id): ?array; // array is not type-safe\n    public function findActiveUsers(): array; // array&lt;what?&gt;\n}\n</code></pre> <p>Use PHPDoc for clarity:</p> <pre><code>interface UserRepositoryInterface\n{\n    /**\n     * @return array&lt;User&gt;\n     */\n    public function findActiveUsers(): array;\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#3-accept-domain-types-not-primitives","title":"3. Accept Domain Types, Not Primitives","text":"<p>\u2705 GOOD: Value Objects</p> <pre><code>interface UserRepositoryInterface\n{\n    public function findById(UserId $id): ?User;\n    public function existsByEmail(Email $email): bool;\n}\n</code></pre> <p>\u274c BAD: Primitives</p> <pre><code>interface UserRepositoryInterface\n{\n    public function findById(string $id): ?User;\n    public function existsByEmail(string $email): bool; // Loses domain validation\n}\n</code></pre> <p>Why? Value objects ensure validation happens at the boundary, not in the adapter.</p>"},{"location":"advanced/port-design-principles/#4-design-for-readability","title":"4. Design for Readability","text":"<p>Method names should read like natural language.</p> <p>\u2705 GOOD: Readable</p> <pre><code>if ($this-&gt;users-&gt;existsByEmail($email)) {\n    throw new EmailAlreadyExistsException();\n}\n\n$orders = $this-&gt;orders-&gt;findPendingOrders();\n</code></pre> <p>\u274c BAD: Unclear</p> <pre><code>if ($this-&gt;users-&gt;checkEmail($email)) { // Check what about email?\n    throw new EmailAlreadyExistsException();\n}\n\n$orders = $this-&gt;orders-&gt;getPending(); // Get pending what?\n</code></pre>"},{"location":"advanced/port-design-principles/#5-avoid-leaking-implementation-details","title":"5. Avoid Leaking Implementation Details","text":"<p>\u2705 GOOD: Implementation-Agnostic</p> <pre><code>interface NotificationServiceInterface\n{\n    public function send(Notification $notification): void;\n}\n</code></pre> <p>\u274c BAD: Leaks Implementation</p> <pre><code>interface NotificationServiceInterface\n{\n    public function sendViaSmtp(Notification $notification): void; // \u274c SMTP is implementation detail\n    public function sendViaSendGrid(Notification $notification): void; // \u274c SendGrid is implementation detail\n}\n</code></pre> <p>Why? Port should describe \"what\", not \"how\". Implementation can change without changing the port.</p>"},{"location":"advanced/port-design-principles/#6-design-for-testability","title":"6. Design for Testability","text":"<p>Ports should be easy to mock/stub.</p> <p>\u2705 GOOD: Simple, Testable</p> <pre><code>interface EmailSenderInterface\n{\n    public function send(Email $email): void;\n}\n\n// Test with in-memory fake\nclass InMemoryEmailSender implements EmailSenderInterface\n{\n    private array $sentEmails = [];\n\n    public function send(Email $email): void\n    {\n        $this-&gt;sentEmails[] = $email;\n    }\n\n    public function getSentEmails(): array\n    {\n        return $this-&gt;sentEmails;\n    }\n}\n</code></pre> <p>\u274c BAD: Hard to Test</p> <pre><code>interface EmailSenderInterface\n{\n    public function send(\n        Email $email,\n        EmailConfiguration $config,\n        TransportOptions $transport,\n        RetryPolicy $retry\n    ): SendResult;\n}\n\n// Test requires complex setup with many dependencies\n</code></pre>"},{"location":"advanced/port-design-principles/#common-port-patterns","title":"Common Port Patterns","text":""},{"location":"advanced/port-design-principles/#pattern-1-repository-port-persistence","title":"Pattern 1: Repository Port (Persistence)","text":"<p>Purpose: Manage aggregate root lifecycle (CRUD).</p> <pre><code>interface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function delete(Order $order): void;\n}\n</code></pre> <p>Key Points: - One repository per aggregate root - Methods use domain language (<code>save</code>, not <code>persist</code>) - Return domain entities, not arrays</p>"},{"location":"advanced/port-design-principles/#pattern-2-query-port-cqrs-read-side","title":"Pattern 2: Query Port (CQRS Read Side)","text":"<p>Purpose: Optimized read operations, may return DTOs instead of entities.</p> <pre><code>interface ProductCatalogQueryInterface\n{\n    /**\n     * @return array&lt;ProductListDTO&gt;\n     */\n    public function findAvailableProducts(int $limit, int $offset): array;\n\n    public function findProductById(ProductId $id): ?ProductDetailDTO;\n\n    public function searchProducts(string $query): array;\n}\n</code></pre> <p>Key Points: - Separate from write operations (repository) - Can return DTOs optimized for display - May bypass domain entities for performance</p>"},{"location":"advanced/port-design-principles/#pattern-3-external-service-port","title":"Pattern 3: External Service Port","text":"<p>Purpose: Communicate with external systems (email, payment, etc.).</p> <pre><code>interface PaymentProcessorInterface\n{\n    public function charge(PaymentRequest $request): PaymentResult;\n    public function refund(RefundRequest $request): RefundResult;\n}\n</code></pre> <p>Key Points: - Express business capability, not technical protocol - Accept/return domain objects - Hide implementation details (Stripe, PayPal, etc.)</p>"},{"location":"advanced/port-design-principles/#pattern-4-event-dispatcher-port","title":"Pattern 4: Event Dispatcher Port","text":"<p>Purpose: Publish domain events.</p> <pre><code>interface EventDispatcherInterface\n{\n    public function dispatch(DomainEvent $event): void;\n}\n</code></pre> <p>Key Points: - Generic interface for all events - Domain events are first-class citizens - Infrastructure handles routing</p>"},{"location":"advanced/port-design-principles/#pattern-5-specification-port-query-builder","title":"Pattern 5: Specification Port (Query Builder)","text":"<p>Purpose: Build complex queries dynamically.</p> <pre><code>interface UserSpecificationInterface\n{\n    public function matching(Specification $spec): array;\n}\n\n// Usage\n$activeAdmins = $this-&gt;users-&gt;matching(\n    new AndSpecification(\n        new IsActiveSpecification(),\n        new HasRoleSpecification(Role::ADMIN)\n    )\n);\n</code></pre> <p>Key Points: - Allows complex filtering without polluting repository - Composable specifications - Advanced pattern, use sparingly</p>"},{"location":"advanced/port-design-principles/#anti-patterns-to-avoid","title":"Anti-Patterns to Avoid","text":""},{"location":"advanced/port-design-principles/#anti-pattern-1-generic-repository","title":"Anti-Pattern 1: Generic Repository","text":"<p>\u274c AVOID:</p> <pre><code>interface GenericRepositoryInterface\n{\n    public function save(object $entity): void;\n    public function findById(string $id): ?object;\n    public function findAll(): array;\n}\n</code></pre> <p>Problems: - Type-unsafe (<code>object</code> and <code>string</code> are too generic) - Loses domain specificity - No type hinting benefits</p> <p>\u2705 BETTER:</p> <pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n}\n\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#anti-pattern-2-repositories-with-business-logic","title":"Anti-Pattern 2: Repositories with Business Logic","text":"<p>\u274c AVOID:</p> <pre><code>interface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n\n    // \u274c Business logic leaked into repository!\n    public function cancelOrder(OrderId $id): void;\n    public function shipOrder(OrderId $id, Address $address): void;\n}\n</code></pre> <p>Problem: Repository should manage persistence, not execute business logic.</p> <p>\u2705 BETTER:</p> <pre><code>// Repository: persistence only\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n}\n\n// Business logic in handlers\nclass CancelOrderHandler\n{\n    public function __invoke(CancelOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n        $order-&gt;cancel(); // Business logic in entity\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#anti-pattern-3-query-methods-returning-scalar-arrays","title":"Anti-Pattern 3: Query Methods Returning Scalar Arrays","text":"<p>\u274c AVOID:</p> <pre><code>interface UserRepositoryInterface\n{\n    /**\n     * @return array&lt;array{id: string, email: string, name: string}&gt;\n     */\n    public function findAllUsers(): array;\n}\n</code></pre> <p>Problem: Array shapes are error-prone and not type-safe.</p> <p>\u2705 BETTER:</p> <pre><code>interface UserQueryInterface\n{\n    /**\n     * @return array&lt;UserListDTO&gt;\n     */\n    public function findAllUsers(): array;\n}\n\nfinal readonly class UserListDTO\n{\n    public function __construct(\n        public string $id,\n        public string $email,\n        public string $name,\n    ) {}\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#anti-pattern-4-ports-depending-on-infrastructure","title":"Anti-Pattern 4: Ports Depending on Infrastructure","text":"<p>\u274c AVOID:</p> <pre><code>use Doctrine\\ORM\\EntityManagerInterface;\n\ninterface UserRepositoryInterface\n{\n    public function getEntityManager(): EntityManagerInterface; // \u274c Leaks infrastructure!\n}\n</code></pre> <p>Problem: Domain now depends on Doctrine.</p> <p>\u2705 BETTER:</p> <pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    // No mention of Doctrine, EntityManager, or any framework\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#real-world-examples","title":"Real-World Examples","text":""},{"location":"advanced/port-design-principles/#example-1-e-commerce-order-system","title":"Example 1: E-Commerce Order System","text":"<pre><code>// Write operations\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function nextOrderNumber(): OrderNumber;\n}\n\n// Read operations (optimized for display)\ninterface OrderQueryInterface\n{\n    /**\n     * @return array&lt;OrderListDTO&gt;\n     */\n    public function findOrdersByCustomer(CustomerId $customerId, int $limit, int $offset): array;\n\n    public function findOrderDetails(OrderId $id): ?OrderDetailDTO;\n\n    /**\n     * @return array&lt;OrderListDTO&gt;\n     */\n    public function findRecentOrders(int $limit): array;\n}\n\n// External payment service\ninterface PaymentProcessorInterface\n{\n    public function charge(PaymentRequest $request): PaymentResult;\n    public function refund(RefundRequest $request): RefundResult;\n    public function getTransactionStatus(TransactionId $id): TransactionStatus;\n}\n\n// Inventory management\ninterface InventoryServiceInterface\n{\n    public function reserveStock(ProductId $productId, int $quantity): void;\n    public function releaseStock(ProductId $productId, int $quantity): void;\n    public function checkAvailability(ProductId $productId): int;\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#example-2-user-authentication-system","title":"Example 2: User Authentication System","text":"<pre><code>// User persistence\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findByEmail(Email $email): ?User;\n    public function existsByEmail(Email $email): bool;\n}\n\n// Password hashing (external service)\ninterface PasswordHasherInterface\n{\n    public function hash(string $plaintext): string;\n    public function verify(string $plaintext, string $hash): bool;\n}\n\n// Email notifications\ninterface EmailSenderInterface\n{\n    public function send(Email $email): void;\n}\n\n// Token generation\ninterface TokenGeneratorInterface\n{\n    public function generate(): string;\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#example-3-blog-system","title":"Example 3: Blog System","text":"<pre><code>// Article persistence\ninterface ArticleRepositoryInterface\n{\n    public function save(Article $article): void;\n    public function findById(ArticleId $id): ?Article;\n    public function delete(Article $article): void;\n}\n\n// Article queries (optimized for performance)\ninterface ArticleQueryInterface\n{\n    /**\n     * @return array&lt;ArticleSummaryDTO&gt;\n     */\n    public function findPublishedArticles(int $limit, int $offset): array;\n\n    public function findArticleBySlug(string $slug): ?ArticleDetailDTO;\n\n    /**\n     * @return array&lt;ArticleSummaryDTO&gt;\n     */\n    public function findArticlesByAuthor(AuthorId $authorId): array;\n\n    public function countPublishedArticles(): int;\n}\n\n// Search functionality\ninterface ArticleSearchInterface\n{\n    /**\n     * @return array&lt;ArticleSearchResultDTO&gt;\n     */\n    public function search(string $query): array;\n}\n\n// Image storage\ninterface ImageStorageInterface\n{\n    public function store(Image $image): string; // Returns URL\n    public function delete(string $url): void;\n}\n</code></pre>"},{"location":"advanced/port-design-principles/#decision-checklist","title":"Decision Checklist","text":"<p>When designing a port, ask yourself:</p> <ul> <li> Does the interface name clearly express its purpose?</li> <li> Are methods named using domain language, not technical terms?</li> <li> Does it accept/return domain objects (entities, value objects, DTOs)?</li> <li> Is it segregated (ISP)\u2014handlers depend only on what they need?</li> <li> Does it avoid leaking implementation details?</li> <li> Can it be easily mocked/stubbed for testing?</li> <li> Would a business expert understand the method names?</li> <li> Is it defined in the Domain layer (<code>Domain/Port/</code>)?</li> <li> Does it have zero dependencies on infrastructure?</li> </ul>"},{"location":"advanced/port-design-principles/#summary","title":"Summary","text":"Principle Guideline Naming Use domain language, avoid technical terms Segregation Split interfaces by responsibility (ISP) Types Accept/return domain objects, not primitives Clarity Methods should read like natural language Abstraction Hide implementation details completely Testability Easy to mock with in-memory fakes Location Always in <code>Domain/Port/</code>, never in Infrastructure <p>Next: Primary vs Secondary Adapters \u2192</p>"},{"location":"advanced/primary-secondary-adapters/","title":"Primary vs Secondary Adapters: The Two Sides of the Hexagon","text":""},{"location":"advanced/primary-secondary-adapters/#table-of-contents","title":"Table of Contents","text":"<ol> <li>The Hexagon Has Two Sides</li> <li>Primary Adapters (Driving/Left Side)</li> <li>Secondary Adapters (Driven/Right Side)</li> <li>Key Differences</li> <li>Dependency Direction</li> <li>Real-World Examples</li> <li>Testing Strategy</li> <li>Common Patterns</li> </ol>"},{"location":"advanced/primary-secondary-adapters/#the-hexagon-has-two-sides","title":"The Hexagon Has Two Sides","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph LR\n    subgraph Primary[\"\ud83d\udd35 PRIMARY ADAPTERS (Driving/Left)\"]\n        REST[\"REST API&lt;br/&gt;Controller\"]\n        CLI[\"CLI&lt;br/&gt;Command\"]\n        GraphQL[\"GraphQL&lt;br/&gt;Resolver\"]\n        UI[\"Web UI&lt;br/&gt;Form\"]\n    end\n\n    subgraph Core[\"\ud83d\udc8e DOMAIN (Hexagon Core)\"]\n        App[\"Application&lt;br/&gt;Handlers\"]\n        Domain[\"Domain&lt;br/&gt;Entities\"]\n        Ports[\"Ports&lt;br/&gt;Interfaces\"]\n    end\n\n    subgraph Secondary[\"\ud83d\udfe2 SECONDARY ADAPTERS (Driven/Right)\"]\n        DB[\"Database&lt;br/&gt;Doctrine\"]\n        Email[\"Email&lt;br/&gt;SMTP\"]\n        Queue[\"Message Queue&lt;br/&gt;RabbitMQ\"]\n        Storage[\"File Storage&lt;br/&gt;S3\"]\n    end\n\n    REST --&gt;|\"drives\"| App\n    CLI --&gt;|\"drives\"| App\n    GraphQL --&gt;|\"drives\"| App\n    UI --&gt;|\"drives\"| App\n\n    App --&gt;|\"uses (via Port)\"| Ports\n    Ports -.-&gt;|\"implemented by\"| DB\n    Ports -.-&gt;|\"implemented by\"| Email\n    Ports -.-&gt;|\"implemented by\"| Queue\n    Ports -.-&gt;|\"implemented by\"| Storage\n\n    style Primary fill:#BBDEFB,stroke:#1976D2,stroke-width:3px\n    style Core fill:#C8E6C9,stroke:#388E3C,stroke-width:4px\n    style Secondary fill:#FFF9C4,stroke:#F57F17,stroke-width:3px</code></pre>"},{"location":"advanced/primary-secondary-adapters/#primary-adapters-drivingleft-side","title":"Primary Adapters (Driving/Left Side)","text":""},{"location":"advanced/primary-secondary-adapters/#what-are-primary-adapters","title":"What Are Primary Adapters?","text":"<p>Primary adapters DRIVE the application. They initiate interactions with your business logic.</p> <p>\"I want to do something\" \u2192 Primary Adapter \u2192 Application</p>"},{"location":"advanced/primary-secondary-adapters/#characteristics","title":"Characteristics","text":"<ul> <li>Initiate requests to the application</li> <li>Depend ON the domain (know about handlers, commands)</li> <li>Convert external input to application commands</li> <li>Located on the LEFT side of the hexagon (driving side)</li> <li>Examples: Controllers, CLI commands, GraphQL resolvers, event listeners</li> </ul>"},{"location":"advanced/primary-secondary-adapters/#responsibility-input-transformation","title":"Responsibility: Input Transformation","text":"<p>Primary adapters transform external format \u2192 application format.</p> <pre><code>HTTP JSON \u2192 Request DTO \u2192 Command \u2192 Handler\nCLI arguments \u2192 Command \u2192 Handler\nGraphQL query \u2192 Command \u2192 Handler\n</code></pre>"},{"location":"advanced/primary-secondary-adapters/#example-1-rest-api-controller-primary-adapter","title":"Example 1: REST API Controller (Primary Adapter)","text":"<pre><code>namespace App\\User\\Infrastructure\\Controller;\n\nuse App\\User\\Application\\Command\\RegisterUserCommand;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\Messenger\\MessageBusInterface;\n\n#[Route('/api/users', methods: ['POST'])]\nfinal readonly class RegisterUserController\n{\n    public function __construct(\n        private MessageBusInterface $messageBus,\n        private SerializerInterface $serializer,\n    ) {}\n\n    public function __invoke(Request $request): JsonResponse\n    {\n        // 1. Deserialize HTTP JSON \u2192 DTO\n        $dto = $this-&gt;serializer-&gt;deserialize(\n            $request-&gt;getContent(),\n            RegisterUserRequest::class,\n            'json'\n        );\n\n        // 2. Transform DTO \u2192 Command (Application)\n        $command = new RegisterUserCommand(\n            email: $dto-&gt;email,\n            password: $dto-&gt;password\n        );\n\n        // 3. DRIVE the application by dispatching command\n        $this-&gt;messageBus-&gt;dispatch($command);\n\n        // 4. Transform result \u2192 HTTP JSON\n        return new JsonResponse(['status' =&gt; 'created'], 201);\n    }\n}\n</code></pre> <p>Key Points: - Initiates the interaction (user makes HTTP request) - Depends on Application layer (imports <code>RegisterUserCommand</code>) - Knows about HTTP, JSON, Symfony Request/Response - Drives the application by calling <code>messageBus-&gt;dispatch()</code></p>"},{"location":"advanced/primary-secondary-adapters/#example-2-cli-command-primary-adapter","title":"Example 2: CLI Command (Primary Adapter)","text":"<pre><code>namespace App\\User\\Infrastructure\\Console;\n\nuse App\\User\\Application\\Command\\ImportUsersCommand;\nuse Symfony\\Component\\Console\\Command\\Command;\nuse Symfony\\Component\\Console\\Input\\InputArgument;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\nuse Symfony\\Component\\Messenger\\MessageBusInterface;\n\nfinal class ImportUsersCliCommand extends Command\n{\n    protected static $defaultName = 'app:import-users';\n\n    public function __construct(\n        private MessageBusInterface $messageBus,\n    ) {\n        parent::__construct();\n    }\n\n    protected function configure(): void\n    {\n        $this-&gt;addArgument('file', InputArgument::REQUIRED, 'CSV file path');\n    }\n\n    protected function execute(InputInterface $input, OutputInterface $output): int\n    {\n        $filePath = $input-&gt;getArgument('file');\n\n        // Parse CSV file\n        $users = $this-&gt;parseCSV($filePath);\n\n        // For each user, DRIVE the application\n        foreach ($users as $userData) {\n            $command = new ImportUsersCommand(\n                email: $userData['email'],\n                name: $userData['name']\n            );\n\n            $this-&gt;messageBus-&gt;dispatch($command);\n        }\n\n        $output-&gt;writeln('Users imported successfully');\n\n        return Command::SUCCESS;\n    }\n}\n</code></pre> <p>Key Points: - Initiates via CLI execution - Depends on Application (imports command) - Knows about Symfony Console, file I/O - Drives application by dispatching commands</p>"},{"location":"advanced/primary-secondary-adapters/#example-3-graphql-resolver-primary-adapter","title":"Example 3: GraphQL Resolver (Primary Adapter)","text":"<pre><code>namespace App\\Product\\Infrastructure\\GraphQL;\n\nuse App\\Product\\Application\\Query\\FindProductQuery;\nuse Overblog\\GraphQLBundle\\Annotation as GQL;\n\n#[GQL\\Type]\nfinal readonly class ProductResolver\n{\n    public function __construct(\n        private MessageBusInterface $queryBus,\n    ) {}\n\n    #[GQL\\Query(name: \"product\")]\n    public function getProduct(string $id): ProductGraphQLDTO\n    {\n        // DRIVE the application\n        $query = new FindProductQuery($id);\n        $product = $this-&gt;queryBus-&gt;dispatch($query);\n\n        // Transform domain \u2192 GraphQL DTO\n        return new ProductGraphQLDTO(\n            id: $product-&gt;getId(),\n            name: $product-&gt;getName(),\n            price: $product-&gt;getPrice()-&gt;toCents()\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/primary-secondary-adapters/#secondary-adapters-drivenright-side","title":"Secondary Adapters (Driven/Right Side)","text":""},{"location":"advanced/primary-secondary-adapters/#what-are-secondary-adapters","title":"What Are Secondary Adapters?","text":"<p>Secondary adapters are DRIVEN by the application. The application tells them what to do.</p> <p>Application \u2192 \"I need to save this\" \u2192 Secondary Adapter \u2192 Database</p>"},{"location":"advanced/primary-secondary-adapters/#characteristics_1","title":"Characteristics","text":"<ul> <li>Respond to requests from the application</li> <li>Implement domain ports (interfaces defined in domain)</li> <li>Convert domain \u2192 external system format</li> <li>Located on the RIGHT side of the hexagon (driven side)</li> <li>Examples: Repositories, email senders, message publishers, file storage</li> </ul>"},{"location":"advanced/primary-secondary-adapters/#responsibility-output-transformation","title":"Responsibility: Output Transformation","text":"<p>Secondary adapters transform domain format \u2192 external format.</p> <pre><code>Entity \u2192 Repository \u2192 Doctrine Mapping \u2192 SQL \u2192 Database\nEmail Object \u2192 EmailSender \u2192 SMTP Protocol \u2192 Email Server\nEvent \u2192 EventPublisher \u2192 JSON \u2192 Message Queue\n</code></pre>"},{"location":"advanced/primary-secondary-adapters/#example-1-doctrine-repository-secondary-adapter","title":"Example 1: Doctrine Repository (Secondary Adapter)","text":"<pre><code>namespace App\\User\\Infrastructure\\Persistence;\n\nuse App\\User\\Domain\\Model\\User;\nuse App\\User\\Domain\\Port\\UserRepositoryInterface; // Port (interface)\nuse App\\User\\Domain\\ValueObject\\UserId;\nuse Doctrine\\ORM\\EntityManagerInterface;\n\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    // DRIVEN by the application\n    public function save(User $user): void\n    {\n        // Transform: Domain Entity \u2192 Doctrine Persistence \u2192 SQL\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n    }\n\n    public function findById(UserId $id): ?User\n    {\n        // Transform: Database Row \u2192 Doctrine Hydration \u2192 Domain Entity\n        return $this-&gt;entityManager-&gt;find(User::class, $id-&gt;toString());\n    }\n\n    public function existsByEmail(string $email): bool\n    {\n        // Transform: Domain Query \u2192 SQL Query \u2192 Boolean Result\n        $qb = $this-&gt;entityManager-&gt;createQueryBuilder();\n        $qb-&gt;select('COUNT(u.id)')\n           -&gt;from(User::class, 'u')\n           -&gt;where('u.email = :email')\n           -&gt;setParameter('email', $email);\n\n        return (int) $qb-&gt;getQuery()-&gt;getSingleScalarResult() &gt; 0;\n    }\n}\n</code></pre> <p>Key Points: - Implements port interface defined in Domain - Driven by application (handler calls methods) - Knows about Doctrine, SQL, database - Does NOT initiate interactions\u2014waits to be called</p>"},{"location":"advanced/primary-secondary-adapters/#example-2-email-sender-secondary-adapter","title":"Example 2: Email Sender (Secondary Adapter)","text":"<pre><code>namespace App\\Notification\\Infrastructure\\Email;\n\nuse App\\Notification\\Domain\\Port\\EmailSenderInterface; // Port\nuse App\\Notification\\Domain\\ValueObject\\Email;\nuse Symfony\\Component\\Mailer\\MailerInterface;\nuse Symfony\\Component\\Mime\\Email as SymfonyEmail;\n\nfinal readonly class SymfonyEmailSender implements EmailSenderInterface\n{\n    public function __construct(\n        private MailerInterface $mailer,\n    ) {}\n\n    // DRIVEN by the application\n    public function send(Email $email): void\n    {\n        // Transform: Domain Email \u2192 Symfony Email \u2192 SMTP Protocol\n        $message = (new SymfonyEmail())\n            -&gt;from($email-&gt;from-&gt;value)\n            -&gt;to($email-&gt;to-&gt;value)\n            -&gt;subject($email-&gt;subject)\n            -&gt;html($email-&gt;body);\n\n        $this-&gt;mailer-&gt;send($message);\n    }\n}\n</code></pre> <p>Key Points: - Implements <code>EmailSenderInterface</code> (domain port) - Driven by handler calling <code>send()</code> - Knows about Symfony Mailer, SMTP - Transforms domain object \u2192 infrastructure format</p>"},{"location":"advanced/primary-secondary-adapters/#example-3-message-queue-publisher-secondary-adapter","title":"Example 3: Message Queue Publisher (Secondary Adapter)","text":"<pre><code>namespace App\\Order\\Infrastructure\\Messaging;\n\nuse App\\Order\\Domain\\Event\\OrderPlacedEvent;\nuse App\\Order\\Domain\\Port\\EventPublisherInterface; // Port\nuse Symfony\\Component\\Messenger\\MessageBusInterface;\n\nfinal readonly class SymfonyEventPublisher implements EventPublisherInterface\n{\n    public function __construct(\n        private MessageBusInterface $eventBus,\n    ) {}\n\n    // DRIVEN by the application\n    public function publish(OrderPlacedEvent $event): void\n    {\n        // Transform: Domain Event \u2192 Message Bus \u2192 RabbitMQ\n        $this-&gt;eventBus-&gt;dispatch($event);\n    }\n}\n</code></pre>"},{"location":"advanced/primary-secondary-adapters/#key-differences","title":"Key Differences","text":"Aspect Primary Adapter Secondary Adapter Direction Drives application Driven by application Initiates? Yes (user action, cron, event) No (called by application) Depends On Application layer Domain ports (interfaces) Implements Nothing (calls handlers) Port interfaces Location Left side (driving) Right side (driven) Examples Controller, CLI, GraphQL Repository, Email, Queue Input/Output Receives external input Produces external output Knows About Commands, Queries, Handlers Ports, Entities"},{"location":"advanced/primary-secondary-adapters/#dependency-direction","title":"Dependency Direction","text":""},{"location":"advanced/primary-secondary-adapters/#primary-adapter-dependencies","title":"Primary Adapter Dependencies","text":"<pre><code>Primary Adapter (Infrastructure)\n    \u2193 depends on\nApplication Layer (Commands, Handlers)\n    \u2193 depends on\nDomain Layer (Entities, Ports)\n</code></pre> <p>Example: <pre><code>// Controller (Primary Adapter) depends on Application\nuse App\\User\\Application\\Command\\RegisterUserCommand; // \u2705 OK\n\nclass RegisterUserController\n{\n    public function __invoke(Request $request): Response\n    {\n        $command = new RegisterUserCommand(...);\n        $this-&gt;messageBus-&gt;dispatch($command);\n    }\n}\n</code></pre></p>"},{"location":"advanced/primary-secondary-adapters/#secondary-adapter-dependencies","title":"Secondary Adapter Dependencies","text":"<pre><code>Domain Layer (Ports = Interfaces)\n    \u2191 implemented by\nSecondary Adapter (Infrastructure)\n</code></pre> <p>Example: <pre><code>// Repository (Secondary Adapter) implements Domain Port\nnamespace App\\User\\Infrastructure\\Persistence;\n\nuse App\\User\\Domain\\Port\\UserRepositoryInterface; // Domain interface\n\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    // Implementation details...\n}\n</code></pre></p> <p>Key Point: Domain defines interface, Infrastructure implements it (Dependency Inversion Principle).</p>"},{"location":"advanced/primary-secondary-adapters/#real-world-examples","title":"Real-World Examples","text":""},{"location":"advanced/primary-secondary-adapters/#example-e-commerce-order-system","title":"Example: E-Commerce Order System","text":"<pre><code>// PRIMARY ADAPTERS (Driving)\n\n// 1. REST API Controller\n#[Route('/api/orders', methods: ['POST'])]\nclass CreateOrderController // Drives application\n{\n    public function __invoke(Request $request): JsonResponse\n    {\n        $command = new CreateOrderCommand(...);\n        $this-&gt;messageBus-&gt;dispatch($command); // Drives\n        return new JsonResponse(['status' =&gt; 'created'], 201);\n    }\n}\n\n// 2. CLI Command\nclass ProcessPendingOrdersCommand extends Command\n{\n    protected function execute(...): int\n    {\n        $orders = $this-&gt;orders-&gt;findPending();\n        foreach ($orders as $order) {\n            $command = new ProcessOrderCommand($order-&gt;getId());\n            $this-&gt;messageBus-&gt;dispatch($command); // Drives\n        }\n        return Command::SUCCESS;\n    }\n}\n\n// 3. Event Listener (triggered by external event)\nclass PaymentReceivedListener // Drives application when payment event arrives\n{\n    public function __invoke(PaymentReceivedEvent $event): void\n    {\n        $command = new ConfirmOrderCommand($event-&gt;orderId);\n        $this-&gt;messageBus-&gt;dispatch($command); // Drives\n    }\n}\n</code></pre> <pre><code>// SECONDARY ADAPTERS (Driven)\n\n// 1. Order Repository (Database)\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    // Driven by handlers calling save(), findById(), etc.\n    public function save(Order $order): void { /* ... */ }\n}\n\n// 2. Payment Processor (External API)\nclass StripePaymentProcessor implements PaymentProcessorInterface\n{\n    // Driven by handlers calling charge(), refund(), etc.\n    public function charge(PaymentRequest $request): PaymentResult { /* ... */ }\n}\n\n// 3. Email Sender (Email Service)\nclass SendGridEmailSender implements EmailSenderInterface\n{\n    // Driven by handlers calling send()\n    public function send(Email $email): void { /* ... */ }\n}\n\n// 4. Inventory Service (External Microservice)\nclass HttpInventoryService implements InventoryServiceInterface\n{\n    // Driven by handlers calling reserveStock()\n    public function reserveStock(ProductId $id, int $quantity): void { /* ... */ }\n}\n</code></pre>"},{"location":"advanced/primary-secondary-adapters/#testing-strategy","title":"Testing Strategy","text":""},{"location":"advanced/primary-secondary-adapters/#testing-primary-adapters","title":"Testing Primary Adapters","text":"<p>Focus: Test input transformation and command/query dispatch.</p> <pre><code>class RegisterUserControllerTest extends WebTestCase\n{\n    public function test_registers_user_via_api(): void\n    {\n        $client = static::createClient();\n\n        // Test HTTP \u2192 Command transformation\n        $client-&gt;request('POST', '/api/users', [], [], [\n            'CONTENT_TYPE' =&gt; 'application/json',\n        ], json_encode([\n            'email' =&gt; 'user@example.com',\n            'password' =&gt; 'secret123',\n        ]));\n\n        $this-&gt;assertResponseStatusCodeSame(201);\n\n        // Verify command was dispatched correctly\n        // (use test message bus or check side effects)\n    }\n}\n</code></pre>"},{"location":"advanced/primary-secondary-adapters/#testing-secondary-adapters","title":"Testing Secondary Adapters","text":"<p>Focus: Test port implementation correctness.</p> <pre><code>class DoctrineUserRepositoryTest extends KernelTestCase\n{\n    public function test_saves_and_retrieves_user(): void\n    {\n        $repository = $this-&gt;getContainer()-&gt;get(UserRepositoryInterface::class);\n\n        $user = new User(\n            UserId::generate(),\n            new Email('test@example.com'),\n            HashedPassword::fromPlaintext('password')\n        );\n\n        // Test port implementation\n        $repository-&gt;save($user);\n\n        $retrieved = $repository-&gt;findById($user-&gt;getId());\n\n        $this-&gt;assertEquals($user-&gt;getId(), $retrieved-&gt;getId());\n        $this-&gt;assertEquals($user-&gt;getEmail(), $retrieved-&gt;getEmail());\n    }\n}\n</code></pre>"},{"location":"advanced/primary-secondary-adapters/#testing-without-adapters-pure-domain","title":"Testing Without Adapters (Pure Domain)","text":"<p>Use in-memory fakes for secondary adapters:</p> <pre><code>class RegisterUserHandlerTest extends TestCase\n{\n    public function test_registers_user(): void\n    {\n        // Fake secondary adapter (in-memory)\n        $users = new InMemoryUserRepository();\n\n        $handler = new RegisterUserHandler($users);\n\n        $command = new RegisterUserCommand('user@example.com', 'password123');\n        $handler($command);\n\n        // Verify via in-memory repository\n        $this-&gt;assertTrue($users-&gt;existsByEmail('user@example.com'));\n    }\n}\n</code></pre>"},{"location":"advanced/primary-secondary-adapters/#common-patterns","title":"Common Patterns","text":""},{"location":"advanced/primary-secondary-adapters/#pattern-1-multiple-primary-adapters-same-use-case","title":"Pattern 1: Multiple Primary Adapters, Same Use Case","text":"<pre><code>REST API Controller  \u2500\u2500\u2500\u2500\u2510\nCLI Command          \u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2192 CreateOrderCommand \u2192 Handler\nGraphQL Resolver     \u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>All three primary adapters drive the same application logic.</p>"},{"location":"advanced/primary-secondary-adapters/#pattern-2-one-secondary-adapter-multiple-implementations","title":"Pattern 2: One Secondary Adapter, Multiple Implementations","text":"<pre><code>Handler uses UserRepositoryInterface (Port)\n                    \u2191\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502               \u2502               \u2502\nInMemory      Doctrine        DynamoDB\n(Test)        (Production)    (AWS)\n</code></pre> <p>Multiple secondary adapters implement the same port for different contexts.</p>"},{"location":"advanced/primary-secondary-adapters/#pattern-3-adapter-composition","title":"Pattern 3: Adapter Composition","text":"<pre><code>// Secondary adapter wrapping another adapter\nfinal readonly class CachedUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private UserRepositoryInterface $decorated, // Another secondary adapter\n        private CacheInterface $cache,\n    ) {}\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;cache-&gt;get(\n            \"user:{$id}\",\n            fn() =&gt; $this-&gt;decorated-&gt;findById($id) // Delegate to real adapter\n        );\n    }\n}\n</code></pre> <p>Decorator pattern: one secondary adapter wraps another.</p>"},{"location":"advanced/primary-secondary-adapters/#visual-summary","title":"Visual Summary","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'13px'}}}%%\ngraph TB\n    subgraph Primary[\"PRIMARY ADAPTERS (Initiate)\"]\n        REST[REST Controller]\n        CLI[CLI Command]\n        GQL[GraphQL]\n    end\n\n    subgraph App[\"APPLICATION\"]\n        Handler[Handler]\n    end\n\n    subgraph Domain[\"DOMAIN\"]\n        Port[Port Interface]\n    end\n\n    subgraph Secondary[\"SECONDARY ADAPTERS (Respond)\"]\n        Repo[Repository]\n        Email[Email Sender]\n    end\n\n    REST --&gt;|\"calls\"| Handler\n    CLI --&gt;|\"calls\"| Handler\n    GQL --&gt;|\"calls\"| Handler\n\n    Handler --&gt;|\"uses\"| Port\n\n    Repo -.-&gt;|\"implements\"| Port\n    Email -.-&gt;|\"implements\"| Port\n\n    style Primary fill:#BBDEFB,stroke:#1976D2,stroke-width:2px\n    style App fill:#C8E6C9,stroke:#388E3C,stroke-width:2px\n    style Domain fill:#FFF9C4,stroke:#F57F17,stroke-width:2px\n    style Secondary fill:#FFCCBC,stroke:#E64A19,stroke-width:2px</code></pre>"},{"location":"advanced/primary-secondary-adapters/#key-takeaways","title":"Key Takeaways","text":"<ol> <li>Primary = Driving (Controllers, CLI) \u2192 Initiate interactions</li> <li>Secondary = Driven (Repositories, Email) \u2192 Respond to application</li> <li>Primary depends ON application (knows about commands/handlers)</li> <li>Secondary implements domain ports (interfaces defined by domain)</li> <li>Dependency Inversion: Domain defines interfaces, infrastructure implements</li> <li>Testing: Primary = functional tests, Secondary = integration tests, Domain = unit tests</li> </ol> <p>Next: CQRS: Cost-Benefit Analysis \u2192</p>"},{"location":"advanced/repository-pattern/","title":"Le Pattern Repository en Architecture Hexagonale","text":"<p>Ce guide explique comment impl\u00e9menter correctement le pattern Repository dans une architecture hexagonale, et pourquoi il ne faut pas utiliser directement l'EntityManager.</p>"},{"location":"advanced/repository-pattern/#table-des-matieres","title":"Table des mati\u00e8res","text":"<p>{: .no_toc .text-delta }</p> <ol> <li>TOC</li> </ol>"},{"location":"advanced/repository-pattern/#quest-ce-que-le-pattern-repository","title":"Qu'est-ce que le Pattern Repository ?","text":"<p>Un Repository se comporte comme une collection d'objets du domaine. Il agit comme un interm\u00e9diaire entre la couche domaine et la couche de persistance.</p>"},{"location":"advanced/repository-pattern/#caracteristiques-principales","title":"Caract\u00e9ristiques principales","text":"<ol> <li>Collection typ\u00e9e : Un <code>GalinetteRepository</code> ne contient que des objets <code>Galinette</code></li> <li>Unicit\u00e9 : Impossible d'ajouter deux fois le m\u00eame objet (identit\u00e9 unique)</li> <li>Abstraction de la persistance : Le d\u00e9veloppeur manipule une collection, le repository g\u00e8re la persistance</li> <li>Contrat dans le domaine : L'interface est d\u00e9finie dans le domaine, l'impl\u00e9mentation dans l'infrastructure</li> </ol>"},{"location":"advanced/repository-pattern/#pourquoi-ne-pas-utiliser-directement-lentitymanager","title":"Pourquoi NE PAS utiliser directement l'EntityManager ?","text":""},{"location":"advanced/repository-pattern/#mauvaise-pratique-problemes-avec-lentitymanager-direct","title":"MAUVAISE PRATIQUE: Probl\u00e8mes avec l'EntityManager direct","text":"<pre><code>// \u274c MAUVAISE PRATIQUE\nclass CreateUserHandler\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    public function __invoke(CreateUserCommand $command): void\n    {\n        $user = new User($command-&gt;email, $command-&gt;name);\n\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n    }\n}\n</code></pre> <p>Probl\u00e8mes :</p> <ol> <li>Couplage fort \u00e0 Doctrine : Votre domaine d\u00e9pend de Doctrine</li> <li>Difficile \u00e0 tester : Vous devez mocker l'EntityManager</li> <li>Violation du principe d'inversion de d\u00e9pendance : Le domaine d\u00e9pend de l'infrastructure</li> <li>Pas de point central de persistance : La logique de persistance est \u00e9parpill\u00e9e</li> <li>Migration difficile : Changer de solution de persistance = refactoring massif</li> </ol>"},{"location":"advanced/repository-pattern/#bonne-pratique-avantages-du-repository","title":"BONNE PRATIQUE: Avantages du Repository","text":"<pre><code>// \u2705 BONNE PRATIQUE\nclass CreateUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $userRepository\n    ) {}\n\n    public function __invoke(CreateUserCommand $command): void\n    {\n        $userId = $this-&gt;userRepository-&gt;nextIdentity();\n        $user = User::create($userId, $command-&gt;email, $command-&gt;name);\n\n        $this-&gt;userRepository-&gt;add($user);\n    }\n}\n</code></pre> <p>Avantages :</p> <ol> <li>Ind\u00e9pendance technologique : Le domaine ne conna\u00eet pas Doctrine</li> <li>Testabilit\u00e9 : Facile de cr\u00e9er un <code>InMemoryUserRepository</code> pour les tests</li> <li>Principe d'inversion de d\u00e9pendance : L'infrastructure d\u00e9pend du domaine</li> <li>Point central de persistance : Toute la logique est dans le repository</li> <li>Migration facilit\u00e9e : Changer l'impl\u00e9mentation sans toucher au domaine</li> </ol>"},{"location":"advanced/repository-pattern/#anatomie-dun-repository","title":"Anatomie d'un Repository","text":""},{"location":"advanced/repository-pattern/#api-generique-dun-repository","title":"API g\u00e9n\u00e9rique d'un Repository","text":"<pre><code>interface RepositoryInterface\n{\n    /**\n     * G\u00e9n\u00e8re la prochaine identit\u00e9 disponible\n     */\n    public function nextIdentity(): EntityId;\n\n    /**\n     * Ajoute une entit\u00e9 \u00e0 la collection\n     */\n    public function add(Entity $entity): void;\n\n    /**\n     * R\u00e9cup\u00e8re une entit\u00e9 par son identit\u00e9\n     * @throws EntityNotFoundException\n     */\n    public function get(EntityId $id): Entity;\n\n    /**\n     * Supprime une entit\u00e9 (optionnel selon le m\u00e9tier)\n     */\n    public function remove(EntityId $id): void;\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#exemple-concret-galinetterepository","title":"Exemple concret : GalinetteRepository","text":""},{"location":"advanced/repository-pattern/#interface-domaine","title":"Interface (Domaine)","text":"<pre><code>&lt;?php\n// src/Hunting/Galinette/Domain/Repository/GalinetteRepositoryInterface.php\n\nnamespace App\\Hunting\\Galinette\\Domain\\Repository;\n\nuse App\\Hunting\\Galinette\\Domain\\Model\\Galinette;\nuse App\\Hunting\\Galinette\\Domain\\ValueObject\\GalinetteId;\nuse App\\Hunting\\Galinette\\Domain\\Exception\\GalinetteNotFoundException;\n\ninterface GalinetteRepositoryInterface\n{\n    /**\n     * G\u00e9n\u00e8re un nouvel identifiant unique pour une Galinette\n     */\n    public function nextIdentity(): GalinetteId;\n\n    /**\n     * Ajoute une Galinette \u00e0 la collection\n     *\n     * @throws PersistenceException Si la persistance \u00e9choue\n     */\n    public function add(Galinette $galinette): void;\n\n    /**\n     * R\u00e9cup\u00e8re une Galinette par son identit\u00e9\n     *\n     * @throws GalinetteNotFoundException Si la Galinette n'existe pas\n     * @throws PersistenceException Si la r\u00e9cup\u00e9ration \u00e9choue\n     */\n    public function get(GalinetteId $id): Galinette;\n\n    /**\n     * Note : remove() n'est pas n\u00e9cessaire car une Galinette\n     * ne se supprime pas, elle va au paradis (goToHeaven())\n     */\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#implementation-infrastructure","title":"Impl\u00e9mentation (Infrastructure)","text":"<pre><code>&lt;?php\n// src/Hunting/Galinette/Infrastructure/Persistence/Doctrine/DoctrineGalinetteRepository.php\n\nnamespace App\\Hunting\\Galinette\\Infrastructure\\Persistence\\Doctrine;\n\nuse App\\Hunting\\Galinette\\Domain\\Model\\Galinette;\nuse App\\Hunting\\Galinette\\Domain\\Repository\\GalinetteRepositoryInterface;\nuse App\\Hunting\\Galinette\\Domain\\ValueObject\\GalinetteId;\nuse App\\Hunting\\Galinette\\Domain\\Exception\\GalinetteNotFoundException;\nuse App\\Hunting\\Galinette\\Domain\\Exception\\PersistenceException;\nuse Doctrine\\ORM\\EntityManagerInterface;\nuse Ramsey\\Uuid\\Uuid;\n\nfinal class DoctrineGalinetteRepository implements GalinetteRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    public function nextIdentity(): GalinetteId\n    {\n        try {\n            return GalinetteId::fromString(Uuid::uuid4()-&gt;toString());\n        } catch (\\Exception $e) {\n            throw new PersistenceException(\n                'Failed to generate identity',\n                0,\n                $e\n            );\n        }\n    }\n\n    public function add(Galinette $galinette): void\n    {\n        try {\n            $this-&gt;entityManager-&gt;persist($galinette);\n            $this-&gt;entityManager-&gt;flush();\n        } catch (\\Exception $e) {\n            throw new PersistenceException(\n                sprintf('Failed to persist Galinette with id %s', $galinette-&gt;getId()),\n                0,\n                $e\n            );\n        }\n    }\n\n    public function get(GalinetteId $id): Galinette\n    {\n        try {\n            $galinette = $this-&gt;entityManager-&gt;find(\n                Galinette::class,\n                $id-&gt;toString()\n            );\n\n            if (null === $galinette) {\n                throw new GalinetteNotFoundException(\n                    sprintf('Galinette with id %s not found', $id-&gt;toString())\n                );\n            }\n\n            return $galinette;\n        } catch (GalinetteNotFoundException $e) {\n            throw $e;\n        } catch (\\Exception $e) {\n            throw new PersistenceException(\n                sprintf('Failed to retrieve Galinette with id %s', $id-&gt;toString()),\n                0,\n                $e\n            );\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#convertir-un-repository-symfony-classique","title":"Convertir un Repository Symfony classique","text":""},{"location":"advanced/repository-pattern/#mauvaise-pratique-avant-repository-symfony-classique-mauvaise-pratique","title":"MAUVAISE PRATIQUE: Avant : Repository Symfony classique (Mauvaise pratique)","text":"<pre><code>&lt;?php\n// src/Repository/UserRepository.php\n\nnamespace App\\Repository;\n\nuse App\\Entity\\User;\nuse Doctrine\\Bundle\\DoctrineBundle\\Repository\\ServiceEntityRepository;\nuse Doctrine\\Persistence\\ManagerRegistry;\n\nclass UserRepository extends ServiceEntityRepository\n{\n    public function __construct(ManagerRegistry $registry)\n    {\n        parent::__construct($registry, User::class);\n    }\n\n    // \u274c Retourne des tableaux\n    public function findActiveUsers(): array\n    {\n        return $this-&gt;createQueryBuilder('u')\n            -&gt;where('u.active = :active')\n            -&gt;setParameter('active', true)\n            -&gt;getQuery()\n            -&gt;getResult();\n    }\n\n    // \u274c Retourne des scalaires\n    public function countActiveUsers(): int\n    {\n        return $this-&gt;createQueryBuilder('u')\n            -&gt;select('COUNT(u.id)')\n            -&gt;where('u.active = :active')\n            -&gt;setParameter('active', true)\n            -&gt;getQuery()\n            -&gt;getSingleScalarResult();\n    }\n\n    // \u274c Retourne un QueryBuilder\n    public function getActiveUsersQueryBuilder(): QueryBuilder\n    {\n        return $this-&gt;createQueryBuilder('u')\n            -&gt;where('u.active = :active')\n            -&gt;setParameter('active', true);\n    }\n\n    // \u274c M\u00e9thode qui expose le d\u00e9tail de la persistance\n    public function save(User $user, bool $flush = false): void\n    {\n        $this-&gt;getEntityManager()-&gt;persist($user);\n\n        if ($flush) {\n            $this-&gt;getEntityManager()-&gt;flush();\n        }\n    }\n}\n</code></pre> <p>Probl\u00e8mes : - M\u00e9lange lecture et \u00e9criture - Retourne diff\u00e9rents types (objets, tableaux, scalaires, QueryBuilder) - Ne respecte pas le contrat d'un vrai Repository - Devient un \"God Object\" avec des dizaines de m\u00e9thodes - Couple le domaine \u00e0 Doctrine</p>"},{"location":"advanced/repository-pattern/#bonne-pratique-apres-architecture-hexagonale-bonne-pratique","title":"BONNE PRATIQUE: Apr\u00e8s : Architecture hexagonale (Bonne pratique)","text":""},{"location":"advanced/repository-pattern/#1-interface-du-repository-domaine","title":"1. Interface du Repository (Domaine)","text":"<pre><code>&lt;?php\n// src/User/Domain/Repository/UserRepositoryInterface.php\n\nnamespace App\\User\\Domain\\Repository;\n\nuse App\\User\\Domain\\Model\\User;\nuse App\\User\\Domain\\ValueObject\\UserId;\nuse App\\User\\Domain\\Exception\\UserNotFoundException;\n\ninterface UserRepositoryInterface\n{\n    public function nextIdentity(): UserId;\n\n    public function add(User $user): void;\n\n    /**\n     * @throws UserNotFoundException\n     */\n    public function get(UserId $id): User;\n\n    /**\n     * @throws UserNotFoundException\n     */\n    public function getByEmail(string $email): User;\n\n    /**\n     * Finder additionnel : retourne uniquement des objets User\n     * @return User[]\n     */\n    public function findActive(): array;\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#2-implementation-doctrine-infrastructure","title":"2. Impl\u00e9mentation Doctrine (Infrastructure)","text":"<pre><code>&lt;?php\n// src/User/Infrastructure/Persistence/Doctrine/DoctrineUserRepository.php\n\nnamespace App\\User\\Infrastructure\\Persistence\\Doctrine;\n\nuse App\\User\\Domain\\Model\\User;\nuse App\\User\\Domain\\Repository\\UserRepositoryInterface;\nuse App\\User\\Domain\\ValueObject\\UserId;\nuse App\\User\\Domain\\Exception\\UserNotFoundException;\nuse App\\User\\Domain\\Exception\\PersistenceException;\nuse Doctrine\\ORM\\EntityManagerInterface;\nuse Ramsey\\Uuid\\Uuid;\n\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    public function nextIdentity(): UserId\n    {\n        try {\n            return UserId::fromString(Uuid::uuid4()-&gt;toString());\n        } catch (\\Exception $e) {\n            throw new PersistenceException('Failed to generate identity', 0, $e);\n        }\n    }\n\n    public function add(User $user): void\n    {\n        try {\n            $this-&gt;entityManager-&gt;persist($user);\n            $this-&gt;entityManager-&gt;flush();\n        } catch (\\Exception $e) {\n            throw new PersistenceException('Failed to persist User', 0, $e);\n        }\n    }\n\n    public function get(UserId $id): User\n    {\n        try {\n            $user = $this-&gt;entityManager-&gt;find(User::class, $id-&gt;toString());\n\n            if (null === $user) {\n                throw new UserNotFoundException(\n                    sprintf('User with id %s not found', $id-&gt;toString())\n                );\n            }\n\n            return $user;\n        } catch (UserNotFoundException $e) {\n            throw $e;\n        } catch (\\Exception $e) {\n            throw new PersistenceException('Failed to retrieve User', 0, $e);\n        }\n    }\n\n    public function getByEmail(string $email): User\n    {\n        try {\n            $dql = 'SELECT u FROM ' . User::class . ' u WHERE u.email = :email';\n            $user = $this-&gt;entityManager\n                -&gt;createQuery($dql)\n                -&gt;setParameter('email', $email)\n                -&gt;getOneOrNullResult();\n\n            if (null === $user) {\n                throw new UserNotFoundException(\n                    sprintf('User with email %s not found', $email)\n                );\n            }\n\n            return $user;\n        } catch (UserNotFoundException $e) {\n            throw $e;\n        } catch (\\Exception $e) {\n            throw new PersistenceException('Failed to retrieve User by email', 0, $e);\n        }\n    }\n\n    /**\n     * Finder additionnel : retourne UNIQUEMENT des objets User\n     */\n    public function findActive(): array\n    {\n        try {\n            $dql = 'SELECT u FROM ' . User::class . ' u WHERE u.active = :active';\n            return $this-&gt;entityManager\n                -&gt;createQuery($dql)\n                -&gt;setParameter('active', true)\n                -&gt;getResult();\n        } catch (\\Exception $e) {\n            throw new PersistenceException('Failed to find active users', 0, $e);\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#3-query-functions-pour-la-lecture-infrastructure","title":"3. Query Functions pour la lecture (Infrastructure)","text":"<pre><code>&lt;?php\n// src/User/Infrastructure/Query/GetActiveUsersQuery.php\n\nnamespace App\\User\\Infrastructure\\Query;\n\nuse Doctrine\\DBAL\\Connection;\n\n/**\n * Query function pour la lecture/reporting\n * Ne fait PAS partie du Repository\n */\nfinal class GetActiveUsersQuery\n{\n    public function __construct(\n        private Connection $connection\n    ) {}\n\n    /**\n     * @return ActiveUserDTO[]\n     */\n    public function __invoke(): array\n    {\n        $sql = &lt;&lt;&lt;SQL\n            SELECT\n                u.id,\n                u.email,\n                u.name,\n                u.created_at,\n                COUNT(o.id) as order_count\n            FROM user u\n            LEFT JOIN `order` o ON o.user_id = u.id\n            WHERE u.active = 1\n            GROUP BY u.id\n            ORDER BY u.created_at DESC\n        SQL;\n\n        $rows = $this-&gt;connection-&gt;fetchAllAssociative($sql);\n\n        return array_map(\n            fn(array $row) =&gt; new ActiveUserDTO(\n                $row['id'],\n                $row['email'],\n                $row['name'],\n                new \\DateTimeImmutable($row['created_at']),\n                (int) $row['order_count']\n            ),\n            $rows\n        );\n    }\n}\n</code></pre> <pre><code>&lt;?php\n// src/User/Infrastructure/Query/ActiveUserDTO.php\n\nnamespace App\\User\\Infrastructure\\Query;\n\n/**\n * DTO pour la lecture\n * Facilement normalisable pour API REST ou templates Twig\n */\nfinal readonly class ActiveUserDTO\n{\n    public function __construct(\n        public string $id,\n        public string $email,\n        public string $name,\n        public \\DateTimeImmutable $createdAt,\n        public int $orderCount\n    ) {}\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#4-utilisation-dans-un-use-case","title":"4. Utilisation dans un Use Case","text":"<pre><code>&lt;?php\n// src/User/Application/Command/CreateUserHandler.php\n\nnamespace App\\User\\Application\\Command;\n\nuse App\\User\\Domain\\Model\\User;\nuse App\\User\\Domain\\Repository\\UserRepositoryInterface;\n\nfinal class CreateUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $userRepository\n    ) {}\n\n    public function __invoke(CreateUserCommand $command): void\n    {\n        // G\u00e9n\u00e9ration de l'identit\u00e9 (pas de d\u00e9pendance \u00e0 l'auto-increment MySQL)\n        $userId = $this-&gt;userRepository-&gt;nextIdentity();\n\n        // Cr\u00e9ation de l'objet du domaine\n        $user = User::create($userId, $command-&gt;email, $command-&gt;name);\n\n        // Persistance (abstraction compl\u00e8te)\n        $this-&gt;userRepository-&gt;add($user);\n    }\n}\n</code></pre> <pre><code>&lt;?php\n// src/User/Presentation/Controller/ListActiveUsersController.php\n\nnamespace App\\User\\Presentation\\Controller;\n\nuse App\\User\\Infrastructure\\Query\\GetActiveUsersQuery;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\n\nfinal class ListActiveUsersController\n{\n    public function __construct(\n        private GetActiveUsersQuery $getActiveUsersQuery\n    ) {}\n\n    public function __invoke(): JsonResponse\n    {\n        // Pour la lecture, on utilise une Query Function\n        $activeUsers = ($this-&gt;getActiveUsersQuery)();\n\n        return new JsonResponse($activeUsers);\n    }\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#comparaison-des-methodes-converties","title":"Comparaison des m\u00e9thodes converties","text":"M\u00e9thode Symfony classique Solution Hexagonale Raison <code>findActiveUsers()</code> retourne array <code>findActive(): array</code> dans Repository + <code>GetActiveUsersQuery</code> S\u00e9paration lecture/\u00e9criture (CQRS) <code>countActiveUsers()</code> retourne int <code>CountActiveUsersQuery</code> uniquement Les repositories ne retournent que des objets du domaine <code>getActiveUsersQueryBuilder()</code> <code>GetActiveUsersQuery</code> avec SQL pur Pas de QueryBuilder expos\u00e9, exploitation compl\u00e8te de SQL <code>save(User $user, bool $flush)</code> <code>add(User $user): void</code> API simple et pr\u00e9visible, toujours flush imm\u00e9diatement"},{"location":"advanced/repository-pattern/#regles-dor-du-repository","title":"R\u00e8gles d'or du Repository","text":""},{"location":"advanced/repository-pattern/#bonne-pratique-do-a-faire","title":"BONNE PRATIQUE: DO (\u00c0 faire)","text":"<ol> <li>D\u00e9finir l'interface dans le domaine</li> <li>Impl\u00e9menter dans l'infrastructure</li> <li>Retourner UNIQUEMENT des objets du domaine</li> <li>Cacher les exceptions tierces (traduire en exceptions du domaine)</li> <li>G\u00e9n\u00e9rer les identit\u00e9s (m\u00e9thode <code>nextIdentity()</code>)</li> <li>Flusher dans le repository (transaction atomique par agr\u00e9gat)</li> <li>Cr\u00e9er des Query Functions s\u00e9par\u00e9es pour la lecture complexe</li> </ol>"},{"location":"advanced/repository-pattern/#mauvaise-pratique-dont-a-eviter","title":"MAUVAISE PRATIQUE: DON'T (\u00c0 \u00e9viter)","text":"<ol> <li>\u274c Retourner des tableaux de scalaires</li> <li>\u274c Retourner des QueryBuilder</li> <li>\u274c Exposer l'EntityManager</li> <li>\u274c M\u00e9langer lecture et \u00e9criture complexe</li> <li>\u274c Cr\u00e9er des dizaines de m\u00e9thodes <code>findBy*</code></li> <li>\u274c D\u00e9pendre directement de Doctrine dans le domaine</li> <li>\u274c Utiliser les annotations Doctrine sur les entit\u00e9s du domaine</li> </ol>"},{"location":"advanced/repository-pattern/#le-pattern-collection-typed-collections","title":"Le Pattern Collection : Typed Collections","text":""},{"location":"advanced/repository-pattern/#pourquoi-utiliser-des-collections-typees","title":"Pourquoi utiliser des Collections typ\u00e9es ?","text":"<p>Dans une architecture hexagonale, les Collections typ\u00e9es renforcent le type safety et l'encapsulation du domaine. Au lieu de retourner des <code>array</code>, on retourne des objets Collection qui garantissent le type et offrent des m\u00e9thodes m\u00e9tier.</p>"},{"location":"advanced/repository-pattern/#mauvaise-pratique-probleme-avec-les-arrays-bruts","title":"MAUVAISE PRATIQUE: Probl\u00e8me avec les arrays bruts","text":"<pre><code>interface UserRepositoryInterface\n{\n    /**\n     * @return User[]  // Documentation seulement, aucune garantie !\n     */\n    public function findActive(): array;\n}\n\n// Utilisation\n$users = $userRepository-&gt;findActive();\n$users[] = new Product(); // \u274c Rien n'emp\u00eache \u00e7a !\n// L'IDE ne peut pas autocomplete les m\u00e9thodes de User\nforeach ($users as $user) {\n    $user-&gt;  // \u2753 Aucune autocompl\u00e9tion\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#bonne-pratique-solution-avec-collections-typees","title":"BONNE PRATIQUE: Solution avec Collections typ\u00e9es","text":"<pre><code>interface UserRepositoryInterface\n{\n    public function findActive(): UserCollection; // \u2705 Type garanti !\n}\n\n// Utilisation\n$users = $userRepository-&gt;findActive();\n$users[] = new Product(); // \u274c TypeError ou InvalidArgumentException !\n// L'IDE sait que $user est un User\nforeach ($users as $user) {\n    $user-&gt;  // \u2705 Autocompl\u00e9tion parfaite\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#note-importante-important-collections-et-architecture-hexagonale","title":"Note importante: Important : Collections et Architecture Hexagonale","text":"<p>Dans une architecture hexagonale stricte, le Domain ne doit JAMAIS d\u00e9pendre de packages externes (sauf PHP natif).</p>"},{"location":"advanced/repository-pattern/#mauvaise-pratique-a-eviter-utiliser-arraycollection-directement-dans-le-domain","title":"MAUVAISE PRATIQUE: \u00c0 \u00c9VITER : Utiliser ArrayCollection directement dans le Domain","text":"<pre><code>&lt;?php\n// src/User/Domain/Repository/UserRepositoryInterface.php\n\nnamespace App\\User\\Domain\\Repository;\n\nuse Doctrine\\Common\\Collections\\ArrayCollection; // \u274c PROBL\u00c8ME !\n\ninterface UserRepositoryInterface\n{\n    /**\n     * \u274c Le Domain d\u00e9pend de doctrine/collections (infrastructure)\n     * \u274c Viole le principe d'ind\u00e9pendance du domaine\n     * \u274c Si vous supprimez Doctrine, votre domaine est cass\u00e9\n     */\n    public function findActive(): ArrayCollection;\n}\n</code></pre> <p>Probl\u00e8mes : - Le Domain d\u00e9pend d'un package d'infrastructure (<code>doctrine/collections</code>) - Viole le principe d'inversion de d\u00e9pendances (DIP) - Rend le domaine difficile \u00e0 tester ind\u00e9pendamment - Emp\u00eache la migration vers une autre solution de persistance</p>"},{"location":"advanced/repository-pattern/#bonne-pratique-bonne-pratique-1-collection-domain-pure-recommande-pour-lhexagonal-strict","title":"BONNE PRATIQUE: Bonne pratique 1 : Collection Domain pure (Recommand\u00e9 pour l'hexagonal strict)","text":"<p>Cr\u00e9ez votre propre classe Collection dans le Domain, sans aucune d\u00e9pendance externe.</p> <p>\u00c9tape 1 : Cr\u00e9er AbstractCollection r\u00e9utilisable dans Shared/Domain</p> <pre><code>&lt;?php\n// src/Shared/Domain/Collection/AbstractCollection.php\n\nnamespace App\\Shared\\Domain\\Collection;\n\n/**\n * Collection abstraite r\u00e9utilisable\n * \u2705 Pur PHP, aucune d\u00e9pendance externe\n * \u2705 Impl\u00e9mente Iterator, Countable, ArrayAccess\n * \u2705 \u00c0 \u00e9tendre pour chaque type d'entit\u00e9\n *\n * @template T\n */\nabstract class AbstractCollection implements \\Iterator, \\Countable, \\ArrayAccess\n{\n    /** @var T[] */\n    protected array $items = [];\n    protected int $position = 0;\n\n    /**\n     * @param T[] $items\n     */\n    public function __construct(array $items = [])\n    {\n        foreach ($items as $item) {\n            $this-&gt;validateType($item);\n        }\n        $this-&gt;items = array_values($items);\n    }\n\n    /**\n     * Validation de type (impl\u00e9ment\u00e9 par les classes enfants)\n     */\n    abstract protected function validateType(mixed $item): void;\n\n    // ========================================\n    // Iterator - Permet foreach()\n    // ========================================\n\n    public function current(): mixed\n    {\n        return $this-&gt;items[$this-&gt;position];\n    }\n\n    public function key(): int\n    {\n        return $this-&gt;position;\n    }\n\n    public function next(): void\n    {\n        ++$this-&gt;position;\n    }\n\n    public function rewind(): void\n    {\n        $this-&gt;position = 0;\n    }\n\n    public function valid(): bool\n    {\n        return isset($this-&gt;items[$this-&gt;position]);\n    }\n\n    // ========================================\n    // Countable - Permet count()\n    // ========================================\n\n    public function count(): int\n    {\n        return count($this-&gt;items);\n    }\n\n    // ========================================\n    // ArrayAccess - Permet $collection[0]\n    // ========================================\n\n    public function offsetExists(mixed $offset): bool\n    {\n        return isset($this-&gt;items[$offset]);\n    }\n\n    public function offsetGet(mixed $offset): mixed\n    {\n        return $this-&gt;items[$offset];\n    }\n\n    public function offsetSet(mixed $offset, mixed $value): void\n    {\n        $this-&gt;validateType($value);\n\n        if (null === $offset) {\n            $this-&gt;items[] = $value;\n        } else {\n            $this-&gt;items[$offset] = $value;\n        }\n    }\n\n    public function offsetUnset(mixed $offset): void\n    {\n        unset($this-&gt;items[$offset]);\n        $this-&gt;items = array_values($this-&gt;items);\n    }\n\n    // ========================================\n    // M\u00e9thodes utilitaires\n    // ========================================\n\n    public function filter(callable $callback): static\n    {\n        return new static(array_filter($this-&gt;items, $callback, ARRAY_FILTER_USE_BOTH));\n    }\n\n    public function map(callable $callback): array\n    {\n        return array_map($callback, $this-&gt;items);\n    }\n\n    public function toArray(): array\n    {\n        return $this-&gt;items;\n    }\n\n    public function first(): mixed\n    {\n        return $this-&gt;items[0] ?? null;\n    }\n\n    public function last(): mixed\n    {\n        return $this-&gt;items[array_key_last($this-&gt;items)] ?? null;\n    }\n\n    public function isEmpty(): bool\n    {\n        return empty($this-&gt;items);\n    }\n}\n</code></pre> <p>\u00c9tape 2 : \u00c9tendre pour votre entit\u00e9 sp\u00e9cifique</p> <pre><code>&lt;?php\n// src/User/Domain/Collection/UserCollection.php\n\nnamespace App\\User\\Domain\\Collection;\n\nuse App\\User\\Domain\\Model\\User;\nuse App\\Shared\\Domain\\Collection\\AbstractCollection;\n\n/**\n * Collection typ\u00e9e d'utilisateurs\n * \u2705 Pur PHP, aucune d\u00e9pendance externe\n * \u2705 Fait partie du Domain\n *\n * @extends AbstractCollection&lt;User&gt;\n */\nfinal class UserCollection extends AbstractCollection\n{\n    /**\n     * Validation du type : accepte uniquement des User\n     */\n    protected function validateType(mixed $item): void\n    {\n        if (!$item instanceof User) {\n            throw new \\InvalidArgumentException(\n                sprintf('UserCollection accepts only %s, %s given',\n                    User::class,\n                    get_debug_type($item)\n                )\n            );\n        }\n    }\n\n    // ========================================\n    // M\u00e9thodes m\u00e9tier du domaine\n    // ========================================\n\n    /**\n     * Filtrer les utilisateurs actifs\n     */\n    public function getActive(): self\n    {\n        return $this-&gt;filter(fn(int $key, User $user) =&gt; $user-&gt;isActive());\n    }\n\n    /**\n     * Rechercher un utilisateur par email\n     */\n    public function findByEmail(string $email): ?User\n    {\n        foreach ($this-&gt;items as $user) {\n            if ($user-&gt;getEmail() === $email) {\n                return $user;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Obtenir tous les emails\n     * @return string[]\n     */\n    public function getEmails(): array\n    {\n        return $this-&gt;map(fn(User $user) =&gt; $user-&gt;getEmail());\n    }\n\n    /**\n     * V\u00e9rifier si un email existe\n     */\n    public function hasEmail(string $email): bool\n    {\n        return null !== $this-&gt;findByEmail($email);\n    }\n}\n</code></pre> <p>Avantages de cette approche : - \u2705 Domaine 100% ind\u00e9pendant (pur PHP) - \u2705 Aucune d\u00e9pendance \u00e0 Doctrine ou autre framework - \u2705 <code>AbstractCollection</code> \u00e9crit une seule fois, r\u00e9utilis\u00e9 partout - \u2705 Type safety garanti - \u2705 M\u00e9thodes m\u00e9tier dans la collection - \u2705 Facilement testable sans infrastructure - \u2705 Permet le changement de stack technique sans impact</p>"},{"location":"advanced/repository-pattern/#utilisation-dans-le-repository","title":"Utilisation dans le Repository","text":"<pre><code>&lt;?php\n// src/User/Domain/Repository/UserRepositoryInterface.php\n\nnamespace App\\User\\Domain\\Repository;\n\nuse App\\User\\Domain\\Model\\User;\nuse App\\User\\Domain\\ValueObject\\UserId;\nuse App\\User\\Domain\\Collection\\UserCollection;\n\ninterface UserRepositoryInterface\n{\n    public function nextIdentity(): UserId;\n    public function add(User $user): void;\n    public function get(UserId $id): User;\n\n    /**\n     * Retourne une collection typ\u00e9e (pas un array !)\n     */\n    public function findActive(): UserCollection;\n}\n</code></pre> <pre><code>&lt;?php\n// src/User/Infrastructure/Persistence/Doctrine/DoctrineUserRepository.php\n\nnamespace App\\User\\Infrastructure\\Persistence\\Doctrine;\n\nuse App\\User\\Domain\\Collection\\UserCollection;\nuse App\\User\\Domain\\Repository\\UserRepositoryInterface;\nuse Doctrine\\ORM\\EntityManagerInterface;\n\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    public function findActive(): UserCollection\n    {\n        // M\u00e9thode 1 : DQL avec getResult()\n        $dql = 'SELECT u FROM ' . User::class . ' u WHERE u.active = :active';\n        $users = $this-&gt;entityManager\n            -&gt;createQuery($dql)\n            -&gt;setParameter('active', true)\n            -&gt;getResult(); // Retourne un array\n\n        return new UserCollection($users);\n\n        // M\u00e9thode 2 : QueryBuilder plus \u00e9l\u00e9gant\n        $users = $this-&gt;entityManager\n            -&gt;createQueryBuilder()\n            -&gt;select('u')\n            -&gt;from(User::class, 'u')\n            -&gt;where('u.active = :active')\n            -&gt;setParameter('active', true)\n            -&gt;getQuery()\n            -&gt;getResult();\n\n        return new UserCollection($users);\n    }\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#utilisation-dans-les-use-cases","title":"Utilisation dans les Use Cases","text":"<pre><code>&lt;?php\n// src/User/Application/Query/GetActiveUsersHandler.php\n\nnamespace App\\User\\Application\\Query;\n\nuse App\\User\\Domain\\Repository\\UserRepositoryInterface;\nuse App\\User\\Domain\\Collection\\UserCollection;\n\nfinal class GetActiveUsersHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $userRepository\n    ) {}\n\n    public function __invoke(GetActiveUsersQuery $query): UserCollection\n    {\n        $users = $this-&gt;userRepository-&gt;findActive();\n\n        // \u2705 Type-safe : on sait que c'est une UserCollection\n        // \u2705 M\u00e9thodes m\u00e9tier disponibles\n        if ($query-&gt;filterByEmail) {\n            return new UserCollection(\n                $users-&gt;filter(fn($k, $u) =&gt; str_contains($u-&gt;getEmail(), $query-&gt;filterByEmail))-&gt;toArray()\n            );\n        }\n\n        return $users;\n    }\n}\n</code></pre> <pre><code>&lt;?php\n// Dans un Controller ou Presenter\n\n$users = $this-&gt;queryBus-&gt;handle(new GetActiveUsersQuery());\n\n// \u2705 Countable\necho sprintf('Found %d active users', count($users));\n\n// \u2705 Iterator\nforeach ($users as $user) {\n    echo $user-&gt;getEmail(); // Autocompl\u00e9tion parfaite !\n}\n\n// \u2705 ArrayAccess\n$firstUser = $users[0];\n\n// \u2705 M\u00e9thodes m\u00e9tier\n$emails = $users-&gt;getEmails();\n$hasAdmin = $users-&gt;hasEmail('admin@example.com');\n$activeOnly = $users-&gt;getActive();\n</code></pre>"},{"location":"advanced/repository-pattern/#collections-et-architecture-hexagonale","title":"Collections et Architecture Hexagonale","text":"<p>Les Collections typ\u00e9es renforcent plusieurs principes de l'architecture hexagonale :</p> Principe Explication Type Safety Le domaine garantit que seuls les bons objets circulent Encapsulation La logique m\u00e9tier est dans la collection (<code>getActive()</code>, <code>findByEmail()</code>) Expressivit\u00e9 <code>$users-&gt;getActive()</code> est plus clair que <code>array_filter($users, ...)</code> Testabilit\u00e9 Facile de cr\u00e9er des collections de test avec des fixtures Immutabilit\u00e9 Les m\u00e9thodes peuvent retourner de nouvelles instances (pattern Value Object) Domain Logic Les collections portent la logique m\u00e9tier li\u00e9e aux ensembles d'objets"},{"location":"advanced/repository-pattern/#bonne-pratique-bonne-pratique-2-collection-pragmatique-avec-arraycollection-compromis-acceptable","title":"BONNE PRATIQUE: Bonne pratique 2 : Collection pragmatique avec ArrayCollection (Compromis acceptable)","text":"<p>Si vous acceptez une d\u00e9pendance l\u00e9g\u00e8re \u00e0 <code>doctrine/collections</code> (qui est juste une lib de collections, pas l'ORM), vous pouvez h\u00e9riter de <code>ArrayCollection</code>.</p> <p>Note : Cette approche est pragmatique mais techniquement viole l'hexagonal pur. C'est un compromis acceptable pour beaucoup de projets.</p> <pre><code>&lt;?php\n// src/User/Domain/Collection/UserCollection.php\n\nnamespace App\\User\\Domain\\Collection;\n\nuse App\\User\\Domain\\Model\\User;\nuse Doctrine\\Common\\Collections\\ArrayCollection;\n\n/**\n * Collection typ\u00e9e h\u00e9ritant de ArrayCollection\n * Note : D\u00e9pend de doctrine/collections (acceptable pour beaucoup de projets)\n * \u2705 Profite de toutes les m\u00e9thodes utilitaires\n *\n * @extends ArrayCollection&lt;int, User&gt;\n */\nfinal class UserCollection extends ArrayCollection\n{\n    /**\n     * @param User[] $users\n     */\n    public function __construct(array $users = [])\n    {\n        foreach ($users as $user) {\n            $this-&gt;validateType($user);\n        }\n        parent::__construct($users);\n    }\n\n    public function add(mixed $user): bool\n    {\n        $this-&gt;validateType($user);\n        return parent::add($user);\n    }\n\n    private function validateType(mixed $user): void\n    {\n        if (!$user instanceof User) {\n            throw new \\InvalidArgumentException(\n                sprintf('UserCollection can only contain %s instances, %s given',\n                    User::class,\n                    get_debug_type($user)\n                )\n            );\n        }\n    }\n\n    // M\u00e9thodes m\u00e9tier\n    public function getActive(): self\n    {\n        return new self(\n            $this-&gt;filter(fn(int $key, User $user) =&gt; $user-&gt;isActive())-&gt;toArray()\n        );\n    }\n\n    public function findByEmail(string $email): ?User\n    {\n        $result = $this-&gt;filter(\n            fn(int $key, User $user) =&gt; $user-&gt;getEmail() === $email\n        );\n        return $result-&gt;first() ?: null;\n    }\n}\n</code></pre> <p>Avantages : - \u2705 Rapidit\u00e9 de d\u00e9veloppement - \u2705 Toutes les m\u00e9thodes d'ArrayCollection disponibles (<code>map</code>, <code>filter</code>, <code>slice</code>, etc.) - \u2705 Type safety garanti par validation</p> <p>Inconv\u00e9nients : - Note : D\u00e9pendance \u00e0 <code>doctrine/collections</code> dans le Domain - Note : Techniquement viole l'ind\u00e9pendance hexagonale stricte</p> <p>Quand l'utiliser : - Projets pragmatiques o\u00f9 la perfection hexagonale n'est pas critique - \u00c9quipes qui veulent aller vite sans r\u00e9inventer la roue - Projets qui utilisent d\u00e9j\u00e0 Doctrine ORM</p>"},{"location":"advanced/repository-pattern/#comparaison-tableau-comparatif-des-approches","title":"Comparaison: Tableau comparatif des approches","text":"Crit\u00e8re <code>array</code> brut <code>ArrayCollection</code> directe Collection h\u00e9ritant <code>ArrayCollection</code> Collection Domain pure Type safety \u274c Aucune \u274c Aucune \u2705 Garantie \u2705 Garantie D\u00e9pendance externe \u2705 Aucune \u274c <code>doctrine/collections</code> Note : <code>doctrine/collections</code> \u2705 Aucune Hexagonal pur \u274c Non \u274c Non Note : Compromis \u2705 Oui M\u00e9thodes m\u00e9tier \u274c Aucune \u274c Aucune \u2705 Oui \u2705 Oui Autocompl\u00e9tion IDE \u274c Faible Note : G\u00e9n\u00e9rique \u2705 Parfaite \u2705 Parfaite M\u00e9thodes utilitaires Note : Fonctions PHP \u2705 Toutes \u2705 Toutes h\u00e9rit\u00e9es \u2705 Vous impl\u00e9mentez Effort d\u00e9veloppement \u2705 Minimal \u2705 Minimal \u2705 Faible Note : Moyen (une fois) Testabilit\u00e9 Note : Moyenne Note : Moyenne \u2705 Bonne \u2705 Excellente Migration stack Note : Difficile \u274c Tr\u00e8s difficile Note : Difficile \u2705 Facile"},{"location":"advanced/repository-pattern/#recommandation-recommandation-par-contexte","title":"Recommandation: Recommandation par contexte","text":""},{"location":"advanced/repository-pattern/#pour-larchitecture-hexagonale-stricte-recommande","title":"Pour l'architecture hexagonale STRICTE (recommand\u00e9)","text":"<pre><code>// \u2705 FAIRE : Collection Domain pure\nfinal class UserCollection extends AbstractCollection\n{\n    // Pur PHP, aucune d\u00e9pendance\n}\n</code></pre> <p>Utilisez cette approche si : - Vous voulez respecter l'hexagonal \u00e0 100% - Vous voulez un domaine compl\u00e8tement ind\u00e9pendant - Vous pr\u00e9voyez de changer de stack technique - Vous voulez tester le domaine sans aucune infrastructure</p>"},{"location":"advanced/repository-pattern/#pour-les-projets-pragmatiques","title":"Pour les projets pragmatiques","text":"<pre><code>// Note : ACCEPTABLE : H\u00e9rite d'ArrayCollection\nfinal class UserCollection extends ArrayCollection\n{\n    // Validation + m\u00e9thodes m\u00e9tier\n}\n</code></pre> <p>Utilisez cette approche si : - Vous utilisez d\u00e9j\u00e0 Doctrine ORM - Vous voulez aller vite - La perfection hexagonale n'est pas critique - Vous acceptez le compromis d\u00e9pendance l\u00e9g\u00e8re vs rapidit\u00e9</p>"},{"location":"advanced/repository-pattern/#a-eviter-absolument","title":"\u00c0 \u00c9VITER absolument","text":"<pre><code>// \u274c NE PAS FAIRE : Utiliser ArrayCollection directement dans les interfaces\ninterface UserRepositoryInterface\n{\n    public function findActive(): ArrayCollection; // \u274c Non !\n}\n\n// \u274c NE PAS FAIRE : Retourner des arrays bruts\ninterface UserRepositoryInterface\n{\n    /**\n     * @return User[]\n     */\n    public function findActive(): array; // \u274c Aucune garantie de type\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#structure-structure-des-dossiers-recommandee","title":"Structure: Structure des dossiers recommand\u00e9e","text":"<pre><code>src/\n\u251c\u2500\u2500 Shared/\n\u2502   \u2514\u2500\u2500 Domain/\n\u2502       \u2514\u2500\u2500 Collection/\n\u2502           \u2514\u2500\u2500 AbstractCollection.php    \u2705 Collection abstraite r\u00e9utilisable\n\u2502\n\u2514\u2500\u2500 User/\n    \u251c\u2500\u2500 Domain/\n    \u2502   \u251c\u2500\u2500 Model/\n    \u2502   \u2502   \u2514\u2500\u2500 User.php                  \u2705 Entit\u00e9\n    \u2502   \u251c\u2500\u2500 Collection/\n    \u2502   \u2502   \u2514\u2500\u2500 UserCollection.php        \u2705 Collection Domain (extend AbstractCollection)\n    \u2502   \u2514\u2500\u2500 Repository/\n    \u2502       \u2514\u2500\u2500 UserRepositoryInterface.php \u2705 Port (Interface)\n    \u2502\n    \u251c\u2500\u2500 Application/\n    \u2502   \u2514\u2500\u2500 Query/\n    \u2502       \u2514\u2500\u2500 GetActiveUsersHandler.php\n    \u2502\n    \u2514\u2500\u2500 Infrastructure/\n        \u2514\u2500\u2500 Persistence/\n            \u2514\u2500\u2500 Doctrine/\n                \u2514\u2500\u2500 DoctrineUserRepository.php \u2705 Adapter (Impl\u00e9mentation)\n</code></pre>"},{"location":"advanced/repository-pattern/#patterns-avances","title":"Patterns avanc\u00e9s","text":""},{"location":"advanced/repository-pattern/#pattern-memento","title":"Pattern Memento","text":"<p>Pour optimiser les performances, vous pouvez impl\u00e9menter le pattern Memento pour ne persister que les changements.</p> <p>Voir l'article de Matthias Noback : https://matthiasnoback.nl/</p>"},{"location":"advanced/repository-pattern/#flush-via-middleware","title":"Flush via Middleware","text":"<p>Au lieu de flusher dans le repository, vous pouvez d\u00e9l\u00e9guer \u00e0 un middleware du MessageBus :</p> <pre><code>final class DoctrineTransactionMiddleware implements MiddlewareInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    public function handle(Envelope $envelope, StackInterface $stack): Envelope\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $result = $stack-&gt;next()-&gt;handle($envelope, $stack);\n            $this-&gt;entityManager-&gt;flush();\n            $this-&gt;entityManager-&gt;commit();\n\n            return $result;\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n            throw $e;\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#testabilite","title":"Testabilit\u00e9","text":""},{"location":"advanced/repository-pattern/#repository-in-memory-pour-les-tests","title":"Repository In-Memory pour les tests","text":"<pre><code>&lt;?php\n// tests/User/Infrastructure/InMemory/InMemoryUserRepository.php\n\nnamespace App\\Tests\\User\\Infrastructure\\InMemory;\n\nuse App\\User\\Domain\\Model\\User;\nuse App\\User\\Domain\\Repository\\UserRepositoryInterface;\nuse App\\User\\Domain\\ValueObject\\UserId;\nuse App\\User\\Domain\\Exception\\UserNotFoundException;\n\nfinal class InMemoryUserRepository implements UserRepositoryInterface\n{\n    /** @var array&lt;string, User&gt; */\n    private array $users = [];\n\n    public function nextIdentity(): UserId\n    {\n        return UserId::fromString((string) count($this-&gt;users) + 1);\n    }\n\n    public function add(User $user): void\n    {\n        $this-&gt;users[$user-&gt;getId()-&gt;toString()] = $user;\n    }\n\n    public function get(UserId $id): User\n    {\n        $user = $this-&gt;users[$id-&gt;toString()] ?? null;\n\n        if (null === $user) {\n            throw new UserNotFoundException(\n                sprintf('User with id %s not found', $id-&gt;toString())\n            );\n        }\n\n        return $user;\n    }\n\n    public function getByEmail(string $email): User\n    {\n        foreach ($this-&gt;users as $user) {\n            if ($user-&gt;getEmail() === $email) {\n                return $user;\n            }\n        }\n\n        throw new UserNotFoundException(\n            sprintf('User with email %s not found', $email)\n        );\n    }\n\n    public function findActive(): array\n    {\n        return array_filter(\n            $this-&gt;users,\n            fn(User $user) =&gt; $user-&gt;isActive()\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#test-unitaire","title":"Test unitaire","text":"<pre><code>&lt;?php\n\nnamespace App\\Tests\\User\\Application\\Command;\n\nuse App\\User\\Application\\Command\\CreateUserCommand;\nuse App\\User\\Application\\Command\\CreateUserHandler;\nuse App\\Tests\\User\\Infrastructure\\InMemory\\InMemoryUserRepository;\nuse PHPUnit\\Framework\\TestCase;\n\nfinal class CreateUserHandlerTest extends TestCase\n{\n    public function testItCreatesAUser(): void\n    {\n        // Given\n        $repository = new InMemoryUserRepository();\n        $handler = new CreateUserHandler($repository);\n        $command = new CreateUserCommand('john@example.com', 'John Doe');\n\n        // When\n        $handler($command);\n\n        // Then\n        $user = $repository-&gt;getByEmail('john@example.com');\n        $this-&gt;assertEquals('John Doe', $user-&gt;getName());\n    }\n}\n</code></pre>"},{"location":"advanced/repository-pattern/#conclusion","title":"Conclusion","text":"<p>Le pattern Repository correctement impl\u00e9ment\u00e9 permet de :</p> <ol> <li>Isoler le domaine de l'infrastructure de persistance</li> <li>Respecter les principes SOLID (notamment Dependency Inversion)</li> <li>Faciliter les tests avec des impl\u00e9mentations in-memory</li> <li>Centraliser la persistance en un point unique</li> <li>Migrer facilement vers une autre solution de persistance</li> <li>S\u00e9parer lecture et \u00e9criture (CQRS l\u00e9ger avec Query Functions)</li> </ol>"},{"location":"advanced/repository-pattern/#ressources","title":"Ressources","text":"<ul> <li>Article de Matthias Noback sur le pattern Repository</li> <li>Conf\u00e9rence d'Arnaud Lemaire sur le pattern Repository</li> <li>Domain-Driven Design par Eric Evans</li> <li>Implementing Domain-Driven Design par Vaughn Vernon</li> </ul>"},{"location":"advanced/repository-pattern/#exemple-complet","title":"Exemple complet","text":"<p>Un exemple complet d'impl\u00e9mentation est disponible dans le bundle : - Module User avec Repository - Tests avec InMemoryRepository</p>"},{"location":"advanced/request-response-flow/","title":"Complete Request-Response Flow: End-to-End Journey","text":""},{"location":"advanced/request-response-flow/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Overview</li> <li>The Complete Flow Diagram</li> <li>Step-by-Step Breakdown</li> <li>Data Transformations</li> <li>Real Example: Register User</li> <li>Error Flow</li> <li>Performance Considerations</li> </ol>"},{"location":"advanced/request-response-flow/#overview","title":"Overview","text":"<p>Understanding how a request flows through all layers of hexagonal architecture is crucial. This guide shows the complete journey from HTTP request to database and back, with data transformations at each boundary.</p>"},{"location":"advanced/request-response-flow/#the-journey-in-one-sentence","title":"The Journey in One Sentence","text":"<p>HTTP JSON \u2192 Controller \u2192 Command DTO \u2192 Handler \u2192 Domain Entity \u2192 Repository Port \u2192 Doctrine Adapter \u2192 Database \u2192 Entity \u2192 Query Result \u2192 Response DTO \u2192 Controller \u2192 HTTP JSON</p>"},{"location":"advanced/request-response-flow/#the-complete-flow-diagram","title":"The Complete Flow Diagram","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'13px'}}}%%\nsequenceDiagram\n    autonumber\n\n    participant Client as \ud83c\udf10 Client&lt;br/&gt;(Browser/API)\n    participant Router as \ud83d\udea6 Symfony Router\n    participant Ctrl as \ud83c\udfae Controller&lt;br/&gt;(Infrastructure)\n    participant Valid as \u2705 Validator&lt;br/&gt;(Symfony)\n    participant Bus as \ud83d\ude8c Message Bus&lt;br/&gt;(Symfony)\n    participant Handler as \u2699\ufe0f Handler&lt;br/&gt;(Application)\n    participant Factory as \ud83c\udfed Factory&lt;br/&gt;(Domain)\n    participant Entity as \ud83d\udc8e Entity&lt;br/&gt;(Domain)\n    participant Port as \ud83d\udd0c Port&lt;br/&gt;(Domain Interface)\n    participant Adapter as \ud83d\udd27 Adapter&lt;br/&gt;(Infrastructure)\n    participant DB as \ud83d\uddc4\ufe0f Database&lt;br/&gt;(PostgreSQL)\n\n    rect rgb(255, 240, 240)\n        Note over Client,Router: INCOMING REQUEST\n        Client-&gt;&gt;Router: POST /api/users&lt;br/&gt;{\"email\": \"user@example.com\", \"password\": \"secret123\"}\n        Router-&gt;&gt;Ctrl: Route to RegisterUserController\n    end\n\n    rect rgb(240, 248, 255)\n        Note over Ctrl,Valid: INFRASTRUCTURE LAYER: Input Validation\n        Ctrl-&gt;&gt;Ctrl: Deserialize JSON to RegisterUserRequest DTO\n        Ctrl-&gt;&gt;Valid: Validate DTO constraints\n        Valid--&gt;&gt;Ctrl: Validation OK\n        Ctrl-&gt;&gt;Bus: Create RegisterUserCommand&lt;br/&gt;dispatch(command)\n    end\n\n    rect rgb(240, 255, 240)\n        Note over Bus,Handler: APPLICATION LAYER: Orchestration\n        Bus-&gt;&gt;Handler: __invoke(RegisterUserCommand)\n        Handler-&gt;&gt;Port: $this-&gt;users-&gt;existsByEmail()\n        Port-&gt;&gt;Adapter: existsByEmail()\n        Adapter-&gt;&gt;DB: SELECT COUNT(*) FROM users WHERE email = ?\n        DB--&gt;&gt;Adapter: 0\n        Adapter--&gt;&gt;Port: false\n        Port--&gt;&gt;Handler: false (email available)\n    end\n\n    rect rgb(255, 255, 240)\n        Note over Handler,Entity: DOMAIN LAYER: Business Logic\n        Handler-&gt;&gt;Factory: UserFactory::create(email, password)\n        Factory-&gt;&gt;Entity: new Email(value)\n        Entity-&gt;&gt;Entity: validate email format\n        Entity--&gt;&gt;Factory: Email created\n        Factory-&gt;&gt;Entity: HashedPassword::fromPlaintext()\n        Entity-&gt;&gt;Entity: hash password + validate length\n        Entity--&gt;&gt;Factory: HashedPassword created\n        Factory-&gt;&gt;Entity: new User(id, email, password)\n        Entity-&gt;&gt;Entity: apply business rules\n        Entity--&gt;&gt;Factory: User entity\n        Factory--&gt;&gt;Handler: User entity\n    end\n\n    rect rgb(240, 248, 255)\n        Note over Handler,DB: INFRASTRUCTURE LAYER: Persistence\n        Handler-&gt;&gt;Port: $this-&gt;users-&gt;save($user)\n        Port-&gt;&gt;Adapter: save($user)\n        Adapter-&gt;&gt;DB: INSERT INTO users (...) VALUES (...)\n        DB--&gt;&gt;Adapter: OK\n        Adapter--&gt;&gt;Port: void\n        Port--&gt;&gt;Handler: void\n    end\n\n    rect rgb(255, 240, 240)\n        Note over Handler,Client: RESPONSE PATH\n        Handler--&gt;&gt;Bus: void (success)\n        Bus--&gt;&gt;Ctrl: void\n        Ctrl-&gt;&gt;Ctrl: Create UserResponse DTO&lt;br/&gt;from User entity\n        Ctrl--&gt;&gt;Router: Response(201, UserResponse)\n        Router--&gt;&gt;Client: 201 Created&lt;br/&gt;{\"id\": \"123\", \"email\": \"user@example.com\"}\n    end</code></pre>"},{"location":"advanced/request-response-flow/#step-by-step-breakdown","title":"Step-by-Step Breakdown","text":""},{"location":"advanced/request-response-flow/#phase-1-request-entry-infrastructure","title":"Phase 1: Request Entry (Infrastructure)","text":""},{"location":"advanced/request-response-flow/#step-1-2-routing","title":"Step 1-2: Routing","text":"<pre><code>Input:  POST /api/users HTTP/1.1\n        Content-Type: application/json\n        {\"email\": \"user@example.com\", \"password\": \"secret123\"}\n\nAction: Symfony Router matches route \u2192 RegisterUserController\n</code></pre>"},{"location":"advanced/request-response-flow/#step-3-deserialization","title":"Step 3: Deserialization","text":"<pre><code>// Controller receives raw request\npublic function __invoke(Request $request): JsonResponse\n{\n    // Deserialize JSON to DTO\n    $dto = $this-&gt;serializer-&gt;deserialize(\n        $request-&gt;getContent(),\n        RegisterUserRequest::class,\n        'json'\n    );\n\n    // $dto is now: RegisterUserRequest {\n    //     email: \"user@example.com\",\n    //     password: \"secret123\"\n    // }\n}\n</code></pre> <p>Data Transformation: <pre><code>Raw JSON String \u2192 RegisterUserRequest DTO (Infrastructure)\n</code></pre></p>"},{"location":"advanced/request-response-flow/#step-4-5-validation","title":"Step 4-5: Validation","text":"<pre><code>// Validate using Symfony constraints\n$errors = $this-&gt;validator-&gt;validate($dto);\n\nif (count($errors) &gt; 0) {\n    throw new ValidationException($errors);\n}\n\n// DTO class with constraints:\nclass RegisterUserRequest\n{\n    #[Assert\\NotBlank]\n    #[Assert\\Email]\n    public string $email;\n\n    #[Assert\\NotBlank]\n    #[Assert\\Length(min: 8)]\n    public string $password;\n}\n</code></pre>"},{"location":"advanced/request-response-flow/#step-6-create-command-dispatch","title":"Step 6: Create Command &amp; Dispatch","text":"<pre><code>// Transform DTO \u2192 Command (Application DTO)\n$command = new RegisterUserCommand(\n    email: $dto-&gt;email,\n    password: $dto-&gt;password\n);\n\n// Dispatch to message bus\n$this-&gt;messageBus-&gt;dispatch($command);\n</code></pre> <p>Data Transformation: <pre><code>RegisterUserRequest DTO \u2192 RegisterUserCommand DTO (Application)\n</code></pre></p>"},{"location":"advanced/request-response-flow/#phase-2-application-layer-orchestration","title":"Phase 2: Application Layer Orchestration","text":""},{"location":"advanced/request-response-flow/#step-7-handler-invocation","title":"Step 7: Handler Invocation","text":"<pre><code>// Symfony automatically invokes handler\n#[AsMessageHandler]\nfinal readonly class RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // Handler starts orchestration\n    }\n}\n</code></pre>"},{"location":"advanced/request-response-flow/#step-8-12-check-email-uniqueness","title":"Step 8-12: Check Email Uniqueness","text":"<pre><code>// Handler calls port\nif ($this-&gt;users-&gt;existsByEmail($command-&gt;email)) {\n    throw new EmailAlreadyExistsException($command-&gt;email);\n}\n\n// Port interface (Domain)\ninterface UserRepositoryInterface\n{\n    public function existsByEmail(string $email): bool;\n}\n\n// Adapter implementation (Infrastructure)\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function existsByEmail(string $email): bool\n    {\n        $qb = $this-&gt;entityManager-&gt;createQueryBuilder();\n        $qb-&gt;select('COUNT(u.id)')\n           -&gt;from(User::class, 'u')\n           -&gt;where('u.email = :email')\n           -&gt;setParameter('email', $email);\n\n        return (int) $qb-&gt;getQuery()-&gt;getSingleScalarResult() &gt; 0;\n    }\n}\n\n// Database query executed:\n// SELECT COUNT(id) FROM users WHERE email = 'user@example.com'\n</code></pre> <p>Data Flow: <pre><code>Command (email string)\n  \u2192 Port method call\n    \u2192 Adapter (Doctrine QueryBuilder)\n      \u2192 SQL Query\n        \u2192 Database\n          \u2192 Result (0)\n            \u2192 Adapter (false)\n              \u2192 Port (false)\n                \u2192 Handler (proceeds)\n</code></pre></p>"},{"location":"advanced/request-response-flow/#phase-3-domain-layer-business-logic","title":"Phase 3: Domain Layer Business Logic","text":""},{"location":"advanced/request-response-flow/#step-13-factory-invocation","title":"Step 13: Factory Invocation","text":"<pre><code>// Handler delegates creation to factory\n$user = UserFactory::create($command-&gt;email, $command-&gt;password);\n</code></pre>"},{"location":"advanced/request-response-flow/#step-14-17-email-value-object-creation","title":"Step 14-17: Email Value Object Creation","text":"<pre><code>// Factory creates Email value object\n$email = new Email($command-&gt;email);\n\n// Email constructor validates\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        // Business rule: must be valid email\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n\n        // Business rule: corporate domain only (example)\n        if (!str_ends_with($value, '@company.com')) {\n            throw new InvalidEmailDomainException($value);\n        }\n    }\n}\n</code></pre> <p>Data Transformation: <pre><code>Primitive string \u2192 Email Value Object (Domain)\n</code></pre></p>"},{"location":"advanced/request-response-flow/#step-18-20-password-hashing","title":"Step 18-20: Password Hashing","text":"<pre><code>// Factory creates hashed password\n$hashedPassword = HashedPassword::fromPlaintext($command-&gt;password);\n\n// Value object handles hashing\nfinal readonly class HashedPassword\n{\n    private function __construct(public string $hash) {}\n\n    public static function fromPlaintext(string $plaintext): self\n    {\n        // Business rule: minimum length\n        if (strlen($plaintext) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        // Hash the password\n        $hash = password_hash($plaintext, PASSWORD_ARGON2ID);\n\n        return new self($hash);\n    }\n}\n</code></pre> <p>Data Transformation: <pre><code>Plaintext string \u2192 HashedPassword Value Object (Domain)\n</code></pre></p>"},{"location":"advanced/request-response-flow/#step-21-23-entity-creation","title":"Step 21-23: Entity Creation","text":"<pre><code>// Factory creates entity with all value objects\npublic static function create(string $email, string $password): User\n{\n    return new User(\n        id: UserId::generate(),\n        email: new Email($email),\n        password: HashedPassword::fromPlaintext($password),\n        isActive: false,\n        createdAt: new \\DateTimeImmutable()\n    );\n}\n\n// Entity constructor applies business rules\npublic function __construct(\n    private UserId $id,\n    private Email $email,\n    private HashedPassword $password,\n    private bool $isActive,\n    private \\DateTimeImmutable $createdAt,\n) {\n    // Business invariant: new users are inactive\n    if ($this-&gt;isActive) {\n        throw new NewUserCannotBeActiveException();\n    }\n}\n</code></pre> <p>Data Transformation: <pre><code>Primitives (string, string)\n  \u2192 Value Objects (Email, HashedPassword)\n    \u2192 Entity (User) [Domain]\n</code></pre></p>"},{"location":"advanced/request-response-flow/#phase-4-persistence-infrastructure","title":"Phase 4: Persistence (Infrastructure)","text":""},{"location":"advanced/request-response-flow/#step-24-28-save-to-database","title":"Step 24-28: Save to Database","text":"<pre><code>// Handler saves entity through port\n$this-&gt;users-&gt;save($user);\n\n// Port interface (Domain)\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n}\n\n// Adapter implementation (Infrastructure)\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n    }\n}\n\n// Doctrine generates SQL:\n// INSERT INTO users (id, email, password, is_active, created_at)\n// VALUES ('550e8400-...', 'user@example.com', '$argon2id$...', false, '2024-01-15 10:30:00')\n</code></pre> <p>Data Transformation: <pre><code>User Entity (Domain)\n  \u2192 Doctrine Metadata Mapping\n    \u2192 SQL INSERT Statement\n      \u2192 Database Row\n</code></pre></p>"},{"location":"advanced/request-response-flow/#phase-5-response-path","title":"Phase 5: Response Path","text":""},{"location":"advanced/request-response-flow/#step-29-30-handler-completion","title":"Step 29-30: Handler Completion","text":"<pre><code>// Handler completes (returns void)\npublic function __invoke(RegisterUserCommand $command): void\n{\n    // ... all steps completed\n\n    // No return value (command pattern)\n}\n</code></pre>"},{"location":"advanced/request-response-flow/#step-31-response-dto-creation","title":"Step 31: Response DTO Creation","text":"<pre><code>// Controller receives void, creates response\npublic function __invoke(Request $request): JsonResponse\n{\n    $command = new RegisterUserCommand(/*...*/);\n\n    $this-&gt;messageBus-&gt;dispatch($command);\n\n    // Fetch created user to return\n    $user = $this-&gt;users-&gt;findByEmail($command-&gt;email);\n\n    // Transform Entity \u2192 Response DTO\n    $response = new UserResponse(\n        id: $user-&gt;getId()-&gt;toString(),\n        email: $user-&gt;getEmail()-&gt;value,\n        isActive: $user-&gt;isActive(),\n        createdAt: $user-&gt;getCreatedAt()-&gt;format('c')\n    );\n\n    return new JsonResponse($response, Response::HTTP_CREATED);\n}\n</code></pre> <p>Data Transformation: <pre><code>User Entity (Domain) \u2192 UserResponse DTO (Infrastructure) \u2192 JSON\n</code></pre></p>"},{"location":"advanced/request-response-flow/#step-32-33-json-response","title":"Step 32-33: JSON Response","text":"<pre><code>Output: HTTP/1.1 201 Created\n        Content-Type: application/json\n\n        {\n            \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n            \"email\": \"user@example.com\",\n            \"isActive\": false,\n            \"createdAt\": \"2024-01-15T10:30:00+00:00\"\n        }\n</code></pre>"},{"location":"advanced/request-response-flow/#data-transformations","title":"Data Transformations","text":""},{"location":"advanced/request-response-flow/#complete-transformation-chain","title":"Complete Transformation Chain","text":"<pre><code>1. Raw JSON (HTTP)\n   \u2193\n2. RegisterUserRequest DTO (Infrastructure - Input validation)\n   \u2193\n3. RegisterUserCommand (Application - Use case intent)\n   \u2193\n4. Email + Password (strings)\n   \u2193\n5. Email Value Object + HashedPassword Value Object (Domain - Business validation)\n   \u2193\n6. User Entity (Domain - Business logic)\n   \u2193\n7. Doctrine Entity Metadata (Infrastructure - ORM mapping)\n   \u2193\n8. SQL INSERT (Infrastructure - Database)\n   \u2193\n9. Database Row (Persistence)\n   \u2193\n10. User Entity (Domain - Loaded from DB)\n   \u2193\n11. UserResponse DTO (Infrastructure - Output formatting)\n   \u2193\n12. JSON Response (HTTP)\n</code></pre>"},{"location":"advanced/request-response-flow/#why-so-many-transformations","title":"Why So Many Transformations?","text":"<p>Each transformation serves a purpose:</p> Transformation Purpose Layer JSON \u2192 Request DTO Input validation, HTTP concerns Infrastructure Request DTO \u2192 Command Use case intent, application concern Application Command \u2192 Value Objects Business validation Domain Value Objects \u2192 Entity Business logic encapsulation Domain Entity \u2192 SQL Persistence mapping Infrastructure SQL \u2192 Database Row Storage Infrastructure Entity \u2192 Response DTO Output formatting, hide internals Infrastructure Response DTO \u2192 JSON HTTP serialization Infrastructure <p>Key Principle: Each layer has its own representation, preventing coupling.</p>"},{"location":"advanced/request-response-flow/#real-example-register-user","title":"Real Example: Register User","text":""},{"location":"advanced/request-response-flow/#complete-code-flow","title":"Complete Code Flow","text":"<pre><code>// 1. INFRASTRUCTURE: Controller\nnamespace App\\User\\Infrastructure\\Controller;\n\n#[Route('/api/users', methods: ['POST'])]\nfinal readonly class RegisterUserController extends AbstractController\n{\n    public function __invoke(Request $request): JsonResponse\n    {\n        // Deserialize + validate\n        $dto = $this-&gt;serializer-&gt;deserialize(\n            $request-&gt;getContent(),\n            RegisterUserRequest::class,\n            'json'\n        );\n\n        $violations = $this-&gt;validator-&gt;validate($dto);\n        if (count($violations) &gt; 0) {\n            throw new ValidationException($violations);\n        }\n\n        // Create command\n        $command = new RegisterUserCommand(\n            email: $dto-&gt;email,\n            password: $dto-&gt;password\n        );\n\n        // Dispatch\n        $this-&gt;messageBus-&gt;dispatch($command);\n\n        // Fetch result\n        $user = $this-&gt;users-&gt;findByEmail($command-&gt;email);\n\n        // Create response\n        return $this-&gt;json(\n            new UserResponse(\n                id: $user-&gt;getId()-&gt;toString(),\n                email: $user-&gt;getEmail()-&gt;value,\n                isActive: $user-&gt;isActive()\n            ),\n            Response::HTTP_CREATED\n        );\n    }\n}\n\n// 2. APPLICATION: Command (DTO)\nnamespace App\\User\\Application\\Command;\n\nfinal readonly class RegisterUserCommand\n{\n    public function __construct(\n        public string $email,\n        public string $password,\n    ) {}\n}\n\n// 3. APPLICATION: Handler\nnamespace App\\User\\Application\\Handler;\n\n#[AsMessageHandler]\nfinal readonly class RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users,\n        private EventDispatcherInterface $eventDispatcher,\n    ) {}\n\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // Check uniqueness (application concern - needs repository)\n        if ($this-&gt;users-&gt;existsByEmail($command-&gt;email)) {\n            throw new EmailAlreadyExistsException($command-&gt;email);\n        }\n\n        // Create user (domain logic in factory)\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        // Persist (infrastructure concern)\n        $this-&gt;users-&gt;save($user);\n\n        // Dispatch event (infrastructure concern)\n        $this-&gt;eventDispatcher-&gt;dispatch(\n            new UserRegisteredEvent($user-&gt;getId())\n        );\n    }\n}\n\n// 4. DOMAIN: Factory\nnamespace App\\User\\Domain\\Factory;\n\nfinal class UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),           // Validates format\n            password: HashedPassword::fromPlaintext($password), // Validates + hashes\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n}\n\n// 5. DOMAIN: Value Objects\nnamespace App\\User\\Domain\\ValueObject;\n\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n    }\n}\n\nfinal readonly class HashedPassword\n{\n    private function __construct(public string $hash) {}\n\n    public static function fromPlaintext(string $plaintext): self\n    {\n        if (strlen($plaintext) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        return new self(password_hash($plaintext, PASSWORD_ARGON2ID));\n    }\n}\n\n// 6. DOMAIN: Entity\nnamespace App\\User\\Domain\\Model;\n\nclass User\n{\n    public function __construct(\n        private UserId $id,\n        private Email $email,\n        private HashedPassword $password,\n        private bool $isActive,\n        private \\DateTimeImmutable $createdAt,\n    ) {}\n\n    public function activate(): void\n    {\n        if ($this-&gt;isActive) {\n            throw new UserAlreadyActiveException();\n        }\n\n        $this-&gt;isActive = true;\n    }\n\n    // Getters...\n}\n\n// 7. DOMAIN: Port (Interface)\nnamespace App\\User\\Domain\\Port;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function existsByEmail(string $email): bool;\n    public function findByEmail(string $email): ?User;\n}\n\n// 8. INFRASTRUCTURE: Adapter (Doctrine Implementation)\nnamespace App\\User\\Infrastructure\\Persistence;\n\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    public function save(User $user): void\n    {\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n    }\n\n    public function existsByEmail(string $email): bool\n    {\n        return $this-&gt;entityManager-&gt;createQueryBuilder()\n            -&gt;select('COUNT(u.id)')\n            -&gt;from(User::class, 'u')\n            -&gt;where('u.email = :email')\n            -&gt;setParameter('email', $email)\n            -&gt;getQuery()\n            -&gt;getSingleScalarResult() &gt; 0;\n    }\n\n    public function findByEmail(string $email): ?User\n    {\n        return $this-&gt;entityManager\n            -&gt;getRepository(User::class)\n            -&gt;findOneBy(['email' =&gt; $email]);\n    }\n}\n</code></pre>"},{"location":"advanced/request-response-flow/#error-flow","title":"Error Flow","text":""},{"location":"advanced/request-response-flow/#domain-exception-path","title":"Domain Exception Path","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Controller\n    participant Handler\n    participant Factory\n    participant Email\n\n    Client-&gt;&gt;Controller: POST /api/users&lt;br/&gt;{\"email\": \"invalid\", \"password\": \"secret\"}\n    Controller-&gt;&gt;Handler: dispatch(command)\n    Handler-&gt;&gt;Factory: create(\"invalid\", \"secret\")\n    Factory-&gt;&gt;Email: new Email(\"invalid\")\n    Email-&gt;&gt;Email: validate format\n    Email--&gt;&gt;Factory: \u274c InvalidEmailException\n    Factory--&gt;&gt;Handler: \u274c InvalidEmailException\n    Handler--&gt;&gt;Controller: \u274c InvalidEmailException\n    Controller-&gt;&gt;Controller: catch &amp; transform\n    Controller--&gt;&gt;Client: 400 Bad Request&lt;br/&gt;{\"error\": \"Invalid email format\"}</code></pre>"},{"location":"advanced/request-response-flow/#infrastructure-exception-path","title":"Infrastructure Exception Path","text":"<pre><code>sequenceDiagram\n    participant Handler\n    participant Port\n    participant Adapter\n    participant DB\n\n    Handler-&gt;&gt;Port: save(user)\n    Port-&gt;&gt;Adapter: save(user)\n    Adapter-&gt;&gt;DB: INSERT INTO users...\n    DB--&gt;&gt;Adapter: \u274c Duplicate key violation\n    Adapter--&gt;&gt;Port: \u274c UniqueConstraintViolationException\n    Port--&gt;&gt;Handler: \u274c UniqueConstraintViolationException\n    Handler-&gt;&gt;Handler: catch &amp; wrap\n    Handler--&gt;&gt;Handler: \u274c EmailAlreadyExistsException</code></pre> <p>Exception Translation: Infrastructure exceptions are caught and translated to domain exceptions.</p>"},{"location":"advanced/request-response-flow/#performance-considerations","title":"Performance Considerations","text":""},{"location":"advanced/request-response-flow/#query-optimization","title":"Query Optimization","text":"<pre><code>// \u274c BAD: N+1 Query Problem\npublic function listUsers(): array\n{\n    $users = $this-&gt;users-&gt;findAll(); // 1 query\n\n    foreach ($users as $user) {\n        $user-&gt;getOrders(); // N queries!\n    }\n\n    return $users;\n}\n\n// \u2705 GOOD: Eager Loading\npublic function listUsers(): array\n{\n    return $this-&gt;entityManager-&gt;createQueryBuilder()\n        -&gt;select('u', 'o')\n        -&gt;from(User::class, 'u')\n        -&gt;leftJoin('u.orders', 'o')\n        -&gt;getQuery()\n        -&gt;getResult(); // 1 query\n}\n</code></pre>"},{"location":"advanced/request-response-flow/#caching-strategy","title":"Caching Strategy","text":"<pre><code>// Add caching at infrastructure layer\nfinal class CachedUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private UserRepositoryInterface $decorated,\n        private CacheInterface $cache,\n    ) {}\n\n    public function findByEmail(string $email): ?User\n    {\n        return $this-&gt;cache-&gt;get(\n            \"user:email:{$email}\",\n            fn() =&gt; $this-&gt;decorated-&gt;findByEmail($email)\n        );\n    }\n}\n</code></pre>"},{"location":"advanced/request-response-flow/#database-connection-pooling","title":"Database Connection Pooling","text":"<p>Configure in <code>config/packages/doctrine.yaml</code>:</p> <pre><code>doctrine:\n    dbal:\n        connections:\n            default:\n                url: '%env(resolve:DATABASE_URL)%'\n                driver: 'pdo_pgsql'\n                server_version: '15'\n                options:\n                    # Connection pooling\n                    persistent: true\n                    # Prepared statement caching\n                    cache_prepared_statements: true\n</code></pre>"},{"location":"advanced/request-response-flow/#key-takeaways","title":"Key Takeaways","text":"<ol> <li>Layered Transformations: Data transforms at each boundary to maintain separation</li> <li>Direction Matters: Dependencies always point inward (Infrastructure \u2192 Application \u2192 Domain)</li> <li>Ports at Boundaries: All domain access to infrastructure goes through ports</li> <li>DTOs Everywhere: Input DTO, Command DTO, Entity, Response DTO\u2014each has a purpose</li> <li>Exception Translation: Infrastructure exceptions become domain exceptions</li> <li>Performance via Infrastructure: Caching, query optimization happen in adapters, not domain</li> </ol> <p>Next: Port Interface Design Principles \u2192</p>"},{"location":"advanced/shared-kernel/","title":"Shared Kernel","text":"<p>The Shared Kernel is a strategic pattern from Domain-Driven Design (DDD) that contains code shared across multiple bounded contexts (modules) in your application.</p> <p>{: .note } The Shared Kernel should be small, well-defined, and changed only with careful coordination, as modifications impact all modules that depend on it.</p>"},{"location":"advanced/shared-kernel/#what-is-the-shared-kernel","title":"What is the Shared Kernel?","text":"<p>In a modular hexagonal architecture, each module (bounded context) should be as independent as possible. However, some concepts are truly generic and used across multiple modules. The Shared Kernel is where you place these common building blocks.</p>"},{"location":"advanced/shared-kernel/#purpose","title":"Purpose","text":"<p>The Shared Kernel serves to:</p> <ol> <li>Prevent Code Duplication - Avoid reimplementing the same value objects or utilities in every module</li> <li>Ensure Consistency - Guarantee that common concepts (like Email, Money, UUID) behave identically everywhere</li> <li>Maintain Independence - Allow modules to share code without creating tight coupling between them</li> <li>Express Ubiquitous Language - Centralize domain concepts that transcend individual bounded contexts</li> </ol>"},{"location":"advanced/shared-kernel/#directory-structure","title":"Directory Structure","text":"<pre><code>src/\n\u251c\u2500\u2500 Module/                    # Your bounded contexts\n\u2502   \u251c\u2500\u2500 User/\n\u2502   \u2502   \u2514\u2500\u2500 Account/\n\u2502   \u251c\u2500\u2500 Blog/\n\u2502   \u2502   \u2514\u2500\u2500 Post/\n\u2502   \u2514\u2500\u2500 Order/\n\u2502       \u2514\u2500\u2500 Checkout/\n\u2514\u2500\u2500 Shared/                    # Shared Kernel\n    \u251c\u2500\u2500 Domain/\n    \u2502   \u251c\u2500\u2500 ValueObject/       # Generic value objects\n    \u2502   \u2502   \u251c\u2500\u2500 Email.php\n    \u2502   \u2502   \u251c\u2500\u2500 Money.php\n    \u2502   \u2502   \u251c\u2500\u2500 Uuid.php\n    \u2502   \u2502   \u2514\u2500\u2500 PhoneNumber.php\n    \u2502   \u251c\u2500\u2500 Exception/         # Base exceptions\n    \u2502   \u2502   \u251c\u2500\u2500 DomainException.php\n    \u2502   \u2502   \u2514\u2500\u2500 ValidationException.php\n    \u2502   \u2514\u2500\u2500 Event/             # Base event classes\n    \u2502       \u2514\u2500\u2500 DomainEvent.php\n    \u251c\u2500\u2500 Application/\n    \u2502   \u2514\u2500\u2500 Service/           # Generic application services\n    \u2502       \u2514\u2500\u2500 Clock.php      # Time abstraction\n    \u2514\u2500\u2500 Infrastructure/\n        \u251c\u2500\u2500 Persistence/       # Generic persistence utilities\n        \u2502   \u2514\u2500\u2500 Doctrine/\n        \u2502       \u2514\u2500\u2500 Type/      # Custom Doctrine types\n        \u2514\u2500\u2500 Messaging/         # Shared messaging infrastructure\n</code></pre>"},{"location":"advanced/shared-kernel/#what-belongs-in-shared-kernel","title":"What Belongs in Shared Kernel?","text":""},{"location":"advanced/shared-kernel/#good-candidates-for-shared-kernel","title":"Good Candidates for Shared Kernel","text":"<p>Generic Value Objects - <code>Email</code> - Used by User, Newsletter, Support modules - <code>Money</code> - Used by Order, Invoice, Payment modules - <code>Uuid</code> - Used across all modules for entity IDs - <code>PhoneNumber</code> - Used by User, Shipping, Contact modules - <code>Address</code> - Used by User, Order, Shipping modules (if truly generic)</p> <p>Base Domain Concepts - Abstract base exceptions (<code>DomainException</code>) - Domain event interfaces - Common enums (Country, Currency, Language) - Measurement units (Weight, Distance)</p> <p>Infrastructure Utilities - Clock interface for testable time - Common Doctrine custom types - Shared event bus configuration</p>"},{"location":"advanced/shared-kernel/#what-should-not-be-in-shared","title":"What Should NOT be in Shared","text":"<p>Context-Specific Logic - <code>UserEmail</code> (includes user-specific validation like \"no admin emails\") \u2192 Keep in User module - <code>OrderTotal</code> (includes tax calculation logic) \u2192 Keep in Order module - <code>ProductPrice</code> (includes pricing rules) \u2192 Keep in Product module</p> <p>Business Rules - Any validation that differs by context - Behavior specific to one domain</p> <p>Premature Abstractions - Code used by only 1-2 modules (wait until 3+) - \"Might be shared someday\" code</p>"},{"location":"advanced/shared-kernel/#examples","title":"Examples","text":""},{"location":"advanced/shared-kernel/#example-1-shared-email-value-object","title":"Example 1: Shared Email Value Object","text":"<pre><code>&lt;?php\n// src/Shared/Domain/ValueObject/Email.php\n\nnamespace App\\Shared\\Domain\\ValueObject;\n\nfinal readonly class Email\n{\n    public function __construct(private string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new \\InvalidArgumentException(\n                \"'{$value}' is not a valid email address\"\n            );\n        }\n    }\n\n    public function getValue(): string\n    {\n        return $this-&gt;value;\n    }\n\n    public function equals(self $other): bool\n    {\n        return $this-&gt;value === $other-&gt;value;\n    }\n\n    public function __toString(): string\n    {\n        return $this-&gt;value;\n    }\n}\n</code></pre> <p>Used across multiple modules:</p> <pre><code>// User module - User entity\nnamespace App\\User\\Account\\Domain\\Model;\n\nuse App\\Shared\\Domain\\ValueObject\\Email;\n\nfinal class User\n{\n    public function __construct(\n        private UserId $id,\n        private Email $email,  // \u2190 Shared Email\n        private string $name\n    ) {}\n}\n\n// Newsletter module - Subscriber entity\nnamespace App\\Newsletter\\Domain\\Model;\n\nuse App\\Shared\\Domain\\ValueObject\\Email;\n\nfinal class Subscriber\n{\n    public function __construct(\n        private SubscriberId $id,\n        private Email $email,  // \u2190 Same shared Email\n        private bool $active\n    ) {}\n}\n\n// Support module - Ticket entity\nnamespace App\\Support\\Ticket\\Domain\\Model;\n\nuse App\\Shared\\Domain\\ValueObject\\Email;\n\nfinal class Ticket\n{\n    public function __construct(\n        private TicketId $id,\n        private Email $customerEmail,  // \u2190 Same shared Email\n        private string $subject\n    ) {}\n}\n</code></pre>"},{"location":"advanced/shared-kernel/#example-2-shared-money-value-object","title":"Example 2: Shared Money Value Object","text":"<pre><code>&lt;?php\n// src/Shared/Domain/ValueObject/Money.php\n\nnamespace App\\Shared\\Domain\\ValueObject;\n\nfinal readonly class Money\n{\n    public function __construct(\n        private int $amount,      // Store as cents/minor units\n        private Currency $currency\n    ) {\n        if ($amount &lt; 0) {\n            throw new \\InvalidArgumentException('Amount cannot be negative');\n        }\n    }\n\n    public function getAmount(): int\n    {\n        return $this-&gt;amount;\n    }\n\n    public function getCurrency(): Currency\n    {\n        return $this-&gt;currency;\n    }\n\n    public function add(self $other): self\n    {\n        $this-&gt;assertSameCurrency($other);\n        return new self($this-&gt;amount + $other-&gt;amount, $this-&gt;currency);\n    }\n\n    public function subtract(self $other): self\n    {\n        $this-&gt;assertSameCurrency($other);\n        return new self($this-&gt;amount - $other-&gt;amount, $this-&gt;currency);\n    }\n\n    public function multiply(int $multiplier): self\n    {\n        return new self($this-&gt;amount * $multiplier, $this-&gt;currency);\n    }\n\n    private function assertSameCurrency(self $other): void\n    {\n        if (!$this-&gt;currency-&gt;equals($other-&gt;currency)) {\n            throw new \\InvalidArgumentException(\n                'Cannot operate on different currencies'\n            );\n        }\n    }\n\n    public function equals(self $other): bool\n    {\n        return $this-&gt;amount === $other-&gt;amount\n            &amp;&amp; $this-&gt;currency-&gt;equals($other-&gt;currency);\n    }\n}\n\n// src/Shared/Domain/ValueObject/Currency.php\nenum Currency: string\n{\n    case USD = 'USD';\n    case EUR = 'EUR';\n    case GBP = 'GBP';\n}\n</code></pre> <p>Used in Order and Invoice modules:</p> <pre><code>// Order module\nuse App\\Shared\\Domain\\ValueObject\\Money;\nuse App\\Shared\\Domain\\ValueObject\\Currency;\n\nfinal class Order\n{\n    private Money $total;\n\n    public function calculateTotal(): void\n    {\n        $this-&gt;total = new Money(0, Currency::USD);\n        foreach ($this-&gt;items as $item) {\n            $this-&gt;total = $this-&gt;total-&gt;add($item-&gt;getPrice());\n        }\n    }\n}\n\n// Invoice module\nuse App\\Shared\\Domain\\ValueObject\\Money;\n\nfinal class Invoice\n{\n    public function __construct(\n        private InvoiceId $id,\n        private Money $amount,     // \u2190 Shared Money\n        private Money $taxAmount   // \u2190 Shared Money\n    ) {}\n}\n</code></pre>"},{"location":"advanced/shared-kernel/#example-3-shared-uuid-value-object","title":"Example 3: Shared UUID Value Object","text":"<pre><code>&lt;?php\n// src/Shared/Domain/ValueObject/Uuid.php\n\nnamespace App\\Shared\\Domain\\ValueObject;\n\nuse Symfony\\Component\\Uid\\Uuid as SymfonyUuid;\n\nabstract readonly class Uuid\n{\n    protected function __construct(private string $value)\n    {\n        if (!SymfonyUuid::isValid($value)) {\n            throw new \\InvalidArgumentException(\"Invalid UUID: {$value}\");\n        }\n    }\n\n    public static function generate(): static\n    {\n        return new static(SymfonyUuid::v4()-&gt;toRfc4122());\n    }\n\n    public static function fromString(string $value): static\n    {\n        return new static($value);\n    }\n\n    public function getValue(): string\n    {\n        return $this-&gt;value;\n    }\n\n    public function equals(self $other): bool\n    {\n        return $this-&gt;value === $other-&gt;value;\n    }\n\n    public function __toString(): string\n    {\n        return $this-&gt;value;\n    }\n}\n</code></pre> <p>Each module extends it with their own typed ID:</p> <pre><code>// User module\nnamespace App\\User\\Account\\Domain\\ValueObject;\n\nuse App\\Shared\\Domain\\ValueObject\\Uuid;\n\nfinal readonly class UserId extends Uuid {}\n\n// Order module\nnamespace App\\Order\\Checkout\\Domain\\ValueObject;\n\nuse App\\Shared\\Domain\\ValueObject\\Uuid;\n\nfinal readonly class OrderId extends Uuid {}\n\n// Blog module\nnamespace App\\Blog\\Post\\Domain\\ValueObject;\n\nuse App\\Shared\\Domain\\ValueObject\\Uuid;\n\nfinal readonly class PostId extends Uuid {}\n</code></pre> <p>Why extend instead of direct use? - Type Safety - <code>UserId</code> \u2260 <code>OrderId</code> at compile time - Clarity - Intent is explicit in method signatures - Flexibility - Each module can add specific behavior later</p>"},{"location":"advanced/shared-kernel/#when-to-move-code-to-shared","title":"When to Move Code to Shared","text":""},{"location":"advanced/shared-kernel/#the-rule-of-three","title":"The \"Rule of Three\"","text":"<p>Wait until 3+ modules need it:</p> <pre><code>Module A needs Email \u2192 Keep in Module A\nModule B also needs Email \u2192 Duplicate or extract to Shared? \u2192 Wait\nModule C also needs Email \u2192 Now extract to Shared!\n</code></pre>"},{"location":"advanced/shared-kernel/#decision-checklist","title":"Decision Checklist","text":"<p>Ask these questions before moving code to Shared:</p> <ol> <li>Is it truly generic?</li> <li>Yes: <code>Email</code> - Same validation everywhere</li> <li> <p>No: <code>UserEmail</code> - Might have user-specific rules</p> </li> <li> <p>Does it have zero business logic?</p> </li> <li>Yes: <code>PhoneNumber</code> - Just format and validation</li> <li> <p>No: <code>CustomerDiscount</code> - Contains pricing rules</p> </li> <li> <p>Will all modules use it the same way?</p> </li> <li>Yes: <code>Uuid</code> - Identity concept is universal</li> <li> <p>No: <code>Status</code> - Each module has different status workflows</p> </li> <li> <p>Is it stable?</p> </li> <li>Yes: <code>Money</code> - Well-established pattern</li> <li>No: <code>Notification</code> - Still evolving per module needs</li> </ol> <p>If you answer \"Yes\" to all \u2192 Move to Shared If you answer \"No\" to any \u2192 Keep in module</p>"},{"location":"advanced/shared-kernel/#anti-patterns-to-avoid","title":"Anti-Patterns to Avoid","text":""},{"location":"advanced/shared-kernel/#shared-becoming-a-junk-drawer","title":"Shared Becoming a \"Junk Drawer\"","text":"<p>Bad: <pre><code>Shared/\n\u251c\u2500\u2500 Utils/\n\u2502   \u251c\u2500\u2500 StringHelper.php\n\u2502   \u251c\u2500\u2500 ArrayHelper.php\n\u2502   \u2514\u2500\u2500 MiscFunctions.php  \u2190 Avoid!\n</code></pre></p> <p>Good: <pre><code>Shared/\n\u251c\u2500\u2500 Domain/\n\u2502   \u2514\u2500\u2500 ValueObject/\n\u2502       \u251c\u2500\u2500 Email.php       \u2190 Clear purpose\n\u2502       \u2514\u2500\u2500 Money.php       \u2190 Clear purpose\n</code></pre></p>"},{"location":"advanced/shared-kernel/#premature-extraction","title":"Premature Extraction","text":"<p>Bad: <pre><code>// After first use in User module\n// \"This might be shared someday...\"\nmv User/ValueObject/Email.php Shared/ValueObject/Email.php  \u2190 Too early!\n</code></pre></p> <p>Good: <pre><code>// After 3rd module needs it\n// \"Now it's proven to be generic\"\nmv User/ValueObject/Email.php Shared/ValueObject/Email.php  \u2190 Right time!\n</code></pre></p>"},{"location":"advanced/shared-kernel/#business-logic-in-shared","title":"Business Logic in Shared","text":"<p>Bad: <pre><code>// Shared/Domain/ValueObject/Price.php\nfinal class Price\n{\n    public function applyDiscount(): self\n    {\n        // Discount logic belongs in Order or Product module!\n        if ($this-&gt;customer-&gt;isPremium()) {\n            return $this-&gt;multiply(0.9);\n        }\n    }\n}\n</code></pre></p> <p>Good: <pre><code>// Shared/Domain/ValueObject/Money.php\nfinal readonly class Money\n{\n    // Pure value object - no business rules\n    public function multiply(float $factor): self\n    {\n        return new self((int)($this-&gt;amount * $factor), $this-&gt;currency);\n    }\n}\n\n// Order/Domain/Service/PricingService.php\nfinal class PricingService\n{\n    // Business logic stays in module\n    public function applyDiscount(Money $price, Customer $customer): Money\n    {\n        if ($customer-&gt;isPremium()) {\n            return $price-&gt;multiply(0.9);\n        }\n        return $price;\n    }\n}\n</code></pre></p>"},{"location":"advanced/shared-kernel/#generating-shared-code","title":"Generating Shared Code","text":""},{"location":"advanced/shared-kernel/#generate-shared-value-objects","title":"Generate Shared Value Objects","text":"<pre><code># Generate in Shared namespace\nbin/console make:hexagonal:value-object shared Email\n</code></pre> <p>This creates: <pre><code>src/Shared/Domain/ValueObject/Email.php\n</code></pre></p>"},{"location":"advanced/shared-kernel/#generate-shared-exceptions","title":"Generate Shared Exceptions","text":"<pre><code>bin/console make:hexagonal:exception shared ValidationException\n</code></pre> <p>This creates: <pre><code>src/Shared/Domain/Exception/ValidationException.php\n</code></pre></p>"},{"location":"advanced/shared-kernel/#managing-shared-kernel-changes","title":"Managing Shared Kernel Changes","text":""},{"location":"advanced/shared-kernel/#coordination-is-key","title":"Coordination is Key","text":"<p>Changes to Shared affect all modules. Follow these rules:</p> <ol> <li>Backward Compatibility - Don't break existing modules</li> <li>Team Agreement - Discuss changes with all module owners</li> <li>Version Carefully - Consider Shared as an internal \"library\"</li> <li>Test Thoroughly - Changes impact multiple contexts</li> </ol>"},{"location":"advanced/shared-kernel/#safe-change-example","title":"Safe Change Example","text":"<p>Before: <pre><code>final readonly class Email\n{\n    public function getValue(): string\n    {\n        return $this-&gt;value;\n    }\n}\n</code></pre></p> <p>After (backward compatible): <pre><code>final readonly class Email\n{\n    public function getValue(): string\n    {\n        return $this-&gt;value;\n    }\n\n    // New method - doesn't break existing code\n    public function getDomain(): string\n    {\n        return explode('@', $this-&gt;value)[1];\n    }\n}\n</code></pre></p>"},{"location":"advanced/shared-kernel/#breaking-change-avoid","title":"Breaking Change (Avoid!)","text":"<p>Bad: <pre><code>final readonly class Email\n{\n    // Renamed - breaks all modules!\n    public function value(): string  // was getValue()\n    {\n        return $this-&gt;value;\n    }\n}\n</code></pre></p>"},{"location":"advanced/shared-kernel/#best-practices","title":"Best Practices","text":"<ol> <li>Keep it Small - Shared Kernel should be minimal</li> <li>Wait for Patterns - Don't prematurely extract</li> <li>No Business Logic - Only pure, generic concepts</li> <li>Document Well - Clear docs on what belongs in Shared</li> <li>Version Changes - Treat Shared as a contract</li> <li>Test Coverage - High test coverage for Shared code</li> </ol>"},{"location":"advanced/shared-kernel/#summary","title":"Summary","text":"<p>The Shared Kernel is for: - Generic value objects (Email, Money, UUID) - Common base exceptions - Infrastructure utilities - Concepts used by 3+ modules</p> <p>The Shared Kernel is NOT for: - Business logic specific to one context - Code used by only 1-2 modules - Unstable or evolving concepts - Context-specific variations</p> <p>Key principle: When in doubt, keep it in the module. Extract to Shared only when the need is proven and clear.</p>"},{"location":"advanced/templates/","title":"Custom Templates","text":"<p>Customize code generation templates to match your team's conventions.</p>"},{"location":"advanced/templates/#configuration","title":"Configuration","text":"<pre><code># config/packages/hexagonal_maker.yaml\nhexagonal_maker:\n    skeleton_dir: '%kernel.project_dir%/config/skeleton'\n</code></pre>"},{"location":"advanced/templates/#template-structure","title":"Template Structure","text":"<pre><code>config/skeleton/\n\u2514\u2500\u2500 src/Module/\n    \u251c\u2500\u2500 Domain/\n    \u2502   \u2514\u2500\u2500 Model/\n    \u2502       \u2514\u2500\u2500 Entity.tpl.php\n    \u251c\u2500\u2500 Application/\n    \u2502   \u2514\u2500\u2500 Command/\n    \u2502       \u2514\u2500\u2500 CommandHandler.tpl.php\n    \u2514\u2500\u2500 ...\n</code></pre>"},{"location":"advanced/templates/#example-custom-template","title":"Example Custom Template","text":"<pre><code>&lt;?= \"&lt;?php\\n\" ?&gt;\n\ndeclare(strict_types=1);\n\nnamespace &lt;?= $namespace ?&gt;;\n\n// Your custom headers, comments, etc.\n\nfinal class &lt;?= $class_name ?&gt;\n{\n    // Your custom template logic\n}\n</code></pre>"},{"location":"advanced/templates/#template-variables","title":"Template Variables","text":"<p>Available variables depend on the maker. Common ones:</p> <ul> <li><code>$namespace</code> - Full namespace</li> <li><code>$class_name</code> - Class name</li> <li><code>$module</code> - Module path</li> <li><code>$entity_name</code> - Entity name</li> </ul> <p>See default templates in <code>vendor/ahmed-bhs/hexagonal-maker-bundle/src/Resources/skeleton/</code></p>"},{"location":"contributing/","title":"Contributing","text":"<p>We welcome contributions to Hexagonal Maker Bundle!</p>"},{"location":"contributing/#how-to-contribute","title":"How to Contribute","text":"<ul> <li>Overview - Contribution guidelines</li> <li>Development - Development setup and workflow</li> </ul>"},{"location":"contributing/#ways-to-contribute","title":"Ways to Contribute","text":"<ol> <li>Report Bugs - Open an issue on GitHub</li> <li>Suggest Features - Share your ideas</li> <li>Submit Pull Requests - Fix bugs or add features</li> <li>Improve Documentation - Help make docs better</li> <li>Share Examples - Contribute real-world examples</li> </ol>"},{"location":"contributing/#getting-started","title":"Getting Started","text":"<p>Read the Contributing Overview to get started with contributing to the project.</p> <p>Thank you for helping make Hexagonal Maker Bundle better!</p>"},{"location":"contributing/development/","title":"Development Guide","text":"<p>Guide for developers contributing to Hexagonal Maker Bundle.</p>"},{"location":"contributing/development/#development-environment","title":"Development Environment","text":""},{"location":"contributing/development/#requirements","title":"Requirements","text":"<ul> <li>PHP 8.1+</li> <li>Composer</li> <li>Git</li> </ul>"},{"location":"contributing/development/#setup","title":"Setup","text":"<pre><code># Clone repository\ngit clone https://github.com/ahmed-bhs/hexagonal-maker-bundle\ncd hexagonal-maker-bundle\n\n# Install dependencies\ncomposer install\n</code></pre>"},{"location":"contributing/development/#running-tests","title":"Running Tests","text":"<pre><code># All tests\nvendor/bin/phpunit\n\n# With coverage\nXDEBUG_MODE=coverage vendor/bin/phpunit --coverage-html coverage\n\n# Specific test\nvendor/bin/phpunit tests/Unit/Maker/MakeEntityTest.php\n</code></pre>"},{"location":"contributing/development/#code-quality","title":"Code Quality","text":""},{"location":"contributing/development/#phpstan-static-analysis","title":"PHPStan (Static Analysis)","text":"<pre><code>vendor/bin/phpstan analyze\n\n# Level 8 (strictest)\nvendor/bin/phpstan analyze --level=8\n</code></pre>"},{"location":"contributing/development/#code-style","title":"Code Style","text":"<pre><code># Check PSR-12 compliance\nvendor/bin/php-cs-fixer fix --dry-run\n\n# Fix automatically\nvendor/bin/php-cs-fixer fix\n</code></pre>"},{"location":"contributing/development/#project-structure","title":"Project Structure","text":"<pre><code>src/\n\u251c\u2500\u2500 Maker/               # Maker command classes\n\u2502   \u251c\u2500\u2500 MakeEntity.php\n\u2502   \u251c\u2500\u2500 MakeCommand.php\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 Generator/           # Code generators\n\u251c\u2500\u2500 Template/            # File templates\n\u2514\u2500\u2500 HexagonalMakerBundle.php\n</code></pre>"},{"location":"contributing/development/#creating-a-new-maker","title":"Creating a New Maker","text":"<p>See full guide in repository documentation.</p>"},{"location":"contributing/development/#submitting-changes","title":"Submitting Changes","text":"<ol> <li>Create feature branch</li> <li>Make changes</li> <li>Add tests</li> <li>Run quality checks</li> <li>Submit PR</li> </ol> <p>For detailed instructions, see the main Contributing Guide.</p>"},{"location":"contributing/overview/","title":"Contributing","text":"<p>Thank you for considering contributing to Hexagonal Maker Bundle!</p>"},{"location":"contributing/overview/#ways-to-contribute","title":"Ways to Contribute","text":""},{"location":"contributing/overview/#report-bugs","title":"\ud83d\udc1b Report Bugs","text":"<p>Found a bug? Open an issue with: - Clear title and description - Steps to reproduce - Expected vs actual behavior - Symfony/PHP versions</p>"},{"location":"contributing/overview/#request-features","title":"\u2728 Request Features","text":"<p>Have an idea? Open a feature request describing: - The problem it solves - Proposed solution - Use cases</p>"},{"location":"contributing/overview/#improve-documentation","title":"\ud83d\udcdd Improve Documentation","text":"<p>Documentation PRs are always welcome: - Fix typos - Add examples - Clarify explanations - Translate to other languages</p>"},{"location":"contributing/overview/#submit-code","title":"\ud83d\udcbb Submit Code","text":"<ol> <li>Fork the repository</li> <li>Create a feature branch (<code>git checkout -b feature/amazing-feature</code>)</li> <li>Make your changes</li> <li>Add tests</li> <li>Commit (<code>git commit -m 'Add amazing feature'</code>)</li> <li>Push (<code>git push origin feature/amazing-feature</code>)</li> <li>Open a Pull Request</li> </ol>"},{"location":"contributing/overview/#development-setup","title":"Development Setup","text":"<pre><code># Clone your fork\ngit clone https://github.com/YOUR-USERNAME/hexagonal-maker-bundle\ncd hexagonal-maker-bundle\n\n# Install dependencies\ncomposer install\n\n# Run tests\nvendor/bin/phpunit\n\n# Run static analysis\nvendor/bin/phpstan analyze\n</code></pre>"},{"location":"contributing/overview/#code-standards","title":"Code Standards","text":"<ul> <li>PSR-12 code style</li> <li>PHPStan Level 8 (strict)</li> <li>Type hints everywhere</li> <li>Readonly classes when possible</li> <li>Comprehensive tests</li> </ul>"},{"location":"contributing/overview/#pull-request-guidelines","title":"Pull Request Guidelines","text":"<ul> <li>Keep PRs focused on single feature/fix</li> <li>Update documentation if needed</li> <li>Add tests for new features</li> <li>Ensure CI passes</li> <li>Follow existing code patterns</li> </ul>"},{"location":"contributing/overview/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the MIT License.</p>"},{"location":"contributing/overview/#questions","title":"Questions?","text":"<ul> <li>GitHub Discussions: Ask here</li> <li>Email: ahmedbhs123@gmail.com</li> </ul>"},{"location":"examples/","title":"Examples","text":"<p>Real-world examples and use cases for Hexagonal Maker Bundle.</p>"},{"location":"examples/#available-examples","title":"Available Examples","text":"<ul> <li>User Registration - Complete user module with authentication</li> <li>CRUD Module - Build a complete CRUD in one command</li> <li>Testing Guide - Testing strategies and examples</li> </ul>"},{"location":"examples/#what-youll-find","title":"What You'll Find","text":"<p>Each example includes: - Step-by-step instructions - Complete code samples - Architecture explanations - Best practices - Testing strategies</p> <p>Start with the User Registration example to see a complete module from scratch.</p>"},{"location":"examples/crud-module/","title":"Example: CRUD Module","text":"<p>Generate complete CRUD module with one command.</p>"},{"location":"examples/crud-module/#quick-crud-generation","title":"Quick CRUD Generation","text":"<pre><code>bin/console make:hexagonal:crud blog/post Post --with-tests --with-id-vo --route-prefix=/posts\n</code></pre> <p>This generates 30+ files:</p> <ul> <li>Entity + Repository + ID ValueObject</li> <li>5 Use Cases (Create, Update, Delete, Get, List)</li> <li>5 Controllers + Form</li> <li>All tests</li> </ul>"},{"location":"examples/crud-module/#generated-routes","title":"Generated Routes","text":"<ul> <li><code>GET /posts</code> - List all posts</li> <li><code>GET /posts/{id}</code> - Show single post</li> <li><code>GET /posts/new</code> - Create form</li> <li><code>POST /posts/new</code> - Submit new post</li> <li><code>GET /posts/{id}/edit</code> - Edit form</li> <li><code>POST /posts/{id}/edit</code> - Submit update</li> <li><code>DELETE /posts/{id}/delete</code> - Delete post</li> </ul>"},{"location":"examples/crud-module/#next-steps","title":"Next Steps","text":"<ol> <li>Complete Doctrine mapping</li> <li>Configure module in <code>doctrine.yaml</code></li> <li>Generate migrations</li> <li>Test your CRUD!</li> </ol> <p>See Quick Start for full tutorial.</p>"},{"location":"examples/testing/","title":"Testing Examples","text":"<p>Examples of testing hexagonal architecture with generated tests.</p>"},{"location":"examples/testing/#generate-tests","title":"Generate Tests","text":"<pre><code># With command\nbin/console make:hexagonal:command blog/post create --with-tests\n\n# Standalone\nbin/console make:hexagonal:use-case-test blog/post CreatePost\nbin/console make:hexagonal:controller-test blog/post CreatePost /posts/new\n</code></pre>"},{"location":"examples/testing/#unit-test-example","title":"Unit Test Example","text":"<pre><code>&lt;?php\n\nnamespace Tests\\Blog\\Post\\Application\\Create;\n\nuse PHPUnit\\Framework\\TestCase;\n\nfinal class CreatePostHandlerTest extends TestCase\n{\n    public function testCreatesPost(): void\n    {\n        $repository = $this-&gt;createMock(PostRepositoryInterface::class);\n        $repository-&gt;expects($this-&gt;once())-&gt;method('save');\n\n        $handler = new CreatePostHandler($repository);\n        $command = new CreatePostCommand('Title', 'Content');\n\n        $handler($command);\n    }\n}\n</code></pre>"},{"location":"examples/testing/#integration-test-example","title":"Integration Test Example","text":"<pre><code>&lt;?php\n\nnamespace Tests\\Blog\\Post\\Application\\Create;\n\nuse Symfony\\Bundle\\FrameworkBundle\\Test\\KernelTestCase;\n\nfinal class CreatePostIntegrationTest extends KernelTestCase\n{\n    public function testCreatesPostInDatabase(): void\n    {\n        self::bootKernel();\n\n        $commandBus = static::getContainer()-&gt;get(MessageBusInterface::class);\n        $command = new CreatePostCommand('Title', 'Content');\n\n        $commandBus-&gt;dispatch($command);\n\n        $repository = static::getContainer()-&gt;get(PostRepositoryInterface::class);\n        $posts = $repository-&gt;findAll();\n\n        $this-&gt;assertCount(1, $posts);\n    }\n}\n</code></pre>"},{"location":"examples/testing/#run-tests","title":"Run Tests","text":"<pre><code>vendor/bin/phpunit\n</code></pre> <p>See generated test files for complete examples.</p>"},{"location":"examples/user-registration/","title":"Example: User Registration Module","text":"<p>Complete example of building a User Registration module with hexagonal architecture.</p>"},{"location":"examples/user-registration/#overview","title":"Overview","text":"<p>We'll build a user registration system with: - Email validation - Password hashing - Duplicate email prevention - Email confirmation workflow</p>"},{"location":"examples/user-registration/#step-1-generate-structure","title":"Step 1: Generate Structure","text":"<pre><code># Domain\nbin/console make:hexagonal:entity user/account User --with-repository --with-id-vo\nbin/console make:hexagonal:value-object user/account Email\nbin/console make:hexagonal:exception user/account InvalidEmailException\nbin/console make:hexagonal:exception user/account UserAlreadyExistsException\n\n# Application\nbin/console make:hexagonal:command user/account register --factory --with-tests\nbin/console make:hexagonal:query user/account find-by-email\n\n# UI\nbin/console make:hexagonal:controller user/account RegisterUser /users/register --with-workflow\n</code></pre>"},{"location":"examples/user-registration/#step-2-complete-implementation","title":"Step 2: Complete Implementation","text":"<p>See full implementation in the Quick Start Guide.</p>"},{"location":"examples/user-registration/#complete-example","title":"Complete Example","text":"<p>For a fully working example with all code, see the repository examples directory.</p>"},{"location":"fr/","title":"Hexagonal Maker Bundle","text":"<p> Bundle Symfony Maker pour l'Architecture Hexagonale (Ports &amp; Adapters) </p> <p> </p> <p>   \u2728 19 commandes maker | \ud83d\udc8e Domaine Pur | \ud83c\udfaf Pattern CQRS | \ud83c\udfd7\ufe0f Couverture Compl\u00e8te </p>"},{"location":"fr/#pourquoi-larchitecture-hexagonale","title":"Pourquoi l'Architecture Hexagonale ?","text":"<p>L'architecture hexagonale (alias Ports &amp; Adapters) vous aide \u00e0 construire des applications maintenables et testables en :</p> <ul> <li>\ud83d\udc8e Isolation du Domaine - Logique m\u00e9tier ind\u00e9pendante des frameworks</li> <li>\ud83c\udfaf Contr\u00f4le des D\u00e9pendances - L'infrastructure d\u00e9pend du domaine, pas l'inverse</li> <li>\u26a1 Vitesse de Test - Tests unitaires 1000x plus rapides (pas de base de donn\u00e9es)</li> <li>\ud83d\udd04 Libert\u00e9 Technologique - Changez de base de donn\u00e9es, de framework sans toucher la logique m\u00e9tier</li> <li>\ud83d\udcb0 Co\u00fbt Pr\u00e9visible - Les fonctionnalit\u00e9s co\u00fbtent un temps constant, pas de taxe de dette technique</li> </ul> <p>Lire le guide complet \u2192</p>"},{"location":"fr/#demarrage-rapide-2-minutes","title":"\u26a1 D\u00e9marrage Rapide (2 minutes)","text":"<p>\u00c9tape 1 : Installation</p> <pre><code>composer require ahmed-bhs/hexagonal-maker-bundle --dev\n</code></pre> <p>\u00c9tape 2 : G\u00e9n\u00e9rez votre premier module</p> <pre><code># Cr\u00e9er un module d'enregistrement utilisateur\nbin/console make:hexagonal:entity user/account User\nbin/console make:hexagonal:repository user/account User\nbin/console make:hexagonal:command user/account register --factory\nbin/console make:hexagonal:controller user/account RegisterUser /users/register\n</code></pre> <p>\u00c9tape 3 : Configurez le mapping Doctrine</p> <pre><code># config/packages/doctrine.yaml\ndoctrine:\n    orm:\n        mappings:\n            UserAccount:\n                type: yml\n                dir: '%kernel.project_dir%/src/User/Account/Infrastructure/Persistence/Doctrine/Orm/Mapping'\n                prefix: 'App\\User\\Account\\Domain\\Model'\n</code></pre> <p>R\u00e9sultat : Module hexagonal complet avec domaine pur, commandes CQRS et contr\u00f4leurs web ! \ud83d\ude80</p> <p>Guide d'installation complet \u2192</p>"},{"location":"fr/#fonctionnalites","title":"Fonctionnalit\u00e9s","text":""},{"location":"fr/#19-commandes-maker","title":"19 Commandes Maker","text":"<p>G\u00e9n\u00e9rez une architecture hexagonale compl\u00e8te avec une seule commande :</p> Couche Maker Ce qu'il g\u00e9n\u00e8re Domaine <code>make:hexagonal:entity</code> Entit\u00e9s PHP pures + mapping YAML Domaine <code>make:hexagonal:value-object</code> Value objects immuables Domaine <code>make:hexagonal:exception</code> Exceptions m\u00e9tier Application <code>make:hexagonal:command</code> Commandes CQRS + handlers Application <code>make:hexagonal:query</code> Queries CQRS + handlers + r\u00e9ponses Application <code>make:hexagonal:repository</code> Port repository + adaptateur Doctrine UI <code>make:hexagonal:controller</code> Contr\u00f4leurs web UI <code>make:hexagonal:form</code> Formulaires Symfony UI <code>make:hexagonal:cli-command</code> Commandes console Tests <code>make:hexagonal:use-case-test</code> Tests de cas d'usage Rapide <code>make:hexagonal:crud</code> Module CRUD complet (20+ fichiers) <p>Voir les 19 commandes \u2192</p>"},{"location":"fr/#documentation","title":"Documentation","text":"Guide Description D\u00e9marrage Rapide Installez et g\u00e9n\u00e9rez votre premier module en 2 minutes Commandes Maker R\u00e9f\u00e9rence compl\u00e8te des 19 commandes maker Guide Architecture Plong\u00e9e profonde dans les patterns d'architecture hexagonale Pourquoi Hexagonal Business case et b\u00e9n\u00e9fices techniques Principes SOLID Comment l'architecture hexagonale applique SOLID Exemples Exemples r\u00e9els et cas d'usage"},{"location":"fr/#documentation-avancee-nouveaux-guides","title":"Documentation Avanc\u00e9e (Nouveaux Guides) \ud83c\udd95","text":"<p>Ces guides approfondis couvrent les aspects critiques de l'architecture hexagonale :</p> Guide Description Domain vs Application Logic Guide de d\u00e9cision : o\u00f9 placer votre logique m\u00e9tier Request-Response Flow Flux complet end-to-end avec diagrammes Port Design Principles Comment concevoir des interfaces de ports efficaces Primary vs Secondary Adapters Comprendre les deux c\u00f4t\u00e9s de l'hexagone CQRS: Cost-Benefit Analysis Quand utiliser CQRS (et quand l'\u00e9viter) Dependency Injection Guide Configuration Symfony compl\u00e8te Factory Pattern Guide Impl\u00e9mentation compl\u00e8te des factories Error Handling Strategy Gestion des exceptions et des erreurs Anti-Patterns &amp; Pitfalls \u00c9viter les erreurs courantes"},{"location":"fr/#exemple-module-utilisateur-complet","title":"Exemple : Module Utilisateur Complet","text":""},{"location":"fr/#etape-1-domaine","title":"\u00c9tape 1 : Domaine","text":"<p>G\u00e9n\u00e9rer les entit\u00e9s de domaine pures</p> <pre><code>bin/console make:hexagonal:entity user/account User\nbin/console make:hexagonal:value-object user/account Email\nbin/console make:hexagonal:exception user/account InvalidEmailException\n</code></pre> <p>G\u00e9n\u00e9r\u00e9 : - <code>Domain/Model/User.php</code> (PHP pur) - <code>Domain/ValueObject/Email.php</code> - <code>Domain/Exception/InvalidEmailException.php</code></p>"},{"location":"fr/#etape-2-application","title":"\u00c9tape 2 : Application","text":"<p>G\u00e9n\u00e9rer les cas d'usage et commandes</p> <pre><code>bin/console make:hexagonal:repository user/account User\nbin/console make:hexagonal:command user/account register --factory\nbin/console make:hexagonal:query user/account find-by-id\n</code></pre> <p>G\u00e9n\u00e9r\u00e9 : - <code>Domain/Port/UserRepositoryInterface.php</code> - <code>Application/Register/RegisterCommand.php</code> - <code>Application/Register/RegisterCommandHandler.php</code> - <code>Application/FindById/FindByIdQuery.php</code></p>"},{"location":"fr/#etape-3-infrastructure","title":"\u00c9tape 3 : Infrastructure","text":"<p>Adaptateurs auto-g\u00e9n\u00e9r\u00e9s</p> <pre><code># D\u00e9j\u00e0 g\u00e9n\u00e9r\u00e9s avec la commande repository !\n</code></pre> <p>G\u00e9n\u00e9r\u00e9 : - <code>Infrastructure/Persistence/Doctrine/DoctrineUserRepository.php</code> - <code>Infrastructure/Persistence/Doctrine/Orm/Mapping/User.orm.yml</code></p>"},{"location":"fr/#etape-4-ui","title":"\u00c9tape 4 : UI","text":"<p>G\u00e9n\u00e9rer contr\u00f4leurs et formulaires</p> <pre><code>bin/console make:hexagonal:controller user/account RegisterUser /users/register\nbin/console make:hexagonal:form user/account User\n</code></pre> <p>G\u00e9n\u00e9r\u00e9 : - <code>UI/Http/Web/Controller/RegisterUserController.php</code> - <code>UI/Http/Web/Form/UserType.php</code></p>"},{"location":"fr/#couches-darchitecture","title":"Couches d'Architecture","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph TB\n    subgraph UI[\"\ud83c\udfae COUCHE UI\"]\n        HTTP[\"Contr\u00f4leurs HTTP\"]\n        CLI[\"Commandes CLI\"]\n    end\n\n    subgraph APP[\"\u2699\ufe0f COUCHE APPLICATION\"]\n        Commands[\"Commandes &amp; Queries\"]\n    end\n\n    subgraph DOMAIN[\"\ud83d\udc8e COUCHE DOMAINE\"]\n        Entities[\"Entit\u00e9s &amp; Value Objects\"]\n        Ports[\"Ports (Interfaces)\"]\n    end\n\n    subgraph INFRA[\"\ud83d\udd0c COUCHE INFRASTRUCTURE\"]\n        Adapters[\"Adaptateurs (Impl\u00e9mentations)\"]\n    end\n\n    UI ==&gt;|utilise| APP\n    APP ==&gt;|d\u00e9pend de| DOMAIN\n    INFRA -.-&gt;|impl\u00e9mente| Ports\n\n    style DOMAIN fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px\n    style APP fill:#B3E5FC,stroke:#0277BD,stroke-width:3px\n    style INFRA fill:#F8BBD0,stroke:#C2185B,stroke-width:3px\n    style UI fill:#E1BEE7,stroke:#6A1B9A,stroke-width:3px</code></pre> <p>R\u00e8gle de D\u00e9pendance : Toutes les d\u00e9pendances pointent vers l'int\u00e9rieur. Le domaine n'a aucune d\u00e9pendance.</p> <p>Guide d'architecture \u2192</p>"},{"location":"fr/#crud-en-1-commande","title":"CRUD en 1 Commande \u26a1","text":"<p>G\u00e9n\u00e9rez un module CRUD complet avec toutes les couches :</p> <pre><code>bin/console make:hexagonal:crud blog/post Post --with-tests --with-id-vo\n</code></pre> <p>G\u00e9n\u00e9r\u00e9 (30+ fichiers) : - Entit\u00e9 + ValueObjects + Repository - 5 Cas d'Usage (Create, Update, Delete, Get, List) - 5 Contr\u00f4leurs + Formulaire - Tous les tests (Cas d'Usage + Contr\u00f4leur) - Mapping YAML Doctrine</p> <p>Exemples CRUD \u2192</p>"},{"location":"fr/#architecture-layers","title":"Architecture Layers","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph TB\n    subgraph UI[\"\ud83c\udfae COUCHE UI\"]\n        HTTP[\"Contr\u00f4leurs HTTP\"]\n        CLI[\"Commandes CLI\"]\n    end\n\n    subgraph APP[\"\u2699\ufe0f COUCHE APPLICATION\"]\n        Commands[\"Commandes &amp; Queries\"]\n    end\n\n    subgraph DOMAIN[\"\ud83d\udc8e COUCHE DOMAINE\"]\n        Entities[\"Entit\u00e9s &amp; Value Objects\"]\n        Ports[\"Ports (Interfaces)\"]\n    end\n\n    subgraph INFRA[\"\ud83d\udd0c COUCHE INFRASTRUCTURE\"]\n        Adapters[\"Adaptateurs (Impl\u00e9mentations)\"]\n    end\n\n    UI ==&gt;|utilise| APP\n    APP ==&gt;|d\u00e9pend de| DOMAIN\n    INFRA -.-&gt;|impl\u00e9mente| Ports\n\n    style DOMAIN fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px\n    style APP fill:#B3E5FC,stroke:#0277BD,stroke-width:3px\n    style INFRA fill:#F8BBD0,stroke:#C2185B,stroke-width:3px\n    style UI fill:#E1BEE7,stroke:#6A1B9A,stroke-width:3px</code></pre> <p>R\u00e8gle de D\u00e9pendance : Toutes les d\u00e9pendances pointent vers l'int\u00e9rieur. Le domaine n'a aucune d\u00e9pendance.</p>"},{"location":"fr/#prerequis","title":"Pr\u00e9requis","text":"<ul> <li>PHP 8.1+</li> <li>Symfony 6.4+ ou 7.x</li> <li>Composer</li> </ul>"},{"location":"fr/#contribution","title":"Contribution","text":"<p>Nous accueillons les contributions ! Voir notre Guide de Contribution.</p>"},{"location":"fr/#licence","title":"Licence","text":"<p>Licence MIT - voir LICENSE pour les d\u00e9tails.</p> <p>Cr\u00e9\u00e9 par Ahmed EBEN HASSINE</p> <p> </p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/","title":"Guide de Contribution - Traductions","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#objectif","title":"\ud83c\udfaf Objectif","text":"<p>Aider la communaut\u00e9 francophone \u00e0 contribuer aux traductions de la documentation du Hexagonal Maker Bundle.</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#etat-actuel-des-traductions","title":"\ud83d\udcca \u00c9tat Actuel des Traductions","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#completement-traduit","title":"\u2705 Compl\u00e8tement Traduit","text":"<ul> <li>Page d'accueil (<code>index.md</code> \u2194 <code>fr/index.md</code>)</li> </ul>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#partiellement-traduit","title":"\ud83d\udd04 Partiellement Traduit","text":"<ul> <li>Guide Architecture (<code>ARCHITECTURE.md</code> - version fran\u00e7aise existe)</li> </ul>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#a-traduire-priorite-haute","title":"\u274c \u00c0 Traduire (Priorit\u00e9 Haute)","text":"<p>Les 9 nouveaux guides avanc\u00e9s cr\u00e9\u00e9s sont en anglais et n\u00e9cessitent une traduction :</p> <ol> <li>Domain vs Application Logic (<code>advanced/domain-vs-application.md</code>)</li> <li>Guide de d\u00e9cision crucial pour les d\u00e9veloppeurs</li> <li>~26 KB de contenu</li> <li> <p>Contient des flowcharts et exemples de code</p> </li> <li> <p>Request-Response Flow (<code>advanced/request-response-flow.md</code>)</p> </li> <li>Flux complet end-to-end avec diagrammes</li> <li>~24 KB de contenu</li> <li> <p>Diagrammes Mermaid s\u00e9quentiels</p> </li> <li> <p>Port Design Principles (<code>advanced/port-design-principles.md</code>)</p> </li> <li>Principes de conception des interfaces</li> <li>~21 KB de contenu</li> <li> <p>Exemples comparatifs \u2705/\u274c</p> </li> <li> <p>Primary vs Secondary Adapters (<code>advanced/primary-secondary-adapters.md</code>)</p> </li> <li>Les deux c\u00f4t\u00e9s de l'hexagone</li> <li>~22 KB de contenu</li> <li> <p>Diagrammes d'architecture</p> </li> <li> <p>CQRS: Cost-Benefit Analysis (<code>advanced/cqrs-cost-benefit.md</code>)</p> </li> <li>Analyse co\u00fbts/b\u00e9n\u00e9fices CQRS</li> <li>~26 KB de contenu</li> <li> <p>Flowchart de d\u00e9cision</p> </li> <li> <p>Dependency Injection Guide (<code>advanced/dependency-injection-guide.md</code>)</p> </li> <li>Configuration Symfony compl\u00e8te</li> <li>~25 KB de contenu</li> <li> <p>Exemples de configuration YAML</p> </li> <li> <p>Factory Pattern Guide (<code>advanced/factory-pattern-guide.md</code>)</p> </li> <li>Impl\u00e9mentation compl\u00e8te des factories</li> <li>~27 KB de contenu</li> <li> <p>Patterns multiples avec exemples</p> </li> <li> <p>Error Handling Strategy (<code>advanced/error-handling-strategy.md</code>)</p> </li> <li>Gestion des exceptions</li> <li>~24 KB de contenu</li> <li> <p>Hi\u00e9rarchie d'exceptions</p> </li> <li> <p>Anti-Patterns &amp; Pitfalls (<code>advanced/anti-patterns-pitfalls.md</code>)</p> </li> <li>Erreurs courantes \u00e0 \u00e9viter</li> <li>~25 KB de contenu</li> <li>Comparaisons \u274c mauvais vs \u2705 bon</li> </ol> <p>Total \u00e0 traduire : ~220 KB de documentation technique</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#comment-contribuer","title":"\ud83d\ude80 Comment Contribuer","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#etape-1-choisir-un-document","title":"\u00c9tape 1 : Choisir un Document","text":"<p>Consultez la liste ci-dessus et choisissez un document \u00e0 traduire. Les guides sont ind\u00e9pendants, vous pouvez en choisir un seul.</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#etape-2-forker-le-depot","title":"\u00c9tape 2 : Forker le D\u00e9p\u00f4t","text":"<pre><code># Fork sur GitHub, puis clone\ngit clone https://github.com/VOTRE-USERNAME/hexagonal-maker-bundle.git\ncd hexagonal-maker-bundle\ngit checkout -b traduction-domain-vs-application\n</code></pre>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#etape-3-creer-la-structure","title":"\u00c9tape 3 : Cr\u00e9er la Structure","text":"<pre><code># Cr\u00e9er le dossier si n\u00e9cessaire\nmkdir -p docs/fr/advanced\n\n# Copier le fichier source\ncp docs/advanced/domain-vs-application.md docs/fr/advanced/domain-vs-application.md\n</code></pre>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#etape-4-traduire-le-contenu","title":"\u00c9tape 4 : Traduire le Contenu","text":"<p>Ouvrez <code>docs/fr/advanced/domain-vs-application.md</code> et commencez la traduction.</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#front-matter-en-tete-yaml","title":"Front Matter (En-t\u00eate YAML)","text":"<pre><code>---\nlayout: default_with_lang\ntitle: Domain vs Application Logic  # \u2190 Traduire le titre\nparent: Sujets Avanc\u00e9s             # \u2190 Traduire \"Advanced Topics\"\nnav_order: 10\nlang: fr                            # \u2190 Changer 'en' en 'fr'\nlang_ref: advanced/domain-vs-application.md  # \u2190 Chemin vers version anglaise\n---\n</code></pre>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#contenu-markdown","title":"Contenu Markdown","text":"<p>\u00c0 traduire : - Titres et sous-titres - Paragraphes explicatifs - Commentaires dans les exemples de code - L\u00e9gendes des diagrammes - Tableaux et listes</p> <p>\u00c0 NE PAS traduire : - Noms de variables et fonctions dans le code - Mots-cl\u00e9s du langage (class, public, function, etc.) - URLs et chemins de fichiers - Noms de classes PHP - Diagrammes Mermaid (sauf labels/textes)</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#regles-de-traduction","title":"\ud83d\udcdd R\u00e8gles de Traduction","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#1-terminologie-technique","title":"1. Terminologie Technique","text":"<p>Utilisez ces traductions coh\u00e9rentes :</p> English Fran\u00e7ais Port Port (garder en anglais dans contexte technique) Adapter Adaptateur Domain Domaine Application Layer Couche Application Infrastructure Infrastructure Handler Handler (garder en anglais) Repository Repository (ou D\u00e9p\u00f4t) Value Object Value Object (ou Objet-Valeur) Entity Entit\u00e9 Use Case Cas d'Usage Command Commande Query Requ\u00eate (ou Query en contexte CQRS) Factory Fabrique (ou Factory) Dependency Injection Injection de D\u00e9pendances"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#2-termes-a-garder-en-anglais","title":"2. Termes \u00e0 Garder en Anglais","text":"<p>Certains termes sont mieux reconnus en anglais :</p> <ul> <li>CQRS (Command Query Responsibility Segregation)</li> <li>SOLID (principes)</li> <li>Design Patterns (ou Patterns de Conception)</li> <li>Hexagonal Architecture</li> <li>Ports &amp; Adapters</li> <li>DTO (Data Transfer Object)</li> </ul>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#3-code-et-exemples","title":"3. Code et Exemples","text":"<p>\u2705 BIEN :</p> <pre><code>// \u2705 BON : La logique m\u00e9tier dans l'entit\u00e9\nclass Order\n{\n    public function ship(): void\n    {\n        if ($this-&gt;status === OrderStatus::CANCELLED) {\n            throw new CannotShipCancelledOrderException();\n        }\n\n        $this-&gt;status = OrderStatus::SHIPPED;\n    }\n}\n</code></pre> <p>Notez : - Commentaire traduit : \"BON : La logique m\u00e9tier dans l'entit\u00e9\" - Code non traduit : <code>class Order</code>, <code>ship()</code>, etc.</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#4-titres-de-sections","title":"4. Titres de Sections","text":"<p>Traduisez les titres mais gardez la structure :</p> <p>Anglais : <pre><code>## The Problem: Anemic Domain Model\n</code></pre></p> <p>Fran\u00e7ais : <pre><code>## Le Probl\u00e8me : Mod\u00e8le de Domaine An\u00e9mique\n</code></pre></p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#5-diagrammes-mermaid","title":"5. Diagrammes Mermaid","text":"<p>Traduisez uniquement les labels/textes :</p> <p>Anglais : <pre><code>graph TD\n    Start[Logic to implement] --&gt; Q1{Is it a business rule?}\n    Q1 --&gt;|Yes| Domain[DOMAIN LAYER]\n    Q1 --&gt;|No| Application[APPLICATION LAYER]</code></pre></p> <p>Fran\u00e7ais : <pre><code>graph TD\n    Start[Logique \u00e0 impl\u00e9menter] --&gt; Q1{Est-ce une r\u00e8gle m\u00e9tier ?}\n    Q1 --&gt;|Oui| Domain[COUCHE DOMAINE]\n    Q1 --&gt;|Non| Application[COUCHE APPLICATION]</code></pre></p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#6-tableaux","title":"6. Tableaux","text":"<p>Traduisez les en-t\u00eates et le contenu :</p> <p>Anglais : <pre><code>| Question | Domain | Application |\n|----------|--------|-------------|\n| Is it a business rule? | \u2705 | \u274c |\n</code></pre></p> <p>Fran\u00e7ais : <pre><code>| Question | Domaine | Application |\n|----------|---------|-------------|\n| Est-ce une r\u00e8gle m\u00e9tier ? | \u2705 | \u274c |\n</code></pre></p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#style-et-ton","title":"\ud83c\udfa8 Style et Ton","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#ton-general","title":"Ton G\u00e9n\u00e9ral","text":"<ul> <li>Formel mais accessible : Utilisez \"vous\" (tutoiement possible si coh\u00e9rent avec le reste)</li> <li>Technique mais clair : Expliquez les concepts complexes simplement</li> <li>Didactique : La documentation est p\u00e9dagogique, gardez cet esprit</li> </ul>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#exemples-de-style","title":"Exemples de Style","text":"<p>Anglais :</p> <p>\"If you need to validate input, use value objects.\"</p> <p>\u274c Mauvaise traduction :</p> <p>\"Si tu as besoin de valider l'input, utilise des value objects.\"</p> <p>\u2705 Bonne traduction :</p> <p>\"Si vous devez valider les donn\u00e9es d'entr\u00e9e, utilisez des value objects.\"</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#tester-votre-traduction","title":"\ud83e\uddea Tester Votre Traduction","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#1-installation-locale-de-jekyll","title":"1. Installation Locale de Jekyll","text":"<pre><code>cd docs\nbundle install\n</code></pre>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#2-lancer-le-serveur-local","title":"2. Lancer le Serveur Local","text":"<pre><code>bundle exec jekyll serve\n</code></pre>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#3-verifier","title":"3. V\u00e9rifier","text":"<ul> <li>Ouvrez http://localhost:4000</li> <li>Naviguez vers votre page traduite</li> <li>V\u00e9rifiez le language switcher (\ud83c\uddec\ud83c\udde7 \u2194 \ud83c\uddeb\ud83c\uddf7)</li> <li>Testez les liens internes</li> <li>V\u00e9rifiez le rendu des diagrammes Mermaid</li> </ul>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#4-checklist-de-validation","title":"4. Checklist de Validation","text":"<ul> <li> Front matter correct (lang: fr)</li> <li> Titre traduit</li> <li> Navigation fonctionne</li> <li> Language switcher fonctionne</li> <li> Liens internes corrects</li> <li> Diagrammes s'affichent correctement</li> <li> Code s'affiche avec coloration syntaxique</li> <li> Tableaux bien format\u00e9s</li> <li> Pas de fautes d'orthographe/grammaire</li> </ul>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#soumettre-votre-traduction","title":"\ud83d\udce4 Soumettre Votre Traduction","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#1-commit-et-push","title":"1. Commit et Push","text":"<pre><code>git add docs/fr/advanced/domain-vs-application.md\ngit commit -m \"feat(docs): add French translation for Domain vs Application Logic\"\ngit push origin traduction-domain-vs-application\n</code></pre>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#2-creer-une-pull-request","title":"2. Cr\u00e9er une Pull Request","text":"<ul> <li>Allez sur GitHub</li> <li>Cliquez sur \"New Pull Request\"</li> <li>Titre : <code>docs(fr): traduction Domain vs Application Logic</code></li> <li>Description :   <pre><code>## Description\nTraduction fran\u00e7aise du guide \"Domain vs Application Logic\"\n\n## Checklist\n- [x] Front matter correct\n- [x] Contenu traduit\n- [x] Diagrammes traduits\n- [x] Test\u00e9 localement\n- [x] Liens fonctionnels\n</code></pre></li> </ul>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#3-review","title":"3. Review","text":"<p>Le mainteneur reviewera votre traduction et pourra demander des ajustements.</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#priorites-de-traduction","title":"\ud83c\udfaf Priorit\u00e9s de Traduction","text":"<p>Si vous ne savez pas par o\u00f9 commencer, voici l'ordre de priorit\u00e9 sugg\u00e9r\u00e9 :</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#priorite-haute","title":"\ud83d\udd25 Priorit\u00e9 Haute","text":"<ol> <li>Domain vs Application Logic - Le guide le plus important pour les d\u00e9butants</li> <li>Anti-Patterns &amp; Pitfalls - \u00c9viter les erreurs courantes</li> <li>Request-Response Flow - Comprendre le flux complet</li> </ol>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#priorite-moyenne","title":"\u26a1 Priorit\u00e9 Moyenne","text":"<ol> <li>Port Design Principles - Conception des interfaces</li> <li>Primary vs Secondary Adapters - Les deux c\u00f4t\u00e9s de l'hexagone</li> <li>Error Handling Strategy - Gestion des erreurs</li> </ol>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#priorite-basse","title":"\ud83d\udca1 Priorit\u00e9 Basse","text":"<ol> <li>CQRS: Cost-Benefit Analysis - Concept avanc\u00e9</li> <li>Dependency Injection Guide - Configuration technique</li> <li>Factory Pattern Guide - Pattern sp\u00e9cifique</li> </ol>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#besoin-daide","title":"\ud83e\udd1d Besoin d'Aide ?","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#questions","title":"Questions","text":"<p>Si vous avez des questions sur : - La terminologie \u00e0 utiliser - L'ambigu\u00eft\u00e9 d'un terme - La meilleure fa\u00e7on de traduire un concept</p> <p>Cr\u00e9ez une issue sur GitHub avec le label <code>traduction</code> : - Titre : <code>[Traduction] Question sur terme \"X\"</code> - D\u00e9crivez votre question avec contexte</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#glossaire-collaboratif","title":"Glossaire Collaboratif","text":"<p>Un glossaire FR/EN est maintenu dans : <code>docs/fr/GLOSSAIRE.md</code></p> <p>Consultez-le avant de traduire et contribuez-y si vous trouvez de nouveaux termes.</p>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#suivi-de-progression","title":"\ud83d\udcca Suivi de Progression","text":""},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#tableau-de-bord","title":"Tableau de Bord","text":"Guide Taille Traducteur Statut PR Domain vs Application 26 KB - \u274c \u00c0 faire - Request-Response Flow 24 KB - \u274c \u00c0 faire - Port Design Principles 21 KB - \u274c \u00c0 faire - Primary vs Secondary 22 KB - \u274c \u00c0 faire - CQRS Cost-Benefit 26 KB - \u274c \u00c0 faire - Dependency Injection 25 KB - \u274c \u00c0 faire - Factory Pattern 27 KB - \u274c \u00c0 faire - Error Handling 24 KB - \u274c \u00c0 faire - Anti-Patterns 25 KB - \u274c \u00c0 faire -"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#legende","title":"L\u00e9gende","text":"<ul> <li>\u274c \u00c0 faire - Pas encore commenc\u00e9</li> <li>\ud83d\udd04 En cours - Traduction en cours</li> <li>\u2705 Termin\u00e9 - Traduit et merg\u00e9</li> <li>\ud83d\udd0d Review - En attente de review</li> </ul>"},{"location":"fr/GUIDE_CONTRIBUTION_TRADUCTION/#remerciements","title":"\ud83c\udf1f Remerciements","text":"<p>Merci \u00e0 tous les contributeurs qui aident \u00e0 rendre cette documentation accessible \u00e0 la communaut\u00e9 francophone !</p> <p>Votre nom sera ajout\u00e9 dans : - Le fichier <code>CONTRIBUTORS.md</code> - La section \"Contributeurs\" de la documentation - Les release notes</p> <p>Questions ? Ouvrez une issue avec le label <code>question</code> ou contactez @ahmed-bhs</p> <p>Pr\u00eat \u00e0 contribuer ? Choisissez un guide dans la liste ci-dessus et lancez-vous ! \ud83d\ude80</p>"},{"location":"fr/advanced/adaptateurs-primary-secondary/","title":"Adaptateurs Primary vs Secondary : Les Deux C\u00f4t\u00e9s de l'Hexagone","text":""},{"location":"fr/advanced/adaptateurs-primary-secondary/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>L'Hexagone a Deux C\u00f4t\u00e9s</li> <li>Adaptateurs Primary (Driving/Gauche)</li> <li>Adaptateurs Secondary (Driven/Droite)</li> <li>Diff\u00e9rences Cl\u00e9s</li> <li>Direction des D\u00e9pendances</li> <li>Exemples Concrets</li> <li>Strat\u00e9gie de Test</li> <li>Patterns Courants</li> </ol>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#lhexagone-a-deux-cotes","title":"L'Hexagone a Deux C\u00f4t\u00e9s","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph LR\n    subgraph Primary[\"\ud83d\udd35 ADAPTATEURS PRIMARY (Driving/Gauche)\"]\n        REST[\"API REST&lt;br/&gt;Contr\u00f4leur\"]\n        CLI[\"CLI&lt;br/&gt;Commande\"]\n        GraphQL[\"GraphQL&lt;br/&gt;Resolver\"]\n        UI[\"UI Web&lt;br/&gt;Formulaire\"]\n    end\n\n    subgraph Core[\"\ud83d\udc8e DOMAINE (Noyau Hexagone)\"]\n        App[\"Application&lt;br/&gt;Handlers\"]\n        Domain[\"Domaine&lt;br/&gt;Entit\u00e9s\"]\n        Ports[\"Ports&lt;br/&gt;Interfaces\"]\n    end\n\n    subgraph Secondary[\"\ud83d\udfe2 ADAPTATEURS SECONDARY (Driven/Droite)\"]\n        DB[\"Base de Donn\u00e9es&lt;br/&gt;Doctrine\"]\n        Email[\"Email&lt;br/&gt;SMTP\"]\n        Queue[\"File Messages&lt;br/&gt;RabbitMQ\"]\n        Storage[\"Stockage Fichiers&lt;br/&gt;S3\"]\n    end\n\n    REST --&gt;|\"pilote\"| App\n    CLI --&gt;|\"pilote\"| App\n    GraphQL --&gt;|\"pilote\"| App\n    UI --&gt;|\"pilote\"| App\n\n    App --&gt;|\"utilise (via Port)\"| Ports\n    Ports -.-&gt;|\"impl\u00e9ment\u00e9 par\"| DB\n    Ports -.-&gt;|\"impl\u00e9ment\u00e9 par\"| Email\n    Ports -.-&gt;|\"impl\u00e9ment\u00e9 par\"| Queue\n    Ports -.-&gt;|\"impl\u00e9ment\u00e9 par\"| Storage\n\n    style Primary fill:#BBDEFB,stroke:#1976D2,stroke-width:3px\n    style Core fill:#C8E6C9,stroke:#388E3C,stroke-width:4px\n    style Secondary fill:#FFF9C4,stroke:#F57F17,stroke-width:3px</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#adaptateurs-primary-drivinggauche","title":"Adaptateurs Primary (Driving/Gauche)","text":""},{"location":"fr/advanced/adaptateurs-primary-secondary/#que-sont-les-adaptateurs-primary","title":"Que Sont les Adaptateurs Primary ?","text":"<p>Les adaptateurs primary PILOTENT l'application. Ils initient les interactions avec votre logique m\u00e9tier.</p> <p>\"Je veux faire quelque chose\" \u2192 Adaptateur Primary \u2192 Application</p>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#caracteristiques","title":"Caract\u00e9ristiques","text":"<ul> <li>Initient les requ\u00eates vers l'application</li> <li>D\u00e9pendent DU domaine (connaissent les handlers, commandes)</li> <li>Convertissent entr\u00e9e externe en commandes application</li> <li>Situ\u00e9s du C\u00d4T\u00c9 GAUCHE de l'hexagone (c\u00f4t\u00e9 driving)</li> <li>Exemples : Contr\u00f4leurs, commandes CLI, resolvers GraphQL, event listeners</li> </ul>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#responsabilite-transformation-dentree","title":"Responsabilit\u00e9 : Transformation d'Entr\u00e9e","text":"<p>Les adaptateurs primary transforment format externe \u2192 format application.</p> <pre><code>JSON HTTP \u2192 DTO Request \u2192 Command \u2192 Handler\nArguments CLI \u2192 Command \u2192 Handler\nQuery GraphQL \u2192 Command \u2192 Handler\n</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#exemple-1-controleur-api-rest-adaptateur-primary","title":"Exemple 1 : Contr\u00f4leur API REST (Adaptateur Primary)","text":"<pre><code>namespace App\\User\\Infrastructure\\Controller;\n\nuse App\\User\\Application\\Command\\RegisterUserCommand;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\Messenger\\MessageBusInterface;\n\n#[Route('/api/users', methods: ['POST'])]\nfinal readonly class RegisterUserController\n{\n    public function __construct(\n        private MessageBusInterface $messageBus,\n        private SerializerInterface $serializer,\n    ) {}\n\n    public function __invoke(Request $request): JsonResponse\n    {\n        // 1. D\u00e9s\u00e9rialiser JSON HTTP \u2192 DTO\n        $dto = $this-&gt;serializer-&gt;deserialize(\n            $request-&gt;getContent(),\n            RegisterUserRequest::class,\n            'json'\n        );\n\n        // 2. Transformer DTO \u2192 Command (Application)\n        $command = new RegisterUserCommand(\n            email: $dto-&gt;email,\n            password: $dto-&gt;password\n        );\n\n        // 3. PILOTER l'application en dispatchant la commande\n        $this-&gt;messageBus-&gt;dispatch($command);\n\n        // 4. Transformer r\u00e9sultat \u2192 JSON HTTP\n        return new JsonResponse(['status' =&gt; 'created'], 201);\n    }\n}\n</code></pre> <p>Points Cl\u00e9s : - Initie l'interaction (utilisateur fait requ\u00eate HTTP) - D\u00e9pend de la couche Application (importe <code>RegisterUserCommand</code>) - Conna\u00eet HTTP, JSON, Symfony Request/Response - Pilote l'application en appelant <code>messageBus-&gt;dispatch()</code></p>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#exemple-2-commande-cli-adaptateur-primary","title":"Exemple 2 : Commande CLI (Adaptateur Primary)","text":"<pre><code>namespace App\\User\\Infrastructure\\Console;\n\nuse App\\User\\Application\\Command\\ImportUsersCommand;\nuse Symfony\\Component\\Console\\Command\\Command;\n\nfinal class ImportUsersCliCommand extends Command\n{\n    protected static $defaultName = 'app:import-users';\n\n    public function __construct(\n        private MessageBusInterface $messageBus,\n    ) {\n        parent::__construct();\n    }\n\n    protected function execute(InputInterface $input, OutputInterface $output): int\n    {\n        $filePath = $input-&gt;getArgument('file');\n        $users = $this-&gt;parseCSV($filePath);\n\n        // PILOTER l'application pour chaque utilisateur\n        foreach ($users as $userData) {\n            $command = new ImportUsersCommand(\n                email: $userData['email'],\n                name: $userData['name']\n            );\n\n            $this-&gt;messageBus-&gt;dispatch($command);\n        }\n\n        $output-&gt;writeln('Utilisateurs import\u00e9s avec succ\u00e8s');\n        return Command::SUCCESS;\n    }\n}\n</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#adaptateurs-secondary-drivendroite","title":"Adaptateurs Secondary (Driven/Droite)","text":""},{"location":"fr/advanced/adaptateurs-primary-secondary/#que-sont-les-adaptateurs-secondary","title":"Que Sont les Adaptateurs Secondary ?","text":"<p>Les adaptateurs secondary sont PILOT\u00c9S par l'application. L'application leur dit quoi faire.</p> <p>Application \u2192 \"J'ai besoin de sauvegarder ceci\" \u2192 Adaptateur Secondary \u2192 Base de Donn\u00e9es</p>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#caracteristiques_1","title":"Caract\u00e9ristiques","text":"<ul> <li>R\u00e9pondent aux requ\u00eates de l'application</li> <li>Impl\u00e9mentent les ports domaine (interfaces d\u00e9finies dans le domaine)</li> <li>Convertissent domaine \u2192 syst\u00e8me externe format</li> <li>Situ\u00e9s du C\u00d4T\u00c9 DROIT de l'hexagone (c\u00f4t\u00e9 driven)</li> <li>Exemples : Repositories, email senders, message publishers, file storage</li> </ul>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#responsabilite-transformation-de-sortie","title":"Responsabilit\u00e9 : Transformation de Sortie","text":"<p>Les adaptateurs secondary transforment format domaine \u2192 format externe.</p> <pre><code>Entit\u00e9 \u2192 Repository \u2192 Mapping Doctrine \u2192 SQL \u2192 Base de Donn\u00e9es\nObjet Email \u2192 EmailSender \u2192 Protocole SMTP \u2192 Serveur Email\n\u00c9v\u00e9nement \u2192 EventPublisher \u2192 JSON \u2192 File Messages\n</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#exemple-1-repository-doctrine-adaptateur-secondary","title":"Exemple 1 : Repository Doctrine (Adaptateur Secondary)","text":"<pre><code>namespace App\\User\\Infrastructure\\Persistence;\n\nuse App\\User\\Domain\\Model\\User;\nuse App\\User\\Domain\\Port\\UserRepositoryInterface; // Port (interface)\nuse Doctrine\\ORM\\EntityManagerInterface;\n\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    // PILOT\u00c9 par l'application\n    public function save(User $user): void\n    {\n        // Transformer : Entit\u00e9 Domaine \u2192 Persistance Doctrine \u2192 SQL\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n    }\n\n    public function findById(UserId $id): ?User\n    {\n        // Transformer : Ligne BD \u2192 Hydratation Doctrine \u2192 Entit\u00e9 Domaine\n        return $this-&gt;entityManager-&gt;find(User::class, $id-&gt;toString());\n    }\n\n    public function existsByEmail(string $email): bool\n    {\n        // Transformer : Query Domaine \u2192 Query SQL \u2192 R\u00e9sultat Boolean\n        $qb = $this-&gt;entityManager-&gt;createQueryBuilder();\n        $qb-&gt;select('COUNT(u.id)')\n           -&gt;from(User::class, 'u')\n           -&gt;where('u.email = :email')\n           -&gt;setParameter('email', $email);\n\n        return (int) $qb-&gt;getQuery()-&gt;getSingleScalarResult() &gt; 0;\n    }\n}\n</code></pre> <p>Points Cl\u00e9s : - Impl\u00e9mente interface port d\u00e9finie dans Domaine - Pilot\u00e9 par application (handler appelle m\u00e9thodes) - Conna\u00eet Doctrine, SQL, base de donn\u00e9es - N'initie PAS interactions\u2014attend d'\u00eatre appel\u00e9</p>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#exemple-2-email-sender-adaptateur-secondary","title":"Exemple 2 : Email Sender (Adaptateur Secondary)","text":"<pre><code>namespace App\\Notification\\Infrastructure\\Email;\n\nuse App\\Notification\\Domain\\Port\\EmailSenderInterface; // Port\nuse Symfony\\Component\\Mailer\\MailerInterface;\n\nfinal readonly class SymfonyEmailSender implements EmailSenderInterface\n{\n    public function __construct(\n        private MailerInterface $mailer,\n    ) {}\n\n    // PILOT\u00c9 par l'application\n    public function send(Email $email): void\n    {\n        // Transformer : Email Domaine \u2192 Email Symfony \u2192 Protocole SMTP\n        $message = (new SymfonyEmail())\n            -&gt;from($email-&gt;from-&gt;value)\n            -&gt;to($email-&gt;to-&gt;value)\n            -&gt;subject($email-&gt;subject)\n            -&gt;html($email-&gt;body);\n\n        $this-&gt;mailer-&gt;send($message);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#differences-cles","title":"Diff\u00e9rences Cl\u00e9s","text":"Aspect Adaptateur Primary Adaptateur Secondary Direction Pilote application Pilot\u00e9 par application Initie? Oui (action utilisateur, cron, \u00e9v\u00e9nement) Non (appel\u00e9 par application) D\u00e9pend De Couche application Ports domaine (interfaces) Impl\u00e9mente Rien (appelle handlers) Interfaces port Localisation C\u00f4t\u00e9 gauche (driving) C\u00f4t\u00e9 droite (driven) Exemples Contr\u00f4leur, CLI, GraphQL Repository, Email, Queue Entr\u00e9e/Sortie Re\u00e7oit entr\u00e9e externe Produit sortie externe Conna\u00eet Commands, Queries, Handlers Ports, Entit\u00e9s"},{"location":"fr/advanced/adaptateurs-primary-secondary/#direction-des-dependances","title":"Direction des D\u00e9pendances","text":""},{"location":"fr/advanced/adaptateurs-primary-secondary/#dependances-adaptateur-primary","title":"D\u00e9pendances Adaptateur Primary","text":"<pre><code>Adaptateur Primary (Infrastructure)\n    \u2193 d\u00e9pend de\nCouche Application (Commands, Handlers)\n    \u2193 d\u00e9pend de\nCouche Domaine (Entit\u00e9s, Ports)\n</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#dependances-adaptateur-secondary","title":"D\u00e9pendances Adaptateur Secondary","text":"<pre><code>Couche Domaine (Ports = Interfaces)\n    \u2191 impl\u00e9ment\u00e9 par\nAdaptateur Secondary (Infrastructure)\n</code></pre> <p>Point Cl\u00e9 : Le domaine d\u00e9finit l'interface, l'infrastructure l'impl\u00e9mente (Principe d'Inversion de D\u00e9pendance).</p>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#exemples-concrets","title":"Exemples Concrets","text":""},{"location":"fr/advanced/adaptateurs-primary-secondary/#exemple-systeme-de-commandes-e-commerce","title":"Exemple : Syst\u00e8me de Commandes E-Commerce","text":"<pre><code>// ADAPTATEURS PRIMARY (Pilotent)\n\n// 1. Contr\u00f4leur API REST\n#[Route('/api/orders', methods: ['POST'])]\nclass CreateOrderController // Pilote l'application\n{\n    public function __invoke(Request $request): JsonResponse\n    {\n        $command = new CreateOrderCommand(...);\n        $this-&gt;messageBus-&gt;dispatch($command); // Pilote\n        return new JsonResponse(['status' =&gt; 'created'], 201);\n    }\n}\n\n// 2. Commande CLI\nclass ProcessPendingOrdersCommand extends Command\n{\n    protected function execute(...): int\n    {\n        $orders = $this-&gt;orders-&gt;findPending();\n        foreach ($orders as $order) {\n            $command = new ProcessOrderCommand($order-&gt;getId());\n            $this-&gt;messageBus-&gt;dispatch($command); // Pilote\n        }\n        return Command::SUCCESS;\n    }\n}\n\n// ADAPTATEURS SECONDARY (Pilot\u00e9s)\n\n// 1. Repository Commandes (Base de Donn\u00e9es)\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    // Pilot\u00e9 par handlers appelant save(), findById(), etc.\n    public function save(Order $order): void { /* ... */ }\n}\n\n// 2. Processeur Paiement (API Externe)\nclass StripePaymentProcessor implements PaymentProcessorInterface\n{\n    // Pilot\u00e9 par handlers appelant charge(), refund(), etc.\n    public function charge(PaymentRequest $request): PaymentResult { /* ... */ }\n}\n\n// 3. Email Sender (Service Email)\nclass SendGridEmailSender implements EmailSenderInterface\n{\n    // Pilot\u00e9 par handlers appelant send()\n    public function send(Email $email): void { /* ... */ }\n}\n</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#strategie-de-test","title":"Strat\u00e9gie de Test","text":""},{"location":"fr/advanced/adaptateurs-primary-secondary/#tester-adaptateurs-primary","title":"Tester Adaptateurs Primary","text":"<p>Focus : Tester transformation entr\u00e9e et dispatch command/query.</p> <pre><code>class RegisterUserControllerTest extends WebTestCase\n{\n    public function test_registers_user_via_api(): void\n    {\n        $client = static::createClient();\n\n        // Tester transformation HTTP \u2192 Command\n        $client-&gt;request('POST', '/api/users', [], [], [\n            'CONTENT_TYPE' =&gt; 'application/json',\n        ], json_encode([\n            'email' =&gt; 'user@example.com',\n            'password' =&gt; 'secret123',\n        ]));\n\n        $this-&gt;assertResponseStatusCodeSame(201);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#tester-adaptateurs-secondary","title":"Tester Adaptateurs Secondary","text":"<p>Focus : Tester correction impl\u00e9mentation port.</p> <pre><code>class DoctrineUserRepositoryTest extends KernelTestCase\n{\n    public function test_saves_and_retrieves_user(): void\n    {\n        $repository = $this-&gt;getContainer()-&gt;get(UserRepositoryInterface::class);\n\n        $user = new User(\n            UserId::generate(),\n            new Email('test@example.com'),\n            HashedPassword::fromPlaintext('password')\n        );\n\n        // Tester impl\u00e9mentation port\n        $repository-&gt;save($user);\n\n        $retrieved = $repository-&gt;findById($user-&gt;getId());\n\n        $this-&gt;assertEquals($user-&gt;getId(), $retrieved-&gt;getId());\n    }\n}\n</code></pre>"},{"location":"fr/advanced/adaptateurs-primary-secondary/#resume-visuel","title":"R\u00e9sum\u00e9 Visuel","text":"Aspect Primary (Gauche) Secondary (Droite) R\u00f4le Initie R\u00e9pond D\u00e9pend de Application Ports Domaine Exemples REST, CLI, GraphQL Doctrine, SMTP, S3 Direction Entr\u00e9e \u2192 Domaine Domaine \u2192 Sortie"},{"location":"fr/advanced/adaptateurs-primary-secondary/#points-cles-a-retenir","title":"Points Cl\u00e9s \u00e0 Retenir","text":"<ol> <li>Primary = Driving (Contr\u00f4leurs, CLI) \u2192 Initient interactions</li> <li>Secondary = Driven (Repositories, Email) \u2192 R\u00e9pondent \u00e0 l'application</li> <li>Primary d\u00e9pend DE l'application (conna\u00eet commands/handlers)</li> <li>Secondary impl\u00e9mente ports domaine (interfaces d\u00e9finies par domaine)</li> <li>Inversion de D\u00e9pendance : Domaine d\u00e9finit interfaces, infrastructure impl\u00e9mente</li> <li>Tests : Primary = tests fonctionnels, Secondary = tests d'int\u00e9gration, Domaine = tests unitaires</li> </ol> <p>Suivant : CQRS: Analyse Co\u00fbts-B\u00e9n\u00e9fices \u2192</p>"},{"location":"fr/advanced/anti-patterns-pieges/","title":"Anti-Patterns et Pi\u00e8ges en Architecture Hexagonale","text":""},{"location":"fr/advanced/anti-patterns-pieges/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>Mod\u00e8le de Domaine An\u00e9mique</li> <li>God Objects</li> <li>Abstractions Fuyantes</li> <li>Repository comme Service Locator</li> <li>Probl\u00e8mes de Gestion des Transactions</li> <li>Probl\u00e8mes de Cascade Delete</li> <li>Sur-ing\u00e9nierie</li> <li>Anti-Patterns de Test</li> </ol>"},{"location":"fr/advanced/anti-patterns-pieges/#modele-de-domaine-anemique","title":"Mod\u00e8le de Domaine An\u00e9mique","text":""},{"location":"fr/advanced/anti-patterns-pieges/#le-probleme","title":"Le Probl\u00e8me","text":"<p>Mod\u00e8le de Domaine An\u00e9mique : Les entit\u00e9s ne sont que des conteneurs de donn\u00e9es avec getters/setters, toute la logique est dans les handlers.</p> <pre><code>// \u274c MAUVAIS : Entit\u00e9 an\u00e9mique\nclass Order\n{\n    private OrderStatus $status;\n    private Money $total;\n    private \\DateTimeImmutable $shippedAt;\n\n    // Seulement des getters et setters, pas de comportement\n    public function getStatus(): OrderStatus { return $this-&gt;status; }\n    public function setStatus(OrderStatus $status): void { $this-&gt;status = $status; }\n\n    public function getTotal(): Money { return $this-&gt;total; }\n    public function setTotal(Money $total): void { $this-&gt;total = $total; }\n\n    public function getShippedAt(): ?\\DateTimeImmutable { return $this-&gt;shippedAt; }\n    public function setShippedAt(\\DateTimeImmutable $shippedAt): void { $this-&gt;shippedAt = $shippedAt; }\n}\n\n// \u274c MAUVAIS : Toute la logique m\u00e9tier dans le handler\nclass ShipOrderHandler\n{\n    public function __invoke(ShipOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        // Logique m\u00e9tier dans le handler (devrait \u00eatre dans l'entit\u00e9 !)\n        if ($order-&gt;getStatus() === OrderStatus::CANCELLED) {\n            throw new CannotShipCancelledOrderException();\n        }\n\n        if ($order-&gt;getStatus() === OrderStatus::SHIPPED) {\n            throw new OrderAlreadyShippedException();\n        }\n\n        $order-&gt;setStatus(OrderStatus::SHIPPED);\n        $order-&gt;setShippedAt(new \\DateTimeImmutable());\n\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre> <p>Probl\u00e8mes : - R\u00e8gles m\u00e9tier \u00e9parpill\u00e9es dans les handlers - Difficile \u00e0 tester (besoin du handler pour tester la logique m\u00e9tier) - Impossible de r\u00e9utiliser la logique ailleurs - L'entit\u00e9 n'est qu'un sac de donn\u00e9es</p>"},{"location":"fr/advanced/anti-patterns-pieges/#la-solution-modele-de-domaine-riche","title":"La Solution : Mod\u00e8le de Domaine Riche","text":"<pre><code>// \u2705 BON : Entit\u00e9 riche avec comportement\nclass Order\n{\n    private OrderStatus $status;\n    private Money $total;\n    private ?\\DateTimeImmutable $shippedAt = null;\n\n    // Logique m\u00e9tier encapsul\u00e9e dans l'entit\u00e9\n    public function ship(): void\n    {\n        if ($this-&gt;status === OrderStatus::CANCELLED) {\n            throw new CannotShipCancelledOrderException();\n        }\n\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new OrderAlreadyShippedException();\n        }\n\n        $this-&gt;status = OrderStatus::SHIPPED;\n        $this-&gt;shippedAt = new \\DateTimeImmutable();\n    }\n\n    public function cancel(): void\n    {\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new CannotCancelShippedOrderException();\n        }\n\n        $this-&gt;status = OrderStatus::CANCELLED;\n    }\n\n    // Seulement des getters (pas de setters !)\n    public function getStatus(): OrderStatus { return $this-&gt;status; }\n    public function getTotal(): Money { return $this-&gt;total; }\n    public function getShippedAt(): ?\\DateTimeImmutable { return $this-&gt;shippedAt; }\n}\n\n// \u2705 BON : Handler mince, juste de l'orchestration\nclass ShipOrderHandler\n{\n    public function __invoke(ShipOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        $order-&gt;ship(); // Logique m\u00e9tier dans l'entit\u00e9\n\n        $this-&gt;orders-&gt;save($order);\n        $this-&gt;eventDispatcher-&gt;dispatch(new OrderShippedEvent($order-&gt;getId()));\n    }\n}\n</code></pre> <p>B\u00e9n\u00e9fices : - Logique m\u00e9tier dans le domaine o\u00f9 elle doit \u00eatre - Facile \u00e0 tester (<code>$order-&gt;ship()</code> peut \u00eatre test\u00e9 sans handler) - R\u00e9utilisable dans tous les cas d'usage - L'entit\u00e9 prot\u00e8ge ses invariants</p>"},{"location":"fr/advanced/anti-patterns-pieges/#god-objects","title":"God Objects","text":""},{"location":"fr/advanced/anti-patterns-pieges/#le-probleme-handlers-obeses","title":"Le Probl\u00e8me : Handlers Ob\u00e8ses","text":"<p>God Object : Handler fait tout (validation, logique m\u00e9tier, orchestration, gestion d'erreurs).</p> <pre><code>// \u274c MAUVAIS : God handler (200+ lignes)\nclass ProcessOrderHandler\n{\n    public function __invoke(ProcessOrderCommand $command): void\n    {\n        // Validation d'entr\u00e9e\n        if (empty($command-&gt;items)) {\n            throw new InvalidOrderException(\"La commande doit avoir des articles\");\n        }\n\n        // V\u00e9rification client\n        $customer = $this-&gt;customers-&gt;findById($command-&gt;customerId);\n        if (!$customer) {\n            throw new CustomerNotFoundException($command-&gt;customerId);\n        }\n\n        if (!$customer-&gt;isActive()) {\n            throw new InactiveCustomerException();\n        }\n\n        // V\u00e9rification inventaire pour chaque article\n        foreach ($command-&gt;items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;productId);\n            if (!$product) {\n                throw new ProductNotFoundException($item-&gt;productId);\n            }\n\n            if ($product-&gt;getStock() &lt; $item-&gt;quantity) {\n                throw new InsufficientStockException($item-&gt;productId);\n            }\n        }\n\n        // Calcul des prix\n        $subtotal = 0;\n        foreach ($command-&gt;items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;productId);\n            $subtotal += $product-&gt;getPrice() * $item-&gt;quantity;\n        }\n\n        $tax = $subtotal * $this-&gt;taxCalculator-&gt;getTaxRate($command-&gt;shippingAddress);\n        $shipping = $this-&gt;shippingCalculator-&gt;calculate($command-&gt;shippingAddress, $command-&gt;items);\n        $total = $subtotal + $tax + $shipping;\n\n        // Cr\u00e9er la commande\n        $order = new Order(/* ... beaucoup de param\u00e8tres ... */);\n\n        // R\u00e9server le stock\n        foreach ($command-&gt;items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;productId);\n            $product-&gt;reserveStock($item-&gt;quantity);\n            $this-&gt;products-&gt;save($product);\n        }\n\n        // Sauvegarder la commande\n        $this-&gt;orders-&gt;save($order);\n\n        // Envoyer les notifications\n        $this-&gt;emailSender-&gt;send(new OrderConfirmationEmail($order));\n        $this-&gt;eventDispatcher-&gt;dispatch(new OrderCreatedEvent($order-&gt;getId()));\n\n        // ... 100 lignes de plus\n    }\n}\n</code></pre> <p>Probl\u00e8mes : - Trop de responsabilit\u00e9s - Difficile \u00e0 tester - Difficile \u00e0 maintenir - Difficile \u00e0 comprendre</p>"},{"location":"fr/advanced/anti-patterns-pieges/#la-solution-decomposer-les-responsabilites","title":"La Solution : D\u00e9composer les Responsabilit\u00e9s","text":"<pre><code>// \u2705 BON : Diviser en plusieurs handlers/services\n\n// 1. Handler : orchestration uniquement\nclass ProcessOrderHandler\n{\n    public function __construct(\n        private OrderFactory $orderFactory,\n        private OrderRepositoryInterface $orders,\n        private InventoryService $inventory,\n        private EventDispatcherInterface $events,\n    ) {}\n\n    public function __invoke(ProcessOrderCommand $command): void\n    {\n        // La factory g\u00e8re la cr\u00e9ation + validation\n        $order = $this-&gt;orderFactory-&gt;create(\n            customerId: $command-&gt;customerId,\n            items: $command-&gt;items,\n            shippingAddress: $command-&gt;shippingAddress\n        );\n\n        // Le service domaine g\u00e8re l'inventaire\n        $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n\n        // Le repository g\u00e8re la persistance\n        $this-&gt;orders-&gt;save($order);\n\n        // Le dispatcher d'\u00e9v\u00e9nements g\u00e8re les notifications\n        $this-&gt;events-&gt;dispatch(new OrderCreatedEvent($order-&gt;getId()));\n    }\n}\n\n// 2. Factory : g\u00e8re la logique de cr\u00e9ation complexe\nclass OrderFactory\n{\n    public function create(\n        CustomerId $customerId,\n        array $items,\n        ShippingAddress $address\n    ): Order {\n        $this-&gt;validateCustomer($customerId);\n        $this-&gt;validateItems($items);\n\n        $subtotal = $this-&gt;calculateSubtotal($items);\n        $tax = $this-&gt;taxCalculator-&gt;calculate($subtotal, $address);\n        $shipping = $this-&gt;shippingCalculator-&gt;calculate($address, $items);\n\n        return new Order(\n            id: OrderId::generate(),\n            customerId: $customerId,\n            items: $items,\n            subtotal: $subtotal,\n            tax: $tax,\n            shipping: $shipping,\n            total: $subtotal-&gt;add($tax)-&gt;add($shipping),\n            status: OrderStatus::PENDING,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    private function validateCustomer(CustomerId $customerId): void { /* ... */ }\n    private function validateItems(array $items): void { /* ... */ }\n    private function calculateSubtotal(array $items): Money { /* ... */ }\n}\n\n// 3. Service domaine : g\u00e8re les op\u00e9rations cross-entit\u00e9s\nclass InventoryService\n{\n    public function reserveStock(array $items): void\n    {\n        foreach ($items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;getProductId());\n\n            if ($product-&gt;getStock() &lt; $item-&gt;getQuantity()) {\n                throw new InsufficientStockException($item-&gt;getProductId());\n            }\n\n            $product-&gt;reserveStock($item-&gt;getQuantity());\n            $this-&gt;products-&gt;save($product);\n        }\n    }\n}\n</code></pre> <p>B\u00e9n\u00e9fices : - Principe de Responsabilit\u00e9 Unique - Facile \u00e0 tester chaque composant - Facile \u00e0 comprendre - Composants r\u00e9utilisables</p>"},{"location":"fr/advanced/anti-patterns-pieges/#abstractions-fuyantes","title":"Abstractions Fuyantes","text":""},{"location":"fr/advanced/anti-patterns-pieges/#le-probleme-port-expose-les-details-dimplementation","title":"Le Probl\u00e8me : Port Expose les D\u00e9tails d'Impl\u00e9mentation","text":"<pre><code>// \u274c MAUVAIS : Port fuit les d\u00e9tails Doctrine\nnamespace App\\User\\Domain\\Port;\n\nuse Doctrine\\ORM\\QueryBuilder;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n\n    // \u274c Expose Doctrine QueryBuilder !\n    public function createQueryBuilder(): QueryBuilder;\n\n    // \u274c Expose une m\u00e9thode sp\u00e9cifique \u00e0 Doctrine !\n    public function findBy(array $criteria, ?array $orderBy = null): array;\n}\n</code></pre> <p>Probl\u00e8me : Le domaine d\u00e9pend maintenant de Doctrine. Impossible de changer pour MongoDB sans modifier le domaine.</p>"},{"location":"fr/advanced/anti-patterns-pieges/#la-solution-port-centre-sur-le-domaine","title":"La Solution : Port Centr\u00e9 sur le Domaine","text":"<pre><code>// \u2705 BON : Port utilise uniquement le langage domaine\nnamespace App\\User\\Domain\\Port;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findByEmail(Email $email): ?User;\n    public function findActiveUsers(): array; // array&lt;User&gt;\n}\n\n// L'adaptateur impl\u00e9mente le port avec Doctrine\nnamespace App\\User\\Infrastructure\\Persistence;\n\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function findActiveUsers(): array\n    {\n        // Les d\u00e9tails Doctrine cach\u00e9s dans l'adaptateur\n        return $this-&gt;entityManager\n            -&gt;createQueryBuilder()\n            -&gt;select('u')\n            -&gt;from(User::class, 'u')\n            -&gt;where('u.isActive = :active')\n            -&gt;setParameter('active', true)\n            -&gt;getQuery()\n            -&gt;getResult();\n    }\n}\n</code></pre> <p>B\u00e9n\u00e9fices : - Domaine ind\u00e9pendant de l'infrastructure - Peut changer de base de donn\u00e9es sans toucher au domaine - API claire, sp\u00e9cifique au domaine</p>"},{"location":"fr/advanced/anti-patterns-pieges/#repository-comme-service-locator","title":"Repository comme Service Locator","text":""},{"location":"fr/advanced/anti-patterns-pieges/#le-probleme-repository-recupere-des-entites-non-liees","title":"Le Probl\u00e8me : Repository R\u00e9cup\u00e8re des Entit\u00e9s Non Li\u00e9es","text":"<pre><code>// \u274c MAUVAIS : Le repository de commandes r\u00e9cup\u00e8re clients et produits\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void\n    {\n        // R\u00e9cup\u00e8re le client (non li\u00e9 \u00e0 la persistance de commande !)\n        $customer = $this-&gt;entityManager-&gt;find(Customer::class, $order-&gt;getCustomerId());\n\n        // R\u00e9cup\u00e8re les produits (non li\u00e9 \u00e0 la persistance de commande !)\n        foreach ($order-&gt;getItems() as $item) {\n            $product = $this-&gt;entityManager-&gt;find(Product::class, $item-&gt;getProductId());\n        }\n\n        $this-&gt;entityManager-&gt;persist($order);\n        $this-&gt;entityManager-&gt;flush();\n    }\n}\n</code></pre> <p>Probl\u00e8me : Le repository devient un service locator, viole le Principe de Responsabilit\u00e9 Unique.</p>"},{"location":"fr/advanced/anti-patterns-pieges/#la-solution-repository-gere-seulement-son-agregat","title":"La Solution : Repository G\u00e8re Seulement Son Agr\u00e9gat","text":"<pre><code>// \u2705 BON : Le repository de commandes g\u00e8re seulement les commandes\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void\n    {\n        $this-&gt;entityManager-&gt;persist($order);\n        $this-&gt;entityManager-&gt;flush();\n        // C'est tout ! Pas de r\u00e9cup\u00e9ration d'autres entit\u00e9s\n    }\n\n    public function findById(OrderId $id): ?Order\n    {\n        return $this-&gt;entityManager-&gt;find(Order::class, $id-&gt;toString());\n    }\n}\n\n// Le handler coordonne plusieurs repositories\nclass CreateOrderHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orders,\n        private CustomerRepositoryInterface $customers, // Repository s\u00e9par\u00e9\n        private ProductRepositoryInterface $products,   // Repository s\u00e9par\u00e9\n    ) {}\n\n    public function __invoke(CreateOrderCommand $command): void\n    {\n        // Le handler r\u00e9cup\u00e8re les entit\u00e9s de leurs propres repositories\n        $customer = $this-&gt;customers-&gt;findById($command-&gt;customerId);\n        // Valider le client...\n\n        foreach ($command-&gt;items as $item) {\n            $product = $this-&gt;products-&gt;findById($item-&gt;productId);\n            // Valider le produit...\n        }\n\n        $order = OrderFactory::create($customer, $command-&gt;items);\n        $this-&gt;orders-&gt;save($order); // Le repository de commandes sauvegarde seulement les commandes\n    }\n}\n</code></pre>"},{"location":"fr/advanced/anti-patterns-pieges/#problemes-de-gestion-des-transactions","title":"Probl\u00e8mes de Gestion des Transactions","text":""},{"location":"fr/advanced/anti-patterns-pieges/#le-probleme-transactions-imbriquees-ou-commits-implicites","title":"Le Probl\u00e8me : Transactions Imbriqu\u00e9es ou Commits Implicites","text":"<pre><code>// \u274c MAUVAIS : Le handler d\u00e9marre une transaction, mais le repository flush aussi\nclass CheckoutOrderHandler\n{\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n            $order-&gt;confirm();\n\n            $this-&gt;orders-&gt;save($order); // \u274c Appelle flush() dans la transaction !\n\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems()); // \u274c Flush aussi !\n\n            $this-&gt;entityManager-&gt;commit(); // Peut commit des donn\u00e9es d\u00e9j\u00e0 flush\u00e9es\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback(); // Peut ne pas tout rollback !\n            throw $e;\n        }\n    }\n}\n\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void\n    {\n        $this-&gt;entityManager-&gt;persist($order);\n        $this-&gt;entityManager-&gt;flush(); // \u274c Flush imm\u00e9diatement !\n    }\n}\n</code></pre> <p>Probl\u00e8me : Les flush interm\u00e9diaires emp\u00eachent un rollback propre.</p>"},{"location":"fr/advanced/anti-patterns-pieges/#la-solution-controle-explicite-des-transactions","title":"La Solution : Contr\u00f4le Explicite des Transactions","text":"<pre><code>// \u2705 BON : Le handler contr\u00f4le la transaction, les repositories ne flush pas\nclass CheckoutOrderHandler\n{\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n            $order-&gt;confirm();\n\n            $this-&gt;orders-&gt;persist($order); // Juste persist, pas de flush\n\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems()); // Juste persist\n\n            $this-&gt;entityManager-&gt;flush(); // Flush tous les changements en une fois\n            $this-&gt;entityManager-&gt;commit();\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n            throw $e;\n        }\n    }\n}\n\n// Repository : m\u00e9thode persist() (pas de flush)\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function persist(Order $order): void\n    {\n        $this-&gt;entityManager-&gt;persist($order);\n        // Pas de flush ! Laisser le handler contr\u00f4ler la transaction\n    }\n\n    public function flush(): void\n    {\n        $this-&gt;entityManager-&gt;flush();\n    }\n}\n</code></pre> <p>Alternative : Utiliser le wrapper transactionnel de Doctrine</p> <pre><code>// \u2705 BON : Utiliser l'helper transactionnel\nclass CheckoutOrderHandler\n{\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;wrapInTransaction(function() use ($command) {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n            $order-&gt;confirm();\n\n            $this-&gt;orders-&gt;persist($order);\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n\n            // Flush et commit automatiques, ou rollback sur exception\n        });\n    }\n}\n</code></pre>"},{"location":"fr/advanced/anti-patterns-pieges/#problemes-de-cascade-delete","title":"Probl\u00e8mes de Cascade Delete","text":""},{"location":"fr/advanced/anti-patterns-pieges/#le-probleme-cascade-deletes-accidentels","title":"Le Probl\u00e8me : Cascade Deletes Accidentels","text":"<pre><code>// \u274c MAUVAIS : Supprimer une commande supprime le client !\n#[ORM\\Entity]\nclass Order\n{\n    #[ORM\\ManyToOne(targetEntity: Customer::class, cascade: ['remove'])] // \u274c Faux !\n    private Customer $customer;\n}\n\n// Supprimer une commande supprime accidentellement le client\n$this-&gt;orders-&gt;delete($order); // \u274c Le client aussi supprim\u00e9 !\n</code></pre> <p>Probl\u00e8me : Les op\u00e9rations en cascade peuvent avoir des effets secondaires non intentionnels.</p>"},{"location":"fr/advanced/anti-patterns-pieges/#la-solution-frontieres-dagregat-explicites","title":"La Solution : Fronti\u00e8res d'Agr\u00e9gat Explicites","text":"<pre><code>// \u2705 BON : Pas de cascade, suppression explicite\n#[ORM\\Entity]\nclass Order\n{\n    #[ORM\\ManyToOne(targetEntity: Customer::class)]\n    private Customer $customer; // Pas de cascade\n}\n\n// Le handler contr\u00f4le explicitement ce qui est supprim\u00e9\nclass DeleteOrderHandler\n{\n    public function __invoke(DeleteOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        // Supprimer seulement la commande, pas le client\n        $this-&gt;orders-&gt;delete($order);\n\n        // Si n\u00e9cessaire, g\u00e9rer le client s\u00e9par\u00e9ment\n        // $this-&gt;customers-&gt;delete($order-&gt;getCustomer());\n    }\n}\n</code></pre> <p>R\u00e8gle : Cascade seulement dans les fronti\u00e8res d'agr\u00e9gat.</p> <pre><code>// \u2705 BON : Cascade dans l'agr\u00e9gat\n#[ORM\\Entity]\nclass Order\n{\n    #[ORM\\OneToMany(\n        targetEntity: OrderItem::class,\n        mappedBy: 'order',\n        cascade: ['persist', 'remove'] // \u2705 OK : OrderItem fait partie de l'agr\u00e9gat Order\n    )]\n    private array $items;\n}\n</code></pre>"},{"location":"fr/advanced/anti-patterns-pieges/#sur-ingenierie","title":"Sur-ing\u00e9nierie","text":""},{"location":"fr/advanced/anti-patterns-pieges/#le-probleme-abstraction-prematuree","title":"Le Probl\u00e8me : Abstraction Pr\u00e9matur\u00e9e","text":"<pre><code>// \u274c MAUVAIS : Sur-ing\u00e9nierie pour un simple CRUD\ninterface UserCreatorInterface { /* ... */ }\ninterface UserUpdaterInterface { /* ... */ }\ninterface UserDeleterInterface { /* ... */ }\ninterface UserFinderInterface { /* ... */ }\ninterface UserValidatorInterface { /* ... */ }\ninterface UserFactoryInterface { /* ... */ }\ninterface UserMapperInterface { /* ... */ }\n\nclass UserCreator implements UserCreatorInterface { /* ... */ }\nclass UserUpdater implements UserUpdaterInterface { /* ... */ }\n// ... 10 classes de plus pour une simple gestion d'utilisateur\n</code></pre> <p>Probl\u00e8me : Trop d'abstractions pour des op\u00e9rations simples.</p>"},{"location":"fr/advanced/anti-patterns-pieges/#la-solution-commencer-simple-refactorer-si-necessaire","title":"La Solution : Commencer Simple, Refactorer si N\u00e9cessaire","text":"<pre><code>// \u2705 BON : Interface simple pour des besoins simples\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findByEmail(Email $email): ?User;\n    public function delete(User $user): void;\n}\n\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    // Impl\u00e9mentation simple\n}\n\n// Refactorer en interfaces s\u00e9par\u00e9es SEULEMENT quand :\n// - Plusieurs impl\u00e9mentations n\u00e9cessaires\n// - Interface devient trop large\n// - Diff\u00e9rents clients ont besoin de diff\u00e9rentes m\u00e9thodes\n</code></pre> <p>R\u00e8gle : YAGNI (You Ain't Gonna Need It) - N'ajoutez pas de complexit\u00e9 avant d'en avoir besoin.</p>"},{"location":"fr/advanced/anti-patterns-pieges/#anti-patterns-de-test","title":"Anti-Patterns de Test","text":""},{"location":"fr/advanced/anti-patterns-pieges/#anti-pattern-1-tester-les-details-dimplementation","title":"Anti-Pattern 1 : Tester les D\u00e9tails d'Impl\u00e9mentation","text":"<pre><code>// \u274c MAUVAIS : Tester l'\u00e9tat interne au lieu du comportement\nclass OrderTest extends TestCase\n{\n    public function test_ship_order(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::CONFIRMED);\n\n        $order-&gt;ship();\n\n        // \u274c Tester la propri\u00e9t\u00e9 priv\u00e9e directement (avec r\u00e9flexion)\n        $reflection = new \\ReflectionClass($order);\n        $property = $reflection-&gt;getProperty('status');\n        $property-&gt;setAccessible(true);\n\n        $this-&gt;assertEquals(OrderStatus::SHIPPED, $property-&gt;getValue($order));\n    }\n}\n</code></pre> <p>Probl\u00e8me : Le test est coupl\u00e9 \u00e0 l'impl\u00e9mentation, se casse lors du refactoring.</p>"},{"location":"fr/advanced/anti-patterns-pieges/#solution-tester-le-comportement-pas-letat","title":"Solution : Tester le Comportement, Pas l'\u00c9tat","text":"<pre><code>// \u2705 BON : Tester le comportement public\nclass OrderTest extends TestCase\n{\n    public function test_ship_order(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::CONFIRMED);\n\n        $order-&gt;ship();\n\n        // Tester la m\u00e9thode publique\n        $this-&gt;assertEquals(OrderStatus::SHIPPED, $order-&gt;getStatus());\n        $this-&gt;assertNotNull($order-&gt;getShippedAt());\n    }\n\n    public function test_cannot_ship_cancelled_order(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::CANCELLED);\n\n        $this-&gt;expectException(CannotShipCancelledOrderException::class);\n\n        $order-&gt;ship();\n    }\n}\n</code></pre>"},{"location":"fr/advanced/anti-patterns-pieges/#anti-pattern-2-tout-mocker","title":"Anti-Pattern 2 : Tout Mocker","text":"<pre><code>// \u274c MAUVAIS : Mocker les value objects et entit\u00e9s\nclass RegisterUserHandlerTest extends TestCase\n{\n    public function test_registers_user(): void\n    {\n        $user = $this-&gt;createMock(User::class); // \u274c Mocker l'entit\u00e9\n        $email = $this-&gt;createMock(Email::class); // \u274c Mocker le value object\n\n        $factory = $this-&gt;createMock(UserFactory::class);\n        $factory-&gt;method('create')-&gt;willReturn($user);\n\n        $repository = $this-&gt;createMock(UserRepositoryInterface::class);\n        $repository-&gt;expects($this-&gt;once())-&gt;method('save')-&gt;with($user);\n\n        $handler = new RegisterUserHandler($factory, $repository);\n        $handler(new RegisterUserCommand('test@example.com', 'password'));\n    }\n}\n</code></pre> <p>Probl\u00e8me : Mocker les objets domaine annule l'int\u00e9r\u00eat du test.</p>"},{"location":"fr/advanced/anti-patterns-pieges/#solution-utiliser-de-vrais-objets-domaine-mocker-seulement-linfrastructure","title":"Solution : Utiliser de Vrais Objets Domaine, Mocker Seulement l'Infrastructure","text":"<pre><code>// \u2705 BON : Vrais objets domaine, mock infrastructure\nclass RegisterUserHandlerTest extends TestCase\n{\n    public function test_registers_user(): void\n    {\n        // Vraie factory et entit\u00e9s\n        $repository = new InMemoryUserRepository(); // Fausse infrastructure\n\n        $handler = new RegisterUserHandler($repository);\n\n        $handler(new RegisterUserCommand('test@example.com', 'ValidPass123'));\n\n        // V\u00e9rifier avec le vrai repository\n        $this-&gt;assertTrue($repository-&gt;existsByEmail('test@example.com'));\n\n        $user = $repository-&gt;findByEmail('test@example.com');\n        $this-&gt;assertFalse($user-&gt;isActive());\n    }\n}\n</code></pre>"},{"location":"fr/advanced/anti-patterns-pieges/#anti-pattern-3-ne-pas-tester-les-cas-derreur","title":"Anti-Pattern 3 : Ne Pas Tester les Cas d'Erreur","text":"<pre><code>// \u274c MAUVAIS : Tester seulement le chemin heureux\nclass OrderTest extends TestCase\n{\n    public function test_create_order(): void\n    {\n        $order = OrderFactory::create($customerId, $items);\n\n        $this-&gt;assertInstanceOf(Order::class, $order);\n    }\n\n    // \u274c Manque : tester items vides, client invalide, etc.\n}\n</code></pre>"},{"location":"fr/advanced/anti-patterns-pieges/#solution-tester-completement-les-cas-derreur","title":"Solution : Tester Compl\u00e8tement les Cas d'Erreur","text":"<pre><code>// \u2705 BON : Tester succ\u00e8s et \u00e9chec\nclass OrderTest extends TestCase\n{\n    public function test_create_order_with_valid_data(): void\n    {\n        $order = OrderFactory::create($customerId, $items);\n        $this-&gt;assertInstanceOf(Order::class, $order);\n    }\n\n    public function test_throws_when_no_items(): void\n    {\n        $this-&gt;expectException(OrderMustHaveItemsException::class);\n        OrderFactory::create($customerId, []);\n    }\n\n    public function test_throws_when_total_below_minimum(): void\n    {\n        $this-&gt;expectException(OrderBelowMinimumException::class);\n        OrderFactory::create($customerId, $cheapItems);\n    }\n\n    public function test_cannot_ship_cancelled_order(): void\n    {\n        $this-&gt;expectException(CannotShipCancelledOrderException::class);\n        $order = new Order(OrderId::generate(), OrderStatus::CANCELLED);\n        $order-&gt;ship();\n    }\n}\n</code></pre>"},{"location":"fr/advanced/anti-patterns-pieges/#checklist-resumee","title":"Checklist R\u00e9sum\u00e9e","text":""},{"location":"fr/advanced/anti-patterns-pieges/#eviter-ces-anti-patterns","title":"\u2705 \u00c9viter Ces Anti-Patterns","text":"<ul> <li> Mod\u00e8le de Domaine An\u00e9mique - Les entit\u00e9s doivent avoir du comportement, pas juste des getters/setters</li> <li> God Objects - Les handlers doivent orchestrer, pas tout impl\u00e9menter</li> <li> Abstractions Fuyantes - Les ports doivent utiliser le langage domaine, ne pas exposer l'infrastructure</li> <li> Repository comme Service Locator - Les repositories g\u00e8rent un seul agr\u00e9gat</li> <li> Probl\u00e8mes de Gestion des Transactions - Contr\u00f4ler les transactions explicitement dans les handlers</li> <li> Probl\u00e8mes de Cascade Delete - Cascade seulement dans les fronti\u00e8res d'agr\u00e9gat</li> <li> Sur-ing\u00e9nierie - Commencer simple, refactorer si n\u00e9cessaire (YAGNI)</li> <li> Tester les D\u00e9tails d'Impl\u00e9mentation - Tester le comportement, pas l'\u00e9tat interne</li> <li> Tout Mocker - Utiliser de vrais objets domaine, mocker seulement l'infrastructure</li> <li> Ne Pas Tester les Cas d'Erreur - Tester compl\u00e8tement les sc\u00e9narios d'\u00e9chec</li> </ul>"},{"location":"fr/advanced/anti-patterns-pieges/#reference-rapide-bon-vs-mauvais","title":"R\u00e9f\u00e9rence Rapide : Bon vs Mauvais","text":"Anti-Pattern Bonne Pratique Getters/setters partout M\u00e9thodes d'entit\u00e9 exprimant le comportement Handler de 500 lignes D\u00e9compos\u00e9 en handler + factory + services Port retourne QueryBuilder Port retourne des objets domaine Repository r\u00e9cup\u00e8re d'autres entit\u00e9s Handler coordonne plusieurs repositories Repository appelle flush() Handler contr\u00f4le les transactions Cascade delete partout Suppressions explicites, cascade seulement dans les agr\u00e9gats Interface pour tout Commencer simple, refactorer si n\u00e9cessaire Tester les propri\u00e9t\u00e9s priv\u00e9es Tester le comportement public Mocker les entit\u00e9s Utiliser de vraies entit\u00e9s, mocker l'infrastructure Tester seulement le chemin heureux Tester les erreurs et cas limites <p>C'est tout ! Vous avez maintenant un guide complet pour \u00e9viter les pi\u00e8ges courants en architecture hexagonale. Bonne chance ! \ud83c\udf89</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/","title":"CQRS : Quand l'Utiliser, Quand l'\u00c9viter","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>Qu'est-ce que CQRS ?</li> <li>Le Probl\u00e8me Central que CQRS R\u00e9sout</li> <li>Analyse Co\u00fbts-B\u00e9n\u00e9fices</li> <li>Quand Utiliser CQRS</li> <li>Quand NE PAS Utiliser CQRS</li> <li>Niveaux d'Impl\u00e9mentation</li> <li>Exemples de D\u00e9cisions R\u00e9elles</li> <li>Strat\u00e9gie de Migration</li> </ol>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#quest-ce-que-cqrs","title":"Qu'est-ce que CQRS ?","text":"<p>CQRS = Command Query Responsibility Segregation (S\u00e9gr\u00e9gation des Responsabilit\u00e9s entre Commandes et Requ\u00eates)</p> <p>S\u00e9parer le mod\u00e8le qui \u00e9crit les donn\u00e9es (Commands) du mod\u00e8le qui lit les donn\u00e9es (Queries).</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#approche-traditionnelle-modele-unique","title":"Approche Traditionnelle (Mod\u00e8le Unique)","text":"<pre><code>// Un repository g\u00e8re lectures et \u00e9critures\ninterface UserRepositoryInterface\n{\n    // \u00c9critures\n    public function save(User $user): void;\n    public function delete(User $user): void;\n\n    // Lectures\n    public function findById(UserId $id): ?User;\n    public function findAll(): array;\n    public function findActiveUsers(): array;\n}\n</code></pre>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#approche-cqrs-modeles-separes","title":"Approche CQRS (Mod\u00e8les S\u00e9par\u00e9s)","text":"<pre><code>// Mod\u00e8le \u00e9criture (Commands)\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function delete(User $user): void;\n}\n\n// Mod\u00e8le lecture (Queries)\ninterface UserQueryInterface\n{\n    public function findById(UserId $id): ?UserDTO;\n    public function findAll(): array; // array&lt;UserDTO&gt;\n    public function findActiveUsers(): array;\n}\n</code></pre>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#le-probleme-central-que-cqrs-resout","title":"Le Probl\u00e8me Central que CQRS R\u00e9sout","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#probleme-1-lectures-et-ecritures-ont-des-besoins-differents","title":"Probl\u00e8me 1 : Lectures et \u00c9critures Ont des Besoins Diff\u00e9rents","text":"Pr\u00e9occupation \u00c9critures (Commands) Lectures (Queries) Focus R\u00e8gles m\u00e9tier, coh\u00e9rence Vitesse, d\u00e9normalisation Mod\u00e8le Entit\u00e9s riches DTOs simples Validation Logique m\u00e9tier complexe Aucune (d\u00e9j\u00e0 valid\u00e9) Performance Peut \u00eatre lent (transactionnel) Doit \u00eatre rapide (cach\u00e9) Complexit\u00e9 Graphes d'objets complexes Projections plates <p>Exemple : Commande E-Commerce</p> <pre><code>// \u00c9CRITURE : Entit\u00e9 complexe avec logique m\u00e9tier\nclass Order\n{\n    private OrderId $id;\n    private CustomerId $customerId;\n    private array $items; // OrderItem[]\n    private Money $totalAmount;\n    private OrderStatus $status;\n\n    public function addItem(Product $product, int $quantity): void\n    {\n        // R\u00e8gles m\u00e9tier complexes\n        if ($this-&gt;status !== OrderStatus::DRAFT) {\n            throw new CannotModifyConfirmedOrderException();\n        }\n\n        if ($quantity &lt;= 0) {\n            throw new InvalidQuantityException();\n        }\n\n        $this-&gt;items[] = new OrderItem($product, $quantity);\n        $this-&gt;recalculateTotal();\n    }\n}\n\n// LECTURE : DTO simple pour affichage\nfinal readonly class OrderListDTO\n{\n    public function __construct(\n        public string $orderId,\n        public string $customerName,\n        public int $totalAmountCents,\n        public string $status,\n        public string $createdAt,\n    ) {}\n}\n</code></pre> <p>Pourquoi la s\u00e9paration aide : - Mod\u00e8le \u00e9criture peut \u00eatre complexe (logique m\u00e9tier) - Mod\u00e8le lecture peut \u00eatre simple (juste donn\u00e9es pour affichage) - Chacun optimis\u00e9 pour son objectif</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#probleme-2-patterns-de-requetes-conflictuels","title":"Probl\u00e8me 2 : Patterns de Requ\u00eates Conflictuels","text":"<p>Requ\u00eates \u00e9criture n\u00e9cessitent : - Relations entit\u00e9s pr\u00e9serv\u00e9es - Coh\u00e9rence transactionnelle - Graphes d'objets complets</p> <p>Requ\u00eates lecture n\u00e9cessitent : - Donn\u00e9es d\u00e9normalis\u00e9es (joins \u00e9vit\u00e9s) - Cache agressif - Pagination, filtrage, tri</p> <pre><code>// \u274c Tenter de servir les deux besoins avec un mod\u00e8le m\u00e8ne au compromis\n\n// \u00c9criture : n\u00e9cessite entit\u00e9 compl\u00e8te\n$order = $this-&gt;orders-&gt;findById($orderId); // Charge Order avec toutes relations\n$order-&gt;addItem($product, 2);\n$this-&gt;orders-&gt;save($order);\n\n// Lecture : n\u00e9cessite donn\u00e9es plates pour affichage\n$orders = $this-&gt;orders-&gt;findAllOrders(); // M\u00eame repository!\n// Mais on n'a pas besoin d'entit\u00e9s compl\u00e8tes avec logique m\u00e9tier pour affichage...\n// On charge trop de donn\u00e9es, gaspille m\u00e9moire, et c'est lent\n</code></pre> <p>Solution CQRS : Mod\u00e8les diff\u00e9rents pour besoins diff\u00e9rents.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#analyse-couts-benefices","title":"Analyse Co\u00fbts-B\u00e9n\u00e9fices","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#benefices-de-cqrs","title":"\u2705 B\u00e9n\u00e9fices de CQRS","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#1-performance-optimisee","title":"1. Performance Optimis\u00e9e","text":"<p>C\u00f4t\u00e9 \u00e9criture : <pre><code>// Entit\u00e9 complexe avec logique m\u00e9tier\n$order-&gt;confirm(); // Logique domaine riche\n$this-&gt;orders-&gt;save($order);\n</code></pre></p> <p>C\u00f4t\u00e9 lecture : <pre><code>// Requ\u00eate SQL optimis\u00e9e, retourne DTO plat\n$orders = $this-&gt;queryBus-&gt;dispatch(new FindOrdersQuery());\n// SELECT o.id, o.status, c.name AS customer_name, ...\n// FROM orders o JOIN customers c ON ...\n// R\u00e9sultat plat, pas de surcharge d'hydratation\n</code></pre></p> <p>B\u00e9n\u00e9fice : Les lectures peuvent \u00eatre optimis\u00e9es agressivement (d\u00e9normalisation, cache) sans affecter mod\u00e8le \u00e9criture.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#2-logique-lecture-simplifiee","title":"2. Logique Lecture Simplifi\u00e9e","text":"<pre><code>// \u274c Sans CQRS : lecture utilise entit\u00e9 complexe\n$user = $this-&gt;users-&gt;findById($userId); // Retourne entit\u00e9 User compl\u00e8te\nreturn new UserResponse(\n    id: $user-&gt;getId()-&gt;toString(),\n    email: $user-&gt;getEmail()-&gt;value,\n    name: $user-&gt;getName(),\n    // Extraire donn\u00e9es de l'entit\u00e9 complexe\n);\n\n// \u2705 Avec CQRS : lecture retourne DTO directement\n$userDTO = $this-&gt;queries-&gt;findById($userId); // Retourne UserDTO\nreturn $userDTO; // D\u00e9j\u00e0 dans le bon format\n</code></pre>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#3-scalabilite-mise-a-lechelle-independante","title":"3. Scalabilit\u00e9 : Mise \u00e0 l'\u00c9chelle Ind\u00e9pendante","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 BD \u00c9criture \u2502         \u2502  BD Lecture \u2502\n\u2502 (Master)    \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502  (Replicas) \u2502\n\u2502             \u2502  Sync   \u2502             \u2502\n\u2502 1 instance  \u2502         \u2502 10 replicas \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2191                       \u2191\n   10% trafic             90% trafic\n</code></pre> <p>B\u00e9n\u00e9fice : Mettre \u00e0 l'\u00e9chelle c\u00f4t\u00e9s lecture et \u00e9criture ind\u00e9pendamment selon charge.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#4-coherence-eventuelle-quand-acceptable","title":"4. Coh\u00e9rence \u00c9ventuelle (Quand Acceptable)","text":"<pre><code>// Commande : \u00c9criture imm\u00e9diate\n$this-&gt;commandBus-&gt;dispatch(new CreateOrderCommand(...));\n// Commande sauvegard\u00e9e en BD \u00e9criture\n\n// Requ\u00eate : Lecture depuis replica (peut \u00eatre l\u00e9g\u00e8rement retard\u00e9e)\n$orders = $this-&gt;queryBus-&gt;dispatch(new FindOrdersQuery());\n// Lit depuis replica lecture (coh\u00e9rence \u00e9ventuelle)\n</code></pre> <p>B\u00e9n\u00e9fice : Accepter l\u00e9ger d\u00e9lai en lecture pour meilleur d\u00e9bit \u00e9criture.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#5-meilleure-securite-vues-en-lecture-seule","title":"5. Meilleure S\u00e9curit\u00e9 : Vues en Lecture Seule","text":"<pre><code>// Mod\u00e8le lecture : exposer seulement donn\u00e9es s\u00fbres\ninterface PublicUserQueryInterface\n{\n    public function findByUsername(string $username): ?PublicUserDTO;\n    // Retourne : username, bio, avatar (champs s\u00fbrs)\n}\n\n// Mod\u00e8le \u00e9criture : contient donn\u00e9es sensibles\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    // Entit\u00e9 User contient hash password, email (sensible)\n}\n</code></pre> <p>B\u00e9n\u00e9fice : Mod\u00e8les lecture peuvent exposer diff\u00e9rentes projections pour diff\u00e9rents utilisateurs (public vs admin).</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#couts-de-cqrs","title":"\u274c Co\u00fbts de CQRS","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#1-complexite-accrue","title":"1. Complexit\u00e9 Accrue","text":"<p>Sans CQRS (simple) : <pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n}\n\n// 1 interface, 1 impl\u00e9mentation, 1 mod\u00e8le\n</code></pre></p> <p>Avec CQRS (complexe) : <pre><code>interface UserRepositoryInterface { /* m\u00e9thodes \u00e9criture */ }\ninterface UserQueryInterface { /* m\u00e9thodes lecture */ }\n\nclass DoctrineUserRepository implements UserRepositoryInterface { /* ... */ }\nclass DoctrineUserQuery implements UserQueryInterface { /* ... */ }\n\n// 2 interfaces, 2 impl\u00e9mentations, 2 mod\u00e8les (entit\u00e9 + DTO)\n</code></pre></p> <p>Co\u00fbt : Double de code, double de maintenance.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#2-surcharge-de-synchronisation","title":"2. Surcharge de Synchronisation","text":"<p>Si bases de donn\u00e9es \u00e9criture et lecture sont s\u00e9par\u00e9es :</p> <pre><code>// \u00c9crire en BD \u00e9criture\n$this-&gt;commandBus-&gt;dispatch(new CreateUserCommand(...));\n\n// Doit synchroniser vers BD lecture\n$this-&gt;eventBus-&gt;dispatch(new UserCreatedEvent(...));\n\n// Gestionnaire \u00e9v\u00e9nement met \u00e0 jour BD lecture\nclass UserCreatedEventHandler\n{\n    public function __invoke(UserCreatedEvent $event): void\n    {\n        $this-&gt;readDatabase-&gt;insertUser(...); // Sync!\n    }\n}\n</code></pre> <p>Co\u00fbt : Infrastructure suppl\u00e9mentaire (files messages, gestionnaires \u00e9v\u00e9nements, logique sync).</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#3-problemes-coherence-eventuelle","title":"3. Probl\u00e8mes Coh\u00e9rence \u00c9ventuelle","text":"<pre><code>// Utilisateur cr\u00e9e compte\n$this-&gt;commandBus-&gt;dispatch(new RegisterUserCommand(...));\n\n// Essaie imm\u00e9diatement de se connecter\n$user = $this-&gt;queries-&gt;findByEmail($email);\n// \u274c Peut retourner null si BD lecture pas encore synchronis\u00e9e!\n</code></pre> <p>Co\u00fbt : Doit g\u00e9rer probl\u00e8me \"lire ses propres \u00e9critures\", ajoutant complexit\u00e9.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#4-temps-de-developpement","title":"4. Temps de D\u00e9veloppement","text":"T\u00e2che Sans CQRS Avec CQRS Ajouter nouvelle entit\u00e9 1 repository 1 repository + 1 interface query + sync Ajouter op\u00e9ration lecture Ajouter m\u00e9thode au repository Ajouter m\u00e9thode \u00e0 interface query Ajouter op\u00e9ration \u00e9criture Ajouter m\u00e9thode au repository Ajouter m\u00e9thode + \u00e9v\u00e9nement + gestionnaire sync Tests Tester repository Tester repository + query + sync + coh\u00e9rence \u00e9ventuelle <p>Co\u00fbt : 30-50% plus de temps d\u00e9veloppement pour op\u00e9rations CRUD.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#5-courbe-dapprentissage-equipe","title":"5. Courbe d'Apprentissage \u00c9quipe","text":"<ul> <li>D\u00e9veloppeurs doivent comprendre :</li> <li>S\u00e9paration Command vs Query</li> <li>Architecture \u00e9v\u00e9nementielle</li> <li>Coh\u00e9rence \u00e9ventuelle</li> <li>Files de messages</li> <li>Synchronisation mod\u00e8le lecture</li> </ul> <p>Co\u00fbt : Temps formation, erreurs pendant phase apprentissage.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#quand-utiliser-cqrs","title":"Quand Utiliser CQRS","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#bons-cas-dusage","title":"\u2705 Bons Cas d'Usage","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#1-ratio-lectureecriture-eleve-90-lectures","title":"1. Ratio Lecture/\u00c9criture \u00c9lev\u00e9 (90%+ lectures)","text":"<p>Exemple : Tableau de Bord Analytics</p> <pre><code>// \u00c9critures : rares (une fois par heure, t\u00e2che fond)\n$this-&gt;commandBus-&gt;dispatch(new GenerateReportCommand(...));\n\n// Lectures : fr\u00e9quentes (milliers par seconde)\n$report = $this-&gt;queries-&gt;getReport($reportId);\n</code></pre> <p>Pourquoi CQRS aide : Optimiser c\u00f4t\u00e9 lecture agressivement (cache, d\u00e9normalisation) sans impacter \u00e9critures rares.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#2-exigences-reporting-complexes","title":"2. Exigences Reporting Complexes","text":"<p>Exemple : Tableau de Bord Admin E-Commerce</p> <pre><code>// Mod\u00e8le \u00e9criture : entit\u00e9s normalis\u00e9es\nOrder -&gt; OrderItem -&gt; Product\nCustomer -&gt; Address\n\n// Mod\u00e8le lecture : vue d\u00e9normalis\u00e9e\ninterface AdminDashboardQueryInterface\n{\n    public function getOrderSummary(): OrderSummaryDTO;\n    // Retourne : total commandes, revenu, valeur commande moyenne, top produits\n    // Tout d\u00e9normalis\u00e9 en une seule requ\u00eate optimis\u00e9e\n}\n</code></pre> <p>Pourquoi CQRS aide : Mod\u00e8le lecture peut \u00eatre d\u00e9normalis\u00e9 pour reporting rapide sans polluer mod\u00e8le \u00e9criture.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#3-multiples-representations-lecture","title":"3. Multiples Repr\u00e9sentations Lecture","text":"<p>Exemple : Catalogue Produits</p> <pre><code>// Mod\u00e8le \u00e9criture : entit\u00e9 Product unique\nclass Product { /* logique m\u00e9tier */ }\n\n// Mod\u00e8les lecture : multiples projections\ninterface ProductListQueryInterface\n{\n    public function findAll(): array; // Liste simple\n}\n\ninterface ProductDetailQueryInterface\n{\n    public function findById(ProductId $id): ProductDetailDTO; // D\u00e9tails complets\n}\n\ninterface ProductSearchQueryInterface\n{\n    public function search(string $query): array; // Elasticsearch\n}\n</code></pre> <p>Pourquoi CQRS aide : Diff\u00e9rents mod\u00e8les lecture pour diff\u00e9rents cas d'usage sans couplage.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#4-exigences-coherence-differentes","title":"4. Exigences Coh\u00e9rence Diff\u00e9rentes","text":"<pre><code>// \u00c9criture : doit \u00eatre fortement coh\u00e9rent\n$this-&gt;orderRepository-&gt;save($order); // Coh\u00e9rence imm\u00e9diate\n\n// Lecture : peut \u00eatre \u00e9ventuellement coh\u00e9rent\n$orders = $this-&gt;orderQuery-&gt;findRecent(); // L\u00e9ger d\u00e9lai OK\n</code></pre> <p>Pourquoi CQRS aide : Accepter coh\u00e9rence \u00e9ventuelle en lecture pour am\u00e9liorer d\u00e9bit \u00e9criture.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#5-piste-audit-event-sourcing","title":"5. Piste Audit / Event Sourcing","text":"<pre><code>// \u00c9criture : \u00e9v\u00e9nements stock\u00e9s\n$this-&gt;commandBus-&gt;dispatch(new UpdatePriceCommand(...));\n// Produit : PriceUpdatedEvent stock\u00e9 dans event store\n\n// Lecture : vue mat\u00e9rialis\u00e9e depuis \u00e9v\u00e9nements\n$product = $this-&gt;queries-&gt;findById($productId);\n// Reconstruit depuis \u00e9v\u00e9nements ou projection cach\u00e9e\n</code></pre> <p>Pourquoi CQRS aide : S'adapte naturellement avec event sourcing (\u00e9v\u00e9nements = mod\u00e8le \u00e9criture, projections = mod\u00e8le lecture).</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#quand-ne-pas-utiliser-cqrs","title":"Quand NE PAS Utiliser CQRS","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#mauvais-cas-dusage","title":"\u274c Mauvais Cas d'Usage","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#1-applications-crud-simples","title":"1. Applications CRUD Simples","text":"<pre><code>// Juste cr\u00e9er, lire, mettre \u00e0 jour, supprimer utilisateurs\n// \u274c CQRS est excessif ici\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findAll(): array;\n    public function delete(User $user): void;\n}\n\n// \u2705 Repository unique suffit\n</code></pre> <p>Pourquoi \u00e9viter CQRS : Pas de goulot performance, pas de requ\u00eates complexes, complexit\u00e9 inutile.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#2-coherence-forte-requise-partout","title":"2. Coh\u00e9rence Forte Requise Partout","text":"<pre><code>// Banque : utilisateur v\u00e9rifie solde, puis retire\n$balance = $this-&gt;accountQuery-&gt;getBalance($accountId);\n// \u274c Si BD lecture d\u00e9synchronis\u00e9e, affiche mauvais solde!\n\n$this-&gt;commandBus-&gt;dispatch(new WithdrawCommand($accountId, $amount));\n// \u274c Peut permettre d\u00e9couvert \u00e0 cause lecture obsol\u00e8te\n</code></pre> <p>Pourquoi \u00e9viter CQRS : Coh\u00e9rence \u00e9ventuelle peut causer bugs dans sc\u00e9narios n\u00e9cessitant coh\u00e9rence forte.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#3-petite-equipe-delais-serres","title":"3. Petite \u00c9quipe, D\u00e9lais Serr\u00e9s","text":"<ul> <li>2-3 d\u00e9veloppeurs</li> <li>D\u00e9lai 3 mois</li> <li>Application web simple</li> </ul> <p>Pourquoi \u00e9viter CQRS : Surcharge pas valable, ralentira livraison.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#4-trafic-faible","title":"4. Trafic Faible","text":"<ul> <li>100 utilisateurs par jour</li> <li>10 requ\u00eates par minute</li> </ul> <p>Pourquoi \u00e9viter CQRS : Pas de probl\u00e8me performance \u00e0 r\u00e9soudre, optimisation pr\u00e9matur\u00e9e.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#5-systemes-intensifs-ecriture","title":"5. Syst\u00e8mes Intensifs \u00c9criture","text":"<ul> <li>Syst\u00e8me logging (\u00e9critures &gt;&gt; lectures)</li> <li>Pipeline ingestion donn\u00e9es</li> </ul> <p>Pourquoi \u00e9viter CQRS : CQRS optimise lectures, mais ce syst\u00e8me est intensif \u00e9criture.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#niveaux-dimplementation","title":"Niveaux d'Impl\u00e9mentation","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#niveau-0-modele-unique-pas-cqrs","title":"Niveau 0 : Mod\u00e8le Unique (Pas CQRS)","text":"<pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n}\n</code></pre> <p>Complexit\u00e9 : Faible Quand utiliser : Petites apps, CRUD simple</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#niveau-1-interfaces-separees-meme-base-de-donnees","title":"Niveau 1 : Interfaces S\u00e9par\u00e9es, M\u00eame Base de Donn\u00e9es","text":"<pre><code>// Interface \u00e9criture\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n}\n\n// Interface lecture\ninterface UserQueryInterface\n{\n    public function findById(UserId $id): ?UserDTO;\n}\n\n// Les deux utilisent m\u00eame BD, interfaces diff\u00e9rentes\n</code></pre> <p>Complexit\u00e9 : Moyenne Quand utiliser : S\u00e9paration logique, m\u00eame BD</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#niveau-2-modeles-separes-meme-base-de-donnees","title":"Niveau 2 : Mod\u00e8les S\u00e9par\u00e9s, M\u00eame Base de Donn\u00e9es","text":"<pre><code>// \u00c9criture : utilise entit\u00e9s\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void { /* ORM */ }\n}\n\n// Lecture : utilise SQL brut\nclass SqlUserQuery implements UserQueryInterface\n{\n    public function findById(UserId $id): ?UserDTO\n    {\n        // SQL brut optimis\u00e9 pour lectures\n        $stmt = $this-&gt;connection-&gt;executeQuery('SELECT ...');\n        return $this-&gt;hydrateDTO($stmt-&gt;fetchAssociative());\n    }\n}\n</code></pre> <p>Complexit\u00e9 : Moyenne-\u00c9lev\u00e9e Quand utiliser : Optimiser lectures, toujours BD unique</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#niveau-3-bases-de-donnees-separees-cqrs-complet","title":"Niveau 3 : Bases de Donn\u00e9es S\u00e9par\u00e9es (CQRS Complet)","text":"<pre><code>// \u00c9criture : BD Master\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        $this-&gt;entityManager-&gt;persist($user); // BD \u00e9criture\n        $this-&gt;eventBus-&gt;dispatch(new UserSavedEvent($user)); // D\u00e9clencher sync\n    }\n}\n\n// Lecture : BD Replica\nclass ReplicaUserQuery implements UserQueryInterface\n{\n    public function findById(UserId $id): ?UserDTO\n    {\n        return $this-&gt;replicaConnection-&gt;fetchOne(...); // BD lecture\n    }\n}\n\n// Gestionnaire \u00e9v\u00e9nement synchronise \u00e9criture \u2192 lecture\nclass UserSavedEventHandler\n{\n    public function __invoke(UserSavedEvent $event): void\n    {\n        $this-&gt;readDatabase-&gt;upsertUser(...); // Sync\n    }\n}\n</code></pre> <p>Complexit\u00e9 : \u00c9lev\u00e9e Quand utiliser : Grande \u00e9chelle, mise \u00e0 l'\u00e9chelle ind\u00e9pendante n\u00e9cessaire</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#exemples-de-decisions-reelles","title":"Exemples de D\u00e9cisions R\u00e9elles","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#exemple-1-plateforme-blog","title":"Exemple 1 : Plateforme Blog","text":"<p>Sc\u00e9nario : - 10 000 articles - 1M vues pages/mois - 50 nouveaux articles/jour</p> <p>Lectures : Voir articles (99% du trafic) \u00c9critures : Publier articles (1% du trafic)</p> <p>D\u00e9cision : \u2705 Utiliser CQRS Niveau 1</p> <pre><code>// \u00c9criture : entit\u00e9 avec logique m\u00e9tier\ninterface ArticleRepositoryInterface\n{\n    public function save(Article $article): void;\n}\n\n// Lecture : DTOs optimis\u00e9s\ninterface ArticleQueryInterface\n{\n    public function findPublished(int $limit, int $offset): array;\n    public function findBySlug(string $slug): ?ArticleDetailDTO;\n}\n</code></pre> <p>Raison : Ratio lecture/\u00e9criture \u00e9lev\u00e9, m\u00eame BD convient, s\u00e9paration logique aide.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#exemple-2-application-todo-simple","title":"Exemple 2 : Application Todo Simple","text":"<p>Sc\u00e9nario : - 1 000 utilisateurs - CRUD simple (cr\u00e9er, lire, mettre \u00e0 jour, supprimer t\u00e2ches) - Trafic faible</p> <p>D\u00e9cision : \u274c Ne pas utiliser CQRS</p> <pre><code>// Repository unique suffit\ninterface TaskRepositoryInterface\n{\n    public function save(Task $task): void;\n    public function findById(TaskId $id): ?Task;\n    public function findByUser(UserId $userId): array;\n    public function delete(Task $task): void;\n}\n</code></pre> <p>Raison : Pas de probl\u00e8me performance, pas de requ\u00eates complexes, CQRS ajoute complexit\u00e9 inutile.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#exemple-3-plateforme-e-commerce","title":"Exemple 3 : Plateforme E-Commerce","text":"<p>Sc\u00e9nario : - 100 000 produits - 10 000 commandes/jour - Tableau de bord admin complexe (rapports ventes, inventaire, analytics)</p> <p>D\u00e9cision : \u2705 Utiliser CQRS Niveau 2-3</p> <pre><code>// \u00c9criture : entit\u00e9s normalis\u00e9es\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n}\n\n// Lecture : projections d\u00e9normalis\u00e9es\ninterface AdminDashboardQueryInterface\n{\n    public function getSalesReport(): SalesReportDTO;\n    public function getInventoryStatus(): InventoryDTO;\n}\n\ninterface OrderQueryInterface\n{\n    public function findRecent(int $limit): array;\n}\n</code></pre> <p>Raison : Reporting complexe, volume lecture \u00e9lev\u00e9, coh\u00e9rence \u00e9ventuelle acceptable pour tableaux de bord.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#exemple-4-systeme-bancaire","title":"Exemple 4 : Syst\u00e8me Bancaire","text":"<p>Sc\u00e9nario : - Soldes comptes doivent \u00eatre pr\u00e9cis - Transactions doivent \u00eatre fortement coh\u00e9rentes</p> <p>D\u00e9cision : \u274c Ne pas utiliser CQRS (ou utiliser Niveau 1 seulement)</p> <pre><code>// Mod\u00e8le unique, coh\u00e9rence forte\ninterface AccountRepositoryInterface\n{\n    public function save(Account $account): void;\n    public function findById(AccountId $id): ?Account;\n    // M\u00eame BD, coh\u00e9rence imm\u00e9diate\n}\n</code></pre> <p>Raison : Coh\u00e9rence forte requise, coh\u00e9rence \u00e9ventuelle inacceptable.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#strategie-de-migration","title":"Strat\u00e9gie de Migration","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#etape-1-identifier-candidats","title":"\u00c9tape 1 : Identifier Candidats","text":"<p>Chercher : - \u2705 Ratio lecture/\u00e9criture \u00e9lev\u00e9 - \u2705 Requ\u00eates complexes - \u2705 Goulots performance en lecture</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#etape-2-commencer-avec-niveau-1-meme-bd-interfaces-separees","title":"\u00c9tape 2 : Commencer avec Niveau 1 (M\u00eame BD, Interfaces S\u00e9par\u00e9es)","text":"<pre><code>// Diviser repository en \u00e9criture + lecture\n// Avant :\ninterface UserRepositoryInterface { /* toutes m\u00e9thodes */ }\n\n// Apr\u00e8s :\ninterface UserRepositoryInterface { /* m\u00e9thodes \u00e9criture */ }\ninterface UserQueryInterface { /* m\u00e9thodes lecture */ }\n</code></pre> <p>B\u00e9n\u00e9fice : S\u00e9paration logique, risque faible.</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#etape-3-optimiser-requetes-lecture","title":"\u00c9tape 3 : Optimiser Requ\u00eates Lecture","text":"<pre><code>// Interface lecture utilise SQL brut au lieu ORM\nclass SqlUserQuery implements UserQueryInterface\n{\n    public function findAll(): array\n    {\n        // SQL optimis\u00e9 avec cache\n        return $this-&gt;cache-&gt;remember('users.all', function() {\n            return $this-&gt;connection-&gt;fetchAllAssociative('SELECT ...');\n        });\n    }\n}\n</code></pre>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#etape-4-considerer-bd-lecture-separee-si-necessaire","title":"\u00c9tape 4 : Consid\u00e9rer BD Lecture S\u00e9par\u00e9e (Si N\u00e9cessaire)","text":"<p>Seulement si : - Charge lecture trop \u00e9lev\u00e9e pour BD unique - Besoin mise \u00e0 l'\u00e9chelle ind\u00e9pendante</p>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#diagramme-de-decision","title":"Diagramme de D\u00e9cision","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'12px'}}}%%\ngraph TD\n    Start[Besoin s\u00e9parer lectures/\u00e9critures?] --&gt; Q1{CRUD simple?}\n\n    Q1 --&gt;|Oui| NoCQRS[\u274c NE PAS utiliser CQRS&lt;br/&gt;Repository unique convient]\n    Q1 --&gt;|Non| Q2{Ratio lecture/\u00e9criture \u00e9lev\u00e9?&lt;br/&gt;90%+ lectures?}\n\n    Q2 --&gt;|Non| Q3{Reporting complexe?}\n    Q2 --&gt;|Oui| Level1[\u2705 Utiliser CQRS Niveau 1&lt;br/&gt;Interfaces s\u00e9par\u00e9es, m\u00eame BD]\n\n    Q3 --&gt;|Non| Q4{Coh\u00e9rence forte&lt;br/&gt;requise partout?}\n    Q3 --&gt;|Oui| Level1\n\n    Q4 --&gt;|Oui| NoCQRS\n    Q4 --&gt;|Non| Q5{Goulot performance&lt;br/&gt;en lecture?}\n\n    Q5 --&gt;|Non| NoCQRS\n    Q5 --&gt;|Oui| Q6{Besoin BD lecture&lt;br/&gt;s\u00e9par\u00e9e?}\n\n    Q6 --&gt;|Non| Level2[\u2705 Utiliser CQRS Niveau 2&lt;br/&gt;Mod\u00e8les s\u00e9par\u00e9s, m\u00eame BD]\n    Q6 --&gt;|Oui| Level3[\u2705 Utiliser CQRS Niveau 3&lt;br/&gt;Bases de donn\u00e9es s\u00e9par\u00e9es]\n\n    style NoCQRS fill:#FFCDD2,stroke:#C62828,stroke-width:2px\n    style Level1 fill:#C8E6C9,stroke:#2E7D32,stroke-width:2px\n    style Level2 fill:#FFF9C4,stroke:#F57F17,stroke-width:2px\n    style Level3 fill:#B3E5FC,stroke:#0277BD,stroke-width:2px</code></pre>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#resume","title":"R\u00e9sum\u00e9","text":""},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#utiliser-cqrs-quand","title":"\u2705 Utiliser CQRS Quand :","text":"<ol> <li>Ratio lecture/\u00e9criture \u00e9lev\u00e9 (90%+ lectures)</li> <li>Exigences reporting complexes</li> <li>Exigences coh\u00e9rence diff\u00e9rentes (coh\u00e9rence \u00e9ventuelle acceptable)</li> <li>Goulot performance en lecture</li> <li>Multiples repr\u00e9sentations lecture n\u00e9cessaires</li> </ol>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#eviter-cqrs-quand","title":"\u274c \u00c9viter CQRS Quand :","text":"<ol> <li>Application CRUD simple</li> <li>Coh\u00e9rence forte requise partout</li> <li>Petite \u00e9quipe, d\u00e9lais serr\u00e9s</li> <li>Trafic faible, pas de probl\u00e8mes performance</li> <li>Syst\u00e8me intensif \u00e9criture</li> </ol>"},{"location":"fr/advanced/cqrs-analyse-couts-benefices/#regle-dor","title":"\ud83c\udfaf R\u00e8gle d'Or :","text":"<p>N'utilisez pas CQRS par d\u00e9faut. Ajoutez-le quand vous avez un probl\u00e8me de performance prouv\u00e9 ou des exigences de lecture complexes.</p> <p>Suivant : Guide Injection de D\u00e9pendances \u2192</p>"},{"location":"fr/advanced/domaine-vs-application/","title":"Logique Domaine vs Application : Guide de D\u00e9cision","text":""},{"location":"fr/advanced/domaine-vs-application/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>La Question Centrale</li> <li>Diagramme de D\u00e9cision Rapide</li> <li>La R\u00e8gle d'Or</li> <li>Responsabilit\u00e9s de la Couche Domaine</li> <li>Responsabilit\u00e9s de la Couche Application</li> <li>Exemples Concrets</li> <li>Erreurs Courantes</li> <li>Les Tests Comme Validation</li> </ol>"},{"location":"fr/advanced/domaine-vs-application/#la-question-centrale","title":"La Question Centrale","text":"<p>O\u00f9 cette logique doit-elle vivre : dans le Domaine (Entit\u00e9/Value Object) ou dans l'Application (Handler) ?</p> <p>C'est LA question la plus fr\u00e9quente lors de l'impl\u00e9mentation d'une architecture hexagonale. La fronti\u00e8re entre Domaine et Application est souvent floue, conduisant \u00e0 : - Mod\u00e8le de Domaine An\u00e9mique - Les entit\u00e9s deviennent des conteneurs de donn\u00e9es, les handlers contiennent toute la logique - Handlers Ob\u00e8ses - La couche Application contient des r\u00e8gles m\u00e9tier qui devraient \u00eatre dans le domaine</p>"},{"location":"fr/advanced/domaine-vs-application/#diagramme-de-decision-rapide","title":"Diagramme de D\u00e9cision Rapide","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'14px'}}}%%\ngraph TD\n    Start[Logique \u00e0 impl\u00e9menter] --&gt; Q1{Est-ce une r\u00e8gle m\u00e9tier&lt;br/&gt;ou un invariant ?}\n\n    Q1 --&gt;|Oui| Q2{Cela implique-t-il&lt;br/&gt;une seule entit\u00e9 ?}\n    Q1 --&gt;|Non| Application[COUCHE APPLICATION&lt;br/&gt;Handler/Service]\n\n    Q2 --&gt;|Oui| Domain1[COUCHE DOMAINE&lt;br/&gt;M\u00e9thode d'Entit\u00e9]\n    Q2 --&gt;|Non| Q3{Cela implique-t-il&lt;br/&gt;plusieurs entit\u00e9s&lt;br/&gt;du m\u00eame agr\u00e9gat ?}\n\n    Q3 --&gt;|Oui| Domain2[COUCHE DOMAINE&lt;br/&gt;M\u00e9thode Racine d'Agr\u00e9gat]\n    Q3 --&gt;|Non| Q4{Cela implique-t-il&lt;br/&gt;plusieurs agr\u00e9gats&lt;br/&gt;ou services externes ?}\n\n    Q4 --&gt;|Oui| Application\n    Q4 --&gt;|Non| Q5{Est-ce une orchestration&lt;br/&gt;de workflow ?}\n\n    Q5 --&gt;|Oui| Application\n    Q5 --&gt;|Non| Q6{Peut-il \u00eatre exprim\u00e9&lt;br/&gt;sans infrastructure ?}\n\n    Q6 --&gt;|Oui| Domain3[COUCHE DOMAINE&lt;br/&gt;Service de Domaine]\n    Q6 --&gt;|Non| Application\n\n    style Domain1 fill:#C8E6C9,stroke:#2E7D32,stroke-width:3px\n    style Domain2 fill:#C8E6C9,stroke:#2E7D32,stroke-width:3px\n    style Domain3 fill:#C8E6C9,stroke:#2E7D32,stroke-width:3px\n    style Application fill:#B3E5FC,stroke:#0277BD,stroke-width:3px</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#la-regle-dor","title":"La R\u00e8gle d'Or","text":"<p>Si un expert m\u00e9tier le d\u00e9crirait comme une r\u00e8gle, cela appartient au Domaine.</p> <p>Si un expert m\u00e9tier le d\u00e9crirait comme un processus/workflow, cela appartient \u00e0 l'Application.</p>"},{"location":"fr/advanced/domaine-vs-application/#exemples","title":"Exemples :","text":"<ul> <li>\u274c \"Quand un utilisateur s'inscrit, lui envoyer un email\" \u2192 Application (workflow/orchestration)</li> <li>\u2705 \"Un utilisateur ne peut pas \u00eatre activ\u00e9 s'il est d\u00e9j\u00e0 actif\" \u2192 Domaine (invariant m\u00e9tier)</li> <li>\u274c \"Sauvegarder l'utilisateur, puis logger l'\u00e9v\u00e9nement, puis notifier les admins\" \u2192 Application (orchestration)</li> <li>\u2705 \"Le total d'une commande doit \u00e9galer la somme des lignes\" \u2192 Domaine (r\u00e8gle m\u00e9tier)</li> </ul>"},{"location":"fr/advanced/domaine-vs-application/#responsabilites-de-la-couche-domaine","title":"Responsabilit\u00e9s de la Couche Domaine","text":""},{"location":"fr/advanced/domaine-vs-application/#le-domaine-doit-contenir","title":"\u2705 Le DOMAINE Doit Contenir :","text":""},{"location":"fr/advanced/domaine-vs-application/#1-invariants-metier","title":"1. Invariants M\u00e9tier","text":"<p>R\u00e8gles qui DOIVENT TOUJOURS \u00eatre vraies, quelle que soit la fa\u00e7on dont l'entit\u00e9 est utilis\u00e9e.</p> <pre><code>// \u2705 BON : Le domaine impose l'invariant\nclass Order\n{\n    private OrderStatus $status;\n    private \\DateTimeImmutable $shippedAt;\n\n    public function ship(): void\n    {\n        if ($this-&gt;status === OrderStatus::CANCELLED) {\n            throw new CannotShipCancelledOrderException();\n        }\n\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new OrderAlreadyShippedException();\n        }\n\n        $this-&gt;status = OrderStatus::SHIPPED;\n        $this-&gt;shippedAt = new \\DateTimeImmutable();\n    }\n}\n</code></pre> <p>Pourquoi dans le Domaine ? La r\u00e8gle \"les commandes annul\u00e9es ne peuvent pas \u00eatre exp\u00e9di\u00e9es\" est un invariant m\u00e9tier. Peu importe o\u00f9 <code>Order</code> est utilis\u00e9 (CLI, API, job en arri\u00e8re-plan), cette r\u00e8gle s'applique.</p>"},{"location":"fr/advanced/domaine-vs-application/#2-transitions-detat","title":"2. Transitions d'\u00c9tat","text":"<p>Logique gouvernant comment une entit\u00e9 passe d'un \u00e9tat \u00e0 un autre.</p> <pre><code>// \u2705 BON : Le domaine contr\u00f4le la machine \u00e0 \u00e9tats\nclass Invoice\n{\n    private InvoiceStatus $status;\n\n    public function markAsPaid(Money $amount): void\n    {\n        if (!$this-&gt;status-&gt;canTransitionTo(InvoiceStatus::PAID)) {\n            throw new InvalidInvoiceStatusTransitionException(\n                $this-&gt;status,\n                InvoiceStatus::PAID\n            );\n        }\n\n        if (!$amount-&gt;equals($this-&gt;totalAmount)) {\n            throw new InvalidPaymentAmountException($amount, $this-&gt;totalAmount);\n        }\n\n        $this-&gt;status = InvoiceStatus::PAID;\n        $this-&gt;paidAt = new \\DateTimeImmutable();\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#3-validation-des-value-objects","title":"3. Validation des Value Objects","text":"<p>Validation qui assure qu'une valeur a du sens dans le domaine m\u00e9tier.</p> <pre><code>// \u2705 BON : Le domaine valide les contraintes m\u00e9tier\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n\n        // R\u00e8gle m\u00e9tier : domaine entreprise uniquement\n        if (!str_ends_with($value, '@company.com')) {\n            throw new InvalidEmailDomainException($value);\n        }\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#4-calculs-bases-sur-les-donnees-de-lentite","title":"4. Calculs Bas\u00e9s sur les Donn\u00e9es de l'Entit\u00e9","text":"<p>Calculs purs utilisant les propri\u00e9t\u00e9s de l'entit\u00e9.</p> <pre><code>// \u2705 BON : Le domaine calcule les valeurs m\u00e9tier\nclass Order\n{\n    private array $items; // OrderItem[]\n    private Money $shippingCost;\n    private Discount $discount;\n\n    public function calculateTotal(): Money\n    {\n        $subtotal = array_reduce(\n            $this-&gt;items,\n            fn(Money $sum, OrderItem $item) =&gt; $sum-&gt;add($item-&gt;getTotal()),\n            Money::zero()\n        );\n\n        $afterDiscount = $this-&gt;discount-&gt;apply($subtotal);\n\n        return $afterDiscount-&gt;add($this-&gt;shippingCost);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#5-methodes-de-logique-metier","title":"5. M\u00e9thodes de Logique M\u00e9tier","text":"<p>M\u00e9thodes qui expriment des op\u00e9rations m\u00e9tier.</p> <pre><code>// \u2705 BON : Le domaine exprime des concepts m\u00e9tier\nclass Subscription\n{\n    private \\DateTimeImmutable $expiresAt;\n\n    public function isExpired(): bool\n    {\n        return $this-&gt;expiresAt &lt; new \\DateTimeImmutable();\n    }\n\n    public function renew(Period $period): void\n    {\n        if ($this-&gt;isExpired()) {\n            throw new CannotRenewExpiredSubscriptionException();\n        }\n\n        $this-&gt;expiresAt = $period-&gt;addTo($this-&gt;expiresAt);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#responsabilites-de-la-couche-application","title":"Responsabilit\u00e9s de la Couche Application","text":""},{"location":"fr/advanced/domaine-vs-application/#lapplication-doit-contenir","title":"\u2705 L'APPLICATION Doit Contenir :","text":""},{"location":"fr/advanced/domaine-vs-application/#1-orchestration-workflow","title":"1. Orchestration &amp; Workflow","text":"<p>Coordination de plusieurs op\u00e9rations en s\u00e9quence.</p> <pre><code>// \u2705 BON : L'application orchestre le workflow\nfinal readonly class RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users,\n        private EmailSenderInterface $emailSender,\n        private EventDispatcherInterface $eventDispatcher,\n    ) {}\n\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // 1. Cr\u00e9er l'entit\u00e9 de domaine (logique domaine dans la factory)\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        // 2. Persister (pr\u00e9occupation infrastructure)\n        $this-&gt;users-&gt;save($user);\n\n        // 3. Envoyer l'email (pr\u00e9occupation infrastructure)\n        $this-&gt;emailSender-&gt;send(\n            new WelcomeEmail($user-&gt;getEmail())\n        );\n\n        // 4. Dispatcher l'\u00e9v\u00e9nement (pr\u00e9occupation infrastructure)\n        $this-&gt;eventDispatcher-&gt;dispatch(\n            new UserRegisteredEvent($user-&gt;getId())\n        );\n    }\n}\n</code></pre> <p>Pourquoi dans l'Application ? C'est un workflow : \"faire ceci, puis cela, puis cela\". Il coordonne plusieurs pr\u00e9occupations d'infrastructure.</p>"},{"location":"fr/advanced/domaine-vs-application/#2-operations-cross-agregat","title":"2. Op\u00e9rations Cross-Agr\u00e9gat","text":"<p>Op\u00e9rations impliquant plusieurs racines d'agr\u00e9gat.</p> <pre><code>// \u2705 BON : L'application coordonne plusieurs agr\u00e9gats\nfinal readonly class TransferMoneyHandler\n{\n    public function __construct(\n        private AccountRepositoryInterface $accounts,\n        private TransactionRepositoryInterface $transactions,\n    ) {}\n\n    public function __invoke(TransferMoneyCommand $command): void\n    {\n        $sourceAccount = $this-&gt;accounts-&gt;findById($command-&gt;sourceAccountId);\n        $destinationAccount = $this-&gt;accounts-&gt;findById($command-&gt;destinationAccountId);\n\n        // Logique domaine : chaque compte valide ses propres r\u00e8gles\n        $sourceAccount-&gt;withdraw($command-&gt;amount);\n        $destinationAccount-&gt;deposit($command-&gt;amount);\n\n        // Logique application : coordonner la persistance des deux agr\u00e9gats\n        $this-&gt;accounts-&gt;save($sourceAccount);\n        $this-&gt;accounts-&gt;save($destinationAccount);\n\n        // Logique application : cr\u00e9er l'enregistrement de transaction\n        $transaction = new Transaction(\n            TransactionId::generate(),\n            $sourceAccount-&gt;getId(),\n            $destinationAccount-&gt;getId(),\n            $command-&gt;amount\n        );\n        $this-&gt;transactions-&gt;save($transaction);\n    }\n}\n</code></pre> <p>Pourquoi dans l'Application ? Modifier deux agr\u00e9gats diff\u00e9rents n\u00e9cessite une coordination au niveau application.</p>"},{"location":"fr/advanced/domaine-vs-application/#3-coordination-dinfrastructure","title":"3. Coordination d'Infrastructure","text":"<p>G\u00e9rer les repositories, emails, messaging, etc.</p> <pre><code>// \u2705 BON : L'application g\u00e8re l'infrastructure\nfinal readonly class PublishArticleHandler\n{\n    public function __construct(\n        private ArticleRepositoryInterface $articles,\n        private SearchIndexInterface $searchIndex,\n        private CacheInterface $cache,\n    ) {}\n\n    public function __invoke(PublishArticleCommand $command): void\n    {\n        $article = $this-&gt;articles-&gt;findById($command-&gt;articleId);\n\n        // Logique domaine\n        $article-&gt;publish();\n\n        // Coordination infrastructure\n        $this-&gt;articles-&gt;save($article);\n        $this-&gt;searchIndex-&gt;index($article);\n        $this-&gt;cache-&gt;invalidate(\"article:{$article-&gt;getId()}\");\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#4-gestion-des-transactions","title":"4. Gestion des Transactions","text":"<p>G\u00e9rer les transactions de base de donn\u00e9es \u00e0 travers les op\u00e9rations.</p> <pre><code>// \u2705 BON : L'application g\u00e8re les transactions\nfinal readonly class CheckoutOrderHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orders,\n        private InventoryServiceInterface $inventory,\n        private EntityManagerInterface $entityManager,\n    ) {}\n\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n            // Logique domaine\n            $order-&gt;confirm();\n\n            // Op\u00e9rations infrastructure dans la transaction\n            $this-&gt;orders-&gt;save($order);\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n\n            $this-&gt;entityManager-&gt;commit();\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n            throw $e;\n        }\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#5-validation-transformation-des-entrees","title":"5. Validation &amp; Transformation des Entr\u00e9es","text":"<p>Valider les entr\u00e9es externes et transformer en objets domaine.</p> <pre><code>// \u2705 BON : L'application valide les entr\u00e9es\nfinal readonly class CreateProductHandler\n{\n    public function __construct(\n        private ProductRepositoryInterface $products,\n        private ValidatorInterface $validator,\n    ) {}\n\n    public function __invoke(CreateProductCommand $command): void\n    {\n        // Application : valider la structure de la commande\n        $errors = $this-&gt;validator-&gt;validate($command);\n        if (count($errors) &gt; 0) {\n            throw new ValidationException($errors);\n        }\n\n        // Application : v\u00e9rifier les contraintes m\u00e9tier n\u00e9cessitant le repository\n        if ($this-&gt;products-&gt;existsByName($command-&gt;name)) {\n            throw new ProductNameAlreadyExistsException($command-&gt;name);\n        }\n\n        // Domaine : la factory contient la logique de cr\u00e9ation d'entit\u00e9\n        $product = ProductFactory::create(\n            name: $command-&gt;name,\n            price: Money::fromCents($command-&gt;priceInCents),\n            stock: $command-&gt;initialStock\n        );\n\n        // Application : persister\n        $this-&gt;products-&gt;save($product);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#exemples-concrets","title":"Exemples Concrets","text":""},{"location":"fr/advanced/domaine-vs-application/#exemple-1-annulation-de-commande","title":"Exemple 1 : Annulation de Commande","text":""},{"location":"fr/advanced/domaine-vs-application/#mauvais-logique-metier-dans-le-handler","title":"\u274c MAUVAIS : Logique M\u00e9tier dans le Handler","text":"<pre><code>// \u274c FAUX : Le handler contient des r\u00e8gles m\u00e9tier !\nfinal readonly class CancelOrderHandler\n{\n    public function __invoke(CancelOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        // Logique m\u00e9tier fuit\u00e9e dans le handler !\n        if ($order-&gt;getStatus() === OrderStatus::SHIPPED) {\n            throw new CannotCancelShippedOrderException();\n        }\n\n        if ($order-&gt;getStatus() === OrderStatus::DELIVERED) {\n            throw new CannotCancelDeliveredOrderException();\n        }\n\n        $order-&gt;setStatus(OrderStatus::CANCELLED);\n        $order-&gt;setCancelledAt(new \\DateTimeImmutable());\n\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre> <p>Probl\u00e8mes : - R\u00e8gles m\u00e9tier \u00e9parpill\u00e9es dans le handler - Impossible de r\u00e9utiliser la logique d'annulation ailleurs - Difficile de tester les r\u00e8gles d'annulation sans le handler - <code>Order</code> est juste un sac de donn\u00e9es (mod\u00e8le an\u00e9mique)</p>"},{"location":"fr/advanced/domaine-vs-application/#bon-logique-metier-dans-le-domaine","title":"\u2705 BON : Logique M\u00e9tier dans le Domaine","text":"<pre><code>// \u2705 CORRECT : L'entit\u00e9 impose les r\u00e8gles m\u00e9tier\nclass Order\n{\n    public function cancel(): void\n    {\n        if ($this-&gt;status === OrderStatus::SHIPPED) {\n            throw new CannotCancelShippedOrderException();\n        }\n\n        if ($this-&gt;status === OrderStatus::DELIVERED) {\n            throw new CannotCancelDeliveredOrderException();\n        }\n\n        $this-&gt;status = OrderStatus::CANCELLED;\n        $this-&gt;cancelledAt = new \\DateTimeImmutable();\n    }\n}\n\n// Le handler devient un orchestrateur mince\nfinal readonly class CancelOrderHandler\n{\n    public function __invoke(CancelOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        $order-&gt;cancel(); // Le domaine impose les r\u00e8gles\n\n        $this-&gt;orders-&gt;save($order);\n        $this-&gt;eventDispatcher-&gt;dispatch(new OrderCancelledEvent($order-&gt;getId()));\n    }\n}\n</code></pre> <p>B\u00e9n\u00e9fices : - R\u00e8gles m\u00e9tier encapsul\u00e9es dans le domaine - R\u00e9utilisable dans n'importe quel cas d'usage (API, CLI, job batch) - Facile \u00e0 tester en isolation - Le handler est un orchestrateur mince</p>"},{"location":"fr/advanced/domaine-vs-application/#exemple-2-inscription-utilisateur","title":"Exemple 2 : Inscription Utilisateur","text":""},{"location":"fr/advanced/domaine-vs-application/#mauvais-tout-dans-le-handler","title":"\u274c MAUVAIS : Tout dans le Handler","text":"<pre><code>// \u274c FAUX : M\u00e9lange des pr\u00e9occupations domaine et application\nfinal readonly class RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // Validation d'entr\u00e9e (OK dans l'application)\n        if (empty($command-&gt;email)) {\n            throw new InvalidArgumentException('Email requis');\n        }\n\n        // Validation m\u00e9tier (devrait \u00eatre dans le domaine !)\n        if (!filter_var($command-&gt;email, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException();\n        }\n\n        // R\u00e8gle m\u00e9tier (devrait \u00eatre dans le domaine !)\n        if (strlen($command-&gt;password) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        // V\u00e9rification de r\u00e8gle m\u00e9tier (OK, n\u00e9cessite le repository)\n        if ($this-&gt;users-&gt;existsByEmail($command-&gt;email)) {\n            throw new EmailAlreadyExistsException();\n        }\n\n        // Cr\u00e9ation d'entit\u00e9 (devrait \u00eatre dans une factory !)\n        $user = new User(\n            UserId::generate(),\n            new Email($command-&gt;email),\n            new HashedPassword($command-&gt;password),\n            false\n        );\n\n        $this-&gt;users-&gt;save($user);\n        $this-&gt;emailSender-&gt;send(new WelcomeEmail($user-&gt;getEmail()));\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#bon-separation-des-preoccupations","title":"\u2705 BON : S\u00e9paration des Pr\u00e9occupations","text":"<pre><code>// Domaine : Value Object avec validation\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n    }\n}\n\n// Domaine : Value Object avec validation\nfinal readonly class Password\n{\n    public function __construct(public string $value)\n    {\n        if (strlen($value) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n    }\n}\n\n// Domaine : Factory encapsule la logique de cr\u00e9ation\nfinal class UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            UserId::generate(),\n            new Email($email), // Valide dans le constructeur\n            HashedPassword::fromPlaintext($password), // Hash + valide\n            isActive: false\n        );\n    }\n}\n\n// Application : Orchestrateur mince\nfinal readonly class RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // Application : v\u00e9rifier l'unicit\u00e9 (n\u00e9cessite le repository)\n        if ($this-&gt;users-&gt;existsByEmail($command-&gt;email)) {\n            throw new EmailAlreadyExistsException($command-&gt;email);\n        }\n\n        // Domaine : la factory g\u00e8re la cr\u00e9ation + validation\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        // Application : orchestrer l'infrastructure\n        $this-&gt;users-&gt;save($user);\n        $this-&gt;emailSender-&gt;send(new WelcomeEmail($user-&gt;getEmail()));\n        $this-&gt;eventDispatcher-&gt;dispatch(new UserRegisteredEvent($user-&gt;getId()));\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#erreurs-courantes","title":"Erreurs Courantes","text":""},{"location":"fr/advanced/domaine-vs-application/#erreur-1-modele-de-domaine-anemique","title":"Erreur 1 : Mod\u00e8le de Domaine An\u00e9mique","text":"<p>Sympt\u00f4me : Les entit\u00e9s sont juste des conteneurs de donn\u00e9es avec getters/setters, toute la logique est dans les handlers.</p> <pre><code>// \u274c Entit\u00e9 an\u00e9mique\nclass Order\n{\n    private OrderStatus $status;\n\n    public function getStatus(): OrderStatus { return $this-&gt;status; }\n    public function setStatus(OrderStatus $status): void { $this-&gt;status = $status; }\n}\n\n// \u274c Handler avec logique m\u00e9tier\nclass ShipOrderHandler\n{\n    public function __invoke(ShipOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        if ($order-&gt;getStatus() !== OrderStatus::CONFIRMED) {\n            throw new InvalidOrderStatusException();\n        }\n\n        $order-&gt;setStatus(OrderStatus::SHIPPED);\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre> <p>Solution : D\u00e9placer la logique m\u00e9tier dans les m\u00e9thodes d'entit\u00e9.</p> <pre><code>// \u2705 Mod\u00e8le de domaine riche\nclass Order\n{\n    private OrderStatus $status;\n\n    public function ship(): void\n    {\n        if ($this-&gt;status !== OrderStatus::CONFIRMED) {\n            throw new CannotShipUnconfirmedOrderException();\n        }\n\n        $this-&gt;status = OrderStatus::SHIPPED;\n        $this-&gt;shippedAt = new \\DateTimeImmutable();\n    }\n}\n\n// \u2705 Handler mince\nclass ShipOrderHandler\n{\n    public function __invoke(ShipOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n        $order-&gt;ship(); // Le domaine g\u00e8re les r\u00e8gles\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#erreur-2-handlers-obeses-god-objects","title":"Erreur 2 : Handlers Ob\u00e8ses (God Objects)","text":"<p>Sympt\u00f4me : Les handlers contiennent des centaines de lignes, plusieurs responsabilit\u00e9s.</p> <pre><code>// \u274c Handler ob\u00e8se avec trop de responsabilit\u00e9s\nclass ProcessOrderHandler\n{\n    public function __invoke(ProcessOrderCommand $command): void\n    {\n        // 200 lignes de validation, calcul, orchestration...\n        // R\u00e8gles m\u00e9tier m\u00e9lang\u00e9es avec l'infrastructure\n        // Difficile \u00e0 tester, difficile \u00e0 comprendre\n    }\n}\n</code></pre> <p>Solution : Extraire la logique m\u00e9tier vers le domaine, garder le handler focalis\u00e9 sur l'orchestration.</p>"},{"location":"fr/advanced/domaine-vs-application/#erreur-3-logique-metier-necessitant-un-repository","title":"Erreur 3 : Logique M\u00e9tier N\u00e9cessitant un Repository","text":"<p>Sympt\u00f4me : Essayer de mettre une logique n\u00e9cessitant des donn\u00e9es externes dans le domaine.</p> <pre><code>// \u274c FAUX : L'entit\u00e9 ne peut pas acc\u00e9der au repository\nclass User\n{\n    public function changeEmail(Email $newEmail, UserRepositoryInterface $users): void\n    {\n        // Ne peut pas injecter le repository dans l'entit\u00e9 !\n        if ($users-&gt;existsByEmail($newEmail)) {\n            throw new EmailAlreadyExistsException();\n        }\n\n        $this-&gt;email = $newEmail;\n    }\n}\n</code></pre> <p>Solution : Mettre la v\u00e9rification dans la couche application.</p> <pre><code>// \u2705 CORRECT : L'application v\u00e9rifie, le domaine met \u00e0 jour\nclass ChangeUserEmailHandler\n{\n    public function __invoke(ChangeUserEmailCommand $command): void\n    {\n        $user = $this-&gt;users-&gt;findById($command-&gt;userId);\n\n        // Application : v\u00e9rification d'unicit\u00e9 n\u00e9cessite le repository\n        if ($this-&gt;users-&gt;existsByEmail($command-&gt;newEmail)) {\n            throw new EmailAlreadyExistsException($command-&gt;newEmail);\n        }\n\n        // Domaine : simple mise \u00e0 jour avec validation\n        $user-&gt;changeEmail(new Email($command-&gt;newEmail));\n\n        $this-&gt;users-&gt;save($user);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#les-tests-comme-validation","title":"Les Tests Comme Validation","text":"<p>Une bonne s\u00e9paration signifie des tests faciles :</p>"},{"location":"fr/advanced/domaine-vs-application/#tests-du-domaine-sans-infrastructure","title":"Tests du Domaine (Sans Infrastructure)","text":"<pre><code>// \u2705 Tester la logique domaine sans aucune infrastructure\nclass OrderTest extends TestCase\n{\n    public function test_cannot_ship_cancelled_order(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::CANCELLED);\n\n        $this-&gt;expectException(CannotShipCancelledOrderException::class);\n\n        $order-&gt;ship();\n    }\n\n    // Pas de base de donn\u00e9es, pas de framework, tests PHP purs\n}\n</code></pre>"},{"location":"fr/advanced/domaine-vs-application/#tests-de-lapplication-avec-doublures-de-test","title":"Tests de l'Application (Avec Doublures de Test)","text":"<pre><code>// \u2705 Tester l'orchestration du handler avec repository en m\u00e9moire\nclass ShipOrderHandlerTest extends TestCase\n{\n    public function test_ships_order_and_dispatches_event(): void\n    {\n        $orders = new InMemoryOrderRepository(); // Fausse infrastructure\n        $events = new InMemoryEventDispatcher();\n        $handler = new ShipOrderHandler($orders, $events);\n\n        $order = new Order(OrderId::generate(), OrderStatus::CONFIRMED);\n        $orders-&gt;save($order);\n\n        $handler(new ShipOrderCommand($order-&gt;getId()));\n\n        $this-&gt;assertEquals(OrderStatus::SHIPPED, $order-&gt;getStatus());\n        $this-&gt;assertTrue($events-&gt;wasDispatched(OrderShippedEvent::class));\n    }\n}\n</code></pre> <p>Si vous ne pouvez pas tester la logique domaine sans infrastructure, votre s\u00e9paration est incorrecte.</p>"},{"location":"fr/advanced/domaine-vs-application/#matrice-de-decision-resumee","title":"Matrice de D\u00e9cision R\u00e9sum\u00e9e","text":"Question Domaine Application Est-ce un invariant m\u00e9tier ? \u2705 \u274c Implique une seule entit\u00e9 ? \u2705 \u274c Logique de transition d'\u00e9tat ? \u2705 \u274c Validation de value object ? \u2705 \u274c Calculs sur donn\u00e9es d'entit\u00e9 ? \u2705 \u274c N\u00e9cessite repository/infrastructure ? \u274c \u2705 Orchestre plusieurs op\u00e9rations ? \u274c \u2705 Implique plusieurs agr\u00e9gats ? \u274c \u2705 Gestion de transaction ? \u274c \u2705 Appels de services externes ? \u274c \u2705 Validation d'entr\u00e9e ? \u274c \u2705"},{"location":"fr/advanced/domaine-vs-application/#points-cles-a-retenir","title":"Points Cl\u00e9s \u00e0 Retenir","text":"<ol> <li>Domaine = \"QUELLES sont les r\u00e8gles m\u00e9tier ?\"</li> <li>Application = \"COMMENT orchestrons-nous ces r\u00e8gles ?\"</li> <li>En cas de doute : Un expert m\u00e9tier peut-il l'expliquer sans mentionner la technologie ? \u2192 Domaine</li> <li>Smell de test : Besoin d'une base de donn\u00e9es pour tester une r\u00e8gle m\u00e9tier \u2192 Mauvaise couche</li> <li>Domaine riche &gt; Domaine an\u00e9mique : Les entit\u00e9s doivent avoir du comportement, pas juste des donn\u00e9es</li> <li>Handlers minces &gt; Handlers ob\u00e8ses : Les handlers orchestrent, n'impl\u00e9mentent pas les r\u00e8gles m\u00e9tier</li> </ol> <p>Suivant : Flux Requ\u00eate-R\u00e9ponse \u2192</p>"},{"location":"fr/advanced/flux-requete-reponse/","title":"Flux Requ\u00eate-R\u00e9ponse Complet : Voyage End-to-End","text":""},{"location":"fr/advanced/flux-requete-reponse/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>Vue d'Ensemble</li> <li>Le Diagramme de Flux Complet</li> <li>D\u00e9composition \u00c9tape par \u00c9tape</li> <li>Transformations de Donn\u00e9es</li> <li>Exemple R\u00e9el : Inscription Utilisateur</li> <li>Flux d'Erreur</li> <li>Consid\u00e9rations de Performance</li> </ol>"},{"location":"fr/advanced/flux-requete-reponse/#vue-densemble","title":"Vue d'Ensemble","text":"<p>Comprendre comment une requ\u00eate traverse toutes les couches de l'architecture hexagonale est crucial. Ce guide montre le voyage complet de la requ\u00eate HTTP \u00e0 la base de donn\u00e9es et retour, avec les transformations de donn\u00e9es \u00e0 chaque fronti\u00e8re.</p>"},{"location":"fr/advanced/flux-requete-reponse/#le-voyage-en-une-phrase","title":"Le Voyage en Une Phrase","text":"<p>JSON HTTP \u2192 Contr\u00f4leur \u2192 DTO Command \u2192 Handler \u2192 Entit\u00e9 Domain \u2192 Port Repository \u2192 Adaptateur Doctrine \u2192 Base de Donn\u00e9es \u2192 Entit\u00e9 \u2192 R\u00e9sultat Query \u2192 DTO Response \u2192 Contr\u00f4leur \u2192 JSON HTTP</p>"},{"location":"fr/advanced/flux-requete-reponse/#le-diagramme-de-flux-complet","title":"Le Diagramme de Flux Complet","text":"<pre><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'13px'}}}%%\nsequenceDiagram\n    autonumber\n\n    participant Client as \ud83c\udf10 Client&lt;br/&gt;(Navigateur/API)\n    participant Router as \ud83d\udea6 Router Symfony\n    participant Ctrl as \ud83c\udfae Contr\u00f4leur&lt;br/&gt;(Infrastructure)\n    participant Valid as \u2705 Validateur&lt;br/&gt;(Symfony)\n    participant Bus as \ud83d\ude8c Message Bus&lt;br/&gt;(Symfony)\n    participant Handler as \u2699\ufe0f Handler&lt;br/&gt;(Application)\n    participant Factory as \ud83c\udfed Factory&lt;br/&gt;(Domaine)\n    participant Entity as \ud83d\udc8e Entit\u00e9&lt;br/&gt;(Domaine)\n    participant Port as \ud83d\udd0c Port&lt;br/&gt;(Interface Domaine)\n    participant Adapter as \ud83d\udd27 Adaptateur&lt;br/&gt;(Infrastructure)\n    participant DB as \ud83d\uddc4\ufe0f Base de Donn\u00e9es&lt;br/&gt;(PostgreSQL)\n\n    rect rgb(255, 240, 240)\n        Note over Client,Router: REQU\u00caTE ENTRANTE\n        Client-&gt;&gt;Router: POST /api/users&lt;br/&gt;{\"email\": \"user@example.com\", \"password\": \"secret123\"}\n        Router-&gt;&gt;Ctrl: Route vers RegisterUserController\n    end\n\n    rect rgb(240, 248, 255)\n        Note over Ctrl,Valid: COUCHE INFRASTRUCTURE : Validation Entr\u00e9e\n        Ctrl-&gt;&gt;Ctrl: D\u00e9s\u00e9rialiser JSON vers DTO RegisterUserRequest\n        Ctrl-&gt;&gt;Valid: Valider contraintes DTO\n        Valid--&gt;&gt;Ctrl: Validation OK\n        Ctrl-&gt;&gt;Bus: Cr\u00e9er RegisterUserCommand&lt;br/&gt;dispatch(command)\n    end\n\n    rect rgb(240, 255, 240)\n        Note over Bus,Handler: COUCHE APPLICATION : Orchestration\n        Bus-&gt;&gt;Handler: __invoke(RegisterUserCommand)\n        Handler-&gt;&gt;Port: $this-&gt;users-&gt;existsByEmail()\n        Port-&gt;&gt;Adapter: existsByEmail()\n        Adapter-&gt;&gt;DB: SELECT COUNT(*) FROM users WHERE email = ?\n        DB--&gt;&gt;Adapter: 0\n        Adapter--&gt;&gt;Port: false\n        Port--&gt;&gt;Handler: false (email disponible)\n    end\n\n    rect rgb(255, 255, 240)\n        Note over Handler,Entity: COUCHE DOMAINE : Logique M\u00e9tier\n        Handler-&gt;&gt;Factory: UserFactory::create(email, password)\n        Factory-&gt;&gt;Entity: new Email(value)\n        Entity-&gt;&gt;Entity: valider format email\n        Entity--&gt;&gt;Factory: Email cr\u00e9\u00e9\n        Factory-&gt;&gt;Entity: HashedPassword::fromPlaintext()\n        Entity-&gt;&gt;Entity: hasher mot de passe + valider longueur\n        Entity--&gt;&gt;Factory: HashedPassword cr\u00e9\u00e9\n        Factory-&gt;&gt;Entity: new User(id, email, password)\n        Entity-&gt;&gt;Entity: appliquer r\u00e8gles m\u00e9tier\n        Entity--&gt;&gt;Factory: Entit\u00e9 User\n        Factory--&gt;&gt;Handler: Entit\u00e9 User\n    end\n\n    rect rgb(240, 248, 255)\n        Note over Handler,DB: COUCHE INFRASTRUCTURE : Persistance\n        Handler-&gt;&gt;Port: $this-&gt;users-&gt;save($user)\n        Port-&gt;&gt;Adapter: save($user)\n        Adapter-&gt;&gt;DB: INSERT INTO users (...) VALUES (...)\n        DB--&gt;&gt;Adapter: OK\n        Adapter--&gt;&gt;Port: void\n        Port--&gt;&gt;Handler: void\n    end\n\n    rect rgb(255, 240, 240)\n        Note over Handler,Client: CHEMIN DE R\u00c9PONSE\n        Handler--&gt;&gt;Bus: void (succ\u00e8s)\n        Bus--&gt;&gt;Ctrl: void\n        Ctrl-&gt;&gt;Ctrl: Cr\u00e9er DTO UserResponse&lt;br/&gt;depuis entit\u00e9 User\n        Ctrl--&gt;&gt;Router: Response(201, UserResponse)\n        Router--&gt;&gt;Client: 201 Created&lt;br/&gt;{\"id\": \"123\", \"email\": \"user@example.com\"}\n    end</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#decomposition-etape-par-etape","title":"D\u00e9composition \u00c9tape par \u00c9tape","text":""},{"location":"fr/advanced/flux-requete-reponse/#phase-1-entree-de-requete-infrastructure","title":"Phase 1 : Entr\u00e9e de Requ\u00eate (Infrastructure)","text":""},{"location":"fr/advanced/flux-requete-reponse/#etapes-1-2-routage","title":"\u00c9tapes 1-2 : Routage","text":"<pre><code>Entr\u00e9e:  POST /api/users HTTP/1.1\n         Content-Type: application/json\n         {\"email\": \"user@example.com\", \"password\": \"secret123\"}\n\nAction: Le Router Symfony matche la route \u2192 RegisterUserController\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#etape-3-deserialisation","title":"\u00c9tape 3 : D\u00e9s\u00e9rialisation","text":"<pre><code>// Le contr\u00f4leur re\u00e7oit la requ\u00eate brute\npublic function __invoke(Request $request): JsonResponse\n{\n    // D\u00e9s\u00e9rialiser JSON vers DTO\n    $dto = $this-&gt;serializer-&gt;deserialize(\n        $request-&gt;getContent(),\n        RegisterUserRequest::class,\n        'json'\n    );\n\n    // $dto est maintenant : RegisterUserRequest {\n    //     email: \"user@example.com\",\n    //     password: \"secret123\"\n    // }\n}\n</code></pre> <p>Transformation de Donn\u00e9es : <pre><code>Cha\u00eene JSON Brute \u2192 DTO RegisterUserRequest (Infrastructure)\n</code></pre></p>"},{"location":"fr/advanced/flux-requete-reponse/#etapes-4-5-validation","title":"\u00c9tapes 4-5 : Validation","text":"<pre><code>// Valider avec contraintes Symfony\n$errors = $this-&gt;validator-&gt;validate($dto);\n\nif (count($errors) &gt; 0) {\n    throw new ValidationException($errors);\n}\n\n// Classe DTO avec contraintes :\nclass RegisterUserRequest\n{\n    #[Assert\\NotBlank]\n    #[Assert\\Email]\n    public string $email;\n\n    #[Assert\\NotBlank]\n    #[Assert\\Length(min: 8)]\n    public string $password;\n}\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#etape-6-creer-command-dispatcher","title":"\u00c9tape 6 : Cr\u00e9er Command &amp; Dispatcher","text":"<pre><code>// Transformer DTO \u2192 Command (DTO Application)\n$command = new RegisterUserCommand(\n    email: $dto-&gt;email,\n    password: $dto-&gt;password\n);\n\n// Dispatcher vers message bus\n$this-&gt;messageBus-&gt;dispatch($command);\n</code></pre> <p>Transformation de Donn\u00e9es : <pre><code>DTO RegisterUserRequest \u2192 DTO RegisterUserCommand (Application)\n</code></pre></p>"},{"location":"fr/advanced/flux-requete-reponse/#phase-2-orchestration-couche-application","title":"Phase 2 : Orchestration Couche Application","text":""},{"location":"fr/advanced/flux-requete-reponse/#etape-7-invocation-du-handler","title":"\u00c9tape 7 : Invocation du Handler","text":"<pre><code>// Symfony invoque automatiquement le handler\n#[AsMessageHandler]\nfinal readonly class RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // Le handler d\u00e9marre l'orchestration\n    }\n}\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#etapes-8-12-verifier-lunicite-de-lemail","title":"\u00c9tapes 8-12 : V\u00e9rifier l'Unicit\u00e9 de l'Email","text":"<pre><code>// Le handler appelle le port\nif ($this-&gt;users-&gt;existsByEmail($command-&gt;email)) {\n    throw new EmailAlreadyExistsException($command-&gt;email);\n}\n\n// Interface port (Domaine)\ninterface UserRepositoryInterface\n{\n    public function existsByEmail(string $email): bool;\n}\n\n// Impl\u00e9mentation adaptateur (Infrastructure)\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function existsByEmail(string $email): bool\n    {\n        $qb = $this-&gt;entityManager-&gt;createQueryBuilder();\n        $qb-&gt;select('COUNT(u.id)')\n           -&gt;from(User::class, 'u')\n           -&gt;where('u.email = :email')\n           -&gt;setParameter('email', $email);\n\n        return (int) $qb-&gt;getQuery()-&gt;getSingleScalarResult() &gt; 0;\n    }\n}\n\n// Requ\u00eate base de donn\u00e9es ex\u00e9cut\u00e9e :\n// SELECT COUNT(id) FROM users WHERE email = 'user@example.com'\n</code></pre> <p>Flux de Donn\u00e9es : <pre><code>Command (cha\u00eene email)\n  \u2192 Appel m\u00e9thode Port\n    \u2192 Adaptateur (Doctrine QueryBuilder)\n      \u2192 Requ\u00eate SQL\n        \u2192 Base de Donn\u00e9es\n          \u2192 R\u00e9sultat (0)\n            \u2192 Adaptateur (false)\n              \u2192 Port (false)\n                \u2192 Handler (continue)\n</code></pre></p>"},{"location":"fr/advanced/flux-requete-reponse/#phase-3-logique-metier-couche-domaine","title":"Phase 3 : Logique M\u00e9tier Couche Domaine","text":""},{"location":"fr/advanced/flux-requete-reponse/#etape-13-invocation-de-la-factory","title":"\u00c9tape 13 : Invocation de la Factory","text":"<pre><code>// Le handler d\u00e9l\u00e8gue la cr\u00e9ation \u00e0 la factory\n$user = UserFactory::create($command-&gt;email, $command-&gt;password);\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#etapes-14-17-creation-du-value-object-email","title":"\u00c9tapes 14-17 : Cr\u00e9ation du Value Object Email","text":"<pre><code>// La factory cr\u00e9e le value object Email\n$email = new Email($command-&gt;email);\n\n// Le constructeur Email valide\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        // R\u00e8gle m\u00e9tier : doit \u00eatre un email valide\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n\n        // R\u00e8gle m\u00e9tier : domaine entreprise uniquement (exemple)\n        if (!str_ends_with($value, '@company.com')) {\n            throw new InvalidEmailDomainException($value);\n        }\n    }\n}\n</code></pre> <p>Transformation de Donn\u00e9es : <pre><code>Cha\u00eene primitive \u2192 Value Object Email (Domaine)\n</code></pre></p>"},{"location":"fr/advanced/flux-requete-reponse/#etapes-18-20-hachage-du-mot-de-passe","title":"\u00c9tapes 18-20 : Hachage du Mot de Passe","text":"<pre><code>// La factory cr\u00e9e le mot de passe hach\u00e9\n$hashedPassword = HashedPassword::fromPlaintext($command-&gt;password);\n\n// Le value object g\u00e8re le hachage\nfinal readonly class HashedPassword\n{\n    private function __construct(public string $hash) {}\n\n    public static function fromPlaintext(string $plaintext): self\n    {\n        // R\u00e8gle m\u00e9tier : longueur minimale\n        if (strlen($plaintext) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        // Hasher le mot de passe\n        $hash = password_hash($plaintext, PASSWORD_ARGON2ID);\n\n        return new self($hash);\n    }\n}\n</code></pre> <p>Transformation de Donn\u00e9es : <pre><code>Cha\u00eene en clair \u2192 Value Object HashedPassword (Domaine)\n</code></pre></p>"},{"location":"fr/advanced/flux-requete-reponse/#etapes-21-23-creation-de-lentite","title":"\u00c9tapes 21-23 : Cr\u00e9ation de l'Entit\u00e9","text":"<pre><code>// La factory cr\u00e9e l'entit\u00e9 avec tous les value objects\npublic static function create(string $email, string $password): User\n{\n    return new User(\n        id: UserId::generate(),\n        email: new Email($email),\n        password: HashedPassword::fromPlaintext($password),\n        isActive: false,\n        createdAt: new \\DateTimeImmutable()\n    );\n}\n\n// Le constructeur de l'entit\u00e9 applique les r\u00e8gles m\u00e9tier\npublic function __construct(\n    private UserId $id,\n    private Email $email,\n    private HashedPassword $password,\n    private bool $isActive,\n    private \\DateTimeImmutable $createdAt,\n) {\n    // Invariant m\u00e9tier : nouveaux utilisateurs inactifs\n    if ($this-&gt;isActive) {\n        throw new NewUserCannotBeActiveException();\n    }\n}\n</code></pre> <p>Transformation de Donn\u00e9es : <pre><code>Primitives (string, string)\n  \u2192 Value Objects (Email, HashedPassword)\n    \u2192 Entit\u00e9 (User) [Domaine]\n</code></pre></p>"},{"location":"fr/advanced/flux-requete-reponse/#phase-4-persistance-infrastructure","title":"Phase 4 : Persistance (Infrastructure)","text":""},{"location":"fr/advanced/flux-requete-reponse/#etapes-24-28-sauvegarder-en-base-de-donnees","title":"\u00c9tapes 24-28 : Sauvegarder en Base de Donn\u00e9es","text":"<pre><code>// Le handler sauvegarde l'entit\u00e9 via le port\n$this-&gt;users-&gt;save($user);\n\n// Interface port (Domaine)\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n}\n\n// Impl\u00e9mentation adaptateur (Infrastructure)\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n    }\n}\n\n// Doctrine g\u00e9n\u00e8re le SQL :\n// INSERT INTO users (id, email, password, is_active, created_at)\n// VALUES ('550e8400-...', 'user@example.com', '$argon2id$...', false, '2024-01-15 10:30:00')\n</code></pre> <p>Transformation de Donn\u00e9es : <pre><code>Entit\u00e9 User (Domaine)\n  \u2192 Mapping Metadata Doctrine\n    \u2192 Instruction SQL INSERT\n      \u2192 Ligne Base de Donn\u00e9es\n</code></pre></p>"},{"location":"fr/advanced/flux-requete-reponse/#phase-5-chemin-de-reponse","title":"Phase 5 : Chemin de R\u00e9ponse","text":""},{"location":"fr/advanced/flux-requete-reponse/#etapes-29-30-completion-du-handler","title":"\u00c9tapes 29-30 : Compl\u00e9tion du Handler","text":"<pre><code>// Le handler se termine (retourne void)\npublic function __invoke(RegisterUserCommand $command): void\n{\n    // ... toutes les \u00e9tapes compl\u00e9t\u00e9es\n\n    // Pas de valeur de retour (pattern command)\n}\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#etape-31-creation-du-dto-response","title":"\u00c9tape 31 : Cr\u00e9ation du DTO Response","text":"<pre><code>// Le contr\u00f4leur re\u00e7oit void, cr\u00e9e la r\u00e9ponse\npublic function __invoke(Request $request): JsonResponse\n{\n    $command = new RegisterUserCommand(/*...*/);\n\n    $this-&gt;messageBus-&gt;dispatch($command);\n\n    // R\u00e9cup\u00e9rer l'utilisateur cr\u00e9\u00e9 pour le retourner\n    $user = $this-&gt;users-&gt;findByEmail($command-&gt;email);\n\n    // Transformer Entit\u00e9 \u2192 DTO Response\n    $response = new UserResponse(\n        id: $user-&gt;getId()-&gt;toString(),\n        email: $user-&gt;getEmail()-&gt;value,\n        isActive: $user-&gt;isActive(),\n        createdAt: $user-&gt;getCreatedAt()-&gt;format('c')\n    );\n\n    return new JsonResponse($response, Response::HTTP_CREATED);\n}\n</code></pre> <p>Transformation de Donn\u00e9es : <pre><code>Entit\u00e9 User (Domaine) \u2192 DTO UserResponse (Infrastructure) \u2192 JSON\n</code></pre></p>"},{"location":"fr/advanced/flux-requete-reponse/#etapes-32-33-reponse-json","title":"\u00c9tapes 32-33 : R\u00e9ponse JSON","text":"<pre><code>Sortie: HTTP/1.1 201 Created\n        Content-Type: application/json\n\n        {\n            \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n            \"email\": \"user@example.com\",\n            \"isActive\": false,\n            \"createdAt\": \"2024-01-15T10:30:00+00:00\"\n        }\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#transformations-de-donnees","title":"Transformations de Donn\u00e9es","text":""},{"location":"fr/advanced/flux-requete-reponse/#chaine-de-transformation-complete","title":"Cha\u00eene de Transformation Compl\u00e8te","text":"<pre><code>1. JSON Brut (HTTP)\n   \u2193\n2. DTO RegisterUserRequest (Infrastructure - Validation entr\u00e9e)\n   \u2193\n3. RegisterUserCommand (Application - Intention cas d'usage)\n   \u2193\n4. Email + Password (cha\u00eenes)\n   \u2193\n5. Value Object Email + Value Object HashedPassword (Domaine - Validation m\u00e9tier)\n   \u2193\n6. Entit\u00e9 User (Domaine - Logique m\u00e9tier)\n   \u2193\n7. Metadata Entit\u00e9 Doctrine (Infrastructure - Mapping ORM)\n   \u2193\n8. SQL INSERT (Infrastructure - Base de donn\u00e9es)\n   \u2193\n9. Ligne Base de Donn\u00e9es (Persistance)\n   \u2193\n10. Entit\u00e9 User (Domaine - Charg\u00e9e depuis BD)\n   \u2193\n11. DTO UserResponse (Infrastructure - Formatage sortie)\n   \u2193\n12. R\u00e9ponse JSON (HTTP)\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#pourquoi-autant-de-transformations","title":"Pourquoi Autant de Transformations ?","text":"<p>Chaque transformation a un objectif :</p> Transformation Objectif Couche JSON \u2192 DTO Request Validation entr\u00e9e, pr\u00e9occupations HTTP Infrastructure DTO Request \u2192 Command Intention cas d'usage, pr\u00e9occupation application Application Command \u2192 Value Objects Validation m\u00e9tier Domaine Value Objects \u2192 Entit\u00e9 Encapsulation logique m\u00e9tier Domaine Entit\u00e9 \u2192 SQL Mapping persistance Infrastructure SQL \u2192 Ligne BD Stockage Infrastructure Entit\u00e9 \u2192 DTO Response Formatage sortie, cacher internes Infrastructure DTO Response \u2192 JSON S\u00e9rialisation HTTP Infrastructure <p>Principe Cl\u00e9 : Chaque couche a sa propre repr\u00e9sentation, \u00e9vitant le couplage.</p>"},{"location":"fr/advanced/flux-requete-reponse/#exemple-reel-inscription-utilisateur","title":"Exemple R\u00e9el : Inscription Utilisateur","text":""},{"location":"fr/advanced/flux-requete-reponse/#flux-de-code-complet","title":"Flux de Code Complet","text":"<pre><code>// 1. INFRASTRUCTURE : Contr\u00f4leur\nnamespace App\\User\\Infrastructure\\Controller;\n\n#[Route('/api/users', methods: ['POST'])]\nfinal readonly class RegisterUserController extends AbstractController\n{\n    public function __invoke(Request $request): JsonResponse\n    {\n        // D\u00e9s\u00e9rialiser + valider\n        $dto = $this-&gt;serializer-&gt;deserialize(\n            $request-&gt;getContent(),\n            RegisterUserRequest::class,\n            'json'\n        );\n\n        $violations = $this-&gt;validator-&gt;validate($dto);\n        if (count($violations) &gt; 0) {\n            throw new ValidationException($violations);\n        }\n\n        // Cr\u00e9er command\n        $command = new RegisterUserCommand(\n            email: $dto-&gt;email,\n            password: $dto-&gt;password\n        );\n\n        // Dispatcher\n        $this-&gt;messageBus-&gt;dispatch($command);\n\n        // R\u00e9cup\u00e9rer r\u00e9sultat\n        $user = $this-&gt;users-&gt;findByEmail($command-&gt;email);\n\n        // Cr\u00e9er r\u00e9ponse\n        return $this-&gt;json(\n            new UserResponse(\n                id: $user-&gt;getId()-&gt;toString(),\n                email: $user-&gt;getEmail()-&gt;value,\n                isActive: $user-&gt;isActive()\n            ),\n            Response::HTTP_CREATED\n        );\n    }\n}\n\n// 2. APPLICATION : Command (DTO)\nnamespace App\\User\\Application\\Command;\n\nfinal readonly class RegisterUserCommand\n{\n    public function __construct(\n        public string $email,\n        public string $password,\n    ) {}\n}\n\n// 3. APPLICATION : Handler\nnamespace App\\User\\Application\\Handler;\n\n#[AsMessageHandler]\nfinal readonly class RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users,\n        private EventDispatcherInterface $eventDispatcher,\n    ) {}\n\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        // V\u00e9rifier unicit\u00e9 (pr\u00e9occupation application - n\u00e9cessite repository)\n        if ($this-&gt;users-&gt;existsByEmail($command-&gt;email)) {\n            throw new EmailAlreadyExistsException($command-&gt;email);\n        }\n\n        // Cr\u00e9er utilisateur (logique domaine dans factory)\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        // Persister (pr\u00e9occupation infrastructure)\n        $this-&gt;users-&gt;save($user);\n\n        // Dispatcher \u00e9v\u00e9nement (pr\u00e9occupation infrastructure)\n        $this-&gt;eventDispatcher-&gt;dispatch(\n            new UserRegisteredEvent($user-&gt;getId())\n        );\n    }\n}\n\n// 4. DOMAINE : Factory\nnamespace App\\User\\Domain\\Factory;\n\nfinal class UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),           // Valide format\n            password: HashedPassword::fromPlaintext($password), // Valide + hash\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n}\n\n// 5. DOMAINE : Value Objects\nnamespace App\\User\\Domain\\ValueObject;\n\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n    }\n}\n\nfinal readonly class HashedPassword\n{\n    private function __construct(public string $hash) {}\n\n    public static function fromPlaintext(string $plaintext): self\n    {\n        if (strlen($plaintext) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        return new self(password_hash($plaintext, PASSWORD_ARGON2ID));\n    }\n}\n\n// 6. DOMAINE : Entit\u00e9\nnamespace App\\User\\Domain\\Model;\n\nclass User\n{\n    public function __construct(\n        private UserId $id,\n        private Email $email,\n        private HashedPassword $password,\n        private bool $isActive,\n        private \\DateTimeImmutable $createdAt,\n    ) {}\n\n    public function activate(): void\n    {\n        if ($this-&gt;isActive) {\n            throw new UserAlreadyActiveException();\n        }\n\n        $this-&gt;isActive = true;\n    }\n\n    // Getters...\n}\n\n// 7. DOMAINE : Port (Interface)\nnamespace App\\User\\Domain\\Port;\n\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function existsByEmail(string $email): bool;\n    public function findByEmail(string $email): ?User;\n}\n\n// 8. INFRASTRUCTURE : Adaptateur (Impl\u00e9mentation Doctrine)\nnamespace App\\User\\Infrastructure\\Persistence;\n\nfinal class DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {}\n\n    public function save(User $user): void\n    {\n        $this-&gt;entityManager-&gt;persist($user);\n        $this-&gt;entityManager-&gt;flush();\n    }\n\n    public function existsByEmail(string $email): bool\n    {\n        return $this-&gt;entityManager-&gt;createQueryBuilder()\n            -&gt;select('COUNT(u.id)')\n            -&gt;from(User::class, 'u')\n            -&gt;where('u.email = :email')\n            -&gt;setParameter('email', $email)\n            -&gt;getQuery()\n            -&gt;getSingleScalarResult() &gt; 0;\n    }\n\n    public function findByEmail(string $email): ?User\n    {\n        return $this-&gt;entityManager\n            -&gt;getRepository(User::class)\n            -&gt;findOneBy(['email' =&gt; $email]);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#flux-derreur","title":"Flux d'Erreur","text":""},{"location":"fr/advanced/flux-requete-reponse/#chemin-dexception-domaine","title":"Chemin d'Exception Domaine","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Controller\n    participant Handler\n    participant Factory\n    participant Email\n\n    Client-&gt;&gt;Controller: POST /api/users&lt;br/&gt;{\"email\": \"invalide\", \"password\": \"secret\"}\n    Controller-&gt;&gt;Handler: dispatch(command)\n    Handler-&gt;&gt;Factory: create(\"invalide\", \"secret\")\n    Factory-&gt;&gt;Email: new Email(\"invalide\")\n    Email-&gt;&gt;Email: valider format\n    Email--&gt;&gt;Factory: \u274c InvalidEmailException\n    Factory--&gt;&gt;Handler: \u274c InvalidEmailException\n    Handler--&gt;&gt;Controller: \u274c InvalidEmailException\n    Controller-&gt;&gt;Controller: capturer &amp; transformer\n    Controller--&gt;&gt;Client: 400 Bad Request&lt;br/&gt;{\"error\": \"Format email invalide\"}</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#chemin-dexception-infrastructure","title":"Chemin d'Exception Infrastructure","text":"<pre><code>sequenceDiagram\n    participant Handler\n    participant Port\n    participant Adapter\n    participant DB\n\n    Handler-&gt;&gt;Port: save(user)\n    Port-&gt;&gt;Adapter: save(user)\n    Adapter-&gt;&gt;DB: INSERT INTO users...\n    DB--&gt;&gt;Adapter: \u274c Violation contrainte cl\u00e9 dupliqu\u00e9e\n    Adapter--&gt;&gt;Port: \u274c UniqueConstraintViolationException\n    Port--&gt;&gt;Handler: \u274c UniqueConstraintViolationException\n    Handler-&gt;&gt;Handler: capturer &amp; envelopper\n    Handler--&gt;&gt;Handler: \u274c EmailAlreadyExistsException</code></pre> <p>Traduction d'Exception : Les exceptions infrastructure sont captur\u00e9es et traduites en exceptions domaine.</p>"},{"location":"fr/advanced/flux-requete-reponse/#considerations-de-performance","title":"Consid\u00e9rations de Performance","text":""},{"location":"fr/advanced/flux-requete-reponse/#optimisation-des-requetes","title":"Optimisation des Requ\u00eates","text":"<pre><code>// \u274c MAUVAIS : Probl\u00e8me N+1 Queries\npublic function listUsers(): array\n{\n    $users = $this-&gt;users-&gt;findAll(); // 1 requ\u00eate\n\n    foreach ($users as $user) {\n        $user-&gt;getOrders(); // N requ\u00eates !\n    }\n\n    return $users;\n}\n\n// \u2705 BON : Chargement Eager\npublic function listUsers(): array\n{\n    return $this-&gt;entityManager-&gt;createQueryBuilder()\n        -&gt;select('u', 'o')\n        -&gt;from(User::class, 'u')\n        -&gt;leftJoin('u.orders', 'o')\n        -&gt;getQuery()\n        -&gt;getResult(); // 1 requ\u00eate\n}\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#strategie-de-cache","title":"Strat\u00e9gie de Cache","text":"<pre><code>// Ajouter du cache au niveau de la couche infrastructure\nfinal class CachedUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private UserRepositoryInterface $decorated,\n        private CacheInterface $cache,\n    ) {}\n\n    public function findByEmail(string $email): ?User\n    {\n        return $this-&gt;cache-&gt;get(\n            \"user:email:{$email}\",\n            fn() =&gt; $this-&gt;decorated-&gt;findByEmail($email)\n        );\n    }\n}\n</code></pre>"},{"location":"fr/advanced/flux-requete-reponse/#points-cles-a-retenir","title":"Points Cl\u00e9s \u00e0 Retenir","text":"<ol> <li>Transformations en Couches : Les donn\u00e9es se transforment \u00e0 chaque fronti\u00e8re pour maintenir la s\u00e9paration</li> <li>Direction Importante : Les d\u00e9pendances pointent toujours vers l'int\u00e9rieur (Infrastructure \u2192 Application \u2192 Domaine)</li> <li>Ports aux Fronti\u00e8res : Tout acc\u00e8s du domaine \u00e0 l'infrastructure passe par des ports</li> <li>DTOs Partout : DTO Input, DTO Command, Entit\u00e9, DTO Response\u2014chacun a un objectif</li> <li>Traduction d'Exception : Les exceptions infrastructure deviennent des exceptions domaine</li> <li>Performance via Infrastructure : Cache, optimisation requ\u00eates se font dans les adaptateurs, pas le domaine</li> </ol> <p>Suivant : Principes de Conception des Ports \u2192</p>"},{"location":"fr/advanced/injection-dependances-guide/","title":"Guide de Configuration de l'Injection de D\u00e9pendances","text":""},{"location":"fr/advanced/injection-dependances-guide/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>Vue d'Ensemble</li> <li>Bases Autowiring Symfony</li> <li>Liaison Ports vers Adaptateurs</li> <li>Liaisons Sp\u00e9cifiques Environnement</li> <li>Services Taggu\u00e9s</li> <li>D\u00e9coration de Services</li> <li>Exemples Configuration Compl\u00e8te</li> <li>D\u00e9pannage</li> </ol>"},{"location":"fr/advanced/injection-dependances-guide/#vue-densemble","title":"Vue d'Ensemble","text":"<p>En architecture hexagonale, l'Injection de D\u00e9pendances (DI) est critique pour lier ports (interfaces) \u00e0 adaptateurs (impl\u00e9mentations). Le conteneur DI de Symfony g\u00e8re ce c\u00e2blage automatiquement avec configuration appropri\u00e9e.</p>"},{"location":"fr/advanced/injection-dependances-guide/#le-probleme-que-di-resout","title":"Le Probl\u00e8me que DI R\u00e9sout","text":"<pre><code>// \u274c Sans DI : D\u00e9pendance cod\u00e9e en dur\nclass RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        $repository = new DoctrineUserRepository(); // \u274c Couplage fort!\n        // ...\n    }\n}\n\n// \u2705 Avec DI : D\u00e9pendance inject\u00e9e\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users // \u2705 Interface, pas impl\u00e9mentation\n    ) {}\n\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        $this-&gt;users-&gt;save(...); // Utilise impl\u00e9mentation configur\u00e9e\n    }\n}\n</code></pre> <p>Configuration Conteneur DI : Dit \u00e0 Symfony \"quand quelqu'un a besoin de <code>UserRepositoryInterface</code>, donne-lui <code>DoctrineUserRepository</code>\".</p>"},{"location":"fr/advanced/injection-dependances-guide/#bases-autowiring-symfony","title":"Bases Autowiring Symfony","text":""},{"location":"fr/advanced/injection-dependances-guide/#quest-ce-que-lautowiring","title":"Qu'est-ce que l'Autowiring ?","text":"<p>Autowiring : Symfony r\u00e9sout automatiquement d\u00e9pendances constructeur en regardant type hints.</p> <pre><code>// Handler avec d\u00e9pendances type-hint\u00e9es\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users,      // Autowired\n        private EmailSenderInterface $emailSender,   // Autowired\n        private EventDispatcherInterface $events,    // Autowired\n    ) {}\n}\n</code></pre> <p>Symfony voit ces type hints et fournit automatiquement services corrects.</p>"},{"location":"fr/advanced/injection-dependances-guide/#activer-autowiring","title":"Activer Autowiring","text":"<p>Dans <code>config/services.yaml</code> :</p> <pre><code>services:\n    _defaults:\n        autowire: true      # Activer autowiring\n        autoconfigure: true # Configurer automatiquement services (tags, etc.)\n        public: false       # Services priv\u00e9s par d\u00e9faut\n\n    # Auto-enregistrer toutes classes dans src/ comme services\n    App\\:\n        resource: '../src/'\n        exclude:\n            - '../src/DependencyInjection/'\n            - '../src/*/Domain/Model/'      # Exclure entit\u00e9s\n            - '../src/*/Domain/ValueObject/' # Exclure value objects\n            - '../src/Kernel.php'\n</code></pre> <p>Comment \u00e7a marche : 1. Symfony scanne r\u00e9pertoire <code>src/</code> 2. Enregistre chaque classe comme service 3. Autowire d\u00e9pendances constructeur</p>"},{"location":"fr/advanced/injection-dependances-guide/#liaison-ports-vers-adaptateurs","title":"Liaison Ports vers Adaptateurs","text":""},{"location":"fr/advanced/injection-dependances-guide/#configuration-de-base","title":"Configuration de Base","text":"<p>Probl\u00e8me : Interface ne peut \u00eatre instanci\u00e9e\u2014Symfony doit savoir quelle impl\u00e9mentation utiliser.</p> <pre><code>// Handler n\u00e9cessite UserRepositoryInterface\nclass RegisterUserHandler\n{\n    public function __construct(\n        private UserRepositoryInterface $users // \u274c Interface, ne peut \u00eatre instanci\u00e9e!\n    ) {}\n}\n</code></pre> <p>Solution : Lier interface \u00e0 impl\u00e9mentation dans <code>services.yaml</code>.</p>"},{"location":"fr/advanced/injection-dependances-guide/#methode-1-liaison-directe-plus-simple","title":"M\u00e9thode 1 : Liaison Directe (Plus Simple)","text":"<pre><code>services:\n    # Lier interface \u2192 impl\u00e9mentation\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        class: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre> <p>Explication : - Quand quelqu'un a besoin <code>UserRepositoryInterface</code> - Symfony fournit <code>DoctrineUserRepository</code></p>"},{"location":"fr/advanced/injection-dependances-guide/#methode-2-alias-recommande","title":"M\u00e9thode 2 : Alias (Recommand\u00e9)","text":"<pre><code>services:\n    # Impl\u00e9mentation\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n        # Autowired par d\u00e9faut\n\n    # Alias : interface \u2192 impl\u00e9mentation\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre> <p>B\u00e9n\u00e9fices : - Plus explicite - Plus facile changer impl\u00e9mentations</p>"},{"location":"fr/advanced/injection-dependances-guide/#methode-3-bind-pour-tous-services","title":"M\u00e9thode 3 : Bind pour Tous Services","text":"<pre><code>services:\n    _defaults:\n        bind:\n            # Lier automatiquement cette interface \u00e0 cette impl\u00e9mentation\n            # pour TOUS les services\n            App\\User\\Domain\\Port\\UserRepositoryInterface: '@App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository'\n</code></pre> <p>Quand utiliser : Interface utilis\u00e9e dans beaucoup d'endroits, \u00e9viter r\u00e9p\u00e9ter configuration.</p>"},{"location":"fr/advanced/injection-dependances-guide/#liaisons-specifiques-environnement","title":"Liaisons Sp\u00e9cifiques Environnement","text":""},{"location":"fr/advanced/injection-dependances-guide/#le-probleme-implementations-differentes-pour-environnements-differents","title":"Le Probl\u00e8me : Impl\u00e9mentations Diff\u00e9rentes pour Environnements Diff\u00e9rents","text":"<ul> <li>D\u00e9veloppement : Utiliser repository en m\u00e9moire (tests rapides)</li> <li>Test : Utiliser repository en m\u00e9moire</li> <li>Production : Utiliser repository Doctrine (vraie base donn\u00e9es)</li> </ul>"},{"location":"fr/advanced/injection-dependances-guide/#solution-configuration-specifique-environnement","title":"Solution : Configuration Sp\u00e9cifique Environnement","text":""},{"location":"fr/advanced/injection-dependances-guide/#1-configuration-principale-configservicesyaml","title":"1. Configuration Principale (<code>config/services.yaml</code>)","text":"<pre><code>services:\n    _defaults:\n        autowire: true\n        autoconfigure: true\n\n    # Enregistrer toutes impl\u00e9mentations\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n    App\\User\\Infrastructure\\Persistence\\InMemoryUserRepository:\n\n    # Liaison par d\u00e9faut (production)\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#2-configuration-test-configservices_testyaml","title":"2. Configuration Test (<code>config/services_test.yaml</code>)","text":"<pre><code>services:\n    # Surcharger liaison pour environnement test\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\InMemoryUserRepository\n</code></pre> <p>R\u00e9sultat : - <code>bin/phpunit</code> \u2192 utilise <code>InMemoryUserRepository</code> - Production \u2192 utilise <code>DoctrineUserRepository</code></p>"},{"location":"fr/advanced/injection-dependances-guide/#3-configuration-developpement-configservices_devyaml","title":"3. Configuration D\u00e9veloppement (<code>config/services_dev.yaml</code>)","text":"<pre><code># Optionnel : utiliser en m\u00e9moire pour feedback dev rapide\nservices:\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\InMemoryUserRepository\n\n    # Ou activer logging debug\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n        decorates: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n        arguments:\n            $decorated: '@.inner'\n            $logger: '@logger'\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#exemple-complet-email-sender","title":"Exemple Complet : Email Sender","text":"<pre><code># config/services.yaml (d\u00e9faut : production)\nservices:\n    # Production : vrai SMTP\n    App\\Notification\\Domain\\Port\\EmailSenderInterface:\n        alias: App\\Notification\\Infrastructure\\Email\\SymfonyEmailSender\n\n# config/services_test.yaml\nservices:\n    # Test : fake en m\u00e9moire\n    App\\Notification\\Domain\\Port\\EmailSenderInterface:\n        alias: App\\Notification\\Infrastructure\\Email\\InMemoryEmailSender\n\n# config/services_dev.yaml\nservices:\n    # Dev : logger emails au lieu d'envoyer\n    App\\Notification\\Domain\\Port\\EmailSenderInterface:\n        alias: App\\Notification\\Infrastructure\\Email\\LoggingEmailSender\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#services-taggues","title":"Services Taggu\u00e9s","text":""},{"location":"fr/advanced/injection-dependances-guide/#le-probleme-multiples-implementations-meme-interface","title":"Le Probl\u00e8me : Multiples Impl\u00e9mentations M\u00eame Interface","text":"<p>Exemple : Multiples souscripteurs \u00e9v\u00e9nement pour m\u00eame \u00e9v\u00e9nement.</p> <pre><code>interface EventSubscriberInterface\n{\n    public function handle(DomainEvent $event): void;\n}\n\nclass SendEmailSubscriber implements EventSubscriberInterface { /* ... */ }\nclass LogEventSubscriber implements EventSubscriberInterface { /* ... */ }\nclass UpdateCacheSubscriber implements EventSubscriberInterface { /* ... */ }\n</code></pre> <p>Besoin : Injecter toutes impl\u00e9mentations, pas juste une.</p>"},{"location":"fr/advanced/injection-dependances-guide/#solution-services-taggues","title":"Solution : Services Taggu\u00e9s","text":""},{"location":"fr/advanced/injection-dependances-guide/#1-taguer-toutes-implementations","title":"1. Taguer Toutes Impl\u00e9mentations","text":"<pre><code>services:\n    # Taguer chaque impl\u00e9mentation\n    App\\Notification\\Infrastructure\\Event\\SendEmailSubscriber:\n        tags: ['app.event_subscriber']\n\n    App\\Notification\\Infrastructure\\Event\\LogEventSubscriber:\n        tags: ['app.event_subscriber']\n\n    App\\Notification\\Infrastructure\\Event\\UpdateCacheSubscriber:\n        tags: ['app.event_subscriber']\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#2-injecter-tous-services-taggues","title":"2. Injecter Tous Services Taggu\u00e9s","text":"<pre><code>services:\n    # Event dispatcher re\u00e7oit tous subscribers\n    App\\Shared\\Infrastructure\\Event\\EventDispatcher:\n        arguments:\n            $subscribers: !tagged_iterator app.event_subscriber\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#3-utiliser-dans-service","title":"3. Utiliser dans Service","text":"<pre><code>use Symfony\\Component\\DependencyInjection\\Attribute\\TaggedIterator;\n\nclass EventDispatcher implements EventDispatcherInterface\n{\n    public function __construct(\n        #[TaggedIterator('app.event_subscriber')]\n        private iterable $subscribers // Tous services taggu\u00e9s inject\u00e9s ici\n    ) {}\n\n    public function dispatch(DomainEvent $event): void\n    {\n        foreach ($this-&gt;subscribers as $subscriber) {\n            $subscriber-&gt;handle($event);\n        }\n    }\n}\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#auto-tagging-avec-interfaces","title":"Auto-Tagging avec Interfaces","text":"<p>Tagging automatique : Taguer toutes classes impl\u00e9mentant une interface.</p> <pre><code>services:\n    _instanceof:\n        # Taguer automatiquement toutes classes impl\u00e9mentant EventSubscriberInterface\n        App\\Shared\\Domain\\Event\\EventSubscriberInterface:\n            tags: ['app.event_subscriber']\n</code></pre> <p>Maintenant vous n'avez pas besoin de taguer manuellement chaque impl\u00e9mentation !</p>"},{"location":"fr/advanced/injection-dependances-guide/#exemple-complet-query-bus-avec-multiples-handlers","title":"Exemple Complet : Query Bus avec Multiples Handlers","text":"<pre><code>services:\n    _instanceof:\n        # Auto-taguer tous query handlers\n        App\\Shared\\Application\\Query\\QueryHandlerInterface:\n            tags: ['app.query_handler']\n\n    # Query bus re\u00e7oit tous handlers\n    App\\Shared\\Infrastructure\\Query\\QueryBus:\n        arguments:\n            $handlers: !tagged_iterator app.query_handler\n</code></pre> <pre><code>class QueryBus\n{\n    public function __construct(\n        #[TaggedIterator('app.query_handler')]\n        private iterable $handlers\n    ) {}\n\n    public function dispatch(Query $query): mixed\n    {\n        foreach ($this-&gt;handlers as $handler) {\n            if ($handler-&gt;supports($query)) {\n                return $handler-&gt;handle($query);\n            }\n        }\n\n        throw new NoHandlerFoundException();\n    }\n}\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#decoration-de-services","title":"D\u00e9coration de Services","text":""},{"location":"fr/advanced/injection-dependances-guide/#le-probleme-ajouter-fonctionnalite-sans-modifier-code","title":"Le Probl\u00e8me : Ajouter Fonctionnalit\u00e9 Sans Modifier Code","text":"<p>Exemple : Ajouter cache au repository sans changer code repository.</p>"},{"location":"fr/advanced/injection-dependances-guide/#solution-pattern-decorator-avec-di","title":"Solution : Pattern Decorator avec DI","text":""},{"location":"fr/advanced/injection-dependances-guide/#1-creer-decorateur","title":"1. Cr\u00e9er D\u00e9corateur","text":"<pre><code>namespace App\\User\\Infrastructure\\Persistence;\n\nfinal readonly class CachedUserRepository implements UserRepositoryInterface\n{\n    public function __construct(\n        private UserRepositoryInterface $decorated, // Repository original\n        private CacheInterface $cache,\n    ) {}\n\n    public function findById(UserId $id): ?User\n    {\n        return $this-&gt;cache-&gt;get(\n            \"user:{$id}\",\n            fn() =&gt; $this-&gt;decorated-&gt;findById($id) // D\u00e9l\u00e9guer \u00e0 l'original\n        );\n    }\n\n    public function save(User $user): void\n    {\n        $this-&gt;decorated-&gt;save($user);\n        $this-&gt;cache-&gt;delete(\"user:{$user-&gt;getId()}\"); // Invalider cache\n    }\n}\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#2-configurer-decoration","title":"2. Configurer D\u00e9coration","text":"<pre><code>services:\n    # Repository original\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n\n    # D\u00e9corateur enveloppe l'original\n    App\\User\\Infrastructure\\Persistence\\CachedUserRepository:\n        decorates: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n        arguments:\n            $decorated: '@.inner' # @.inner = le service d\u00e9cor\u00e9\n</code></pre> <p>R\u00e9sultat : - Quiconque demande <code>DoctrineUserRepository</code> obtient <code>CachedUserRepository</code> - <code>CachedUserRepository</code> enveloppe <code>DoctrineUserRepository</code> - Cache ajout\u00e9 de fa\u00e7on transparente</p>"},{"location":"fr/advanced/injection-dependances-guide/#priorite-decoration","title":"Priorit\u00e9 D\u00e9coration","text":"<p>Multiples d\u00e9corateurs :</p> <pre><code>services:\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n\n    # Premier d\u00e9corateur : cache\n    App\\User\\Infrastructure\\Persistence\\CachedUserRepository:\n        decorates: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n        decoration_priority: 10 # Priorit\u00e9 plus \u00e9lev\u00e9e = couche externe\n        arguments:\n            $decorated: '@.inner'\n\n    # Second d\u00e9corateur : logging\n    App\\User\\Infrastructure\\Persistence\\LoggingUserRepository:\n        decorates: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n        decoration_priority: 5 # Priorit\u00e9 plus basse = couche interne\n        arguments:\n            $decorated: '@.inner'\n</code></pre> <p>Cha\u00eene d'appel : <pre><code>Handler \u2192 LoggingUserRepository \u2192 CachedUserRepository \u2192 DoctrineUserRepository \u2192 Base de Donn\u00e9es\n</code></pre></p>"},{"location":"fr/advanced/injection-dependances-guide/#exemples-configuration-complete","title":"Exemples Configuration Compl\u00e8te","text":""},{"location":"fr/advanced/injection-dependances-guide/#exemple-1-module-user","title":"Exemple 1 : Module User","text":"<pre><code># config/services.yaml\nservices:\n    _defaults:\n        autowire: true\n        autoconfigure: true\n\n    # Auto-enregistrer tous services\n    App\\:\n        resource: '../src/'\n        exclude:\n            - '../src/*/Domain/Model/'\n            - '../src/*/Domain/ValueObject/'\n            - '../src/Kernel.php'\n\n    # Lier ports \u00e0 adaptateurs\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n\n    App\\User\\Domain\\Port\\PasswordHasherInterface:\n        alias: App\\User\\Infrastructure\\Security\\SymfonyPasswordHasher\n\n    App\\Shared\\Domain\\Port\\EmailSenderInterface:\n        alias: App\\Shared\\Infrastructure\\Email\\SymfonyEmailSender\n\n    App\\Shared\\Domain\\Port\\EventDispatcherInterface:\n        alias: App\\Shared\\Infrastructure\\Event\\SymfonyEventDispatcher\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#exemple-2-module-order-avec-cqrs","title":"Exemple 2 : Module Order avec CQRS","text":"<pre><code>services:\n    # C\u00f4t\u00e9 \u00e9criture\n    App\\Order\\Domain\\Port\\OrderRepositoryInterface:\n        alias: App\\Order\\Infrastructure\\Persistence\\DoctrineOrderRepository\n\n    # C\u00f4t\u00e9 lecture (CQRS)\n    App\\Order\\Application\\Query\\OrderQueryInterface:\n        alias: App\\Order\\Infrastructure\\Query\\SqlOrderQuery\n\n    # Services externes\n    App\\Order\\Domain\\Port\\PaymentProcessorInterface:\n        alias: App\\Order\\Infrastructure\\Payment\\StripePaymentProcessor\n\n    App\\Order\\Domain\\Port\\InventoryServiceInterface:\n        alias: App\\Order\\Infrastructure\\Inventory\\HttpInventoryService\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#exemple-3-application-multi-tenant","title":"Exemple 3 : Application Multi-Tenant","text":"<pre><code>services:\n    # R\u00e9solveur tenant\n    App\\Shared\\Infrastructure\\Tenancy\\TenantResolver:\n\n    # Repository tenant-aware\n    App\\User\\Infrastructure\\Persistence\\TenantAwareUserRepository:\n        arguments:\n            $tenantResolver: '@App\\Shared\\Infrastructure\\Tenancy\\TenantResolver'\n\n    # Lier interface \u00e0 impl\u00e9mentation tenant-aware\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\TenantAwareUserRepository\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#exemple-4-repository-decore-avec-cache-logging","title":"Exemple 4 : Repository D\u00e9cor\u00e9 avec Cache &amp; Logging","text":"<pre><code>services:\n    # Repository de base\n    App\\Product\\Infrastructure\\Persistence\\DoctrineProductRepository:\n\n    # D\u00e9corateur : cache\n    App\\Product\\Infrastructure\\Persistence\\CachedProductRepository:\n        decorates: App\\Product\\Infrastructure\\Persistence\\DoctrineProductRepository\n        decoration_priority: 10\n        arguments:\n            $decorated: '@.inner'\n            $cache: '@cache.app'\n\n    # D\u00e9corateur : logging\n    App\\Product\\Infrastructure\\Persistence\\LoggingProductRepository:\n        decorates: App\\Product\\Infrastructure\\Persistence\\DoctrineProductRepository\n        decoration_priority: 5\n        arguments:\n            $decorated: '@.inner'\n            $logger: '@logger'\n\n    # Lier interface \u00e0 la base (d\u00e9corateurs l'enveloppent automatiquement)\n    App\\Product\\Domain\\Port\\ProductRepositoryInterface:\n        alias: App\\Product\\Infrastructure\\Persistence\\DoctrineProductRepository\n</code></pre> <p>Cha\u00eene d'appel : <code>Handler \u2192 Logging \u2192 Caching \u2192 Doctrine \u2192 BD</code></p>"},{"location":"fr/advanced/injection-dependances-guide/#depannage","title":"D\u00e9pannage","text":""},{"location":"fr/advanced/injection-dependances-guide/#probleme-1-cannot-autowire-service-argument-is-type-hinted-with-interface","title":"Probl\u00e8me 1 : \"Cannot autowire service: argument is type-hinted with interface\"","text":"<p>Erreur : <pre><code>Cannot autowire service \"App\\User\\Application\\Handler\\RegisterUserHandler\":\nargument \"$users\" of method \"__construct()\" is type-hinted with the interface\n\"App\\User\\Domain\\Port\\UserRepositoryInterface\" but no implementation is registered.\n</code></pre></p> <p>Solution : Lier interface \u00e0 impl\u00e9mentation.</p> <pre><code>services:\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#probleme-2-service-not-found","title":"Probl\u00e8me 2 : \"Service not found\"","text":"<p>Erreur : <pre><code>Service \"App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\" not found.\n</code></pre></p> <p>Solution : V\u00e9rifier que r\u00e9pertoire n'est pas exclu dans <code>services.yaml</code>.</p> <pre><code>services:\n    App\\:\n        resource: '../src/'\n        exclude:\n            - '../src/*/Domain/Model/'  # \u2705 Exclure entit\u00e9s\n            # \u274c Ne pas exclure Infrastructure!\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#probleme-3-circular-reference-detected","title":"Probl\u00e8me 3 : \"Circular reference detected\"","text":"<p>Erreur : <pre><code>Circular reference detected for service \"App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\".\n</code></pre></p> <p>Solution : Refactorer pour supprimer d\u00e9pendance circulaire ou utiliser injection setter.</p> <pre><code>services:\n    App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository:\n        calls:\n            - setLogger: ['@logger'] # Injection setter au lieu constructeur\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#probleme-4-mauvaise-implementation-injectee-dans-tests","title":"Probl\u00e8me 4 : \"Mauvaise impl\u00e9mentation inject\u00e9e dans tests\"","text":"<p>Probl\u00e8me : Test utilise impl\u00e9mentation production au lieu fake.</p> <p>Solution : Cr\u00e9er <code>config/services_test.yaml</code> et surcharger liaison.</p> <pre><code># config/services_test.yaml\nservices:\n    App\\User\\Domain\\Port\\UserRepositoryInterface:\n        alias: App\\User\\Infrastructure\\Persistence\\InMemoryUserRepository\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#probleme-5-services-taggues-non-injectes","title":"Probl\u00e8me 5 : Services taggu\u00e9s non inject\u00e9s","text":"<p>Erreur : <code>$subscribers</code> est vide m\u00eame si services sont taggu\u00e9s.</p> <p>Solution : V\u00e9rifier nom tag correspond.</p> <pre><code>services:\n    # D\u00e9finition tag\n    _instanceof:\n        App\\Shared\\Domain\\Event\\EventSubscriberInterface:\n            tags: ['app.event_subscriber'] # Nom tag\n\n    # Injection (doit correspondre!)\n    App\\Shared\\Infrastructure\\Event\\EventDispatcher:\n        arguments:\n            $subscribers: !tagged_iterator app.event_subscriber # M\u00eame nom tag\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#bonnes-pratiques","title":"Bonnes Pratiques","text":""},{"location":"fr/advanced/injection-dependances-guide/#1-utiliser-alias-pour-liaisons-port","title":"1. Utiliser Alias pour Liaisons Port","text":"<p>\u2705 BON : <pre><code>App\\User\\Domain\\Port\\UserRepositoryInterface:\n    alias: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre></p> <p>\u274c \u00c9VITER : <pre><code>App\\User\\Domain\\Port\\UserRepositoryInterface:\n    class: App\\User\\Infrastructure\\Persistence\\DoctrineUserRepository\n</code></pre></p> <p>Raison : Alias plus clairs et plus faciles \u00e0 surcharger.</p>"},{"location":"fr/advanced/injection-dependances-guide/#2-fichiers-configuration-specifiques-environnement","title":"2. Fichiers Configuration Sp\u00e9cifiques Environnement","text":"<pre><code>config/\n\u251c\u2500\u2500 services.yaml          # D\u00e9faut (production)\n\u251c\u2500\u2500 services_dev.yaml      # Surcharges d\u00e9veloppement\n\u251c\u2500\u2500 services_test.yaml     # Surcharges test\n\u2514\u2500\u2500 services_prod.yaml     # Sp\u00e9cifique production (optionnel)\n</code></pre>"},{"location":"fr/advanced/injection-dependances-guide/#3-utiliser-_instanceof-pour-auto-tagging","title":"3. Utiliser <code>_instanceof</code> pour Auto-Tagging","text":"<p>\u2705 BON : <pre><code>_instanceof:\n    App\\Shared\\Application\\Query\\QueryHandlerInterface:\n        tags: ['app.query_handler']\n</code></pre></p> <p>\u274c \u00c9VITER : <pre><code>App\\User\\Application\\Query\\FindUserQueryHandler:\n    tags: ['app.query_handler']\n\nApp\\Order\\Application\\Query\\FindOrderQueryHandler:\n    tags: ['app.query_handler']\n\n# ... taguer manuellement chacun\n</code></pre></p>"},{"location":"fr/advanced/injection-dependances-guide/#4-exclure-classes-non-service","title":"4. Exclure Classes Non-Service","text":"<pre><code>App\\:\n    resource: '../src/'\n    exclude:\n        - '../src/*/Domain/Model/'       # Entit\u00e9s\n        - '../src/*/Domain/ValueObject/' # Value objects\n        - '../src/*/Application/Command/' # DTOs\n        - '../src/*/Application/Query/'   # DTOs\n        - '../src/Kernel.php'\n</code></pre> <p>Raison : Seulement services devraient \u00eatre enregistr\u00e9s, pas objets donn\u00e9es.</p>"},{"location":"fr/advanced/injection-dependances-guide/#resume-antiseche","title":"R\u00e9sum\u00e9 Antis\u00e8che","text":"T\u00e2che Configuration Lier port \u00e0 adaptateur <code>alias: App\\...\\Implementation</code> Injecter tous services taggu\u00e9s <code>!tagged_iterator tag_name</code> Auto-taguer par interface <code>_instanceof: { Interface: tags: [...] }</code> Surcharger pour test Cr\u00e9er <code>services_test.yaml</code> D\u00e9corer service <code>decorates: OriginalService</code> + <code>$decorated: '@.inner'</code> Exclure r\u00e9pertoire <code>exclude: ['../src/Path/']</code> <p>Suivant : Impl\u00e9mentation Pattern Factory \u2192</p>"},{"location":"fr/advanced/pattern-factory-guide/","title":"Pattern Factory : Guide d'Impl\u00e9mentation Complet","text":""},{"location":"fr/advanced/pattern-factory-guide/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>Pourquoi Utiliser des Factories ?</li> <li>Factory vs Constructeur</li> <li>Types de Factories</li> <li>Validation Entr\u00e9e dans Factories</li> <li>Gestion des Erreurs</li> <li>Factories avec Value Objects</li> <li>Factory avec D\u00e9pendances</li> <li>Tester les Factories</li> <li>Exemples R\u00e9els Complets</li> </ol>"},{"location":"fr/advanced/pattern-factory-guide/#pourquoi-utiliser-des-factories","title":"Pourquoi Utiliser des Factories ?","text":""},{"location":"fr/advanced/pattern-factory-guide/#le-probleme-creation-entite-complexe","title":"Le Probl\u00e8me : Cr\u00e9ation Entit\u00e9 Complexe","text":"<pre><code>// \u274c Cr\u00e9er entit\u00e9 directement : complexe et source d'erreurs\n$user = new User(\n    id: UserId::generate(),\n    email: new Email($request-&gt;email),\n    password: HashedPassword::fromPlaintext($request-&gt;password),\n    roles: [Role::USER],\n    isActive: false,\n    createdAt: new \\DateTimeImmutable(),\n    updatedAt: new \\DateTimeImmutable()\n);\n\n// Et si validation email l\u00e8ve exception ?\n// Et si mot de passe trop court ?\n// Et si on oublie de d\u00e9finir createdAt ?\n</code></pre> <p>Probl\u00e8mes : - Logique d'instanciation complexe \u00e9parpill\u00e9e partout - Facile d'oublier champs requis - Difficile \u00e0 maintenir (changement un endroit = changement partout) - R\u00e8gles m\u00e9tier dupliqu\u00e9es</p>"},{"location":"fr/advanced/pattern-factory-guide/#la-solution-pattern-factory","title":"La Solution : Pattern Factory","text":"<pre><code>// \u2705 Utiliser factory : simple et coh\u00e9rent\n$user = UserFactory::create(\n    email: $request-&gt;email,\n    password: $request-&gt;password\n);\n\n// Factory g\u00e8re :\n// - G\u00e9n\u00e9ration ID\n// - Validation email\n// - Hashage mot de passe\n// - R\u00f4les par d\u00e9faut\n// - Timestamps\n// - R\u00e8gles m\u00e9tier\n</code></pre> <p>B\u00e9n\u00e9fices : - Encapsule logique de cr\u00e9ation complexe - Force r\u00e8gles m\u00e9tier - Fournit valeurs par d\u00e9faut sens\u00e9es - Un seul endroit pour changer logique cr\u00e9ation - API claire pour cr\u00e9er entit\u00e9s</p>"},{"location":"fr/advanced/pattern-factory-guide/#factory-vs-constructeur","title":"Factory vs Constructeur","text":""},{"location":"fr/advanced/pattern-factory-guide/#quand-utiliser-constructeur","title":"Quand Utiliser Constructeur","text":"<p>\u2705 Utiliser constructeur quand : - Cr\u00e9ation simple (pas de logique) - Tous champs requis, pas de d\u00e9fauts - Reconstruction depuis base donn\u00e9es (hydratation)</p> <pre><code>// Value object simple : constructeur convient\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n    }\n}\n\n// Usage\n$email = new Email('user@example.com'); // Simple, clair\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#quand-utiliser-factory","title":"Quand Utiliser Factory","text":"<p>\u2705 Utiliser factory quand : - Logique d'initialisation complexe - Plusieurs m\u00e9thodes de cr\u00e9ation n\u00e9cessaires - Besoin de g\u00e9n\u00e9rer IDs ou timestamps - R\u00e8gles m\u00e9tier s'appliquent - Plusieurs \u00e9tapes impliqu\u00e9es</p> <pre><code>// Entit\u00e9 complexe : factory est mieux\nclass UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),              // G\u00e9n\u00e9r\u00e9\n            email: new Email($email),            // Valid\u00e9\n            password: HashedPassword::fromPlaintext($password), // Hach\u00e9\n            roles: [Role::USER],                 // D\u00e9faut\n            isActive: false,                     // D\u00e9faut\n            createdAt: new \\DateTimeImmutable(), // Auto\n            updatedAt: new \\DateTimeImmutable()  // Auto\n        );\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#types-de-factories","title":"Types de Factories","text":""},{"location":"fr/advanced/pattern-factory-guide/#type-1-methodes-factory-statiques","title":"Type 1 : M\u00e9thodes Factory Statiques","text":"<p>Meilleur pour : Factories simples sans d\u00e9pendances.</p> <pre><code>class UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password),\n            roles: [Role::USER],\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    public static function createAdmin(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password),\n            roles: [Role::USER, Role::ADMIN], // D\u00e9faut diff\u00e9rent\n            isActive: true,                   // D\u00e9faut diff\u00e9rent\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n}\n\n// Usage\n$user = UserFactory::create('user@example.com', 'password123');\n$admin = UserFactory::createAdmin('admin@example.com', 'admin123');\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#type-2-factory-instance-avec-dependances","title":"Type 2 : Factory Instance avec D\u00e9pendances","text":"<p>Meilleur pour : Factories n\u00e9cessitant services (ex. g\u00e9n\u00e9rateur ID, horloge).</p> <pre><code>final readonly class OrderFactory\n{\n    public function __construct(\n        private OrderNumberGenerator $numberGenerator,\n        private ClockInterface $clock,\n    ) {}\n\n    public function create(CustomerId $customerId, array $items): Order\n    {\n        return new Order(\n            id: OrderId::generate(),\n            orderNumber: $this-&gt;numberGenerator-&gt;next(), // Utilise service\n            customerId: $customerId,\n            items: $items,\n            status: OrderStatus::PENDING,\n            createdAt: $this-&gt;clock-&gt;now() // Utilise service\n        );\n    }\n}\n\n// Usage (via DI)\nclass CreateOrderHandler\n{\n    public function __construct(\n        private OrderFactory $orderFactory,\n        private OrderRepositoryInterface $orders,\n    ) {}\n\n    public function __invoke(CreateOrderCommand $command): void\n    {\n        $order = $this-&gt;orderFactory-&gt;create(\n            customerId: $command-&gt;customerId,\n            items: $command-&gt;items\n        );\n\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#type-3-constructeurs-nommes-alternative-a-factory","title":"Type 3 : Constructeurs Nomm\u00e9s (Alternative \u00e0 Factory)","text":"<p>Meilleur pour : Value objects avec plusieurs m\u00e9thodes cr\u00e9ation.</p> <pre><code>final readonly class Money\n{\n    private function __construct(\n        public int $amountInCents,\n        public Currency $currency,\n    ) {}\n\n    // Constructeur nomm\u00e9 : depuis centimes\n    public static function fromCents(int $cents, Currency $currency): self\n    {\n        return new self($cents, $currency);\n    }\n\n    // Constructeur nomm\u00e9 : depuis float\n    public static function fromFloat(float $amount, Currency $currency): self\n    {\n        return new self((int) round($amount * 100), $currency);\n    }\n\n    // Constructeur nomm\u00e9 : montant z\u00e9ro\n    public static function zero(Currency $currency): self\n    {\n        return new self(0, $currency);\n    }\n}\n\n// Usage\n$price1 = Money::fromCents(1999, Currency::USD);     // $19.99\n$price2 = Money::fromFloat(19.99, Currency::USD);    // $19.99\n$balance = Money::zero(Currency::USD);                // $0.00\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#validation-entree-dans-factories","title":"Validation Entr\u00e9e dans Factories","text":""},{"location":"fr/advanced/pattern-factory-guide/#ou-valider","title":"O\u00f9 Valider ?","text":"<p>R\u00e8gle : Valider dans value objects d'abord, puis v\u00e9rifier r\u00e8gles m\u00e9tier dans factory.</p>"},{"location":"fr/advanced/pattern-factory-guide/#exemple-inscription-utilisateur","title":"Exemple : Inscription Utilisateur","text":"<pre><code>// 1. Value object valide format\nfinal readonly class Email\n{\n    public function __construct(public string $value)\n    {\n        // Validation technique : format email\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException($value);\n        }\n\n        // Validation m\u00e9tier : restriction domaine\n        if (!str_ends_with($value, '@company.com')) {\n            throw new InvalidEmailDomainException($value);\n        }\n    }\n}\n\nfinal readonly class Password\n{\n    public function __construct(public string $value)\n    {\n        // Validation m\u00e9tier : longueur minimale\n        if (strlen($value) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        // Validation m\u00e9tier : complexit\u00e9\n        if (!preg_match('/[A-Z]/', $value)) {\n            throw new PasswordNeedsUppercaseException();\n        }\n\n        if (!preg_match('/[0-9]/', $value)) {\n            throw new PasswordNeedsNumberException();\n        }\n    }\n}\n\n// 2. Factory g\u00e8re logique cr\u00e9ation\nclass UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        // Value objects se valident \u00e0 la construction\n        $emailVO = new Email($email); // L\u00e8ve si invalide\n        $passwordVO = new Password($password); // L\u00e8ve si invalide\n\n        // Factory g\u00e8re logique suppl\u00e9mentaire\n        return new User(\n            id: UserId::generate(),\n            email: $emailVO,\n            password: HashedPassword::fromPassword($passwordVO),\n            roles: [Role::USER],\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n}\n</code></pre> <p>S\u00e9paration des pr\u00e9occupations : - Value objects : Validation technique + m\u00e9tier basique - Factory : Orchestration + d\u00e9fauts + r\u00e8gles m\u00e9tier complexes</p>"},{"location":"fr/advanced/pattern-factory-guide/#exemple-commande-avec-regles-metier","title":"Exemple : Commande avec R\u00e8gles M\u00e9tier","text":"<pre><code>class OrderFactory\n{\n    public function create(\n        CustomerId $customerId,\n        array $items, // OrderItem[]\n        ShippingAddress $address\n    ): Order {\n        // R\u00e8gle m\u00e9tier : doit avoir au moins un article\n        if (empty($items)) {\n            throw new OrderMustHaveItemsException();\n        }\n\n        // R\u00e8gle m\u00e9tier : total doit \u00eatre au-dessus minimum\n        $total = $this-&gt;calculateTotal($items);\n        if ($total-&gt;isLessThan(Money::fromCents(500, Currency::USD))) {\n            throw new OrderBelowMinimumException($total);\n        }\n\n        // R\u00e8gle m\u00e9tier : valider livraison vers pays\n        if (!$this-&gt;canShipToCountry($address-&gt;country)) {\n            throw new CannotShipToCountryException($address-&gt;country);\n        }\n\n        return new Order(\n            id: OrderId::generate(),\n            customerId: $customerId,\n            items: $items,\n            shippingAddress: $address,\n            status: OrderStatus::PENDING,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    private function calculateTotal(array $items): Money\n    {\n        return array_reduce(\n            $items,\n            fn(Money $sum, OrderItem $item) =&gt; $sum-&gt;add($item-&gt;getTotal()),\n            Money::zero(Currency::USD)\n        );\n    }\n\n    private function canShipToCountry(Country $country): bool\n    {\n        return in_array($country, [Country::US, Country::CA, Country::UK]);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#gestion-des-erreurs","title":"Gestion des Erreurs","text":""},{"location":"fr/advanced/pattern-factory-guide/#strategie-1-lever-exceptions-domaine","title":"Strat\u00e9gie 1 : Lever Exceptions Domaine","text":"<pre><code>class UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        try {\n            $emailVO = new Email($email);\n        } catch (InvalidEmailException $e) {\n            throw new UserCreationFailedException(\n                \"Email invalide : {$e-&gt;getMessage()}\",\n                previous: $e\n            );\n        }\n\n        try {\n            $passwordVO = HashedPassword::fromPlaintext($password);\n        } catch (PasswordTooShortException $e) {\n            throw new UserCreationFailedException(\n                \"Mot de passe invalide : {$e-&gt;getMessage()}\",\n                previous: $e\n            );\n        }\n\n        return new User(\n            id: UserId::generate(),\n            email: $emailVO,\n            password: $passwordVO,\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n}\n</code></pre> <p>B\u00e9n\u00e9fices : - Exceptions domaine se propagent naturellement - Appelant g\u00e8re erreurs - Messages erreur clairs</p>"},{"location":"fr/advanced/pattern-factory-guide/#strategie-2-retourner-objet-result-railway-oriented","title":"Strat\u00e9gie 2 : Retourner Objet Result (Railway-Oriented)","text":"<pre><code>// Wrapper Result\nfinal readonly class Result\n{\n    private function __construct(\n        public bool $success,\n        public mixed $value = null,\n        public ?string $error = null,\n    ) {}\n\n    public static function ok(mixed $value): self\n    {\n        return new self(true, $value);\n    }\n\n    public static function fail(string $error): self\n    {\n        return new self(false, error: $error);\n    }\n}\n\n// Factory retourne Result\nclass UserFactory\n{\n    public static function create(string $email, string $password): Result\n    {\n        try {\n            $emailVO = new Email($email);\n        } catch (InvalidEmailException $e) {\n            return Result::fail(\"Email invalide : {$e-&gt;getMessage()}\");\n        }\n\n        try {\n            $passwordVO = HashedPassword::fromPlaintext($password);\n        } catch (\\Exception $e) {\n            return Result::fail(\"Mot de passe invalide : {$e-&gt;getMessage()}\");\n        }\n\n        $user = new User(\n            id: UserId::generate(),\n            email: $emailVO,\n            password: $passwordVO,\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n\n        return Result::ok($user);\n    }\n}\n\n// Usage\n$result = UserFactory::create($email, $password);\n\nif (!$result-&gt;success) {\n    return new JsonResponse(['error' =&gt; $result-&gt;error], 400);\n}\n\n$user = $result-&gt;value;\n</code></pre> <p>B\u00e9n\u00e9fices : - Erreurs sont valeurs, pas exceptions - Gestion erreur explicite - Style programmation fonctionnelle</p>"},{"location":"fr/advanced/pattern-factory-guide/#factories-avec-value-objects","title":"Factories avec Value Objects","text":""},{"location":"fr/advanced/pattern-factory-guide/#pattern-factory-utilise-factories-value-object","title":"Pattern : Factory Utilise Factories Value Object","text":"<pre><code>// Value object avec sa propre factory\nfinal readonly class HashedPassword\n{\n    private function __construct(public string $hash) {}\n\n    // Factory value object\n    public static function fromPlaintext(string $plaintext): self\n    {\n        if (strlen($plaintext) &lt; 8) {\n            throw new PasswordTooShortException();\n        }\n\n        $hash = password_hash($plaintext, PASSWORD_ARGON2ID);\n\n        return new self($hash);\n    }\n\n    public static function fromHash(string $hash): self\n    {\n        return new self($hash);\n    }\n}\n\n// Factory entit\u00e9 utilise factory value object\nclass UserFactory\n{\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password), // Utilise factory VO\n            isActive: false,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    // Reconstituer depuis base de donn\u00e9es (m\u00e9thode factory VO diff\u00e9rente)\n    public static function reconstitute(\n        string $id,\n        string $email,\n        string $passwordHash,\n        bool $isActive,\n        string $createdAt\n    ): User {\n        return new User(\n            id: UserId::fromString($id),\n            email: new Email($email),\n            password: HashedPassword::fromHash($passwordHash), // Factory VO diff\u00e9rente\n            isActive: $isActive,\n            createdAt: new \\DateTimeImmutable($createdAt)\n        );\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#factory-avec-dependances","title":"Factory avec D\u00e9pendances","text":""},{"location":"fr/advanced/pattern-factory-guide/#exemple-factory-order-avec-services","title":"Exemple : Factory Order avec Services","text":"<pre><code>final readonly class OrderFactory\n{\n    public function __construct(\n        private OrderNumberGenerator $numberGenerator,\n        private TaxCalculator $taxCalculator,\n        private ShippingCalculator $shippingCalculator,\n        private ClockInterface $clock,\n    ) {}\n\n    public function create(\n        CustomerId $customerId,\n        array $items,\n        ShippingAddress $address\n    ): Order {\n        // Utiliser services inject\u00e9s\n        $orderNumber = $this-&gt;numberGenerator-&gt;next();\n        $subtotal = $this-&gt;calculateSubtotal($items);\n        $tax = $this-&gt;taxCalculator-&gt;calculate($subtotal, $address-&gt;country);\n        $shipping = $this-&gt;shippingCalculator-&gt;calculate($address, $items);\n        $total = $subtotal-&gt;add($tax)-&gt;add($shipping);\n\n        return new Order(\n            id: OrderId::generate(),\n            orderNumber: $orderNumber,\n            customerId: $customerId,\n            items: $items,\n            subtotal: $subtotal,\n            tax: $tax,\n            shipping: $shipping,\n            total: $total,\n            status: OrderStatus::PENDING,\n            createdAt: $this-&gt;clock-&gt;now()\n        );\n    }\n\n    private function calculateSubtotal(array $items): Money\n    {\n        return array_reduce(\n            $items,\n            fn(Money $sum, OrderItem $item) =&gt; $sum-&gt;add($item-&gt;getTotal()),\n            Money::zero(Currency::USD)\n        );\n    }\n}\n</code></pre> <p>Configuration (services.yaml) :</p> <pre><code>services:\n    App\\Order\\Domain\\Factory\\OrderFactory:\n        arguments:\n            $numberGenerator: '@App\\Order\\Infrastructure\\OrderNumberGenerator'\n            $taxCalculator: '@App\\Order\\Domain\\Service\\TaxCalculator'\n            $shippingCalculator: '@App\\Order\\Domain\\Service\\ShippingCalculator'\n            $clock: '@App\\Shared\\Infrastructure\\Clock\\SystemClock'\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#tester-les-factories","title":"Tester les Factories","text":""},{"location":"fr/advanced/pattern-factory-guide/#test-1-creation-reussie","title":"Test 1 : Cr\u00e9ation R\u00e9ussie","text":"<pre><code>class UserFactoryTest extends TestCase\n{\n    public function test_creates_user_with_valid_data(): void\n    {\n        $user = UserFactory::create(\n            email: 'user@example.com',\n            password: 'ValidPass123'\n        );\n\n        $this-&gt;assertInstanceOf(User::class, $user);\n        $this-&gt;assertEquals('user@example.com', $user-&gt;getEmail()-&gt;value);\n        $this-&gt;assertFalse($user-&gt;isActive());\n        $this-&gt;assertContains(Role::USER, $user-&gt;getRoles());\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#test-2-echecs-validation","title":"Test 2 : \u00c9checs Validation","text":"<pre><code>class UserFactoryTest extends TestCase\n{\n    public function test_throws_on_invalid_email(): void\n    {\n        $this-&gt;expectException(InvalidEmailException::class);\n\n        UserFactory::create(\n            email: 'pas-un-email',\n            password: 'ValidPass123'\n        );\n    }\n\n    public function test_throws_on_short_password(): void\n    {\n        $this-&gt;expectException(PasswordTooShortException::class);\n\n        UserFactory::create(\n            email: 'user@example.com',\n            password: 'court'\n        );\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#test-3-factory-avec-dependances","title":"Test 3 : Factory avec D\u00e9pendances","text":"<pre><code>class OrderFactoryTest extends TestCase\n{\n    public function test_creates_order_with_calculated_totals(): void\n    {\n        $numberGenerator = $this-&gt;createMock(OrderNumberGenerator::class);\n        $numberGenerator-&gt;method('next')-&gt;willReturn(new OrderNumber('ORD-001'));\n\n        $taxCalculator = $this-&gt;createMock(TaxCalculator::class);\n        $taxCalculator-&gt;method('calculate')-&gt;willReturn(Money::fromCents(200, Currency::USD));\n\n        $shippingCalculator = $this-&gt;createMock(ShippingCalculator::class);\n        $shippingCalculator-&gt;method('calculate')-&gt;willReturn(Money::fromCents(500, Currency::USD));\n\n        $clock = new FixedClock(new \\DateTimeImmutable('2024-01-15 10:00:00'));\n\n        $factory = new OrderFactory($numberGenerator, $taxCalculator, $shippingCalculator, $clock);\n\n        $order = $factory-&gt;create(\n            customerId: CustomerId::generate(),\n            items: [new OrderItem(ProductId::generate(), 2, Money::fromCents(1000, Currency::USD))],\n            address: new ShippingAddress(/* ... */)\n        );\n\n        $this-&gt;assertEquals('ORD-001', $order-&gt;getOrderNumber()-&gt;value);\n        $this-&gt;assertEquals(2700, $order-&gt;getTotal()-&gt;amountInCents); // 2000 + 200 + 500\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#exemples-reels-complets","title":"Exemples R\u00e9els Complets","text":""},{"location":"fr/advanced/pattern-factory-guide/#exemple-1-factory-product","title":"Exemple 1 : Factory Product","text":"<pre><code>namespace App\\Catalog\\Domain\\Factory;\n\nfinal class ProductFactory\n{\n    public static function create(\n        string $name,\n        string $description,\n        int $priceInCents,\n        int $initialStock\n    ): Product {\n        // Validation\n        if (empty($name)) {\n            throw new ProductNameCannotBeEmptyException();\n        }\n\n        if ($priceInCents &lt; 0) {\n            throw new ProductPriceCannotBeNegativeException();\n        }\n\n        if ($initialStock &lt; 0) {\n            throw new ProductStockCannotBeNegativeException();\n        }\n\n        // Cr\u00e9er value objects\n        $price = Money::fromCents($priceInCents, Currency::USD);\n        $stock = new Stock($initialStock);\n\n        // Cr\u00e9er entit\u00e9\n        return new Product(\n            id: ProductId::generate(),\n            name: $name,\n            description: $description,\n            price: $price,\n            stock: $stock,\n            isActive: true,\n            createdAt: new \\DateTimeImmutable()\n        );\n    }\n\n    public static function createOutOfStock(string $name, string $description, int $priceInCents): Product\n    {\n        $product = self::create($name, $description, $priceInCents, 0);\n        $product-&gt;deactivate(); // Produits en rupture sont inactifs\n        return $product;\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#exemple-2-factory-invoice-avec-lignes","title":"Exemple 2 : Factory Invoice avec Lignes","text":"<pre><code>namespace App\\Billing\\Domain\\Factory;\n\nfinal readonly class InvoiceFactory\n{\n    public function __construct(\n        private InvoiceNumberGenerator $numberGenerator,\n        private ClockInterface $clock,\n    ) {}\n\n    public function create(\n        CustomerId $customerId,\n        array $lineItems, // InvoiceLineItem[]\n        ?DateTimeImmutable $dueDate = null\n    ): Invoice {\n        // Validation\n        if (empty($lineItems)) {\n            throw new InvoiceMustHaveLineItemsException();\n        }\n\n        // Calculer total\n        $total = array_reduce(\n            $lineItems,\n            fn(Money $sum, InvoiceLineItem $item) =&gt; $sum-&gt;add($item-&gt;getTotal()),\n            Money::zero(Currency::USD)\n        );\n\n        // Date \u00e9ch\u00e9ance par d\u00e9faut : 30 jours depuis maintenant\n        $dueDate ??= $this-&gt;clock-&gt;now()-&gt;modify('+30 days');\n\n        // G\u00e9n\u00e9rer num\u00e9ro facture\n        $invoiceNumber = $this-&gt;numberGenerator-&gt;next();\n\n        return new Invoice(\n            id: InvoiceId::generate(),\n            invoiceNumber: $invoiceNumber,\n            customerId: $customerId,\n            lineItems: $lineItems,\n            total: $total,\n            status: InvoiceStatus::DRAFT,\n            issuedAt: $this-&gt;clock-&gt;now(),\n            dueDate: $dueDate\n        );\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#exemple-3-factory-user-complexe-avec-plusieurs-methodes","title":"Exemple 3 : Factory User Complexe avec Plusieurs M\u00e9thodes","text":"<pre><code>namespace App\\User\\Domain\\Factory;\n\nfinal class UserFactory\n{\n    // Inscription utilisateur r\u00e9gulier\n    public static function create(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password),\n            roles: [Role::USER],\n            isActive: false, // Requiert v\u00e9rification email\n            isEmailVerified: false,\n            createdAt: new \\DateTimeImmutable(),\n            updatedAt: new \\DateTimeImmutable()\n        );\n    }\n\n    // Utilisateur admin (pas de v\u00e9rification n\u00e9cessaire)\n    public static function createAdmin(string $email, string $password): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: HashedPassword::fromPlaintext($password),\n            roles: [Role::USER, Role::ADMIN],\n            isActive: true,\n            isEmailVerified: true,\n            createdAt: new \\DateTimeImmutable(),\n            updatedAt: new \\DateTimeImmutable()\n        );\n    }\n\n    // Utilisateur OAuth (pas de mot de passe)\n    public static function createFromOAuth(string $email, OAuthProvider $provider, string $providerId): User\n    {\n        return new User(\n            id: UserId::generate(),\n            email: new Email($email),\n            password: null, // Pas de mot de passe pour utilisateurs OAuth\n            roles: [Role::USER],\n            isActive: true,\n            isEmailVerified: true, // Faire confiance fournisseur OAuth\n            oauthProvider: $provider,\n            oauthProviderId: $providerId,\n            createdAt: new \\DateTimeImmutable(),\n            updatedAt: new \\DateTimeImmutable()\n        );\n    }\n\n    // Reconstituer depuis base de donn\u00e9es\n    public static function reconstitute(array $data): User\n    {\n        return new User(\n            id: UserId::fromString($data['id']),\n            email: new Email($data['email']),\n            password: $data['password'] ? HashedPassword::fromHash($data['password']) : null,\n            roles: array_map(fn($role) =&gt; Role::from($role), $data['roles']),\n            isActive: $data['is_active'],\n            isEmailVerified: $data['is_email_verified'],\n            oauthProvider: $data['oauth_provider'] ? OAuthProvider::from($data['oauth_provider']) : null,\n            oauthProviderId: $data['oauth_provider_id'],\n            createdAt: new \\DateTimeImmutable($data['created_at']),\n            updatedAt: new \\DateTimeImmutable($data['updated_at'])\n        );\n    }\n}\n</code></pre>"},{"location":"fr/advanced/pattern-factory-guide/#points-cles-a-retenir","title":"Points Cl\u00e9s \u00e0 Retenir","text":"<ol> <li>Utiliser factories pour cr\u00e9ation entit\u00e9 complexe - Encapsuler logique en un endroit</li> <li>Valider dans value objects d'abord - Puis v\u00e9rifier r\u00e8gles m\u00e9tier dans factory</li> <li>Fournir plusieurs m\u00e9thodes cr\u00e9ation - Cas d'usage diff\u00e9rents n\u00e9cessitent factories diff\u00e9rentes</li> <li>G\u00e9rer erreurs avec exceptions domaine - Messages erreur clairs et significatifs</li> <li>Injecter d\u00e9pendances si n\u00e9cessaire - Utiliser factories instance pour services</li> <li>Tester factories minutieusement - Assurer validation et d\u00e9fauts fonctionnent correctement</li> </ol> <p>Suivant : Strat\u00e9gie Gestion Erreurs \u2192</p>"},{"location":"fr/advanced/principes-conception-ports/","title":"Principes de Conception des Ports (Interfaces)","text":""},{"location":"fr/advanced/principes-conception-ports/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>Qu'est-ce qu'un Port ?</li> <li>Conventions de Nommage</li> <li>Principe de S\u00e9gr\u00e9gation des Interfaces (ISP)</li> <li>Directives de Conception des M\u00e9thodes</li> <li>Patterns de Ports Courants</li> <li>Anti-Patterns \u00e0 \u00c9viter</li> <li>Exemples Concrets</li> </ol>"},{"location":"fr/advanced/principes-conception-ports/#quest-ce-quun-port","title":"Qu'est-ce qu'un Port ?","text":"<p>Un Port est une interface d\u00e9finie dans la couche Domaine qui d\u00e9clare ce que le domaine a besoin du monde ext\u00e9rieur.</p> <pre><code>Le Domaine d\u00e9finit :    \"J'ai besoin de sauvegarder des utilisateurs\"  \u2192 UserRepositoryInterface (Port)\nL'Infrastructure fournit :  \"Voici comment\"                            \u2192 DoctrineUserRepository (Adaptateur)\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#caracteristiques-cles","title":"Caract\u00e9ristiques Cl\u00e9s","text":"<ul> <li>D\u00e9fini dans le Domaine - Vit dans <code>Domain/Port/</code></li> <li>Impl\u00e9ment\u00e9 par l'Infrastructure - Adaptateurs dans <code>Infrastructure/</code></li> <li>Exprime l'Intention M\u00e9tier - Utilise le langage domaine, pas technique</li> <li>Aucun D\u00e9tail d'Impl\u00e9mentation - Aucune mention de Doctrine, MySQL, HTTP, etc.</li> </ul>"},{"location":"fr/advanced/principes-conception-ports/#conventions-de-nommage","title":"Conventions de Nommage","text":""},{"location":"fr/advanced/principes-conception-ports/#ports-repository","title":"Ports Repository","text":"<p>\u2705 BON : <pre><code>interface UserRepositoryInterface       // Clair : g\u00e8re les entit\u00e9s User\ninterface OrderRepositoryInterface      // Clair : g\u00e8re les entit\u00e9s Order\ninterface ProductRepositoryInterface    // Clair : g\u00e8re les entit\u00e9s Product\n</code></pre></p> <p>\u274c MAUVAIS : <pre><code>interface UserDAO                       // Terme technique (Data Access Object)\ninterface UserPersistence               // Vague\ninterface IUserRepository               // Notation hongroise (\u00e9viter pr\u00e9fixe \"I\")\ninterface UserRepositoryPort            // Suffixe redondant\n</code></pre></p>"},{"location":"fr/advanced/principes-conception-ports/#ports-service","title":"Ports Service","text":"<p>\u2705 BON : <pre><code>interface EmailSenderInterface          // Capacit\u00e9 claire\ninterface PaymentProcessorInterface     // Responsabilit\u00e9 claire\ninterface NotificationServiceInterface  // Objectif clair\n</code></pre></p> <p>\u274c MAUVAIS : <pre><code>interface EmailService                  // Trop vague\ninterface IEmailSender                  // Notation hongroise\ninterface SMTPEmailSender               // D\u00e9tail d'impl\u00e9mentation fuite !\n</code></pre></p>"},{"location":"fr/advanced/principes-conception-ports/#ports-query-cqrs","title":"Ports Query (CQRS)","text":"<p>\u2705 BON : <pre><code>interface UserQueryInterface            // Clair : op\u00e9rations lecture pour Users\ninterface OrderQueryInterface           // Clair : op\u00e9rations lecture pour Orders\ninterface ProductCatalogQueryInterface  // Clair : pr\u00e9occupation lecture sp\u00e9cifique\n</code></pre></p> <p>\u274c MAUVAIS : <pre><code>interface UserReader                    // Peu clair\ninterface GetUserQuery                  // Pas une capacit\u00e9, mais une action\n</code></pre></p>"},{"location":"fr/advanced/principes-conception-ports/#principe-de-segregation-des-interfaces-isp","title":"Principe de S\u00e9gr\u00e9gation des Interfaces (ISP)","text":"<p>\"Les clients ne devraient pas \u00eatre forc\u00e9s de d\u00e9pendre de m\u00e9thodes qu'ils n'utilisent pas.\"</p>"},{"location":"fr/advanced/principes-conception-ports/#le-probleme-interfaces-obeses","title":"Le Probl\u00e8me : Interfaces Ob\u00e8ses","text":"<p>\u274c MAUVAIS : Interface Dieu</p> <pre><code>interface UserRepositoryInterface\n{\n    // M\u00e9thodes lecture\n    public function findById(UserId $id): ?User;\n    public function findByEmail(string $email): ?User;\n    public function findAll(): array;\n    public function findActiveUsers(): array;\n    public function findUsersByRole(string $role): array;\n    public function searchUsers(string $query): array;\n\n    // M\u00e9thodes \u00e9criture\n    public function save(User $user): void;\n    public function delete(User $user): void;\n\n    // M\u00e9thodes statistiques\n    public function countUsers(): int;\n    public function countActiveUsers(): int;\n\n    // M\u00e9thodes admin\n    public function purgeInactiveUsers(): void;\n    public function exportUsersToCSV(): string;\n\n    // M\u00e9thodes notification\n    public function findUsersToNotify(): array;\n}\n</code></pre> <p>Probl\u00e8mes : - Handler qui sauvegarde uniquement des utilisateurs d\u00e9pend de 15 m\u00e9thodes dont il n'a pas besoin - Difficile \u00e0 tester (doit mocker 15 m\u00e9thodes) - Difficile \u00e0 impl\u00e9menter (adaptateur doit tout impl\u00e9menter) - Viole le Principe de Responsabilit\u00e9 Unique</p>"},{"location":"fr/advanced/principes-conception-ports/#la-solution-interfaces-segregees","title":"La Solution : Interfaces S\u00e9gr\u00e9g\u00e9es","text":"<p>\u2705 BON : S\u00e9gr\u00e9g\u00e9 par Responsabilit\u00e9</p> <pre><code>// Op\u00e9rations \u00e9criture\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function delete(User $user): void;\n    public function existsByEmail(string $email): bool;\n}\n\n// Op\u00e9rations lecture (pattern CQRS)\ninterface UserQueryInterface\n{\n    public function findById(UserId $id): ?User;\n    public function findByEmail(string $email): ?User;\n    public function findActiveUsers(): array;\n}\n\n// Op\u00e9rations admin\ninterface UserAdminInterface\n{\n    public function purgeInactiveUsers(): void;\n    public function countUsers(): int;\n}\n\n// Op\u00e9rations notification\ninterface UserNotificationQueryInterface\n{\n    public function findUsersToNotify(): array;\n}\n</code></pre> <p>B\u00e9n\u00e9fices : - Les handlers d\u00e9pendent uniquement de ce dont ils ont besoin - Facile \u00e0 tester (mocker uniquement les m\u00e9thodes pertinentes) - Facile \u00e0 impl\u00e9menter (adaptateur impl\u00e9mente une responsabilit\u00e9 \u00e0 la fois) - S\u00e9paration claire des pr\u00e9occupations</p>"},{"location":"fr/advanced/principes-conception-ports/#quand-diviser-vs-garder-ensemble","title":"Quand Diviser vs Garder Ensemble","text":"<p>\u2705 Garder ensemble quand les m\u00e9thodes sont toujours utilis\u00e9es ensemble :</p> <pre><code>// BON : Ces m\u00e9thodes appartiennent logiquement ensemble\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function delete(Order $order): void;\n}\n</code></pre> <p>\u274c Diviser quand les m\u00e9thodes servent diff\u00e9rents cas d'usage :</p> <pre><code>// MAUVAIS : findPendingOrders est sp\u00e9cifique \u00e0 un job en arri\u00e8re-plan\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function findPendingOrders(): array; // \u274c Pr\u00e9occupation diff\u00e9rente !\n}\n\n// BON : Interface query s\u00e9par\u00e9e\ninterface OrderQueryInterface\n{\n    public function findPendingOrders(): array;\n}\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#directives-de-conception-des-methodes","title":"Directives de Conception des M\u00e9thodes","text":""},{"location":"fr/advanced/principes-conception-ports/#1-utiliser-le-langage-domaine-pas-technique","title":"1. Utiliser le Langage Domaine, Pas Technique","text":"<p>\u2705 BON : Langage Domaine</p> <pre><code>interface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function findPendingOrders(): array; // Concept m\u00e9tier\n}\n</code></pre> <p>\u274c MAUVAIS : Langage Technique</p> <pre><code>interface OrderRepositoryInterface\n{\n    public function persist(Order $order): void; // Technique (terme SQL)\n    public function selectById(OrderId $id): ?Order; // Technique (terme SQL)\n    public function queryByStatusPending(): array; // D\u00e9tail d'impl\u00e9mentation technique\n}\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#2-retourner-des-objets-domaine-pas-des-primitives","title":"2. Retourner des Objets Domaine, Pas des Primitives","text":"<p>\u2705 BON : Objets Domaine</p> <pre><code>interface UserRepositoryInterface\n{\n    public function findById(UserId $id): ?User;\n    public function findActiveUsers(): array; // array&lt;User&gt;\n}\n</code></pre> <p>\u274c MAUVAIS : Primitives</p> <pre><code>interface UserRepositoryInterface\n{\n    public function findById(string $id): ?array; // array n'est pas type-safe\n    public function findActiveUsers(): array; // array&lt;quoi?&gt;\n}\n</code></pre> <p>Utiliser PHPDoc pour la clart\u00e9 :</p> <pre><code>interface UserRepositoryInterface\n{\n    /**\n     * @return array&lt;User&gt;\n     */\n    public function findActiveUsers(): array;\n}\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#3-accepter-des-types-domaine-pas-des-primitives","title":"3. Accepter des Types Domaine, Pas des Primitives","text":"<p>\u2705 BON : Value Objects</p> <pre><code>interface UserRepositoryInterface\n{\n    public function findById(UserId $id): ?User;\n    public function existsByEmail(Email $email): bool;\n}\n</code></pre> <p>\u274c MAUVAIS : Primitives</p> <pre><code>interface UserRepositoryInterface\n{\n    public function findById(string $id): ?User;\n    public function existsByEmail(string $email): bool; // Perd la validation domaine\n}\n</code></pre> <p>Pourquoi ? Les value objects assurent que la validation se produit \u00e0 la fronti\u00e8re, pas dans l'adaptateur.</p>"},{"location":"fr/advanced/principes-conception-ports/#4-concevoir-pour-la-lisibilite","title":"4. Concevoir pour la Lisibilit\u00e9","text":"<p>Les noms de m\u00e9thode doivent se lire comme du langage naturel.</p> <p>\u2705 BON : Lisible</p> <pre><code>if ($this-&gt;users-&gt;existsByEmail($email)) {\n    throw new EmailAlreadyExistsException();\n}\n\n$orders = $this-&gt;orders-&gt;findPendingOrders();\n</code></pre> <p>\u274c MAUVAIS : Peu Clair</p> <pre><code>if ($this-&gt;users-&gt;checkEmail($email)) { // V\u00e9rifier quoi sur l'email ?\n    throw new EmailAlreadyExistsException();\n}\n\n$orders = $this-&gt;orders-&gt;getPending(); // Obtenir pending quoi ?\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#5-eviter-de-faire-fuir-les-details-dimplementation","title":"5. \u00c9viter de Faire Fuir les D\u00e9tails d'Impl\u00e9mentation","text":"<p>\u2705 BON : Agnostique \u00e0 l'Impl\u00e9mentation</p> <pre><code>interface NotificationServiceInterface\n{\n    public function send(Notification $notification): void;\n}\n</code></pre> <p>\u274c MAUVAIS : Fuite d'Impl\u00e9mentation</p> <pre><code>interface NotificationServiceInterface\n{\n    public function sendViaSmtp(Notification $notification): void; // \u274c SMTP est d\u00e9tail d'impl\u00e9mentation\n    public function sendViaSendGrid(Notification $notification): void; // \u274c SendGrid est d\u00e9tail d'impl\u00e9mentation\n}\n</code></pre> <p>Pourquoi ? Le port doit d\u00e9crire \"quoi\", pas \"comment\". L'impl\u00e9mentation peut changer sans changer le port.</p>"},{"location":"fr/advanced/principes-conception-ports/#6-concevoir-pour-la-testabilite","title":"6. Concevoir pour la Testabilit\u00e9","text":"<p>Les ports doivent \u00eatre faciles \u00e0 mocker/stub.</p> <p>\u2705 BON : Simple, Testable</p> <pre><code>interface EmailSenderInterface\n{\n    public function send(Email $email): void;\n}\n\n// Test avec fake en m\u00e9moire\nclass InMemoryEmailSender implements EmailSenderInterface\n{\n    private array $sentEmails = [];\n\n    public function send(Email $email): void\n    {\n        $this-&gt;sentEmails[] = $email;\n    }\n\n    public function getSentEmails(): array\n    {\n        return $this-&gt;sentEmails;\n    }\n}\n</code></pre> <p>\u274c MAUVAIS : Difficile \u00e0 Tester</p> <pre><code>interface EmailSenderInterface\n{\n    public function send(\n        Email $email,\n        EmailConfiguration $config,\n        TransportOptions $transport,\n        RetryPolicy $retry\n    ): SendResult;\n}\n\n// Test n\u00e9cessite configuration complexe avec nombreuses d\u00e9pendances\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#patterns-de-ports-courants","title":"Patterns de Ports Courants","text":""},{"location":"fr/advanced/principes-conception-ports/#pattern-1-port-repository-persistance","title":"Pattern 1 : Port Repository (Persistance)","text":"<p>Objectif : G\u00e9rer le cycle de vie de la racine d'agr\u00e9gat (CRUD).</p> <pre><code>interface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function delete(Order $order): void;\n}\n</code></pre> <p>Points Cl\u00e9s : - Un repository par racine d'agr\u00e9gat - M\u00e9thodes utilisent le langage domaine (<code>save</code>, pas <code>persist</code>) - Retournent des entit\u00e9s domaine, pas des tableaux</p>"},{"location":"fr/advanced/principes-conception-ports/#pattern-2-port-query-cote-lecture-cqrs","title":"Pattern 2 : Port Query (C\u00f4t\u00e9 Lecture CQRS)","text":"<p>Objectif : Op\u00e9rations de lecture optimis\u00e9es, peut retourner des DTOs au lieu d'entit\u00e9s.</p> <pre><code>interface ProductCatalogQueryInterface\n{\n    /**\n     * @return array&lt;ProductListDTO&gt;\n     */\n    public function findAvailableProducts(int $limit, int $offset): array;\n\n    public function findProductById(ProductId $id): ?ProductDetailDTO;\n\n    public function searchProducts(string $query): array;\n}\n</code></pre> <p>Points Cl\u00e9s : - S\u00e9par\u00e9 des op\u00e9rations \u00e9criture (repository) - Peut retourner des DTOs optimis\u00e9s pour l'affichage - Peut contourner les entit\u00e9s domaine pour la performance</p>"},{"location":"fr/advanced/principes-conception-ports/#pattern-3-port-service-externe","title":"Pattern 3 : Port Service Externe","text":"<p>Objectif : Communiquer avec des syst\u00e8mes externes (email, paiement, etc.).</p> <pre><code>interface PaymentProcessorInterface\n{\n    public function charge(PaymentRequest $request): PaymentResult;\n    public function refund(RefundRequest $request): RefundResult;\n}\n</code></pre> <p>Points Cl\u00e9s : - Exprime la capacit\u00e9 m\u00e9tier, pas le protocole technique - Accepte/retourne des objets domaine - Cache les d\u00e9tails d'impl\u00e9mentation (Stripe, PayPal, etc.)</p>"},{"location":"fr/advanced/principes-conception-ports/#pattern-4-port-dispatcher-devenements","title":"Pattern 4 : Port Dispatcher d'\u00c9v\u00e9nements","text":"<p>Objectif : Publier des \u00e9v\u00e9nements domaine.</p> <pre><code>interface EventDispatcherInterface\n{\n    public function dispatch(DomainEvent $event): void;\n}\n</code></pre> <p>Points Cl\u00e9s : - Interface g\u00e9n\u00e9rique pour tous les \u00e9v\u00e9nements - Les \u00e9v\u00e9nements domaine sont des citoyens de premi\u00e8re classe - L'infrastructure g\u00e8re le routage</p>"},{"location":"fr/advanced/principes-conception-ports/#anti-patterns-a-eviter","title":"Anti-Patterns \u00e0 \u00c9viter","text":""},{"location":"fr/advanced/principes-conception-ports/#anti-pattern-1-repository-generique","title":"Anti-Pattern 1 : Repository G\u00e9n\u00e9rique","text":"<p>\u274c \u00c0 \u00c9VITER :</p> <pre><code>interface GenericRepositoryInterface\n{\n    public function save(object $entity): void;\n    public function findById(string $id): ?object;\n    public function findAll(): array;\n}\n</code></pre> <p>Probl\u00e8mes : - Type-unsafe (<code>object</code> et <code>string</code> sont trop g\u00e9n\u00e9riques) - Perd la sp\u00e9cificit\u00e9 domaine - Aucun b\u00e9n\u00e9fice type hinting</p> <p>\u2705 MIEUX :</p> <pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n}\n\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n}\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#anti-pattern-2-repositories-avec-logique-metier","title":"Anti-Pattern 2 : Repositories avec Logique M\u00e9tier","text":"<p>\u274c \u00c0 \u00c9VITER :</p> <pre><code>interface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n\n    // \u274c Logique m\u00e9tier fuit\u00e9e dans le repository !\n    public function cancelOrder(OrderId $id): void;\n    public function shipOrder(OrderId $id, Address $address): void;\n}\n</code></pre> <p>Probl\u00e8me : Repository devrait g\u00e9rer la persistance, pas ex\u00e9cuter la logique m\u00e9tier.</p> <p>\u2705 MIEUX :</p> <pre><code>// Repository : persistance uniquement\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n}\n\n// Logique m\u00e9tier dans les handlers\nclass CancelOrderHandler\n{\n    public function __invoke(CancelOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n        $order-&gt;cancel(); // Logique m\u00e9tier dans l'entit\u00e9\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#anti-pattern-3-ports-dependant-de-linfrastructure","title":"Anti-Pattern 3 : Ports D\u00e9pendant de l'Infrastructure","text":"<p>\u274c \u00c0 \u00c9VITER :</p> <pre><code>use Doctrine\\ORM\\EntityManagerInterface;\n\ninterface UserRepositoryInterface\n{\n    public function getEntityManager(): EntityManagerInterface; // \u274c Fuite infrastructure !\n}\n</code></pre> <p>Probl\u00e8me : Le domaine d\u00e9pend maintenant de Doctrine.</p> <p>\u2705 MIEUX :</p> <pre><code>interface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    // Aucune mention de Doctrine, EntityManager, ou framework\n}\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#exemples-concrets","title":"Exemples Concrets","text":""},{"location":"fr/advanced/principes-conception-ports/#exemple-1-systeme-e-commerce-de-commandes","title":"Exemple 1 : Syst\u00e8me E-Commerce de Commandes","text":"<pre><code>// Op\u00e9rations \u00e9criture\ninterface OrderRepositoryInterface\n{\n    public function save(Order $order): void;\n    public function findById(OrderId $id): ?Order;\n    public function nextOrderNumber(): OrderNumber;\n}\n\n// Op\u00e9rations lecture (optimis\u00e9es pour affichage)\ninterface OrderQueryInterface\n{\n    /**\n     * @return array&lt;OrderListDTO&gt;\n     */\n    public function findOrdersByCustomer(CustomerId $customerId, int $limit, int $offset): array;\n\n    public function findOrderDetails(OrderId $id): ?OrderDetailDTO;\n\n    /**\n     * @return array&lt;OrderListDTO&gt;\n     */\n    public function findRecentOrders(int $limit): array;\n}\n\n// Service paiement externe\ninterface PaymentProcessorInterface\n{\n    public function charge(PaymentRequest $request): PaymentResult;\n    public function refund(RefundRequest $request): RefundResult;\n    public function getTransactionStatus(TransactionId $id): TransactionStatus;\n}\n\n// Gestion inventaire\ninterface InventoryServiceInterface\n{\n    public function reserveStock(ProductId $productId, int $quantity): void;\n    public function releaseStock(ProductId $productId, int $quantity): void;\n    public function checkAvailability(ProductId $productId): int;\n}\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#exemple-2-systeme-dauthentification-utilisateur","title":"Exemple 2 : Syst\u00e8me d'Authentification Utilisateur","text":"<pre><code>// Persistance utilisateur\ninterface UserRepositoryInterface\n{\n    public function save(User $user): void;\n    public function findById(UserId $id): ?User;\n    public function findByEmail(Email $email): ?User;\n    public function existsByEmail(Email $email): bool;\n}\n\n// Hachage mot de passe (service externe)\ninterface PasswordHasherInterface\n{\n    public function hash(string $plaintext): string;\n    public function verify(string $plaintext, string $hash): bool;\n}\n\n// Notifications email\ninterface EmailSenderInterface\n{\n    public function send(Email $email): void;\n}\n\n// G\u00e9n\u00e9ration token\ninterface TokenGeneratorInterface\n{\n    public function generate(): string;\n}\n</code></pre>"},{"location":"fr/advanced/principes-conception-ports/#checklist-de-decision","title":"Checklist de D\u00e9cision","text":"<p>Lors de la conception d'un port, demandez-vous :</p> <ul> <li> Le nom de l'interface exprime-t-il clairement son objectif ?</li> <li> Les m\u00e9thodes sont-elles nomm\u00e9es en langage domaine, pas en termes techniques ?</li> <li> Accepte-t-il/retourne-t-il des objets domaine (entit\u00e9s, value objects, DTOs) ?</li> <li> Est-il s\u00e9gr\u00e9g\u00e9 (ISP)\u2014les handlers d\u00e9pendent uniquement de ce dont ils ont besoin ?</li> <li> \u00c9vite-t-il de faire fuir les d\u00e9tails d'impl\u00e9mentation ?</li> <li> Peut-il \u00eatre facilement mock\u00e9/stubb\u00e9 pour les tests ?</li> <li> Un expert m\u00e9tier comprendrait-il les noms de m\u00e9thodes ?</li> <li> Est-il d\u00e9fini dans la couche Domaine (<code>Domain/Port/</code>) ?</li> <li> A-t-il z\u00e9ro d\u00e9pendance vers l'infrastructure ?</li> </ul>"},{"location":"fr/advanced/principes-conception-ports/#resume","title":"R\u00e9sum\u00e9","text":"Principe Directive Nommage Utiliser langage domaine, \u00e9viter termes techniques S\u00e9gr\u00e9gation Diviser interfaces par responsabilit\u00e9 (ISP) Types Accepter/retourner objets domaine, pas primitives Clart\u00e9 M\u00e9thodes doivent se lire comme langage naturel Abstraction Cacher compl\u00e8tement d\u00e9tails d'impl\u00e9mentation Testabilit\u00e9 Facile \u00e0 mocker avec fakes en m\u00e9moire Localisation Toujours dans <code>Domain/Port/</code>, jamais dans Infrastructure <p>Suivant : Primary vs Secondary Adapters \u2192</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/","title":"Strat\u00e9gie de Gestion des Erreurs en Architecture Hexagonale","text":""},{"location":"fr/advanced/strategie-gestion-erreurs/#table-des-matieres","title":"Table des Mati\u00e8res","text":"<ol> <li>Hi\u00e9rarchie d'Exceptions</li> <li>Exceptions Domaine vs Infrastructure</li> <li>Traduction d'Exceptions aux Fronti\u00e8res</li> <li>Gestion des Exceptions dans les Handlers</li> <li>Gestion des Exceptions dans les Contr\u00f4leurs</li> <li>Tests des Sc\u00e9narios d'Erreur</li> <li>Exemples Concrets Complets</li> </ol>"},{"location":"fr/advanced/strategie-gestion-erreurs/#hierarchie-dexceptions","title":"Hi\u00e9rarchie d'Exceptions","text":""},{"location":"fr/advanced/strategie-gestion-erreurs/#structure-recommandee","title":"Structure Recommand\u00e9e","text":"<pre><code>Exception (PHP)\n\u251c\u2500\u2500 DomainException (Base personnalis\u00e9e)\n\u2502   \u251c\u2500\u2500 ValidationException\n\u2502   \u2502   \u251c\u2500\u2500 InvalidEmailException\n\u2502   \u2502   \u251c\u2500\u2500 PasswordTooShortException\n\u2502   \u2502   \u2514\u2500\u2500 InvalidQuantityException\n\u2502   \u251c\u2500\u2500 BusinessRuleException\n\u2502   \u2502   \u251c\u2500\u2500 OrderAlreadyShippedException\n\u2502   \u2502   \u251c\u2500\u2500 InsufficientStockException\n\u2502   \u2502   \u2514\u2500\u2500 CannotCancelShippedOrderException\n\u2502   \u2514\u2500\u2500 NotFoundException\n\u2502       \u251c\u2500\u2500 UserNotFoundException\n\u2502       \u251c\u2500\u2500 OrderNotFoundException\n\u2502       \u2514\u2500\u2500 ProductNotFoundException\n\u2514\u2500\u2500 InfrastructureException (Base personnalis\u00e9e)\n    \u251c\u2500\u2500 PersistenceException\n    \u2502   \u251c\u2500\u2500 DatabaseConnectionException\n    \u2502   \u2514\u2500\u2500 UniqueConstraintViolationException\n    \u251c\u2500\u2500 ExternalServiceException\n    \u2502   \u251c\u2500\u2500 PaymentGatewayException\n    \u2502   \u2514\u2500\u2500 EmailSendingException\n    \u2514\u2500\u2500 CacheException\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#classes-dexception-de-base","title":"Classes d'Exception de Base","text":"<pre><code>namespace App\\Shared\\Domain\\Exception;\n\n// Base pour toutes les exceptions domaine\nabstract class DomainException extends \\Exception\n{\n    public function __construct(\n        string $message = '',\n        int $code = 0,\n        ?\\Throwable $previous = null\n    ) {\n        parent::__construct($message, $code, $previous);\n    }\n}\n\n// \u00c9checs de validation domaine\nabstract class ValidationException extends DomainException {}\n\n// Violations de r\u00e8gles m\u00e9tier\nabstract class BusinessRuleException extends DomainException {}\n\n// Entit\u00e9 non trouv\u00e9e\nabstract class NotFoundException extends DomainException\n{\n    public function __construct(string $entityName, string $identifier)\n    {\n        parent::__construct(\"$entityName avec identifiant '$identifier' introuvable\");\n    }\n}\n</code></pre> <pre><code>namespace App\\Shared\\Infrastructure\\Exception;\n\n// Base pour toutes les exceptions infrastructure\nabstract class InfrastructureException extends \\Exception {}\n\n// \u00c9checs de base de donn\u00e9es/persistance\nabstract class PersistenceException extends InfrastructureException {}\n\n// \u00c9checs de service externe\nabstract class ExternalServiceException extends InfrastructureException {}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#exceptions-domaine-vs-infrastructure","title":"Exceptions Domaine vs Infrastructure","text":""},{"location":"fr/advanced/strategie-gestion-erreurs/#exceptions-domaine","title":"Exceptions Domaine","text":"<p>Objectif : Repr\u00e9senter les violations de r\u00e8gles m\u00e9tier ou erreurs sp\u00e9cifiques au domaine.</p> <p>Caract\u00e9ristiques : - Lanc\u00e9es par la couche domaine (entit\u00e9s, value objects, services domaine) - Expriment des concepts m\u00e9tier - Doivent \u00eatre captur\u00e9es et g\u00e9r\u00e9es par la couche application - Peuvent se propager au contr\u00f4leur pour feedback utilisateur</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/#exemple-exceptions-de-validation-domaine","title":"Exemple : Exceptions de Validation Domaine","text":"<pre><code>namespace App\\User\\Domain\\Exception;\n\nfinal class InvalidEmailException extends ValidationException\n{\n    public function __construct(string $email)\n    {\n        parent::__construct(\"L'email '$email' n'est pas valide\");\n    }\n}\n\nfinal class PasswordTooShortException extends ValidationException\n{\n    public function __construct()\n    {\n        parent::__construct(\"Le mot de passe doit faire au moins 8 caract\u00e8res\");\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#exemple-exceptions-de-regle-metier","title":"Exemple : Exceptions de R\u00e8gle M\u00e9tier","text":"<pre><code>namespace App\\Order\\Domain\\Exception;\n\nfinal class CannotShipCancelledOrderException extends BusinessRuleException\n{\n    public function __construct()\n    {\n        parent::__construct(\"Impossible d'exp\u00e9dier une commande annul\u00e9e\");\n    }\n}\n\nfinal class OrderAlreadyShippedException extends BusinessRuleException\n{\n    public function __construct(OrderId $orderId)\n    {\n        parent::__construct(\"La commande {$orderId} a d\u00e9j\u00e0 \u00e9t\u00e9 exp\u00e9di\u00e9e\");\n    }\n}\n\nfinal class InsufficientStockException extends BusinessRuleException\n{\n    public function __construct(ProductId $productId, int $requested, int $available)\n    {\n        parent::__construct(\n            \"Stock insuffisant pour le produit {$productId} : demand\u00e9 $requested, disponible $available\"\n        );\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#exemple-exceptions-not-found","title":"Exemple : Exceptions Not Found","text":"<pre><code>namespace App\\User\\Domain\\Exception;\n\nfinal class UserNotFoundException extends NotFoundException\n{\n    public function __construct(UserId $userId)\n    {\n        parent::__construct('User', $userId-&gt;toString());\n    }\n\n    public static function byEmail(string $email): self\n    {\n        $exception = new self(UserId::generate()); // ID factice\n        $exception-&gt;message = \"Utilisateur avec email '$email' introuvable\";\n        return $exception;\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#exceptions-infrastructure","title":"Exceptions Infrastructure","text":"<p>Objectif : Repr\u00e9senter les \u00e9checs techniques (base de donn\u00e9es, r\u00e9seau, services externes).</p> <p>Caract\u00e9ristiques : - Lanc\u00e9es par la couche infrastructure (repositories, adaptateurs) - Expriment des probl\u00e8mes techniques - Doivent \u00eatre captur\u00e9es par la couche application et traduites en exceptions domaine ou logg\u00e9es - Ne doivent g\u00e9n\u00e9ralement PAS se propager \u00e0 la couche domaine</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/#exemple-exceptions-de-persistance","title":"Exemple : Exceptions de Persistance","text":"<pre><code>namespace App\\Shared\\Infrastructure\\Exception;\n\nfinal class DatabaseConnectionException extends PersistenceException\n{\n    public function __construct(string $message, ?\\Throwable $previous = null)\n    {\n        parent::__construct(\"\u00c9chec de connexion \u00e0 la base de donn\u00e9es : $message\", 0, $previous);\n    }\n}\n\nfinal class UniqueConstraintViolationException extends PersistenceException\n{\n    public function __construct(string $field, string $value, ?\\Throwable $previous = null)\n    {\n        parent::__construct(\n            \"Violation de contrainte unique sur le champ '$field' avec la valeur '$value'\",\n            0,\n            $previous\n        );\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#exemple-exceptions-de-service-externe","title":"Exemple : Exceptions de Service Externe","text":"<pre><code>namespace App\\Payment\\Infrastructure\\Exception;\n\nfinal class PaymentGatewayException extends ExternalServiceException\n{\n    public function __construct(string $message, ?\\Throwable $previous = null)\n    {\n        parent::__construct(\"Erreur passerelle de paiement : $message\", 0, $previous);\n    }\n\n    public static function timeout(): self\n    {\n        return new self(\"La requ\u00eate vers la passerelle de paiement a expir\u00e9\");\n    }\n\n    public static function invalidResponse(string $details): self\n    {\n        return new self(\"R\u00e9ponse invalide de la passerelle de paiement : $details\");\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#traduction-dexceptions-aux-frontieres","title":"Traduction d'Exceptions aux Fronti\u00e8res","text":""},{"location":"fr/advanced/strategie-gestion-erreurs/#le-probleme-exceptions-infrastructure-dans-le-domaine","title":"Le Probl\u00e8me : Exceptions Infrastructure dans le Domaine","text":"<pre><code>// \u274c MAUVAIS : Exception infrastructure fuite vers le handler\nclass RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        try {\n            $this-&gt;users-&gt;save($user);\n        } catch (UniqueConstraintViolationException $e) {\n            // \u274c Capture d'exception infrastructure dans la couche application\n            throw new EmailAlreadyExistsException($command-&gt;email);\n        }\n    }\n}\n</code></pre> <p>Probl\u00e8me : La couche application ne devrait pas conna\u00eetre <code>UniqueConstraintViolationException</code> (d\u00e9tail infrastructure).</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/#solution-traduire-dans-le-repository-adaptateur","title":"Solution : Traduire dans le Repository (Adaptateur)","text":"<pre><code>// \u2705 BON : Le repository traduit infrastructure \u2192 domaine\nclass DoctrineUserRepository implements UserRepositoryInterface\n{\n    public function save(User $user): void\n    {\n        try {\n            $this-&gt;entityManager-&gt;persist($user);\n            $this-&gt;entityManager-&gt;flush();\n        } catch (UniqueConstraintViolationException $e) {\n            // V\u00e9rifier quel champ a viol\u00e9 la contrainte\n            if (str_contains($e-&gt;getMessage(), 'email')) {\n                throw new EmailAlreadyExistsException($user-&gt;getEmail()-&gt;value);\n            }\n\n            // Re-lancer comme exception de persistance g\u00e9n\u00e9rique\n            throw new PersistenceException(\"\u00c9chec de sauvegarde utilisateur\", previous: $e);\n        } catch (DriverException $e) {\n            throw new DatabaseConnectionException($e-&gt;getMessage(), previous: $e);\n        }\n    }\n}\n\n// \u2705 BON : Le handler ne traite que des exceptions domaine\nclass RegisterUserHandler\n{\n    public function __invoke(RegisterUserCommand $command): void\n    {\n        $user = UserFactory::create($command-&gt;email, $command-&gt;password);\n\n        $this-&gt;users-&gt;save($user); // Peut lancer EmailAlreadyExistsException (domaine)\n    }\n}\n</code></pre> <p>B\u00e9n\u00e9fices : - La couche application ne conna\u00eet que les exceptions domaine - D\u00e9tails infrastructure cach\u00e9s - Facile de changer de base de donn\u00e9es sans affecter l'application</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/#pattern-de-traduction","title":"Pattern de Traduction","text":"<pre><code>// Le repository traduit infrastructure \u2192 domaine\nclass DoctrineOrderRepository implements OrderRepositoryInterface\n{\n    public function save(Order $order): void\n    {\n        try {\n            $this-&gt;entityManager-&gt;persist($order);\n            $this-&gt;entityManager-&gt;flush();\n        } catch (\\Doctrine\\DBAL\\Exception\\UniqueConstraintViolationException $e) {\n            // Traduire en exception domaine\n            throw new OrderAlreadyExistsException($order-&gt;getId());\n        } catch (\\Doctrine\\DBAL\\Exception\\ConnectionException $e) {\n            // Traduire en exception infrastructure\n            throw new DatabaseConnectionException($e-&gt;getMessage(), $e);\n        } catch (\\Exception $e) {\n            // Capture g\u00e9n\u00e9rale : envelopper dans exception g\u00e9n\u00e9rique\n            throw new PersistenceException(\"\u00c9chec de sauvegarde commande\", previous: $e);\n        }\n    }\n\n    public function findById(OrderId $id): ?Order\n    {\n        try {\n            $order = $this-&gt;entityManager-&gt;find(Order::class, $id-&gt;toString());\n\n            if ($order === null) {\n                throw new OrderNotFoundException($id);\n            }\n\n            return $order;\n        } catch (\\Doctrine\\DBAL\\Exception\\ConnectionException $e) {\n            throw new DatabaseConnectionException($e-&gt;getMessage(), $e);\n        }\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#gestion-des-exceptions-dans-les-handlers","title":"Gestion des Exceptions dans les Handlers","text":""},{"location":"fr/advanced/strategie-gestion-erreurs/#strategie-1-laisser-les-exceptions-domaine-se-propager","title":"Strat\u00e9gie 1 : Laisser les Exceptions Domaine se Propager","text":"<pre><code>// \u2705 BON : Laisser les exceptions domaine remonter\nclass CancelOrderHandler\n{\n    public function __invoke(CancelOrderCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n        // Peut lancer OrderNotFoundException\n\n        $order-&gt;cancel();\n        // Peut lancer CannotCancelShippedOrderException\n\n        $this-&gt;orders-&gt;save($order);\n        // Peut lancer PersistenceException\n    }\n}\n</code></pre> <p>Quand utiliser : Les exceptions domaine doivent atteindre le contr\u00f4leur pour une r\u00e9ponse HTTP appropri\u00e9e.</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/#strategie-2-capturer-et-transformer","title":"Strat\u00e9gie 2 : Capturer et Transformer","text":"<pre><code>// \u2705 BON : Capturer une exception sp\u00e9cifique et fournir du contexte\nclass ProcessPaymentHandler\n{\n    public function __invoke(ProcessPaymentCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        try {\n            $result = $this-&gt;paymentProcessor-&gt;charge($order-&gt;getTotal());\n        } catch (PaymentGatewayException $e) {\n            // Transformer en exception domaine avec contexte\n            throw new PaymentFailedException(\n                orderId: $order-&gt;getId(),\n                amount: $order-&gt;getTotal(),\n                reason: $e-&gt;getMessage(),\n                previous: $e\n            );\n        }\n\n        $order-&gt;markAsPaid($result-&gt;transactionId);\n        $this-&gt;orders-&gt;save($order);\n    }\n}\n</code></pre> <p>Quand utiliser : Ajouter du contexte m\u00e9tier aux exceptions infrastructure.</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/#strategie-3-capturer-et-recuperer","title":"Strat\u00e9gie 3 : Capturer et R\u00e9cup\u00e9rer","text":"<pre><code>// \u2705 BON : Capturer l'exception et tenter une r\u00e9cup\u00e9ration\nclass SendOrderConfirmationHandler\n{\n    public function __invoke(SendOrderConfirmationCommand $command): void\n    {\n        $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n        try {\n            $this-&gt;emailSender-&gt;send(new OrderConfirmationEmail($order));\n        } catch (EmailSendingException $e) {\n            // Logger l'erreur mais ne pas faire \u00e9chouer toute l'op\u00e9ration\n            $this-&gt;logger-&gt;error(\"\u00c9chec envoi confirmation commande\", [\n                'orderId' =&gt; $order-&gt;getId(),\n                'error' =&gt; $e-&gt;getMessage()\n            ]);\n\n            // Mettre en file d'attente pour r\u00e9essai ult\u00e9rieur\n            $this-&gt;retryQueue-&gt;add(new RetryEmailJob($order-&gt;getId()));\n\n            // Ne pas lancer - commande toujours confirm\u00e9e m\u00eame si email \u00e9chou\u00e9\n        }\n    }\n}\n</code></pre> <p>Quand utiliser : Op\u00e9rations non critiques qui ne doivent pas faire \u00e9chouer le cas d'usage entier.</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/#strategie-4-envelopper-plusieurs-operations-dans-une-transaction","title":"Strat\u00e9gie 4 : Envelopper Plusieurs Op\u00e9rations dans une Transaction","text":"<pre><code>// \u2705 BON : Rollback sur toute exception\nclass CheckoutOrderHandler\n{\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n\n            // Peut lancer InsufficientStockException\n            $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n\n            // Peut lancer PaymentFailedException\n            $payment = $this-&gt;paymentProcessor-&gt;charge($order-&gt;getTotal());\n\n            $order-&gt;confirm($payment-&gt;transactionId);\n            $this-&gt;orders-&gt;save($order);\n\n            $this-&gt;entityManager-&gt;commit();\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n            throw $e; // Re-lancer vers le contr\u00f4leur\n        }\n    }\n}\n</code></pre> <p>Quand utiliser : Plusieurs op\u00e9rations qui doivent r\u00e9ussir ensemble (transaction ACID).</p>"},{"location":"fr/advanced/strategie-gestion-erreurs/#gestion-des-exceptions-dans-les-controleurs","title":"Gestion des Exceptions dans les Contr\u00f4leurs","text":""},{"location":"fr/advanced/strategie-gestion-erreurs/#strategie-1-global-exception-handler-recommande","title":"Strat\u00e9gie 1 : Global Exception Handler (Recommand\u00e9)","text":"<pre><code>namespace App\\Shared\\Infrastructure\\Http;\n\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\HttpKernel\\Event\\ExceptionEvent;\n\nfinal class ExceptionListener\n{\n    public function __construct(\n        private LoggerInterface $logger,\n        private bool $debug = false,\n    ) {}\n\n    public function onKernelException(ExceptionEvent $event): void\n    {\n        $exception = $event-&gt;getThrowable();\n\n        // Logger toutes les exceptions\n        $this-&gt;logger-&gt;error($exception-&gt;getMessage(), [\n            'exception' =&gt; get_class($exception),\n            'trace' =&gt; $exception-&gt;getTraceAsString(),\n        ]);\n\n        // Mapper l'exception vers une r\u00e9ponse HTTP\n        $response = $this-&gt;createResponse($exception);\n\n        $event-&gt;setResponse($response);\n    }\n\n    private function createResponse(\\Throwable $exception): JsonResponse\n    {\n        // Exceptions domaine\n        if ($exception instanceof ValidationException) {\n            return new JsonResponse([\n                'error' =&gt; '\u00c9chec de validation',\n                'message' =&gt; $exception-&gt;getMessage(),\n            ], Response::HTTP_BAD_REQUEST);\n        }\n\n        if ($exception instanceof BusinessRuleException) {\n            return new JsonResponse([\n                'error' =&gt; 'Violation de r\u00e8gle m\u00e9tier',\n                'message' =&gt; $exception-&gt;getMessage(),\n            ], Response::HTTP_UNPROCESSABLE_ENTITY);\n        }\n\n        if ($exception instanceof NotFoundException) {\n            return new JsonResponse([\n                'error' =&gt; 'Ressource introuvable',\n                'message' =&gt; $exception-&gt;getMessage(),\n            ], Response::HTTP_NOT_FOUND);\n        }\n\n        // Exceptions infrastructure\n        if ($exception instanceof InfrastructureException) {\n            return new JsonResponse([\n                'error' =&gt; 'Erreur serveur interne',\n                'message' =&gt; $this-&gt;debug ? $exception-&gt;getMessage() : 'Une erreur est survenue',\n            ], Response::HTTP_INTERNAL_SERVER_ERROR);\n        }\n\n        // Exceptions inconnues\n        return new JsonResponse([\n            'error' =&gt; 'Erreur serveur interne',\n            'message' =&gt; $this-&gt;debug ? $exception-&gt;getMessage() : 'Une erreur inattendue est survenue',\n        ], Response::HTTP_INTERNAL_SERVER_ERROR);\n    }\n}\n</code></pre> <p>Configuration (services.yaml) :</p> <pre><code>services:\n    App\\Shared\\Infrastructure\\Http\\ExceptionListener:\n        arguments:\n            $debug: '%kernel.debug%'\n        tags:\n            - { name: kernel.event_listener, event: kernel.exception }\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#tests-des-scenarios-derreur","title":"Tests des Sc\u00e9narios d'Erreur","text":""},{"location":"fr/advanced/strategie-gestion-erreurs/#test-1-exception-domaine-lancee","title":"Test 1 : Exception Domaine Lanc\u00e9e","text":"<pre><code>class CancelOrderHandlerTest extends TestCase\n{\n    public function test_throws_when_order_already_shipped(): void\n    {\n        $order = new Order(OrderId::generate(), OrderStatus::SHIPPED);\n        $orders = new InMemoryOrderRepository();\n        $orders-&gt;save($order);\n\n        $handler = new CancelOrderHandler($orders);\n        $command = new CancelOrderCommand($order-&gt;getId());\n\n        $this-&gt;expectException(CannotCancelShippedOrderException::class);\n\n        $handler($command);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#test-2-exception-infrastructure-traduite","title":"Test 2 : Exception Infrastructure Traduite","text":"<pre><code>class DoctrineUserRepositoryTest extends KernelTestCase\n{\n    public function test_throws_domain_exception_on_duplicate_email(): void\n    {\n        $repository = $this-&gt;getContainer()-&gt;get(UserRepositoryInterface::class);\n\n        $user1 = UserFactory::create('test@example.com', 'password123');\n        $repository-&gt;save($user1);\n\n        $user2 = UserFactory::create('test@example.com', 'password456');\n\n        $this-&gt;expectException(EmailAlreadyExistsException::class);\n\n        $repository-&gt;save($user2); // Email dupliqu\u00e9\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#test-3-gestion-des-exceptions-dans-le-controleur","title":"Test 3 : Gestion des Exceptions dans le Contr\u00f4leur","text":"<pre><code>class RegisterUserControllerTest extends WebTestCase\n{\n    public function test_returns_400_on_invalid_email(): void\n    {\n        $client = static::createClient();\n\n        $client-&gt;request('POST', '/api/users', [], [], [\n            'CONTENT_TYPE' =&gt; 'application/json',\n        ], json_encode([\n            'email' =&gt; 'pas-un-email',\n            'password' =&gt; 'ValidPass123',\n        ]));\n\n        $this-&gt;assertResponseStatusCodeSame(Response::HTTP_BAD_REQUEST);\n        $this-&gt;assertJsonContains(['error' =&gt; '\u00c9chec de validation']);\n    }\n\n    public function test_returns_409_on_duplicate_email(): void\n    {\n        $client = static::createClient();\n\n        // Cr\u00e9er le premier utilisateur\n        $client-&gt;request('POST', '/api/users', [], [], [\n            'CONTENT_TYPE' =&gt; 'application/json',\n        ], json_encode([\n            'email' =&gt; 'test@example.com',\n            'password' =&gt; 'ValidPass123',\n        ]));\n\n        // Essayer de cr\u00e9er un doublon\n        $client-&gt;request('POST', '/api/users', [], [], [\n            'CONTENT_TYPE' =&gt; 'application/json',\n        ], json_encode([\n            'email' =&gt; 'test@example.com',\n            'password' =&gt; 'AnotherPass456',\n        ]));\n\n        $this-&gt;assertResponseStatusCodeSame(Response::HTTP_CONFLICT);\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#exemples-concrets-complets","title":"Exemples Concrets Complets","text":""},{"location":"fr/advanced/strategie-gestion-erreurs/#exemple-traitement-de-commande-avec-exceptions-multiples","title":"Exemple : Traitement de Commande avec Exceptions Multiples","text":"<pre><code>// Exceptions domaine\nnamespace App\\Order\\Domain\\Exception;\n\nfinal class InsufficientStockException extends BusinessRuleException\n{\n    public function __construct(ProductId $productId, int $requested, int $available)\n    {\n        parent::__construct(\n            \"Le produit {$productId} a un stock insuffisant : demand\u00e9 $requested, disponible $available\"\n        );\n    }\n}\n\nfinal class PaymentFailedException extends BusinessRuleException\n{\n    public function __construct(\n        public readonly OrderId $orderId,\n        public readonly Money $amount,\n        public readonly string $reason,\n        ?\\Throwable $previous = null\n    ) {\n        parent::__construct(\n            \"\u00c9chec du paiement pour la commande {$orderId} : $reason\",\n            previous: $previous\n        );\n    }\n}\n\n// Handler avec gestion d'exceptions\nfinal readonly class CheckoutOrderHandler\n{\n    public function __construct(\n        private OrderRepositoryInterface $orders,\n        private InventoryServiceInterface $inventory,\n        private PaymentProcessorInterface $payment,\n        private EntityManagerInterface $entityManager,\n        private LoggerInterface $logger,\n    ) {}\n\n    public function __invoke(CheckoutOrderCommand $command): void\n    {\n        $this-&gt;entityManager-&gt;beginTransaction();\n\n        try {\n            $order = $this-&gt;orders-&gt;findById($command-&gt;orderId);\n            // Peut lancer OrderNotFoundException\n\n            // R\u00e9server l'inventaire\n            try {\n                $this-&gt;inventory-&gt;reserveStock($order-&gt;getItems());\n            } catch (InsufficientStockException $e) {\n                $this-&gt;logger-&gt;warning(\"Stock insuffisant\", [\n                    'orderId' =&gt; $order-&gt;getId(),\n                    'error' =&gt; $e-&gt;getMessage()\n                ]);\n                throw $e; // Re-lancer pour rollback transaction\n            }\n\n            // Traiter le paiement\n            try {\n                $payment = $this-&gt;payment-&gt;charge(new PaymentRequest(\n                    amount: $order-&gt;getTotal(),\n                    currency: Currency::USD,\n                    orderId: $order-&gt;getId()\n                ));\n            } catch (PaymentGatewayException $e) {\n                // Lib\u00e9rer le stock r\u00e9serv\u00e9\n                $this-&gt;inventory-&gt;releaseStock($order-&gt;getItems());\n\n                throw new PaymentFailedException(\n                    orderId: $order-&gt;getId(),\n                    amount: $order-&gt;getTotal(),\n                    reason: $e-&gt;getMessage(),\n                    previous: $e\n                );\n            }\n\n            // Confirmer la commande\n            $order-&gt;confirm($payment-&gt;transactionId);\n            $this-&gt;orders-&gt;save($order);\n\n            $this-&gt;entityManager-&gt;commit();\n\n            $this-&gt;logger-&gt;info(\"Commande valid\u00e9e avec succ\u00e8s\", [\n                'orderId' =&gt; $order-&gt;getId()\n            ]);\n        } catch (\\Exception $e) {\n            $this-&gt;entityManager-&gt;rollback();\n\n            $this-&gt;logger-&gt;error(\"\u00c9chec de validation\", [\n                'orderId' =&gt; $command-&gt;orderId,\n                'error' =&gt; $e-&gt;getMessage()\n            ]);\n\n            throw $e;\n        }\n    }\n}\n</code></pre>"},{"location":"fr/advanced/strategie-gestion-erreurs/#resume","title":"R\u00e9sum\u00e9","text":"Type d'Exception O\u00f9 Lanc\u00e9e O\u00f9 Captur\u00e9e Exemple Validation Value objects Contr\u00f4leur (via handler global) <code>InvalidEmailException</code> R\u00e8gle M\u00e9tier Entit\u00e9s, services domaine Contr\u00f4leur (via handler global) <code>CannotCancelShippedOrderException</code> Not Found Repositories Contr\u00f4leur (via handler global) <code>OrderNotFoundException</code> Infrastructure Adaptateurs Traduite dans adaptateurs vers exceptions domaine <code>DatabaseConnectionException</code> Service Externe Adaptateurs Handler (capturer &amp; transformer ou r\u00e9cup\u00e9rer) <code>PaymentGatewayException</code>"},{"location":"fr/advanced/strategie-gestion-erreurs/#principes-cles","title":"Principes Cl\u00e9s","text":"<ol> <li>Les exceptions domaine expriment des concepts m\u00e9tier - Utilisez des noms clairs et significatifs</li> <li>Les exceptions infrastructure doivent \u00eatre traduites - Ne pas fuiter vers application/domaine</li> <li>Utiliser un handler d'exceptions global - Centraliser le mapping des r\u00e9ponses HTTP</li> <li>Logger toutes les exceptions - Essentiel pour d\u00e9boguer les probl\u00e8mes en production</li> <li>Tester les sc\u00e9narios d'exception - Assurer une gestion et des r\u00e9ponses appropri\u00e9es</li> </ol> <p>Suivant : Anti-Patterns et Pi\u00e8ges \u2192</p>"},{"location":"getting-started/","title":"Getting Started","text":"<p>Learn how to install and use Hexagonal Maker Bundle in your Symfony projects.</p>"},{"location":"getting-started/#quick-links","title":"Quick Links","text":"<ul> <li>Installation - Install and configure the bundle</li> <li>Quick Start - Generate your first module in 2 minutes</li> <li>First Module - Complete walkthrough of building a module</li> </ul>"},{"location":"getting-started/#what-youll-learn","title":"What You'll Learn","text":"<p>In this section, you'll learn:</p> <ol> <li>How to install the bundle via Composer</li> <li>How to configure Doctrine for hexagonal architecture</li> <li>How to generate your first complete module</li> <li>How to understand the generated file structure</li> </ol>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before starting, make sure you have:</p> <ul> <li>PHP 8.1 or higher</li> <li>Symfony 6.4+ or 7.x</li> <li>Basic understanding of Symfony</li> <li>Composer installed</li> </ul> <p>Let's get started!</p>"},{"location":"getting-started/first-module/","title":"First Module Tutorial","text":"<p>Complete step-by-step guide to build your first hexagonal module from scratch.</p>"},{"location":"getting-started/first-module/#what-well-build","title":"What We'll Build","text":"<p>A Blog Post module with: - CRUD operations (Create, Read, Update, Delete, List) - Pure domain entities - CQRS commands and queries - Web controllers and forms - Complete tests</p> <p>Time: 15-20 minutes</p>"},{"location":"getting-started/first-module/#prerequisites","title":"Prerequisites","text":"<ul> <li>Hexagonal Maker Bundle installed</li> <li>Doctrine configured with YAML mappings</li> <li>Database created</li> </ul> <p>See installation guide \u2192</p>"},{"location":"getting-started/first-module/#step-1-plan-the-module","title":"Step 1: Plan the Module","text":""},{"location":"getting-started/first-module/#module-structure","title":"Module Structure","text":"<pre><code>src/Blog/Post/\n\u251c\u2500\u2500 Domain/              # Business logic\n\u251c\u2500\u2500 Application/         # Use cases\n\u251c\u2500\u2500 Infrastructure/      # Technical implementations\n\u2514\u2500\u2500 UI/                  # Controllers and forms\n</code></pre>"},{"location":"getting-started/first-module/#bounded-context","title":"Bounded Context","text":"<ul> <li>Context: Blog</li> <li>Module: Post</li> <li>Aggregate Root: Post entity</li> </ul>"},{"location":"getting-started/first-module/#step-2-generate-domain-layer","title":"Step 2: Generate Domain Layer","text":""},{"location":"getting-started/first-module/#21-create-post-entity","title":"2.1 Create Post Entity","text":"<pre><code>bin/console make:hexagonal:entity blog/post Post\n</code></pre> <p>Generated: <pre><code>src/Blog/Post/Domain/Model/Post.php\nsrc/Blog/Post/Infrastructure/Persistence/Doctrine/Orm/Mapping/Post.orm.yml\n</code></pre></p> <p>Edit the entity:</p> <pre><code>&lt;?php\n// src/Blog/Post/Domain/Model/Post.php\n\ndeclare(strict_types=1);\n\nnamespace App\\Blog\\Post\\Domain\\Model;\n\nfinal class Post\n{\n    private string $id;\n    private string $title;\n    private string $content;\n    private string $status;  // draft, published\n    private \\DateTimeImmutable $createdAt;\n    private ?\\DateTimeImmutable $publishedAt;\n\n    public function __construct(\n        string $id,\n        string $title,\n        string $content\n    ) {\n        $this-&gt;id = $id;\n        $this-&gt;title = $title;\n        $this-&gt;content = $content;\n        $this-&gt;status = 'draft';\n        $this-&gt;createdAt = new \\DateTimeImmutable();\n        $this-&gt;publishedAt = null;\n    }\n\n    // Business method\n    public function publish(): void\n    {\n        if ($this-&gt;status === 'published') {\n            throw new \\DomainException('Post is already published');\n        }\n\n        $this-&gt;status = 'published';\n        $this-&gt;publishedAt = new \\DateTimeImmutable();\n    }\n\n    public function update(string $title, string $content): void\n    {\n        $this-&gt;title = $title;\n        $this-&gt;content = $content;\n    }\n\n    // Getters\n    public function getId(): string { return $this-&gt;id; }\n    public function getTitle(): string { return $this-&gt;title; }\n    public function getContent(): string { return $this-&gt;content; }\n    public function getStatus(): string { return $this-&gt;status; }\n    public function isPublished(): bool { return $this-&gt;status === 'published'; }\n}\n</code></pre>"},{"location":"getting-started/first-module/#22-complete-doctrine-mapping","title":"2.2 Complete Doctrine Mapping","text":"<pre><code># src/Blog/Post/Infrastructure/Persistence/Doctrine/Orm/Mapping/Post.orm.yml\n\nApp\\Blog\\Post\\Domain\\Model\\Post:\n    type: entity\n    repositoryClass: App\\Blog\\Post\\Infrastructure\\Persistence\\Doctrine\\DoctrinePostRepository\n    table: post\n\n    id:\n        id:\n            type: string\n            length: 36\n\n    fields:\n        title:\n            type: string\n            length: 255\n\n        content:\n            type: text\n\n        status:\n            type: string\n            length: 20\n            options:\n                default: 'draft'\n\n        createdAt:\n            type: datetime_immutable\n            column: created_at\n\n        publishedAt:\n            type: datetime_immutable\n            column: published_at\n            nullable: true\n</code></pre>"},{"location":"getting-started/first-module/#23-add-doctrine-mapping-configuration","title":"2.3 Add Doctrine Mapping Configuration","text":"<p>Edit <code>config/packages/doctrine.yaml</code>:</p> <pre><code>doctrine:\n    orm:\n        mappings:\n            BlogPost:\n                is_bundle: false\n                type: yml\n                dir: '%kernel.project_dir%/src/Blog/Post/Infrastructure/Persistence/Doctrine/Orm/Mapping'\n                prefix: 'App\\Blog\\Post\\Domain\\Model'\n                alias: BlogPost\n</code></pre>"},{"location":"getting-started/first-module/#step-3-generate-repository","title":"Step 3: Generate Repository","text":"<pre><code>bin/console make:hexagonal:repository blog/post Post\n</code></pre> <p>Generated: - <code>Domain/Port/PostRepositoryInterface.php</code> (Interface) - <code>Infrastructure/Persistence/Doctrine/DoctrinePostRepository.php</code> (Implementation)</p> <p>Complete the repository interface:</p> <pre><code>&lt;?php\n// src/Blog/Post/Domain/Port/PostRepositoryInterface.php\n\nnamespace App\\Blog\\Post\\Domain\\Port;\n\nuse App\\Blog\\Post\\Domain\\Model\\Post;\n\ninterface PostRepositoryInterface\n{\n    public function save(Post $post): void;\n    public function findById(string $id): ?Post;\n    public function findAll(): array;\n    public function delete(Post $post): void;\n}\n</code></pre> <p>Implement repository methods:</p> <pre><code>&lt;?php\n// src/Blog/Post/Infrastructure/Persistence/Doctrine/DoctrinePostRepository.php\n\nnamespace App\\Blog\\Post\\Infrastructure\\Persistence\\Doctrine;\n\nuse App\\Blog\\Post\\Domain\\Model\\Post;\nuse App\\Blog\\Post\\Domain\\Port\\PostRepositoryInterface;\nuse Doctrine\\ORM\\EntityManagerInterface;\n\nfinal readonly class DoctrinePostRepository implements PostRepositoryInterface\n{\n    public function __construct(\n        private EntityManagerInterface $entityManager\n    ) {\n    }\n\n    public function save(Post $post): void\n    {\n        $this-&gt;entityManager-&gt;persist($post);\n        $this-&gt;entityManager-&gt;flush();\n    }\n\n    public function findById(string $id): ?Post\n    {\n        return $this-&gt;entityManager-&gt;find(Post::class, $id);\n    }\n\n    public function findAll(): array\n    {\n        return $this-&gt;entityManager\n            -&gt;getRepository(Post::class)\n            -&gt;findAll();\n    }\n\n    public function delete(Post $post): void\n    {\n        $this-&gt;entityManager-&gt;remove($post);\n        $this-&gt;entityManager-&gt;flush();\n    }\n}\n</code></pre>"},{"location":"getting-started/first-module/#step-4-generate-use-cases-cqrs","title":"Step 4: Generate Use Cases (CQRS)","text":""},{"location":"getting-started/first-module/#41-create-post-command","title":"4.1 Create Post Command","text":"<pre><code>bin/console make:hexagonal:command blog/post create --factory\n</code></pre> <p>Complete the command and handler logic following the CQRS pattern.</p>"},{"location":"getting-started/first-module/#42-update-post-command","title":"4.2 Update Post Command","text":"<pre><code>bin/console make:hexagonal:command blog/post update\n</code></pre>"},{"location":"getting-started/first-module/#43-delete-post-command","title":"4.3 Delete Post Command","text":"<pre><code>bin/console make:hexagonal:command blog/post delete\n</code></pre>"},{"location":"getting-started/first-module/#44-find-post-query","title":"4.4 Find Post Query","text":"<pre><code>bin/console make:hexagonal:query blog/post find-by-id\n</code></pre>"},{"location":"getting-started/first-module/#45-list-posts-query","title":"4.5 List Posts Query","text":"<pre><code>bin/console make:hexagonal:query blog/post list-all\n</code></pre>"},{"location":"getting-started/first-module/#step-5-generate-ui-layer","title":"Step 5: Generate UI Layer","text":""},{"location":"getting-started/first-module/#51-controllers","title":"5.1 Controllers","text":"<pre><code># Create post\nbin/console make:hexagonal:controller blog/post CreatePost /posts/new\n\n# Edit post\nbin/console make:hexagonal:controller blog/post EditPost /posts/{id}/edit\n\n# Show post\nbin/console make:hexagonal:controller blog/post ShowPost /posts/{id}\n\n# List posts\nbin/console make:hexagonal:controller blog/post ListPosts /posts\n\n# Delete post\nbin/console make:hexagonal:controller blog/post DeletePost /posts/{id}/delete\n</code></pre>"},{"location":"getting-started/first-module/#52-forms","title":"5.2 Forms","text":"<pre><code>bin/console make:hexagonal:form blog/post Post\n</code></pre>"},{"location":"getting-started/first-module/#step-6-create-database-schema","title":"Step 6: Create Database Schema","text":"<pre><code># Validate mapping\nbin/console doctrine:schema:validate\n\n# Generate migration\nbin/console doctrine:migrations:diff\n\n# Execute migration\nbin/console doctrine:migrations:migrate\n</code></pre>"},{"location":"getting-started/first-module/#step-7-test-your-module","title":"Step 7: Test Your Module","text":""},{"location":"getting-started/first-module/#manual-testing-via-cli","title":"Manual Testing via CLI","text":"<p>Create a test CLI command:</p> <pre><code>bin/console make:hexagonal:cli-command blog/post CreatePost app:post:create\n</code></pre> <p>Run:</p> <pre><code>bin/console app:post:create --title=\"My First Post\" --content=\"Hello World\"\n</code></pre>"},{"location":"getting-started/first-module/#alternative-use-crud-maker","title":"Alternative: Use CRUD Maker \u26a1","text":"<p>Instead of steps 4-5, generate everything at once:</p> <pre><code>bin/console make:hexagonal:crud blog/post Post --with-tests\n</code></pre> <p>This generates: - Entity + Repository - 5 Use Cases (Create, Update, Delete, Get, List) - 5 Controllers + Form - All tests</p>"},{"location":"getting-started/first-module/#next-steps","title":"Next Steps","text":"<p>Congratulations! You've built a complete hexagonal module. Now:</p> <ol> <li>Add tests - Unit and integration tests</li> <li>Add validation - Input DTOs with constraints</li> <li>Add domain events - Event-driven architecture</li> <li>Explore all makers - Learn advanced features</li> </ol>"},{"location":"getting-started/first-module/#common-patterns","title":"Common Patterns","text":""},{"location":"getting-started/first-module/#validation","title":"Validation","text":"<p>Use Input DTOs with Symfony Validator:</p> <pre><code>bin/console make:hexagonal:input blog/post CreatePostInput\n</code></pre> <pre><code>&lt;?php\n\nnamespace App\\Blog\\Post\\Application\\Input;\n\nuse Symfony\\Component\\Validator\\Constraints as Assert;\n\nfinal readonly class CreatePostInput\n{\n    public function __construct(\n        #[Assert\\NotBlank]\n        #[Assert\\Length(min: 3, max: 255)]\n        public string $title,\n\n        #[Assert\\NotBlank]\n        #[Assert\\Length(min: 10)]\n        public string $content,\n    ) {\n    }\n}\n</code></pre>"},{"location":"getting-started/first-module/#domain-events","title":"Domain Events","text":"<p>Generate domain event:</p> <pre><code>bin/console make:hexagonal:domain-event blog/post PostPublished --with-subscriber\n</code></pre> <p>Dispatch from entity:</p> <pre><code>public function publish(): void\n{\n    $this-&gt;status = 'published';\n    $this-&gt;publishedAt = new \\DateTimeImmutable();\n\n    // Dispatch event\n    $this-&gt;recordEvent(new PostPublishedEvent($this-&gt;id, $this-&gt;title));\n}\n</code></pre>"},{"location":"getting-started/first-module/#async-processing","title":"Async Processing","text":"<p>Generate message handler for async tasks:</p> <pre><code>bin/console make:hexagonal:message-handler blog/post SendNotification\n</code></pre> <p>Configure routing in <code>messenger.yaml</code>:</p> <pre><code>framework:\n    messenger:\n        routing:\n            'App\\Blog\\Post\\Application\\Message\\SendNotificationMessage': async\n</code></pre>"},{"location":"getting-started/first-module/#troubleshooting","title":"Troubleshooting","text":"<p>See Installation Guide - Troubleshooting</p>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>Complete installation and configuration guide for Hexagonal Maker Bundle.</p>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>PHP: 8.1 or higher</li> <li>Symfony: 6.4+ or 7.x</li> <li>Composer: Latest version</li> </ul>"},{"location":"getting-started/installation/#step-1-install-via-composer","title":"Step 1: Install via Composer","text":"<pre><code>composer require ahmed-bhs/hexagonal-maker-bundle --dev\n</code></pre> <p>The <code>--dev</code> flag ensures the bundle is only installed in development environment.</p>"},{"location":"getting-started/installation/#step-2-enable-the-bundle","title":"Step 2: Enable the Bundle","text":""},{"location":"getting-started/installation/#with-symfony-flex-automatic","title":"With Symfony Flex (Automatic)","text":"<p>If you're using Symfony Flex, the bundle is auto-registered. Skip to Step 3.</p>"},{"location":"getting-started/installation/#without-symfony-flex-manual","title":"Without Symfony Flex (Manual)","text":"<p>Add the bundle to <code>config/bundles.php</code>:</p> <pre><code>&lt;?php\n\nreturn [\n    // ... other bundles ...\n    AhmedBhs\\HexagonalMakerBundle\\HexagonalMakerBundle::class =&gt; ['dev' =&gt; true],\n];\n</code></pre>"},{"location":"getting-started/installation/#step-3-configure-doctrine-required","title":"Step 3: Configure Doctrine (Required)","text":"<p>Hexagonal Maker Bundle uses YAML mapping to keep domain entities pure (no annotations).</p>"},{"location":"getting-started/installation/#31-create-doctrine-configuration","title":"3.1 Create Doctrine Configuration","text":"<p>Edit <code>config/packages/doctrine.yaml</code>:</p> <pre><code>doctrine:\n    dbal:\n        url: '%env(resolve:DATABASE_URL)%'\n        # Use utf8mb4 for full Unicode support\n        charset: utf8mb4\n        default_table_options:\n            charset: utf8mb4\n            collate: utf8mb4_unicode_ci\n\n    orm:\n        auto_generate_proxy_classes: true\n        naming_strategy: doctrine.orm.naming_strategy.underscore_number_aware\n        auto_mapping: true\n\n        # IMPORTANT: Add YAML mappings for each module\n        mappings: {}\n            # Example mappings will be added per module\n            # See section 3.2 below\n</code></pre>"},{"location":"getting-started/installation/#32-add-module-mappings","title":"3.2 Add Module Mappings","text":"<p>Each time you create a new module (e.g., <code>User/Account</code>), add its mapping:</p> <pre><code>doctrine:\n    orm:\n        mappings:\n            # User Account Module\n            UserAccount:\n                is_bundle: false\n                type: yml\n                dir: '%kernel.project_dir%/src/User/Account/Infrastructure/Persistence/Doctrine/Orm/Mapping'\n                prefix: 'App\\User\\Account\\Domain\\Model'\n                alias: UserAccount\n\n            # Blog Post Module (example)\n            BlogPost:\n                is_bundle: false\n                type: yml\n                dir: '%kernel.project_dir%/src/Blog/Post/Infrastructure/Persistence/Doctrine/Orm/Mapping'\n                prefix: 'App\\Blog\\Post\\Domain\\Model'\n                alias: BlogPost\n\n            # Add more modules as needed...\n</code></pre> <p>Pattern: - <code>dir</code>: Path to YAML mapping files (Infrastructure layer) - <code>prefix</code>: Namespace of domain entities (Domain layer) - <code>alias</code>: Short alias for DQL queries</p>"},{"location":"getting-started/installation/#step-4-configure-symfony-messenger-optional","title":"Step 4: Configure Symfony Messenger (Optional)","text":"<p>For CQRS commands and queries, configure Symfony Messenger.</p> <p>Edit <code>config/packages/messenger.yaml</code>:</p> <pre><code>framework:\n    messenger:\n        default_bus: command.bus\n\n        buses:\n            command.bus:\n                middleware:\n                    - validation\n                    - doctrine_transaction\n\n            query.bus:\n                middleware:\n                    - validation\n\n            event.bus:\n                default_middleware: allow_no_handlers\n                middleware:\n                    - validation\n\n        transports:\n            async: '%env(MESSENGER_TRANSPORT_DSN)%'\n\n        routing:\n            # Route commands to command.bus\n            'App\\*\\Application\\*\\*Command': command.bus\n\n            # Route queries to query.bus\n            'App\\*\\Application\\*\\*Query': query.bus\n\n            # Route async messages to async transport\n            'App\\*\\Infrastructure\\Messaging\\*': async\n</code></pre>"},{"location":"getting-started/installation/#configure-transport-optional-for-async","title":"Configure Transport (Optional - for async)","text":"<p>In <code>.env</code>:</p> <pre><code>###&gt; symfony/messenger ###\n# For async processing (optional)\nMESSENGER_TRANSPORT_DSN=doctrine://default?auto_setup=false\n# Or use RabbitMQ, Redis, etc.\n# MESSENGER_TRANSPORT_DSN=amqp://guest:guest@localhost:5672/%2f/messages\n###&lt; symfony/messenger ###\n</code></pre>"},{"location":"getting-started/installation/#step-5-configure-bundle-optional","title":"Step 5: Configure Bundle (Optional)","text":"<p>Create <code>config/packages/hexagonal_maker.yaml</code> to customize skeleton templates:</p> <pre><code>hexagonal_maker:\n    # Directory where custom skeleton templates are stored\n    skeleton_dir: '%kernel.project_dir%/config/skeleton'\n\n    # Root source directory (default: 'src')\n    root_dir: 'src'\n\n    # Root namespace (default: 'App')\n    root_namespace: 'App'\n</code></pre>"},{"location":"getting-started/installation/#step-6-verify-installation","title":"Step 6: Verify Installation","text":"<p>Check that maker commands are available:</p> <pre><code>bin/console list make:hexagonal\n</code></pre> <p>Expected output:</p> <pre><code>make:hexagonal:cli-command         Generate a CLI command\nmake:hexagonal:command             Generate a CQRS command\nmake:hexagonal:controller          Generate a web controller\nmake:hexagonal:controller-test     Generate a controller test\nmake:hexagonal:crud                Generate complete CRUD module\nmake:hexagonal:domain-event        Generate a domain event\nmake:hexagonal:entity              Generate a domain entity\nmake:hexagonal:event-subscriber    Generate an event subscriber\nmake:hexagonal:exception           Generate a domain exception\nmake:hexagonal:form                Generate a Symfony form\nmake:hexagonal:input               Generate an input DTO\nmake:hexagonal:message-handler     Generate a message handler\nmake:hexagonal:query               Generate a CQRS query\nmake:hexagonal:repository          Generate a repository\nmake:hexagonal:test-config         Generate test configuration\nmake:hexagonal:use-case            Generate a use case\nmake:hexagonal:use-case-test       Generate a use case test\nmake:hexagonal:value-object        Generate a value object\n</code></pre>"},{"location":"getting-started/installation/#directory-structure","title":"Directory Structure","text":"<p>After installation, your project will generate code in this structure:</p> <pre><code>src/\n\u251c\u2500\u2500 Module/              # Recommended: organize by bounded context\n\u2502   \u251c\u2500\u2500 User/\n\u2502   \u2502   \u2514\u2500\u2500 Account/     # Sub-domain module\n\u2502   \u2502       \u251c\u2500\u2500 Domain/\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 Model/\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 ValueObject/\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 Exception/\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 Port/\n\u2502   \u2502       \u251c\u2500\u2500 Application/\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 Command/\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 Query/\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 UseCase/\n\u2502   \u2502       \u251c\u2500\u2500 Infrastructure/\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 Persistence/\n\u2502   \u2502       \u2502       \u2514\u2500\u2500 Doctrine/\n\u2502   \u2502       \u2502           \u251c\u2500\u2500 DoctrineUserRepository.php\n\u2502   \u2502       \u2502           \u2514\u2500\u2500 Orm/Mapping/\n\u2502   \u2502       \u2502               \u2514\u2500\u2500 User.orm.yml\n\u2502   \u2502       \u2514\u2500\u2500 UI/\n\u2502   \u2502           \u251c\u2500\u2500 Http/Web/\n\u2502   \u2502           \u2502   \u251c\u2500\u2500 Controller/\n\u2502   \u2502           \u2502   \u2514\u2500\u2500 Form/\n\u2502   \u2502           \u2514\u2500\u2500 Cli/\n\u2502   \u2514\u2500\u2500 Blog/\n\u2502       \u2514\u2500\u2500 Post/        # Another module\n\u2514\u2500\u2500 Shared/              # Shared kernel (optional)\n    \u251c\u2500\u2500 Domain/\n    \u251c\u2500\u2500 Application/\n    \u2514\u2500\u2500 Infrastructure/\n</code></pre> <p>Or simpler flat structure:</p> <pre><code>src/\n\u251c\u2500\u2500 User/Account/        # Module without \"Module/\" prefix\n\u251c\u2500\u2500 Blog/Post/\n\u2514\u2500\u2500 Shared/\n</code></pre>"},{"location":"getting-started/installation/#configuration-files-summary","title":"Configuration Files Summary","text":""},{"location":"getting-started/installation/#essential-files","title":"Essential Files","text":"<pre><code>config/\n\u251c\u2500\u2500 packages/\n\u2502   \u251c\u2500\u2500 doctrine.yaml              \u2190 REQUIRED: Add YAML mappings\n\u2502   \u251c\u2500\u2500 messenger.yaml             \u2190 Optional: CQRS buses\n\u2502   \u2514\u2500\u2500 hexagonal_maker.yaml       \u2190 Optional: Custom templates\n\u2514\u2500\u2500 services.yaml                  \u2190 Service configuration\n</code></pre>"},{"location":"getting-started/installation/#recommended-services-configuration","title":"Recommended Services Configuration","text":"<pre><code># config/services.yaml\nservices:\n    _defaults:\n        autowire: true\n        autoconfigure: true\n\n    # Make controllers public\n    App\\:\n        resource: '../src/'\n        exclude:\n            - '../src/DependencyInjection/'\n            - '../src/*/Domain/Model/'  # Exclude entities\n            - '../src/Kernel.php'\n\n    # Repository interfaces autowiring\n    App\\User\\Account\\Domain\\Port\\UserRepositoryInterface:\n        class: App\\User\\Account\\Infrastructure\\Persistence\\Doctrine\\DoctrineUserRepository\n\n    # OR use bind for automatic interface resolution\n    _defaults:\n        bind:\n            $commandBus: '@messenger.bus.command'\n            $queryBus: '@messenger.bus.query'\n            $eventBus: '@messenger.bus.event'\n</code></pre>"},{"location":"getting-started/installation/#database-setup","title":"Database Setup","text":""},{"location":"getting-started/installation/#1-configure-database-url","title":"1. Configure Database URL","text":"<p>In <code>.env</code>:</p> <pre><code>DATABASE_URL=\"mysql://user:password@127.0.0.1:3306/hexagonal_app?serverVersion=8.0\"\n</code></pre>"},{"location":"getting-started/installation/#2-create-database","title":"2. Create Database","text":"<pre><code>bin/console doctrine:database:create\n</code></pre>"},{"location":"getting-started/installation/#3-generate-migrations","title":"3. Generate Migrations","text":"<p>After creating entities with makers:</p> <pre><code># Validate mapping\nbin/console doctrine:schema:validate\n\n# Generate migration\nbin/console doctrine:migrations:diff\n\n# Execute migration\nbin/console doctrine:migrations:migrate\n</code></pre>"},{"location":"getting-started/installation/#testing-setup-optional","title":"Testing Setup (Optional)","text":""},{"location":"getting-started/installation/#1-install-phpunit","title":"1. Install PHPUnit","text":"<pre><code>composer require --dev phpunit/phpunit symfony/phpunit-bridge\n</code></pre>"},{"location":"getting-started/installation/#2-configure-test-environment","title":"2. Configure Test Environment","text":"<pre><code># Generate test configuration\nbin/console make:hexagonal:test-config\n</code></pre> <p>This creates: - <code>config/packages/test/doctrine.yaml</code> (test database) - <code>.env.test</code> (test environment variables)</p>"},{"location":"getting-started/installation/#3-create-test-database","title":"3. Create Test Database","text":"<pre><code>bin/console doctrine:database:create --env=test\nbin/console doctrine:schema:create --env=test\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<p>Installation complete! Now:</p> <ol> <li>Quick Start - Generate your first module</li> <li>First Module Tutorial - Complete step-by-step guide</li> <li>Maker Commands - Learn all 19 commands</li> </ol>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#bundle-not-found-in-binconsole-list","title":"Bundle not found in <code>bin/console list</code>","text":"<p>Solution: Clear cache and check <code>config/bundles.php</code></p> <pre><code>bin/console cache:clear\n</code></pre>"},{"location":"getting-started/installation/#doctrine-mapping-errors","title":"Doctrine mapping errors","text":"<p>Error: <code>The class 'X' was not found in the chain configured namespaces</code></p> <p>Solution: Ensure YAML mapping is configured in <code>config/packages/doctrine.yaml</code> for your module</p>"},{"location":"getting-started/installation/#autowiring-fails-for-repositories","title":"Autowiring fails for repositories","text":"<p>Error: <code>Cannot autowire service \"X\": argument \"$repository\" references interface but no such service exists</code></p> <p>Solution: Add interface alias in <code>config/services.yaml</code>:</p> <pre><code>services:\n    App\\User\\Account\\Domain\\Port\\UserRepositoryInterface:\n        class: App\\User\\Account\\Infrastructure\\Persistence\\Doctrine\\DoctrineUserRepository\n</code></pre>"},{"location":"getting-started/installation/#commands-not-generating-files","title":"Commands not generating files","text":"<p>Solution: Check permissions on <code>src/</code> directory:</p> <pre><code>chmod -R 755 src/\n</code></pre>"},{"location":"getting-started/installation/#uninstallation","title":"Uninstallation","text":"<p>To remove the bundle:</p> <pre><code>composer remove ahmed-bhs/hexagonal-maker-bundle\n</code></pre> <p>Then remove from <code>config/bundles.php</code> if added manually.</p>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Get started with Hexagonal Maker Bundle in 2 minutes.</p>"},{"location":"getting-started/quick-start/#installation","title":"Installation","text":"<pre><code>composer require ahmed-bhs/hexagonal-maker-bundle --dev\n</code></pre> <p>The bundle auto-registers via Symfony Flex. If not using Flex, add to <code>config/bundles.php</code>:</p> <pre><code>return [\n    // ...\n    AhmedBhs\\HexagonalMakerBundle\\HexagonalMakerBundle::class =&gt; ['dev' =&gt; true],\n];\n</code></pre>"},{"location":"getting-started/quick-start/#first-module-user-registration","title":"First Module: User Registration","text":"<p>Let's build a complete User Registration module with all hexagonal layers.</p>"},{"location":"getting-started/quick-start/#step-1-domain-layer-pure-business-logic","title":"Step 1: Domain Layer (Pure Business Logic)","text":"<pre><code># Create User entity (pure PHP, no Doctrine annotations)\nbin/console make:hexagonal:entity user/account User\n\n# Create Email value object\nbin/console make:hexagonal:value-object user/account Email\n\n# Create business exception\nbin/console make:hexagonal:exception user/account InvalidEmailException\n</code></pre> <p>Generated: <pre><code>src/User/Account/\n\u251c\u2500\u2500 Domain/\n\u2502   \u251c\u2500\u2500 Model/\n\u2502   \u2502   \u2514\u2500\u2500 User.php                    # Pure PHP entity\n\u2502   \u251c\u2500\u2500 ValueObject/\n\u2502   \u2502   \u2514\u2500\u2500 Email.php                   # Immutable value object\n\u2502   \u2514\u2500\u2500 Exception/\n\u2502       \u2514\u2500\u2500 InvalidEmailException.php   # Business exception\n</code></pre></p>"},{"location":"getting-started/quick-start/#step-2-repository-port-adapter","title":"Step 2: Repository (Port + Adapter)","text":"<pre><code># Generate repository interface + Doctrine implementation\nbin/console make:hexagonal:repository user/account User\n</code></pre> <p>Generated: <pre><code>src/User/Account/\n\u251c\u2500\u2500 Domain/Port/\n\u2502   \u2514\u2500\u2500 UserRepositoryInterface.php           # Interface (Port)\n\u2514\u2500\u2500 Infrastructure/Persistence/Doctrine/\n    \u251c\u2500\u2500 DoctrineUserRepository.php            # Implementation (Adapter)\n    \u2514\u2500\u2500 Orm/Mapping/\n        \u2514\u2500\u2500 User.orm.yml                      # Doctrine YAML mapping\n</code></pre></p>"},{"location":"getting-started/quick-start/#step-3-application-layer-use-cases","title":"Step 3: Application Layer (Use Cases)","text":"<pre><code># Generate registration command with factory\nbin/console make:hexagonal:command user/account register --factory\n\n# Generate query to find user\nbin/console make:hexagonal:query user/account find-by-id\n</code></pre> <p>Generated: <pre><code>src/User/Account/Application/\n\u251c\u2500\u2500 Register/\n\u2502   \u251c\u2500\u2500 RegisterCommand.php           # Command DTO\n\u2502   \u251c\u2500\u2500 RegisterCommandHandler.php    # Handler with business logic\n\u2502   \u2514\u2500\u2500 UserFactory.php               # Factory for creating users\n\u2514\u2500\u2500 FindById/\n    \u251c\u2500\u2500 FindByIdQuery.php             # Query DTO\n    \u251c\u2500\u2500 FindByIdQueryHandler.php      # Query handler\n    \u2514\u2500\u2500 FindByIdResponse.php          # Response DTO\n</code></pre></p>"},{"location":"getting-started/quick-start/#step-4-ui-layer-controllers","title":"Step 4: UI Layer (Controllers)","text":"<pre><code># Generate web controller\nbin/console make:hexagonal:controller user/account RegisterUser /users/register\n\n# Generate Symfony form\nbin/console make:hexagonal:form user/account User\n</code></pre> <p>Generated: <pre><code>src/User/Account/UI/\n\u2514\u2500\u2500 Http/Web/\n    \u251c\u2500\u2500 Controller/\n    \u2502   \u2514\u2500\u2500 RegisterUserController.php   # Web controller\n    \u2514\u2500\u2500 Form/\n        \u2514\u2500\u2500 UserType.php                 # Symfony form\n</code></pre></p>"},{"location":"getting-started/quick-start/#configure-doctrine-mapping","title":"Configure Doctrine Mapping","text":"<p>Add YAML mapping configuration to <code>config/packages/doctrine.yaml</code>:</p> <pre><code>doctrine:\n    dbal:\n        url: '%env(resolve:DATABASE_URL)%'\n\n    orm:\n        auto_generate_proxy_classes: true\n        naming_strategy: doctrine.orm.naming_strategy.underscore_number_aware\n        auto_mapping: true\n        mappings:\n            UserAccount:\n                is_bundle: false\n                type: yml\n                dir: '%kernel.project_dir%/src/User/Account/Infrastructure/Persistence/Doctrine/Orm/Mapping'\n                prefix: 'App\\User\\Account\\Domain\\Model'\n                alias: UserAccount\n</code></pre>"},{"location":"getting-started/quick-start/#complete-the-implementation","title":"Complete the Implementation","text":""},{"location":"getting-started/quick-start/#1-edit-user-entity","title":"1. Edit User Entity","text":"<pre><code>// src/User/Account/Domain/Model/User.php\n&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\User\\Account\\Domain\\Model;\n\nuse App\\User\\Account\\Domain\\ValueObject\\Email;\n\nfinal class User\n{\n    private string $id;\n    private Email $email;\n    private string $passwordHash;\n    private \\DateTimeImmutable $createdAt;\n\n    public function __construct(\n        string $id,\n        Email $email,\n        string $passwordHash\n    ) {\n        $this-&gt;id = $id;\n        $this-&gt;email = $email;\n        $this-&gt;passwordHash = $passwordHash;\n        $this-&gt;createdAt = new \\DateTimeImmutable();\n    }\n\n    public function getId(): string\n    {\n        return $this-&gt;id;\n    }\n\n    public function getEmail(): Email\n    {\n        return $this-&gt;email;\n    }\n\n    // Business methods...\n    public function changeEmail(Email $newEmail): void\n    {\n        $this-&gt;email = $newEmail;\n    }\n}\n</code></pre>"},{"location":"getting-started/quick-start/#2-complete-email-value-object","title":"2. Complete Email Value Object","text":"<pre><code>// src/User/Account/Domain/ValueObject/Email.php\n&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\User\\Account\\Domain\\ValueObject;\n\nuse App\\User\\Account\\Domain\\Exception\\InvalidEmailException;\n\nfinal readonly class Email\n{\n    private string $value;\n\n    public function __construct(string $value)\n    {\n        if (!filter_var($value, FILTER_VALIDATE_EMAIL)) {\n            throw new InvalidEmailException(\"Invalid email: $value\");\n        }\n\n        $this-&gt;value = strtolower($value);\n    }\n\n    public function getValue(): string\n    {\n        return $this-&gt;value;\n    }\n\n    public function __toString(): string\n    {\n        return $this-&gt;value;\n    }\n}\n</code></pre>"},{"location":"getting-started/quick-start/#3-complete-doctrine-mapping","title":"3. Complete Doctrine Mapping","text":"<pre><code># src/User/Account/Infrastructure/Persistence/Doctrine/Orm/Mapping/User.orm.yml\nApp\\User\\Account\\Domain\\Model\\User:\n    type: entity\n    repositoryClass: App\\User\\Account\\Infrastructure\\Persistence\\Doctrine\\DoctrineUserRepository\n    table: user\n\n    id:\n        id:\n            type: string\n            length: 36\n\n    fields:\n        email:\n            type: string\n            length: 180\n            unique: true\n            # Email VO will be stored as string\n\n        passwordHash:\n            type: string\n            length: 255\n            column: password_hash\n\n        createdAt:\n            type: datetime_immutable\n            column: created_at\n</code></pre>"},{"location":"getting-started/quick-start/#4-implement-handler","title":"4. Implement Handler","text":"<pre><code>// src/User/Account/Application/Register/RegisterCommandHandler.php\n&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\User\\Account\\Application\\Register;\n\nuse App\\User\\Account\\Domain\\Port\\UserRepositoryInterface;\nuse Symfony\\Component\\Messenger\\Attribute\\AsMessageHandler;\n\n#[AsMessageHandler]\nfinal readonly class RegisterCommandHandler\n{\n    public function __construct(\n        private UserFactory $factory,\n        private UserRepositoryInterface $repository,\n    ) {\n    }\n\n    public function __invoke(RegisterCommand $command): void\n    {\n        // Use factory to create user\n        $user = $this-&gt;factory-&gt;create(\n            email: $command-&gt;email,\n            password: $command-&gt;password\n        );\n\n        // Save via repository\n        $this-&gt;repository-&gt;save($user);\n    }\n}\n</code></pre>"},{"location":"getting-started/quick-start/#generate-database-schema","title":"Generate Database Schema","text":"<pre><code># Validate mapping\nbin/console doctrine:schema:validate\n\n# Generate migration\nbin/console doctrine:migrations:diff\n\n# Execute migration\nbin/console doctrine:migrations:migrate\n</code></pre>"},{"location":"getting-started/quick-start/#test-your-module","title":"Test Your Module","text":""},{"location":"getting-started/quick-start/#option-1-web-interface","title":"Option 1: Web Interface","text":"<p>Create a controller action:</p> <pre><code>// src/User/Account/UI/Http/Web/Controller/RegisterUserController.php\nuse Symfony\\Component\\Messenger\\MessageBusInterface;\n\n#[Route('/users/register', name: 'user_register', methods: ['GET', 'POST'])]\npublic function register(Request $request, MessageBusInterface $commandBus): Response\n{\n    $form = $this-&gt;createForm(UserType::class);\n    $form-&gt;handleRequest($request);\n\n    if ($form-&gt;isSubmitted() &amp;&amp; $form-&gt;isValid()) {\n        $data = $form-&gt;getData();\n\n        $command = new RegisterCommand(\n            email: $data['email'],\n            password: $data['password']\n        );\n\n        $commandBus-&gt;dispatch($command);\n\n        return $this-&gt;redirectToRoute('user_success');\n    }\n\n    return $this-&gt;render('user/register.html.twig', [\n        'form' =&gt; $form,\n    ]);\n}\n</code></pre>"},{"location":"getting-started/quick-start/#option-2-cli-command","title":"Option 2: CLI Command","text":"<pre><code>bin/console make:hexagonal:cli-command user/account RegisterUser app:user:register\n</code></pre> <p>Then test:</p> <pre><code>bin/console app:user:register --email=test@example.com --password=secret\n</code></pre>"},{"location":"getting-started/quick-start/#whats-next","title":"What's Next?","text":"<p>You've built a complete hexagonal module! Next steps:</p> <ol> <li>Add more use cases - Update, Delete, List</li> <li>Add tests - Unit and integration tests</li> <li>Add validation - Input DTOs with constraints</li> <li>Add domain events - Event-driven architecture</li> <li>Generate complete CRUD - Use the CRUD maker</li> </ol>"},{"location":"getting-started/quick-start/#quick-crud-alternative","title":"Quick CRUD Alternative","text":"<p>Want to skip manual generation? Use the CRUD maker:</p> <pre><code>bin/console make:hexagonal:crud user/account User --with-tests --with-id-vo\n</code></pre> <p>This generates everything in one command: - Entity + Repository + ValueObjects - 5 Use Cases (Create, Update, Delete, Get, List) - 5 Controllers + Form - All tests</p> <p>Learn more about CRUD maker \u2192</p>"},{"location":"getting-started/quick-start/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/quick-start/#doctrine-mapping-not-found","title":"Doctrine mapping not found","text":"<p>Error: <code>Class \"App\\User\\Account\\Domain\\Model\\User\" sub class of \"X\" is not a valid entity or mapped super class.</code></p> <p>Solution: Add mapping configuration to <code>config/packages/doctrine.yaml</code> (see Configure Doctrine Mapping above)</p>"},{"location":"getting-started/quick-start/#entity-not-persisted","title":"Entity not persisted","text":"<p>Error: <code>A new entity was found through the relationship...</code></p> <p>Solution: Add <code>cascade: ['persist']</code> in your YAML mapping or call <code>$entityManager-&gt;persist()</code> explicitly</p>"},{"location":"getting-started/quick-start/#service-autowiring-failed","title":"Service autowiring failed","text":"<p>Error: <code>Cannot autowire service \"X\": argument \"$repository\" references interface \"UserRepositoryInterface\" but no such service exists.</code></p> <p>Solution: Configure service alias in <code>config/services.yaml</code>:</p> <pre><code>services:\n    App\\User\\Account\\Domain\\Port\\UserRepositoryInterface:\n        class: App\\User\\Account\\Infrastructure\\Persistence\\Doctrine\\DoctrineUserRepository\n</code></pre> <p>Or use <code>_defaults: autowire: true</code> with <code>bind</code> for automatic resolution.</p>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Installation Guide - Detailed installation and configuration</li> <li>First Module Tutorial - Step-by-step guide with full code</li> <li>Maker Commands Reference - All 19 commands documented</li> <li>Architecture Guide - Deep dive into hexagonal architecture</li> </ul>"},{"location":"makers/","title":"Maker Commands","text":"<p>Complete reference for all 19 maker commands.</p>"},{"location":"makers/#command-categories","title":"Command Categories","text":""},{"location":"makers/#domain-layer","title":"Domain Layer","text":"<ul> <li><code>make:hexagonal:entity</code> - Pure PHP entities</li> <li><code>make:hexagonal:value-object</code> - Immutable value objects</li> <li><code>make:hexagonal:exception</code> - Business exceptions</li> <li><code>make:hexagonal:domain-event</code> - Domain events</li> </ul>"},{"location":"makers/#application-layer","title":"Application Layer","text":"<ul> <li><code>make:hexagonal:command</code> - CQRS commands + handlers</li> <li><code>make:hexagonal:query</code> - CQRS queries + handlers + responses</li> <li><code>make:hexagonal:repository</code> - Repository port + adapter</li> <li><code>make:hexagonal:input</code> - Input DTOs</li> <li><code>make:hexagonal:use-case</code> - Use cases</li> </ul>"},{"location":"makers/#ui-layer","title":"UI Layer","text":"<ul> <li><code>make:hexagonal:controller</code> - Web controllers</li> <li><code>make:hexagonal:form</code> - Symfony forms</li> <li><code>make:hexagonal:cli-command</code> - Console commands</li> </ul>"},{"location":"makers/#infrastructure-layer","title":"Infrastructure Layer","text":"<ul> <li><code>make:hexagonal:message-handler</code> - Async message handlers</li> <li><code>make:hexagonal:event-subscriber</code> - Event subscribers</li> </ul>"},{"location":"makers/#testing","title":"Testing","text":"<ul> <li><code>make:hexagonal:use-case-test</code> - Use case tests</li> <li><code>make:hexagonal:controller-test</code> - Controller tests</li> <li><code>make:hexagonal:cli-command-test</code> - CLI command tests</li> <li><code>make:hexagonal:test-config</code> - Test configuration</li> </ul>"},{"location":"makers/#rapid-development","title":"Rapid Development","text":"<ul> <li><code>make:hexagonal:crud</code> - Complete CRUD module (20+ files)</li> </ul> <p>See detailed documentation \u2192</p>"},{"location":"makers/commands/","title":"Maker Commands Reference","text":"<p>Complete reference for all 19 maker commands in Hexagonal Maker Bundle.</p>"},{"location":"makers/commands/#quick-reference","title":"Quick Reference","text":"Command Layer What it generates make:hexagonal:entity Domain Pure PHP entities + YAML mapping make:hexagonal:value-object Domain Immutable value objects make:hexagonal:exception Domain Business exceptions make:hexagonal:repository Domain + Infra Repository port + Doctrine adapter make:hexagonal:command Application CQRS commands + handlers make:hexagonal:query Application CQRS queries + handlers + responses make:hexagonal:use-case Application Use cases (application services) make:hexagonal:input Application Input DTOs with validation make:hexagonal:controller UI Web controllers make:hexagonal:form UI Symfony forms make:hexagonal:cli-command UI Console commands make:hexagonal:domain-event Domain Domain events make:hexagonal:event-subscriber App/Infra Event subscribers make:hexagonal:message-handler Infrastructure Async message handlers make:hexagonal:use-case-test Tests Use case tests make:hexagonal:controller-test Tests Controller tests make:hexagonal:cli-command-test Tests CLI command tests make:hexagonal:test-config Config Test configuration setup make:hexagonal:crud All Complete CRUD module (30+ files)"},{"location":"makers/commands/#domain-layer","title":"Domain Layer","text":""},{"location":"makers/commands/#entity","title":"Entity","text":"<p>Generate a pure domain entity with Doctrine YAML mapping.</p> <pre><code>bin/console make:hexagonal:entity &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:entity user/account User\n</code></pre> <p>Generated: - <code>Domain/Model/User.php</code> - Pure PHP entity - <code>Infrastructure/Persistence/Doctrine/Orm/Mapping/User.orm.yml</code> - Doctrine mapping</p> <p>Options:</p> <pre><code># With repository\n--with-repository\n\n# With ID value object\n--with-id-vo\n\n# Combined\nbin/console make:hexagonal:entity blog/post Post --with-repository --with-id-vo\n</code></pre>"},{"location":"makers/commands/#value-object","title":"Value Object","text":"<p>Generate an immutable value object.</p> <pre><code>bin/console make:hexagonal:value-object &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:value-object user/account Email\n</code></pre> <p>Generated: - <code>Domain/ValueObject/Email.php</code> - Immutable readonly class</p> <p>Template:</p> <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\User\\Account\\Domain\\ValueObject;\n\nfinal readonly class Email\n{\n    private string $value;\n\n    public function __construct(string $value)\n    {\n        // Validation logic\n        $this-&gt;value = $value;\n    }\n\n    public function getValue(): string\n    {\n        return $this-&gt;value;\n    }\n}\n</code></pre>"},{"location":"makers/commands/#exception","title":"Exception","text":"<p>Generate a domain exception for business rule violations.</p> <pre><code>bin/console make:hexagonal:exception &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:exception user/account InvalidEmailException\n</code></pre> <p>Generated: - <code>Domain/Exception/InvalidEmailException.php</code></p>"},{"location":"makers/commands/#repository","title":"Repository","text":"<p>Generate repository interface (Port) and Doctrine implementation (Adapter).</p> <pre><code>bin/console make:hexagonal:repository &lt;module&gt; &lt;entity&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:repository user/account User\n</code></pre> <p>Generated: - <code>Domain/Port/UserRepositoryInterface.php</code> - Interface (Port) - <code>Infrastructure/Persistence/Doctrine/DoctrineUserRepository.php</code> - Implementation (Adapter)</p>"},{"location":"makers/commands/#application-layer","title":"Application Layer","text":""},{"location":"makers/commands/#command","title":"Command","text":"<p>Generate CQRS command for write operations.</p> <pre><code>bin/console make:hexagonal:command &lt;module&gt; &lt;name&gt; [options]\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:command blog/post create\n</code></pre> <p>Generated: - <code>Application/Create/CreateCommand.php</code> - Command DTO - <code>Application/Create/CreateCommandHandler.php</code> - Handler with <code>#[AsMessageHandler]</code></p> <p>Options:</p> <pre><code># With factory pattern\n--factory\n\n# With tests\n--with-tests\n\n# Combined\nbin/console make:hexagonal:command user/account register --factory --with-tests\n</code></pre> <p>With Factory Generated: - <code>Application/Register/RegisterCommand.php</code> - <code>Application/Register/RegisterCommandHandler.php</code> - <code>Application/Register/UserFactory.php</code> - Factory for creating entities</p>"},{"location":"makers/commands/#query","title":"Query","text":"<p>Generate CQRS query for read operations.</p> <pre><code>bin/console make:hexagonal:query &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:query blog/post find-by-id\n</code></pre> <p>Generated: - <code>Application/FindById/FindByIdQuery.php</code> - Query DTO - <code>Application/FindById/FindByIdQueryHandler.php</code> - Handler - <code>Application/FindById/FindByIdResponse.php</code> - Response DTO</p>"},{"location":"makers/commands/#use-case","title":"Use Case","text":"<p>Generate a use case (application service).</p> <pre><code>bin/console make:hexagonal:use-case &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:use-case blog/post PublishPost\n</code></pre> <p>Generated: - <code>Application/UseCase/PublishPostUseCase.php</code></p> <p>Options:</p> <pre><code># With test\n--with-test\n\nbin/console make:hexagonal:use-case blog/post CreatePost --with-test\n</code></pre>"},{"location":"makers/commands/#input","title":"Input","text":"<p>Generate input DTO with validation.</p> <pre><code>bin/console make:hexagonal:input &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:input blog/post CreatePostInput\n</code></pre> <p>Generated: - <code>Application/Input/CreatePostInput.php</code> - DTO with Symfony Validator constraints</p>"},{"location":"makers/commands/#ui-layer","title":"UI Layer","text":""},{"location":"makers/commands/#controller","title":"Controller","text":"<p>Generate web controller.</p> <pre><code>bin/console make:hexagonal:controller &lt;module&gt; &lt;name&gt; &lt;route&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:controller blog/post CreatePost /posts/new\n</code></pre> <p>Generated: - <code>UI/Http/Web/Controller/CreatePostController.php</code></p> <p>Options:</p> <pre><code># With complete workflow (Form + UseCase + Command + Input)\n--with-workflow\n\nbin/console make:hexagonal:controller blog/post CreatePost /posts/new --with-workflow\n</code></pre> <p>With Workflow Generated: - Controller - Form - UseCase - Command + Handler - Input DTO</p>"},{"location":"makers/commands/#form","title":"Form","text":"<p>Generate Symfony form type.</p> <pre><code>bin/console make:hexagonal:form &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:form blog/post Post\n</code></pre> <p>Generated: - <code>UI/Http/Web/Form/PostType.php</code></p> <p>Options:</p> <pre><code># With command workflow\n--with-command --action=Create\n\nbin/console make:hexagonal:form blog/post Post --with-command --action=Create\n</code></pre> <p>With Command Generated: - Form - Command + Handler - Input DTO</p>"},{"location":"makers/commands/#cli-command","title":"CLI Command","text":"<p>Generate console command.</p> <pre><code>bin/console make:hexagonal:cli-command &lt;module&gt; &lt;name&gt; &lt;command-name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:cli-command blog/post CreatePost app:post:create\n</code></pre> <p>Generated: - <code>UI/Cli/CreatePostCommand.php</code></p> <p>Options:</p> <pre><code># With use case workflow\n--with-use-case\n\nbin/console make:hexagonal:cli-command blog/post CreatePost app:post:create --with-use-case\n</code></pre>"},{"location":"makers/commands/#infrastructure-layer","title":"Infrastructure Layer","text":""},{"location":"makers/commands/#message-handler","title":"Message Handler","text":"<p>Generate async message handler.</p> <pre><code>bin/console make:hexagonal:message-handler &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:message-handler user/account SendWelcomeEmail\n</code></pre> <p>Generated: - <code>Infrastructure/Messaging/Handler/SendWelcomeEmailHandler.php</code></p> <p>Options:</p> <pre><code># With message class\n--with-message\n\nbin/console make:hexagonal:message-handler user/account SendEmail --with-message\n</code></pre>"},{"location":"makers/commands/#events","title":"Events","text":""},{"location":"makers/commands/#domain-event","title":"Domain Event","text":"<p>Generate domain event.</p> <pre><code>bin/console make:hexagonal:domain-event &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:domain-event order/payment OrderPlaced\n</code></pre> <p>Generated: - <code>Domain/Event/OrderPlacedEvent.php</code> - Immutable event</p> <p>Options:</p> <pre><code># With subscriber\n--with-subscriber\n\nbin/console make:hexagonal:domain-event order/payment OrderPlaced --with-subscriber\n</code></pre>"},{"location":"makers/commands/#event-subscriber","title":"Event Subscriber","text":"<p>Generate event subscriber.</p> <pre><code>bin/console make:hexagonal:event-subscriber &lt;module&gt; &lt;name&gt; --layer=&lt;application|infrastructure&gt;\n</code></pre> <p>Example:</p> <pre><code># Application layer (business workflow)\nbin/console make:hexagonal:event-subscriber order/payment OrderPlaced --layer=application\n\n# Infrastructure layer (technical concerns)\nbin/console make:hexagonal:event-subscriber shared/logging Exception --layer=infrastructure\n</code></pre>"},{"location":"makers/commands/#tests","title":"Tests","text":""},{"location":"makers/commands/#use-case-test","title":"Use Case Test","text":"<p>Generate use case test.</p> <pre><code>bin/console make:hexagonal:use-case-test &lt;module&gt; &lt;name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:use-case-test blog/post CreatePost\n</code></pre> <p>Generated: - <code>tests/Blog/Post/Application/CreatePost/CreatePostTest.php</code> - KernelTestCase</p>"},{"location":"makers/commands/#controller-test","title":"Controller Test","text":"<p>Generate controller test.</p> <pre><code>bin/console make:hexagonal:controller-test &lt;module&gt; &lt;name&gt; &lt;route&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:controller-test blog/post CreatePost /posts/new\n</code></pre> <p>Generated: - <code>tests/Blog/Post/UI/Http/Web/Controller/CreatePostControllerTest.php</code> - WebTestCase</p>"},{"location":"makers/commands/#cli-command-test","title":"CLI Command Test","text":"<p>Generate CLI command test.</p> <pre><code>bin/console make:hexagonal:cli-command-test &lt;module&gt; &lt;name&gt; &lt;command-name&gt;\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:cli-command-test blog/post CreatePost app:post:create\n</code></pre> <p>Generated: - <code>tests/Blog/Post/UI/Cli/CreatePostCommandTest.php</code> - CommandTester</p>"},{"location":"makers/commands/#configuration","title":"Configuration","text":""},{"location":"makers/commands/#test-config","title":"Test Config","text":"<p>Generate test environment configuration.</p> <pre><code>bin/console make:hexagonal:test-config\n</code></pre> <p>Generated: - <code>config/packages/test/doctrine.yaml</code> - Test database config - <code>.env.test</code> - Test environment variables</p>"},{"location":"makers/commands/#rapid-development","title":"Rapid Development","text":""},{"location":"makers/commands/#crud","title":"CRUD","text":"<p>Generate complete CRUD module.</p> <pre><code>bin/console make:hexagonal:crud &lt;module&gt; &lt;entity&gt; [options]\n</code></pre> <p>Example:</p> <pre><code>bin/console make:hexagonal:crud blog/post Post --with-tests --with-id-vo\n</code></pre> <p>Generated (30+ files):</p> <p>Domain: - Entity - Repository Interface - ID ValueObject (with <code>--with-id-vo</code>)</p> <p>Infrastructure: - Doctrine Repository - YAML Mapping</p> <p>Application: - 5 Use Cases (Create, Update, Delete, Get, List) - 5 Commands + Handlers - 5 Input DTOs</p> <p>UI: - 5 Controllers - 1 Form</p> <p>Tests (with <code>--with-tests</code>): - 5 Use Case Tests - 5 Controller Tests</p> <p>Routes: - <code>GET /posts</code> - List - <code>GET /posts/{id}</code> - Show - <code>GET /posts/new</code> - Create form - <code>POST /posts/new</code> - Submit - <code>GET /posts/{id}/edit</code> - Edit form - <code>POST /posts/{id}/edit</code> - Update - <code>DELETE /posts/{id}/delete</code> - Delete</p>"},{"location":"makers/commands/#options-summary","title":"Options Summary","text":"Option Available For Description <code>--with-repository</code> Entity Generate repository with entity <code>--with-id-vo</code> Entity, CRUD Generate ID value object <code>--factory</code> Command Generate factory pattern <code>--with-tests</code> Command, UseCase, CRUD Generate tests <code>--with-use-case</code> CLI Command Generate use case workflow <code>--with-workflow</code> Controller Generate complete workflow <code>--with-command</code> Form Generate command workflow <code>--with-message</code> Message Handler Generate message class <code>--with-subscriber</code> Domain Event Generate event subscriber <code>--layer</code> Event Subscriber Choose application or infrastructure <code>--action</code> Form Specify action (Create, Update, etc.)"},{"location":"makers/commands/#module-path-format","title":"Module Path Format","text":"<p>All commands use the module path format: <code>&lt;context&gt;/&lt;module&gt;</code></p> <p>Examples: - <code>user/account</code> \u2192 <code>src/User/Account/</code> - <code>blog/post</code> \u2192 <code>src/Blog/Post/</code> - <code>order/payment</code> \u2192 <code>src/Order/Payment/</code></p> <p>Flexibility: - <code>module/user/account</code> \u2192 <code>src/Module/User/Account/</code> - <code>shared/common</code> \u2192 <code>src/Shared/Common/</code></p>"},{"location":"makers/commands/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start - Build your first module</li> <li>Examples - Real-world usage</li> <li>Architecture Guide - Understand the patterns</li> </ul>"}]}