<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Symfony Maker Bundle for Hexagonal Architecture (Ports & Adapters). Generate CQRS Commands, Queries, Entities, and complete modular architecture with 19 maker commands."><meta name=author content="Ahmed EBEN HASSINE"><link href=https://ahmed-bhs.github.io/hexagonal-maker-bundle/WHY-HEXAGONAL/ rel=canonical><link href=../SOLID/ rel=prev><link href=../examples/user-registration/ rel=next><link rel=icon href=../images/hexagonal-architecture.jpg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Why Hexagonal Architecture - Hexagonal Maker Bundle</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#why-hexagonal-architecture class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Hexagonal Maker Bundle" class="md-header__button md-logo" aria-label="Hexagonal Maker Bundle" data-md-component=logo> <img src=../images/hexagonal-architecture.jpg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Hexagonal Maker Bundle </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Why Hexagonal Architecture </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=purple aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ahmed-bhs/hexagonal-maker-bundle title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ahmed-bhs/hexagonal-maker-bundle </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../getting-started/quick-start/ class=md-tabs__link> Getting Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ARCHITECTURE/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../examples/user-registration/ class=md-tabs__link> Examples </a> </li> <li class=md-tabs__item> <a href=../advanced/doctrine/ class=md-tabs__link> Advanced </a> </li> <li class=md-tabs__item> <a href=../contributing/overview/ class=md-tabs__link> Contributing </a> </li> <li class=md-tabs__item> <a href=../about/faq/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Hexagonal Maker Bundle" class="md-nav__button md-logo" aria-label="Hexagonal Maker Bundle" data-md-component=logo> <img src=../images/hexagonal-architecture.jpg alt=logo> </a> Hexagonal Maker Bundle </label> <div class=md-nav__source> <a href=https://github.com/ahmed-bhs/hexagonal-maker-bundle title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ahmed-bhs/hexagonal-maker-bundle </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../getting-started/quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../getting-started/first-module/ class=md-nav__link> <span class=md-ellipsis> First Module </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ARCHITECTURE/ class=md-nav__link> <span class=md-ellipsis> Architecture Guide </span> </a> </li> <li class=md-nav__item> <a href=../makers/commands/ class=md-nav__link> <span class=md-ellipsis> Maker Commands </span> </a> </li> <li class=md-nav__item> <a href=../SOLID/ class=md-nav__link> <span class=md-ellipsis> SOLID Principles </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Why Hexagonal </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Why Hexagonal </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#21-the-fundamental-question class=md-nav__link> <span class=md-ellipsis> 2.1 The Fundamental Question </span> </a> </li> <li class=md-nav__item> <a href=#22-traditional-layered-architecture-the-critical-problems class=md-nav__link> <span class=md-ellipsis> 2.2 Traditional Layered Architecture: The Critical Problems </span> </a> <nav class=md-nav aria-label="2.2 Traditional Layered Architecture: The Critical Problems"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221-framework-prison class=md-nav__link> <span class=md-ellipsis> 2.2.1 Framework Prison </span> </a> </li> <li class=md-nav__item> <a href=#222-testing-complexity class=md-nav__link> <span class=md-ellipsis> 2.2.2 Testing Complexity </span> </a> </li> <li class=md-nav__item> <a href=#223-lost-business-rules class=md-nav__link> <span class=md-ellipsis> 2.2.3 Lost Business Rules </span> </a> </li> <li class=md-nav__item> <a href=#224-cannot-evolve class=md-nav__link> <span class=md-ellipsis> 2.2.4 Cannot Evolve </span> </a> </li> <li class=md-nav__item> <a href=#225-death-by-thousand-cuts class=md-nav__link> <span class=md-ellipsis> 2.2.5 Death by Thousand Cuts </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-hexagonal-architecture-inverting-the-dependency-chain class=md-nav__link> <span class=md-ellipsis> 2.3 Hexagonal Architecture: Inverting the Dependency Chain </span> </a> <nav class=md-nav aria-label="2.3 Hexagonal Architecture: Inverting the Dependency Chain"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#230-the-laptop-analogy class=md-nav__link> <span class=md-ellipsis> 2.3.0 The Laptop Analogy üíªüîå </span> </a> </li> <li class=md-nav__item> <a href=#231-dependency-direction class=md-nav__link> <span class=md-ellipsis> 2.3.1 Dependency Direction </span> </a> </li> <li class=md-nav__item> <a href=#232-practical-implications class=md-nav__link> <span class=md-ellipsis> 2.3.2 Practical Implications </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#24-real-world-scenarios class=md-nav__link> <span class=md-ellipsis> 2.4 Real-World Scenarios </span> </a> <nav class=md-nav aria-label="2.4 Real-World Scenarios"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#241-framework-update-symfony-4-to-7 class=md-nav__link> <span class=md-ellipsis> 2.4.1 Framework Update (Symfony 4 to 7) </span> </a> </li> <li class=md-nav__item> <a href=#242-testing-speed-comparison class=md-nav__link> <span class=md-ellipsis> 2.4.2 Testing Speed Comparison </span> </a> </li> <li class=md-nav__item> <a href=#243-lost-business-rules class=md-nav__link> <span class=md-ellipsis> 2.4.3 Lost Business Rules </span> </a> </li> <li class=md-nav__item> <a href=#244-adding-new-interface-graphql class=md-nav__link> <span class=md-ellipsis> 2.4.4 Adding New Interface (GraphQL) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#25-benefits-comparison class=md-nav__link> <span class=md-ellipsis> 2.5 Benefits Comparison </span> </a> </li> <li class=md-nav__item> <a href=#26-cost-predictability-the-5-day-rule class=md-nav__link> <span class=md-ellipsis> 2.6 Cost Predictability: The "5-Day Rule" </span> </a> <nav class=md-nav aria-label='2.6 Cost Predictability: The "5-Day Rule"'> <ul class=md-nav__list> <li class=md-nav__item> <a href=#261-the-layered-architecture-fail class=md-nav__link> <span class=md-ellipsis> 2.6.1 The Layered Architecture "Fail" </span> </a> </li> <li class=md-nav__item> <a href=#262-the-hexagonal-architecture-advantage class=md-nav__link> <span class=md-ellipsis> 2.6.2 The Hexagonal Architecture Advantage </span> </a> </li> <li class=md-nav__item> <a href=#263-tests-the-safety-net-that-accelerates-development class=md-nav__link> <span class=md-ellipsis> 2.6.3 Tests: The Safety Net That Accelerates Development </span> </a> </li> <li class=md-nav__item> <a href=#264-the-investment-vs-credit-analogy class=md-nav__link> <span class=md-ellipsis> 2.6.4 The Investment vs. Credit Analogy </span> </a> </li> <li class=md-nav__item> <a href=#265-the-long-term-math class=md-nav__link> <span class=md-ellipsis> 2.6.5 The Long-Term Math </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#27-database-migration-the-ultimate-test class=md-nav__link> <span class=md-ellipsis> 2.7 Database Migration: The Ultimate Test </span> </a> <nav class=md-nav aria-label="2.7 Database Migration: The Ultimate Test"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#layered-architecture-impact class=md-nav__link> <span class=md-ellipsis> Layered Architecture Impact: </span> </a> </li> <li class=md-nav__item> <a href=#hexagonal-architecture-impact class=md-nav__link> <span class=md-ellipsis> Hexagonal Architecture Impact: </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#28-decision-guide class=md-nav__link> <span class=md-ellipsis> 2.8 Decision Guide </span> </a> <nav class=md-nav aria-label="2.8 Decision Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#281-choose-hexagonal-architecture-when class=md-nav__link> <span class=md-ellipsis> 2.8.1 Choose Hexagonal Architecture When: </span> </a> </li> <li class=md-nav__item> <a href=#282-stick-with-simpler-architecture-when class=md-nav__link> <span class=md-ellipsis> 2.8.2 Stick with Simpler Architecture When: </span> </a> </li> <li class=md-nav__item> <a href=#283-the-core-truth-about-decoupling class=md-nav__link> <span class=md-ellipsis> 2.8.3 The Core Truth About Decoupling </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#29-summary class=md-nav__link> <span class=md-ellipsis> 2.9 Summary </span> </a> </li> <li class=md-nav__item> <a href=#210-hexagonal-architecture-core-design-principles class=md-nav__link> <span class=md-ellipsis> 2.10 Hexagonal Architecture &amp; Core Design Principles </span> </a> <nav class=md-nav aria-label="2.10 Hexagonal Architecture & Core Design Principles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2101-dry-dont-repeat-yourself class=md-nav__link> <span class=md-ellipsis> 2.10.1 DRY (Don't Repeat Yourself) </span> </a> </li> <li class=md-nav__item> <a href=#2102-kiss-keep-it-simple-stupid class=md-nav__link> <span class=md-ellipsis> 2.10.2 KISS (Keep It Simple, Stupid) </span> </a> </li> <li class=md-nav__item> <a href=#2103-yagni-you-arent-gonna-need-it class=md-nav__link> <span class=md-ellipsis> 2.10.3 YAGNI (You Aren't Gonna Need It) </span> </a> </li> <li class=md-nav__item> <a href=#2104-soc-separation-of-concerns class=md-nav__link> <span class=md-ellipsis> 2.10.4 SoC (Separation of Concerns) </span> </a> </li> <li class=md-nav__item> <a href=#2105-dependency-injection-di class=md-nav__link> <span class=md-ellipsis> 2.10.5 Dependency Injection (DI) </span> </a> </li> <li class=md-nav__item> <a href=#2106-factory-pattern class=md-nav__link> <span class=md-ellipsis> 2.10.6 Factory Pattern </span> </a> </li> <li class=md-nav__item> <a href=#2107-dto-pattern-data-transfer-objects class=md-nav__link> <span class=md-ellipsis> 2.10.7 DTO Pattern (Data Transfer Objects) </span> </a> </li> <li class=md-nav__item> <a href=#2108-event-sourcing-pattern class=md-nav__link> <span class=md-ellipsis> 2.10.8 Event Sourcing Pattern </span> </a> </li> <li class=md-nav__item> <a href=#2109-strategy-pattern class=md-nav__link> <span class=md-ellipsis> 2.10.9 Strategy Pattern </span> </a> </li> <li class=md-nav__item> <a href=#21010-why-these-patterns-matter-together class=md-nav__link> <span class=md-ellipsis> 2.10.10 Why These Patterns Matter Together </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#211-complete-decision-tree-what-to-create-and-how class=md-nav__link> <span class=md-ellipsis> 2.11 Complete Decision Tree: What to Create and How üå≥ </span> </a> <nav class=md-nav aria-label="2.11 Complete Decision Tree: What to Create and How üå≥"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-master-decision-tree class=md-nav__link> <span class=md-ellipsis> üéØ The Master Decision Tree </span> </a> </li> <li class=md-nav__item> <a href=#quick-reference-interface-decision-matrix class=md-nav__link> <span class=md-ellipsis> üìä Quick Reference: Interface Decision Matrix </span> </a> </li> <li class=md-nav__item> <a href=#golden-rule-for-interfaces class=md-nav__link> <span class=md-ellipsis> üéØ Golden Rule for Interfaces </span> </a> </li> <li class=md-nav__item> <a href=#common-scenarios class=md-nav__link> <span class=md-ellipsis> üí° Common Scenarios </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../examples/user-registration/ class=md-nav__link> <span class=md-ellipsis> User Registration </span> </a> </li> <li class=md-nav__item> <a href=../examples/crud-module/ class=md-nav__link> <span class=md-ellipsis> CRUD Module </span> </a> </li> <li class=md-nav__item> <a href=../examples/testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Advanced </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../advanced/doctrine/ class=md-nav__link> <span class=md-ellipsis> Doctrine Integration </span> </a> </li> <li class=md-nav__item> <a href=../advanced/templates/ class=md-nav__link> <span class=md-ellipsis> Custom Templates </span> </a> </li> <li class=md-nav__item> <a href=../advanced/shared-kernel/ class=md-nav__link> <span class=md-ellipsis> Shared Kernel </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../contributing/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../contributing/development/ class=md-nav__link> <span class=md-ellipsis> Development </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> About </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../about/faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../about/changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class=md-nav__item> <a href=../about/license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#21-the-fundamental-question class=md-nav__link> <span class=md-ellipsis> 2.1 The Fundamental Question </span> </a> </li> <li class=md-nav__item> <a href=#22-traditional-layered-architecture-the-critical-problems class=md-nav__link> <span class=md-ellipsis> 2.2 Traditional Layered Architecture: The Critical Problems </span> </a> <nav class=md-nav aria-label="2.2 Traditional Layered Architecture: The Critical Problems"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221-framework-prison class=md-nav__link> <span class=md-ellipsis> 2.2.1 Framework Prison </span> </a> </li> <li class=md-nav__item> <a href=#222-testing-complexity class=md-nav__link> <span class=md-ellipsis> 2.2.2 Testing Complexity </span> </a> </li> <li class=md-nav__item> <a href=#223-lost-business-rules class=md-nav__link> <span class=md-ellipsis> 2.2.3 Lost Business Rules </span> </a> </li> <li class=md-nav__item> <a href=#224-cannot-evolve class=md-nav__link> <span class=md-ellipsis> 2.2.4 Cannot Evolve </span> </a> </li> <li class=md-nav__item> <a href=#225-death-by-thousand-cuts class=md-nav__link> <span class=md-ellipsis> 2.2.5 Death by Thousand Cuts </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-hexagonal-architecture-inverting-the-dependency-chain class=md-nav__link> <span class=md-ellipsis> 2.3 Hexagonal Architecture: Inverting the Dependency Chain </span> </a> <nav class=md-nav aria-label="2.3 Hexagonal Architecture: Inverting the Dependency Chain"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#230-the-laptop-analogy class=md-nav__link> <span class=md-ellipsis> 2.3.0 The Laptop Analogy üíªüîå </span> </a> </li> <li class=md-nav__item> <a href=#231-dependency-direction class=md-nav__link> <span class=md-ellipsis> 2.3.1 Dependency Direction </span> </a> </li> <li class=md-nav__item> <a href=#232-practical-implications class=md-nav__link> <span class=md-ellipsis> 2.3.2 Practical Implications </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#24-real-world-scenarios class=md-nav__link> <span class=md-ellipsis> 2.4 Real-World Scenarios </span> </a> <nav class=md-nav aria-label="2.4 Real-World Scenarios"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#241-framework-update-symfony-4-to-7 class=md-nav__link> <span class=md-ellipsis> 2.4.1 Framework Update (Symfony 4 to 7) </span> </a> </li> <li class=md-nav__item> <a href=#242-testing-speed-comparison class=md-nav__link> <span class=md-ellipsis> 2.4.2 Testing Speed Comparison </span> </a> </li> <li class=md-nav__item> <a href=#243-lost-business-rules class=md-nav__link> <span class=md-ellipsis> 2.4.3 Lost Business Rules </span> </a> </li> <li class=md-nav__item> <a href=#244-adding-new-interface-graphql class=md-nav__link> <span class=md-ellipsis> 2.4.4 Adding New Interface (GraphQL) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#25-benefits-comparison class=md-nav__link> <span class=md-ellipsis> 2.5 Benefits Comparison </span> </a> </li> <li class=md-nav__item> <a href=#26-cost-predictability-the-5-day-rule class=md-nav__link> <span class=md-ellipsis> 2.6 Cost Predictability: The "5-Day Rule" </span> </a> <nav class=md-nav aria-label='2.6 Cost Predictability: The "5-Day Rule"'> <ul class=md-nav__list> <li class=md-nav__item> <a href=#261-the-layered-architecture-fail class=md-nav__link> <span class=md-ellipsis> 2.6.1 The Layered Architecture "Fail" </span> </a> </li> <li class=md-nav__item> <a href=#262-the-hexagonal-architecture-advantage class=md-nav__link> <span class=md-ellipsis> 2.6.2 The Hexagonal Architecture Advantage </span> </a> </li> <li class=md-nav__item> <a href=#263-tests-the-safety-net-that-accelerates-development class=md-nav__link> <span class=md-ellipsis> 2.6.3 Tests: The Safety Net That Accelerates Development </span> </a> </li> <li class=md-nav__item> <a href=#264-the-investment-vs-credit-analogy class=md-nav__link> <span class=md-ellipsis> 2.6.4 The Investment vs. Credit Analogy </span> </a> </li> <li class=md-nav__item> <a href=#265-the-long-term-math class=md-nav__link> <span class=md-ellipsis> 2.6.5 The Long-Term Math </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#27-database-migration-the-ultimate-test class=md-nav__link> <span class=md-ellipsis> 2.7 Database Migration: The Ultimate Test </span> </a> <nav class=md-nav aria-label="2.7 Database Migration: The Ultimate Test"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#layered-architecture-impact class=md-nav__link> <span class=md-ellipsis> Layered Architecture Impact: </span> </a> </li> <li class=md-nav__item> <a href=#hexagonal-architecture-impact class=md-nav__link> <span class=md-ellipsis> Hexagonal Architecture Impact: </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#28-decision-guide class=md-nav__link> <span class=md-ellipsis> 2.8 Decision Guide </span> </a> <nav class=md-nav aria-label="2.8 Decision Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#281-choose-hexagonal-architecture-when class=md-nav__link> <span class=md-ellipsis> 2.8.1 Choose Hexagonal Architecture When: </span> </a> </li> <li class=md-nav__item> <a href=#282-stick-with-simpler-architecture-when class=md-nav__link> <span class=md-ellipsis> 2.8.2 Stick with Simpler Architecture When: </span> </a> </li> <li class=md-nav__item> <a href=#283-the-core-truth-about-decoupling class=md-nav__link> <span class=md-ellipsis> 2.8.3 The Core Truth About Decoupling </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#29-summary class=md-nav__link> <span class=md-ellipsis> 2.9 Summary </span> </a> </li> <li class=md-nav__item> <a href=#210-hexagonal-architecture-core-design-principles class=md-nav__link> <span class=md-ellipsis> 2.10 Hexagonal Architecture &amp; Core Design Principles </span> </a> <nav class=md-nav aria-label="2.10 Hexagonal Architecture & Core Design Principles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2101-dry-dont-repeat-yourself class=md-nav__link> <span class=md-ellipsis> 2.10.1 DRY (Don't Repeat Yourself) </span> </a> </li> <li class=md-nav__item> <a href=#2102-kiss-keep-it-simple-stupid class=md-nav__link> <span class=md-ellipsis> 2.10.2 KISS (Keep It Simple, Stupid) </span> </a> </li> <li class=md-nav__item> <a href=#2103-yagni-you-arent-gonna-need-it class=md-nav__link> <span class=md-ellipsis> 2.10.3 YAGNI (You Aren't Gonna Need It) </span> </a> </li> <li class=md-nav__item> <a href=#2104-soc-separation-of-concerns class=md-nav__link> <span class=md-ellipsis> 2.10.4 SoC (Separation of Concerns) </span> </a> </li> <li class=md-nav__item> <a href=#2105-dependency-injection-di class=md-nav__link> <span class=md-ellipsis> 2.10.5 Dependency Injection (DI) </span> </a> </li> <li class=md-nav__item> <a href=#2106-factory-pattern class=md-nav__link> <span class=md-ellipsis> 2.10.6 Factory Pattern </span> </a> </li> <li class=md-nav__item> <a href=#2107-dto-pattern-data-transfer-objects class=md-nav__link> <span class=md-ellipsis> 2.10.7 DTO Pattern (Data Transfer Objects) </span> </a> </li> <li class=md-nav__item> <a href=#2108-event-sourcing-pattern class=md-nav__link> <span class=md-ellipsis> 2.10.8 Event Sourcing Pattern </span> </a> </li> <li class=md-nav__item> <a href=#2109-strategy-pattern class=md-nav__link> <span class=md-ellipsis> 2.10.9 Strategy Pattern </span> </a> </li> <li class=md-nav__item> <a href=#21010-why-these-patterns-matter-together class=md-nav__link> <span class=md-ellipsis> 2.10.10 Why These Patterns Matter Together </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#211-complete-decision-tree-what-to-create-and-how class=md-nav__link> <span class=md-ellipsis> 2.11 Complete Decision Tree: What to Create and How üå≥ </span> </a> <nav class=md-nav aria-label="2.11 Complete Decision Tree: What to Create and How üå≥"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-master-decision-tree class=md-nav__link> <span class=md-ellipsis> üéØ The Master Decision Tree </span> </a> </li> <li class=md-nav__item> <a href=#quick-reference-interface-decision-matrix class=md-nav__link> <span class=md-ellipsis> üìä Quick Reference: Interface Decision Matrix </span> </a> </li> <li class=md-nav__item> <a href=#golden-rule-for-interfaces class=md-nav__link> <span class=md-ellipsis> üéØ Golden Rule for Interfaces </span> </a> </li> <li class=md-nav__item> <a href=#common-scenarios class=md-nav__link> <span class=md-ellipsis> üí° Common Scenarios </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ahmed-bhs/hexagonal-maker-bundle/edit/main/docs/WHY-HEXAGONAL.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <h1 id=why-hexagonal-architecture>Why Hexagonal Architecture<a class=headerlink href=#why-hexagonal-architecture title="Permanent link">&para;</a></h1> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ul> <li><a href=#21-the-fundamental-question>2.1 The Fundamental Question</a></li> <li><a href=#22-traditional-layered-architecture-the-critical-problems>2.2 Traditional Layered Architecture: The Critical Problems</a></li> <li><a href=#23-hexagonal-architecture-inverting-the-dependency-chain>2.3 Hexagonal Architecture: Inverting the Dependency Chain</a></li> <li><a href=#24-real-world-scenarios>2.4 Real-World Scenarios</a></li> <li><a href=#25-benefits-comparison>2.5 Benefits Comparison</a></li> <li><a href=#26-cost-predictability-the-5-day-rule>2.6 Cost Predictability: The "5-Day Rule"</a></li> <li><a href=#27-database-migration-the-ultimate-test>2.7 Database Migration: The Ultimate Test</a></li> <li><a href=#28-decision-guide>2.8 Decision Guide</a></li> <li><a href=#29-summary>2.9 Summary</a></li> <li><a href=#210-hexagonal-architecture--core-design-principles>2.10 Hexagonal Architecture &amp; Core Design Principles</a></li> <li><a href=#211-complete-decision-tree-what-to-create-and-how->2.11 Complete Decision Tree</a></li> </ul> <hr> <h2 id=21-the-fundamental-question>2.1 The Fundamental Question<a class=headerlink href=#21-the-fundamental-question title="Permanent link">&para;</a></h2> <p><strong>Everything is coupled anyway, so why bother?</strong></p> <p>Your code will always call other code. Repositories, services, databases‚Äîeverything is connected. The question is not about eliminating coupling (impossible), but about <strong>controlling the direction</strong> of coupling.</p> <hr> <h2 id=22-traditional-layered-architecture-the-critical-problems>2.2 Traditional Layered Architecture: The Critical Problems<a class=headerlink href=#22-traditional-layered-architecture-the-critical-problems title="Permanent link">&para;</a></h2> <p>In a traditional layered architecture, business logic (Services) depends directly on infrastructure (Database, Framework, Libraries). This creates a dangerous dependency chain with the following critical problems:</p> <h3 id=221-framework-prison>2.2.1 Framework Prison<a class=headerlink href=#221-framework-prison title="Permanent link">&para;</a></h3> <ul> <li>Business logic is tightly coupled to Doctrine, Symfony, or any framework</li> <li>Switching from MySQL to MongoDB requires rewriting everything</li> <li>Framework update breaking APIs stops the entire application</li> <li><strong>Real cost:</strong> Weeks of rewriting for technology changes</li> </ul> <h3 id=222-testing-complexity>2.2.2 Testing Complexity<a class=headerlink href=#222-testing-complexity title="Permanent link">&para;</a></h3> <ul> <li>Every test requires a real database, containers, and fixtures</li> <li>Test suite takes 10 minutes instead of 10 seconds</li> <li>Cannot test business rules without booting the entire framework</li> <li><strong>Real cost:</strong> Developers wait, lose focus, tests get skipped</li> </ul> <h3 id=223-lost-business-rules>2.2.3 Lost Business Rules<a class=headerlink href=#223-lost-business-rules title="Permanent link">&para;</a></h3> <ul> <li>Rules scattered across controllers, services, entities, templates</li> <li>Question: "Can we cancel a shipped order?" requires searching multiple locations</li> <li>Same rule duplicated in 5 different places with slight variations</li> <li><strong>Real cost:</strong> Bugs, inconsistencies, impossible maintenance</li> </ul> <h3 id=224-cannot-evolve>2.2.4 Cannot Evolve<a class=headerlink href=#224-cannot-evolve title="Permanent link">&para;</a></h3> <ul> <li>Adding GraphQL API requires duplicating all logic</li> <li>Adding CLI commands requires copy-pasting controllers</li> <li>Planning gRPC requires starting from scratch</li> <li><strong>Real cost:</strong> Code duplication, diverging implementations</li> </ul> <h3 id=225-death-by-thousand-cuts>2.2.5 Death by Thousand Cuts<a class=headerlink href=#225-death-by-thousand-cuts title="Permanent link">&para;</a></h3> <ul> <li>"Just one quick change" touches 20 files</li> <li>Simple features become 3-day tasks</li> <li>Fear of refactoring because everything is interconnected</li> <li><strong>Real cost:</strong> Technical debt accumulates until rewrite is the only option</li> </ul> <hr> <h2 id=23-hexagonal-architecture-inverting-the-dependency-chain>2.3 Hexagonal Architecture: Inverting the Dependency Chain<a class=headerlink href=#23-hexagonal-architecture-inverting-the-dependency-chain title="Permanent link">&para;</a></h2> <p><strong>Core Principle:</strong> Make business logic independent by inverting who depends on whom.</p> <h3 id=230-the-laptop-analogy>2.3.0 The Laptop Analogy üíªüîå<a class=headerlink href=#230-the-laptop-analogy title="Permanent link">&para;</a></h3> <p>Before diving into technical details, let's use a simple, everyday analogy:</p> <p><strong>Your Laptop and USB Devices</strong></p> <p>Think about your laptop and how it connects to external devices:</p> <ul> <li>Your <strong>laptop</strong> is the core (business logic)</li> <li>Your laptop has <strong>USB ports</strong> (interfaces/contracts)</li> <li>You can plug in different <strong>devices</strong> (adapters):</li> <li>USB mouse</li> <li>USB keyboard</li> <li>USB external hard drive</li> <li>USB printer</li> <li>USB phone charger</li> </ul> <p><strong>Key Insight:</strong> Your laptop doesn't care WHAT you plug in, as long as it respects the USB standard (interface).</p> <p><strong>What if USB didn't exist?</strong> - Every laptop would need a specific Sony mouse port, HP keyboard port, Samsung phone port - Want to change your mouse brand? Buy a new laptop! - This is exactly how <strong>traditional layered architecture</strong> works üå™Ô∏è</p> <p><strong>With USB (Ports &amp; Adapters):</strong> - Your laptop defines: "I need a USB port" - Devices provide: "I implement USB" - Change devices anytime without changing the laptop - This is <strong>Hexagonal Architecture</strong> üéØ</p> <p><strong>Mapping to Software:</strong></p> <table> <thead> <tr> <th>Real World</th> <th>Software</th> </tr> </thead> <tbody> <tr> <td>üíª <strong>Laptop</strong></td> <td>Domain (Business Logic)</td> </tr> <tr> <td>üîå <strong>USB Port</strong></td> <td>Port Interface (Contract)</td> </tr> <tr> <td>üñ±Ô∏è <strong>USB Mouse</strong></td> <td>Doctrine Adapter</td> </tr> <tr> <td>‚å®Ô∏è <strong>USB Keyboard</strong></td> <td>MongoDB Adapter</td> </tr> <tr> <td>üñ®Ô∏è <strong>USB Printer</strong></td> <td>Redis Adapter</td> </tr> <tr> <td>üì± <strong>USB Phone</strong></td> <td>InMemory Adapter (for tests)</td> </tr> </tbody> </table> <p><strong>The Power:</strong> - Your laptop (domain) doesn't know if a mouse, keyboard, or hard drive is plugged in - It just knows: "Something respecting USB is connected" - Your domain doesn't know if MySQL, MongoDB, or Redis is used - It just knows: "Something respecting <code>UserRepositoryInterface</code> is connected"</p> <p><strong>Real Example in Code:</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=x>// üå™Ô∏è Traditional: Domain depends on concrete MySQL</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=x>class OrderService {</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=x>    public function __construct(</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=x>        private DoctrineRepository $repo  // Tightly coupled!</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=x>    ) {}</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=x>}</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=x>// Problem: Want MongoDB? Rewrite OrderService!</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=x>// üéØ Hexagonal: Domain depends on interface (USB port)</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=x>class PlaceOrderHandler {</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=x>    public function __construct(</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=x>        private OrderRepositoryInterface $repo  // Just a port!</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=x>    ) {}</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=x>}</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=x>// Solution: Want MongoDB? Create MongoOrderRepository implementing the interface!</span>
</span></code></pre></div> <p><strong>Why This Matters:</strong></p> <p>Just like you can use your mouse on any laptop (Windows, Mac, Linux) because they all have USB ports, your business logic works with any database (MySQL, MongoDB, Redis) because they all implement your port interfaces.</p> <p>You control the "USB standard" (interface), not the device manufacturers (infrastructure libraries).</p> <hr> <h3 id=231-dependency-direction>2.3.1 Dependency Direction<a class=headerlink href=#231-dependency-direction title="Permanent link">&para;</a></h3> <p><strong>Traditional (Dependencies flow DOWN):</strong></p> <pre class=mermaid><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'16px'}}}%%
graph TD
    A["üéÆ Controllers&lt;br/&gt;&lt;small&gt;UI Layer&lt;/small&gt;"]
    B["‚öôÔ∏è Services&lt;br/&gt;&lt;small&gt;Business Logic&lt;/small&gt;"]
    C["üíæ Infrastructure&lt;br/&gt;&lt;small&gt;Doctrine/Database&lt;/small&gt;"]

    A ==&gt;|"üå™Ô∏è depends on"| B
    B ==&gt;|"üå™Ô∏è depends on"| C

    style A fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#000
    style B fill:#FFF9C4,stroke:#F57C00,stroke-width:3px,color:#000
    style C fill:#FFCDD2,stroke:#C62828,stroke-width:3px,color:#000

    classDef problemArrow stroke:#C62828,stroke-width:3px</code></pre> <p><strong>Problem:</strong> Change database = rewrite business logic üå™Ô∏è</p> <p><strong>Hexagonal (Dependencies flow INWARD):</strong></p> <pre class=mermaid><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'16px'}}}%%
graph BT
    C["üîå Infrastructure&lt;br/&gt;&lt;small&gt;Doctrine/Database&lt;/small&gt;"]
    B["üîó Ports&lt;br/&gt;&lt;small&gt;Interfaces&lt;/small&gt;"]
    A["üíé Domain&lt;br/&gt;&lt;small&gt;Business Logic - CORE&lt;/small&gt;"]

    C -.-&gt;|"üéØ implements"| B
    B ==&gt;|"üéØ defined by"| A

    style A fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px,color:#000,rx:10,ry:10
    style B fill:#FFF9C4,stroke:#F9A825,stroke-width:3px,color:#000
    style C fill:#F8BBD0,stroke:#C2185B,stroke-width:3px,color:#000</code></pre> <p><strong>Solution:</strong> Change database = new adapter, business logic untouched üéØ</p> <h3 id=232-practical-implications>2.3.2 Practical Implications<a class=headerlink href=#232-practical-implications title="Permanent link">&para;</a></h3> <p><strong>Traditional:</strong> <code>Order</code> entity has Doctrine annotations. Remove Doctrine? Domain breaks. - üî¥ Like having a laptop with a hardwired Sony mouse - want a Logitech? Buy a new laptop!</p> <p><strong>Hexagonal:</strong> <code>Order</code> is pure PHP with business rules. Infrastructure adapts to it. Remove Doctrine? Create a new adapter. - üü¢ Like having a laptop with USB ports - want a different mouse? Just plug it in!</p> <p><strong>Key insight:</strong> Business logic doesn't know (and doesn't care) if data is stored in MySQL, MongoDB, Redis, or a text file. It defines WHAT it needs (interfaces/ports), and infrastructure provides HOW (adapters).</p> <p><strong>Back to the Laptop Analogy:</strong> - Your laptop doesn't have "Logitech mouse code" or "HP printer code" inside - It has generic USB port logic: "Accept anything that implements USB" - Similarly, your domain doesn't have "Doctrine code" or "MongoDB code" inside - It has generic port logic: "Accept anything that implements <code>OrderRepositoryInterface</code>"</p> <p><strong>The Freedom This Gives You:</strong> - üîÑ Switch databases like swapping USB devices - üß™ Test with in-memory storage (like testing laptop without plugging real devices) - üöÄ Deploy with different storage per environment (dev/staging/prod) - üîå Add new storage types without touching business logic</p> <hr> <h2 id=24-real-world-scenarios>2.4 Real-World Scenarios<a class=headerlink href=#24-real-world-scenarios title="Permanent link">&para;</a></h2> <h3 id=241-framework-update-symfony-4-to-7>2.4.1 Framework Update (Symfony 4 to 7)<a class=headerlink href=#241-framework-update-symfony-4-to-7 title="Permanent link">&para;</a></h3> <p><strong>Layered Architecture Impact:</strong> - Business services depend on Symfony APIs (TokenStorage, Session, etc.) - Framework APIs changed? Business logic needs rewriting - Risk: Breaking changes cascade through entire application - Time: Days to weeks fixing compatibility issues</p> <p><strong>Hexagonal Architecture Impact:</strong> - Business handlers depend only on your own interfaces - Framework APIs changed? Update adapters, handlers stay untouched - Risk: Isolated to infrastructure layer - Time: Hours updating specific adapters</p> <h3 id=242-testing-speed-comparison>2.4.2 Testing Speed Comparison<a class=headerlink href=#242-testing-speed-comparison title="Permanent link">&para;</a></h3> <p><strong>Layered Architecture Reality:</strong> - Boot Symfony kernel for every test - Connect to database, load fixtures - Run test with full I/O operations - <strong>Time per test:</strong> 2-3 seconds - <strong>Result:</strong> 100 tests = 5 minutes (developers skip tests)</p> <p><strong>Hexagonal Architecture Reality:</strong> - Instantiate handler with in-memory repository - Test pure PHP logic with zero I/O - <strong>Time per test:</strong> 0.001 seconds - <strong>Result:</strong> 1000 tests = 1 second (developers run tests constantly)</p> <p><strong>Impact:</strong> You can run 1000 hexagonal tests in the time layered runs 10 tests.</p> <p><strong>Laptop Analogy for Testing:</strong> - üî¥ <strong>Traditional</strong>: Testing laptop functionality requires plugging in real mouse, keyboard, printer, etc. - Takes forever to set up - Need physical devices for every test - If printer is broken, can't test laptop!</p> <ul> <li>üü¢ <strong>Hexagonal</strong>: Testing laptop functionality with "mock USB devices"</li> <li>Instant setup (no physical devices needed)</li> <li>Test laptop logic in isolation</li> <li>Real devices can be broken, laptop tests still pass!</li> </ul> <p>This is exactly what in-memory repositories do - they're "mock USB devices" for your tests!</p> <h3 id=243-lost-business-rules>2.4.3 Lost Business Rules<a class=headerlink href=#243-lost-business-rules title="Permanent link">&para;</a></h3> <p><strong>The Question:</strong> "Can we cancel a shipped order?"</p> <p><strong>Layered Architecture:</strong> Rule scattered across: - Controller (validation: <code>if ($status === 'shipped') return error;</code>) - Service (business logic with different check) - Template (UI hiding/showing cancel button with yet another condition) - Repository (queries filtering "cancelable" orders)</p> <p><strong>Result:</strong> 4 different implementations, slight variations, which one is correct? Nobody knows.</p> <p><strong>Hexagonal Architecture:</strong> One method in Domain: <div class="language-php highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=x>Order-&gt;cancel() throws exception if status is SHIPPED</span>
</span></code></pre></div></p> <p><strong>Result:</strong> ONE source of truth. Crystal clear. Impossible to miss.</p> <h3 id=244-adding-new-interface-graphql>2.4.4 Adding New Interface (GraphQL)<a class=headerlink href=#244-adding-new-interface-graphql title="Permanent link">&para;</a></h3> <p><strong>Layered Architecture Problem:</strong> - Business logic mixed in REST controllers - Want GraphQL? Must copy-paste logic - Result: Same business rules duplicated in 2+ places - Maintenance nightmare: change rule = update everywhere</p> <p><strong>Hexagonal Architecture Solution:</strong> - Business logic in handler (once) - REST controller dispatches command - GraphQL resolver dispatches same command - CLI command dispatches same command - Result: Write once, use everywhere</p> <p><strong>Laptop Analogy for Multiple Interfaces:</strong> - üî¥ <strong>Traditional</strong>: Want to use mouse with desktop, laptop, and tablet? - Need to buy 3 different mice (one for each device) - Each mouse has custom logic for its device - Update mouse firmware? Do it 3 times!</p> <ul> <li>üü¢ <strong>Hexagonal</strong>: One USB mouse works with ALL devices</li> <li>Same mouse plugs into desktop, laptop, tablet</li> <li>Mouse logic written once</li> <li>Update firmware once, works everywhere!</li> </ul> <p>Your business logic is the "mouse" - write it once, plug it into REST/GraphQL/CLI/gRPC!</p> <hr> <h2 id=25-benefits-comparison>2.5 Benefits Comparison<a class=headerlink href=#25-benefits-comparison title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Benefit</th> <th>Concrete Impact</th> <th>Time Saved</th> </tr> </thead> <tbody> <tr> <td><strong>Direction Control</strong></td> <td>Change database, framework, or any infrastructure without touching business logic</td> <td>Weeks to Days</td> </tr> <tr> <td><strong>Single Source of Truth</strong></td> <td>Business rules in ONE place (Domain), not scattered across 10 files</td> <td>50% less bugs</td> </tr> <tr> <td><strong>Lightning Tests</strong></td> <td>1000x faster (in-memory vs database I/O)</td> <td>10 min to 10 sec</td> </tr> <tr> <td><strong>Technology Freedom</strong></td> <td>Swap MySQL to MongoDB, Doctrine to Another ORM in days not months</td> <td>80% effort reduction</td> </tr> <tr> <td><strong>Reusability</strong></td> <td>Same business logic for REST, GraphQL, CLI, gRPC, message queue</td> <td>Write once, use everywhere</td> </tr> <tr> <td><strong>Team Scalability</strong></td> <td>Juniors on adapters (infrastructure), Seniors on domain (business)</td> <td>Clear separation of skill levels</td> </tr> <tr> <td><strong>Long-term Viability</strong></td> <td>Code survives framework updates, technology shifts, team changes</td> <td>10 years vs 10 months</td> </tr> </tbody> </table> <hr> <h2 id=26-cost-predictability-the-5-day-rule>2.6 Cost Predictability: The "5-Day Rule"<a class=headerlink href=#26-cost-predictability-the-5-day-rule title="Permanent link">&para;</a></h2> <p>In traditional layered architecture, components are tightly coupled. When you add feature "X" after two years into the project, you must navigate code where business logic is mixed with database concerns and framework dependencies. Each modification risks breaking hidden dependencies.</p> <h3 id=261-the-layered-architecture-fail>2.6.1 The Layered Architecture "Fail"<a class=headerlink href=#261-the-layered-architecture-fail title="Permanent link">&para;</a></h3> <p><strong>The Problem:</strong> Time spent is no longer dedicated to coding the feature itself, but to: - Doing archaeology in the codebase - Understanding tangled dependencies - Fixing side effects and cascading breakages - Working around technical debt accumulated over time</p> <p><strong>Real Impact:</strong> A feature that should take 5 days now takes 15 days because: - 3 days understanding existing code - 5 days implementing the feature - 7 days fixing broken tests and side effects</p> <h3 id=262-the-hexagonal-architecture-advantage>2.6.2 The Hexagonal Architecture Advantage<a class=headerlink href=#262-the-hexagonal-architecture-advantage title="Permanent link">&para;</a></h3> <p><strong>The Solution:</strong> Because the domain is isolated, adding business feature "X" happens in a protected environment (the core). Technical complexity (ports and adapters) is pushed to the periphery.</p> <p><strong>Result:</strong> Similar features always cost approximately <strong>5 days</strong>, because technical "friction" doesn't increase with business complexity growth.</p> <p><strong>Why This Works:</strong> - üì¶ <strong>Isolated Domain</strong>: Business logic lives in its own protected space - üîå <strong>Peripheral Complexity</strong>: Technical concerns stay at the edges - üìè <strong>Predictable Costs</strong>: No hidden dependencies to unravel - üéØ <strong>Focus</strong>: Developers code features, not fix technical debt</p> <h3 id=263-tests-the-safety-net-that-accelerates-development>2.6.3 Tests: The Safety Net That Accelerates Development<a class=headerlink href=#263-tests-the-safety-net-that-accelerates-development title="Permanent link">&para;</a></h3> <p>This is the most powerful technical argument for maintaining the 5-day velocity:</p> <p><strong>High-Fidelity, Fast Tests:</strong> - Write unit tests for your domain covering 100% of business rules - Never need to start a database or server - Tests run in milliseconds, not seconds</p> <p><strong>Immediate Feedback:</strong> - Developer knows in <strong>10 seconds</strong> if new feature "X" broke something - In traditional architecture, database-dependent tests are slow or skipped - Bugs discovered later cost <strong>10x-100x more</strong> to fix</p> <p><strong>Example:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=x>// üéØ Hexagonal: Test in 10ms</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=x>$handler = new PlaceOrderHandler(new InMemoryOrderRepository());</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=x>$result = $handler-&gt;handle($command);</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=x>$this-&gt;assertTrue($result-&gt;isSuccess());</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=x>// üå™Ô∏è Traditional: Test in 2-3 seconds</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=x>// - Boot Symfony kernel</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=x>// - Connect to database</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=x>// - Load fixtures</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=x>// - Execute test</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=x>// - Rollback transaction</span>
</span></code></pre></div></p> <h3 id=264-the-investment-vs-credit-analogy>2.6.4 The Investment vs. Credit Analogy<a class=headerlink href=#264-the-investment-vs-credit-analogy title="Permanent link">&para;</a></h3> <p><strong>Layered Architecture is Consumer Credit:</strong> - ‚ú® Easy and fast at the beginning - üí∏ But interest (technical debt) compounds - üîí Eventually, debt strangles you - üí∞ Every feature becomes exponentially more expensive</p> <p><strong>Hexagonal Architecture is Investment:</strong> - üí™ Pay a bit more upfront (learning curve, initial structure) - üìà Each future feature costs its <strong>real price</strong> - üö´ No additional complexity tax - üíé Value grows over time instead of degrading</p> <h3 id=265-the-long-term-math>2.6.5 The Long-Term Math<a class=headerlink href=#265-the-long-term-math title="Permanent link">&para;</a></h3> <p><strong>Year 1:</strong> Both architectures similar speed</p> <p><strong>Year 2:</strong> - Layered: Features take 2x longer (archaeology + side effects) - Hexagonal: Features still take baseline time</p> <p><strong>Year 3:</strong> - Layered: Features take 3-5x longer (massive technical debt) - Hexagonal: Features still take baseline time</p> <p><strong>Year 5:</strong> - Layered: Major refactoring or rewrite required - Hexagonal: Still delivering features at predictable pace</p> <p><strong>The "5-Day Rule" in Practice:</strong> - Traditional: "Similar" feature in Year 3 = 15-25 days - Hexagonal: "Similar" feature in Year 3 = 5-7 days - <strong>Savings:</strong> 10-20 days per feature √ó 50 features/year = 500-1000 days saved</p> <hr> <h2 id=27-database-migration-the-ultimate-test>2.7 Database Migration: The Ultimate Test<a class=headerlink href=#27-database-migration-the-ultimate-test title="Permanent link">&para;</a></h2> <p><strong>Challenge:</strong> Change from MySQL (Doctrine ORM) to MongoDB (Document Database)</p> <p><strong>Laptop Analogy:</strong> - üî¥ <strong>Traditional</strong>: Laptop hardwired to Sony mouse - want Logitech? Buy new laptop and reinstall all your software! - üü¢ <strong>Hexagonal</strong>: Laptop with USB port - want different mouse? Unplug Sony, plug Logitech. Laptop works instantly!</p> <p>This is database migration in a nutshell. Let's see the real impact:</p> <h3 id=layered-architecture-impact>Layered Architecture Impact:<a class=headerlink href=#layered-architecture-impact title="Permanent link">&para;</a></h3> <p><strong>What must change:</strong> 1. All Entities with <code>@ORM</code> annotations must be rewritten as documents 2. All Repositories using Doctrine API must be rewritten for MongoDB driver 3. All Services depending on EntityManager must refactor dependencies 4. All Tests with database fixtures must be rewritten for MongoDB 5. All Query Builder usage must be rewritten as MongoDB queries</p> <p><strong>Estimated effort:</strong> 2-4 weeks of full-team work <strong>Risk level:</strong> HIGH - touching 60-80% of codebase <strong>Regression probability:</strong> Very high - every query must be rewritten and retested</p> <h3 id=hexagonal-architecture-impact>Hexagonal Architecture Impact:<a class=headerlink href=#hexagonal-architecture-impact title="Permanent link">&para;</a></h3> <p><strong>What must change:</strong> 1. Create <code>MongoUserRepository implements UserRepositoryInterface</code> 2. Create <code>MongoOrderRepository implements OrderRepositoryInterface</code> 3. Update dependency injection configuration 4. Done.</p> <p><strong>What stays the same:</strong> - All Domain entities (pure PHP, no annotations) - All Application handlers (depend on interfaces, not implementations) - All Business rules (in Domain, framework-agnostic) - All Unit tests (use in-memory repositories)</p> <p><strong>Estimated effort:</strong> 1-2 days <strong>Risk level:</strong> LOW - only infrastructure adapters change <strong>Regression probability:</strong> Minimal - business logic untouched</p> <p><strong>The Math:</strong> Hexagonal saves you 10-20x the effort on technology changes.</p> <hr> <h2 id=28-decision-guide>2.8 Decision Guide<a class=headerlink href=#28-decision-guide title="Permanent link">&para;</a></h2> <h3 id=281-choose-hexagonal-architecture-when>2.8.1 Choose Hexagonal Architecture When:<a class=headerlink href=#281-choose-hexagonal-architecture-when title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Criterion</th> <th>Why It Matters</th> </tr> </thead> <tbody> <tr> <td><strong>Long-term project (&gt; 2 years)</strong></td> <td>Architecture ROI pays off over time as tech evolves</td> </tr> <tr> <td><strong>Growing team (&gt; 3 devs)</strong></td> <td>Clear boundaries help multiple developers work in parallel</td> </tr> <tr> <td><strong>Complex business rules</strong></td> <td>Need single source of truth for domain logic</td> </tr> <tr> <td><strong>Multiple interfaces</strong></td> <td>REST + GraphQL + CLI + Events = reusable handlers</td> </tr> <tr> <td><strong>Tech might change</strong></td> <td>Framework updates, database migrations, cloud migrations</td> </tr> <tr> <td><strong>Testing is critical</strong></td> <td>Fast, reliable tests enable continuous deployment</td> </tr> <tr> <td><strong>Enterprise/production</strong></td> <td>Business continuity requires technology independence</td> </tr> </tbody> </table> <h3 id=282-stick-with-simpler-architecture-when>2.8.2 Stick with Simpler Architecture When:<a class=headerlink href=#282-stick-with-simpler-architecture-when title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Situation</th> <th>Better Approach</th> </tr> </thead> <tbody> <tr> <td><strong>Quick prototype (&lt; 3 months)</strong></td> <td>Speed matters more than structure</td> </tr> <tr> <td><strong>Simple CRUD</strong></td> <td>Little to no business logic = overkill</td> </tr> <tr> <td><strong>Solo dev, tiny project</strong></td> <td>Overhead not justified</td> </tr> <tr> <td><strong>Stack 100% frozen</strong></td> <td>If you're SURE nothing will ever change (rarely true)</td> </tr> </tbody> </table> <h3 id=283-the-core-truth-about-decoupling>2.8.3 The Core Truth About Decoupling<a class=headerlink href=#283-the-core-truth-about-decoupling title="Permanent link">&para;</a></h3> <p><strong>What People Think Decoupling Means:</strong></p> <blockquote> <p>"My code doesn't depend on anything! Zero coupling!"</p> </blockquote> <p><strong>Reality:</strong> Impossible. Your code will always call other code. That's programming.</p> <p><strong>What Decoupling ACTUALLY Means:</strong></p> <blockquote> <p>"My business logic defines WHAT it needs (interfaces). Infrastructure provides HOW (implementations)."</p> </blockquote> <h4 id=the-fundamental-shift>The Fundamental Shift<a class=headerlink href=#the-fundamental-shift title="Permanent link">&para;</a></h4> <p><strong>Traditional Mindset:</strong></p> <pre class=mermaid><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'15px'}}}%%
graph LR
    A["ü§î What can we do with&lt;br/&gt;the tools we have?"]
    B["üîí Business logic limited&lt;br/&gt;by database capabilities"]
    C["üëÄ Rules adapt to&lt;br/&gt;framework constraints"]
    D["üå™Ô∏è Domain serves&lt;br/&gt;infrastructure"]

    A ==&gt; B ==&gt; C ==&gt; D

    style A fill:#FFEBEE,stroke:#C62828,stroke-width:3px,color:#000
    style B fill:#FFF3E0,stroke:#E65100,stroke-width:3px,color:#000
    style C fill:#FFF3E0,stroke:#E65100,stroke-width:3px,color:#000
    style D fill:#FFEBEE,stroke:#C62828,stroke-width:4px,color:#000</code></pre> <p><strong>Hexagonal Mindset:</strong></p> <pre class=mermaid><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'15px'}}}%%
graph LR
    A["üí° What does the&lt;br/&gt;business need?"]
    B["üìã Define domain&lt;br/&gt;rules first"]
    C["üîß Infrastructure adapts&lt;br/&gt;to serve those rules"]
    D["üéØ Infrastructure&lt;br/&gt;serves domain"]

    A ==&gt; B ==&gt; C ==&gt; D

    style A fill:#E8F5E9,stroke:#2E7D32,stroke-width:3px,color:#000
    style B fill:#E8F5E9,stroke:#2E7D32,stroke-width:3px,color:#000
    style C fill:#E1F5FE,stroke:#0277BD,stroke-width:3px,color:#000
    style D fill:#E8F5E9,stroke:#2E7D32,stroke-width:4px,color:#000</code></pre> <hr> <h2 id=29-summary>2.9 Summary<a class=headerlink href=#29-summary title="Permanent link">&para;</a></h2> <p><strong>Hexagonal architecture is not about:</strong> - Eliminating all coupling - Making code more complex - Following a trendy pattern</p> <p><strong>Hexagonal architecture IS about:</strong> - <strong>Direction Control:</strong> Your business logic depends on abstractions, infrastructure depends on your business - <strong>Stability:</strong> Business rules stable while technology changes around them - <strong>Clarity:</strong> One place for each business rule, impossible to miss - <strong>Freedom:</strong> Change tech stack in days, not months - <strong>Speed:</strong> Test suite runs in seconds, not minutes</p> <p><strong>The Question to Ask:</strong></p> <blockquote> <p>"If we need to change databases, frameworks, or add new interfaces next year, do I want to spend 2 weeks or 2 days?"</p> </blockquote> <p>If your answer is "2 days," hexagonal architecture is your solution.</p> <p><strong>Remember:</strong> The coupling doesn't go away. You're still calling repositories and services. What changes is <strong>who is in charge</strong>‚Äîyour business logic or your database.</p> <hr> <h2 id=210-hexagonal-architecture-core-design-principles>2.10 Hexagonal Architecture &amp; Core Design Principles<a class=headerlink href=#210-hexagonal-architecture-core-design-principles title="Permanent link">&para;</a></h2> <p>Hexagonal Architecture isn't just a pattern‚Äîit's the natural embodiment of fundamental software engineering principles. Here's how it adheres to and enforces the most important design principles:</p> <h3 id=2101-dry-dont-repeat-yourself>2.10.1 DRY (Don't Repeat Yourself)<a class=headerlink href=#2101-dry-dont-repeat-yourself title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Every piece of knowledge should have a single, unambiguous representation in your system.</p> <p><strong>How Hexagonal Enforces DRY:</strong></p> <p><strong>Traditional Layered Architecture - DRY Violations:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=x>// Controller</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=x>if ($order-&gt;getStatus() === &#39;shipped&#39;) {</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=x>    throw new Exception(&#39;Cannot cancel shipped order&#39;);</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=x>}</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=x>// Service</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=x>if ($order-&gt;getStatus() === &#39;shipped&#39;) {</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=x>    return false; // Same rule, different implementation</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=x>}</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=x>// Template</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=x>{% if order.status != &#39;shipped&#39; %}</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=x>    &lt;button&gt;Cancel&lt;/button&gt;  {# Same rule, third place #}</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=x>{% endif %}</span>
</span></code></pre></div></p> <p><strong>Hexagonal Architecture - Single Source of Truth:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=x>// Domain/Entity/Order.php - ONE place</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=x>public function cancel(): void</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=x>{</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=x>    if ($this-&gt;status-&gt;isShipped()) {</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=x>        throw new CannotCancelShippedOrder();</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=x>    }</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=x>    $this-&gt;status = OrderStatus::cancelled();</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=x>}</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=x>// Everywhere else just calls: $order-&gt;cancel()</span>
</span></code></pre></div></p> <p><strong>Impact:</strong> - Business rules written <strong>once</strong> in the Domain - Controllers, CLI commands, GraphQL resolvers all use the same logic - Change rule once, applies everywhere - No diverging implementations</p> <hr> <h3 id=2102-kiss-keep-it-simple-stupid>2.10.2 KISS (Keep It Simple, Stupid)<a class=headerlink href=#2102-kiss-keep-it-simple-stupid title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Simplicity should be a key goal; unnecessary complexity should be avoided.</p> <p><strong>How Hexagonal Enforces KISS:</strong></p> <p><strong>The Clarity:</strong> - Domain entities are <strong>pure PHP</strong> (no annotations, no framework magic) - Handlers do <strong>one thing</strong> (single responsibility) - Ports are <strong>simple interfaces</strong> (clear contracts) - Each layer has <strong>one purpose</strong> (no mixed concerns)</p> <p><strong>Example - Simple Domain Entity:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=x>// Simple, readable, no framework coupling</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=x>final class Order</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=x>{</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=x>    private OrderId $id;</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=x>    private OrderStatus $status;</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=x>    private Money $total;</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=x>    public function place(): void</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=x>    {</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=x>        if ($this-&gt;total-&gt;isZero()) {</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=x>            throw new EmptyOrderException();</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=x>        }</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=x>        $this-&gt;status = OrderStatus::placed();</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=x>    }</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>What Makes It KISS:</strong> - No annotations cluttering the code - No framework dependencies to understand - Pure business logic, nothing else - Junior developers can read and understand immediately</p> <p><strong>Contrast with Traditional:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=x>// Complex: ORM annotations, framework coupling, mixed concerns</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=x>/**</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=x> * @ORM\Entity(repositoryClass=&quot;OrderRepository&quot;)</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=x> * @ORM\Table(name=&quot;orders&quot;, indexes={...})</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=x> * @ORM\HasLifecycleCallbacks</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=x> */</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=x>class Order</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=x>{</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=x>    /** @ORM\Column(type=&quot;decimal&quot;, precision=10, scale=2) */</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=x>    private $total;</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=x>    /** @ORM\PrePersist */</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=x>    public function validate() { ... }</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=x>}</span>
</span></code></pre></div></p> <hr> <h3 id=2103-yagni-you-arent-gonna-need-it>2.10.3 YAGNI (You Aren't Gonna Need It)<a class=headerlink href=#2103-yagni-you-arent-gonna-need-it title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Don't add functionality until it's necessary.</p> <p><strong>How Hexagonal Enforces YAGNI:</strong></p> <p><strong>The Protection:</strong> Hexagonal architecture prevents over-engineering by forcing you to focus on <strong>what the business needs right now</strong>, not hypothetical future scenarios.</p> <p><strong>Example - Creating Exactly What You Need:</strong></p> <p><strong>Bad (YAGNI Violation):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=x>// Creating generic repository with 50 methods &quot;just in case&quot;</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=x>interface RepositoryInterface</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=x>{</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=x>    public function find($id);</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=x>    public function findAll();</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=x>    public function findBy(array $criteria);</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=x>    public function findOneBy(array $criteria);</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=x>    public function save($entity);</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=x>    public function remove($entity);</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=x>    public function count(array $criteria);</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=x>    public function paginate($page, $limit);</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=x>    // ... 42 more methods you don&#39;t use</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>Good (YAGNI Compliant - Hexagonal Way):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=x>// Only create methods you actually need TODAY</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=x>interface UserRepositoryInterface</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=x>{</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=x>    public function save(User $user): void;</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=x>    public function ofId(UserId $id): ?User;</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=x>    // That&#39;s it! Create new interfaces when needed.</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>How Hexagonal Helps:</strong> - Ports (interfaces) force you to define <strong>only what you need</strong> - Small, focused interfaces prevent premature generalization - Easy to add methods later when requirements emerge - No framework base classes forcing unused methods on you</p> <hr> <h3 id=2104-soc-separation-of-concerns>2.10.4 SoC (Separation of Concerns)<a class=headerlink href=#2104-soc-separation-of-concerns title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Different concerns should be handled by different parts of the system.</p> <p><strong>How Hexagonal Enforces SoC:</strong></p> <p>Hexagonal Architecture is <strong>fundamentally about SoC</strong>‚Äîit's built into the structure.</p> <p><strong>The Four Concerns, Clearly Separated:</strong></p> <table> <thead> <tr> <th>Concern</th> <th>Layer</th> <th>Responsibility</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><strong>Business Rules</strong></td> <td>Domain</td> <td>"What can/cannot happen?"</td> <td><code>Order-&gt;cancel()</code></td> </tr> <tr> <td><strong>Use Cases</strong></td> <td>Application</td> <td>"How to orchestrate?"</td> <td><code>PlaceOrderHandler</code></td> </tr> <tr> <td><strong>User Interface</strong></td> <td>UI</td> <td>"How to present/receive?"</td> <td><code>OrderController</code>, <code>CLI Command</code></td> </tr> <tr> <td><strong>External World</strong></td> <td>Infrastructure</td> <td>"How to persist/send?"</td> <td><code>DoctrineOrderRepository</code></td> </tr> </tbody> </table> <p><strong>Real Example:</strong></p> <p><strong>Traditional - Mixed Concerns:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=x>// Controller doing EVERYTHING (UI + Business + Infrastructure)</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=x>class OrderController</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=x>{</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=x>    public function cancel(Request $request, EntityManager $em)</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=x>    {</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=x>        // UI concern</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=x>        $orderId = $request-&gt;get(&#39;id&#39;);</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=x>        // Infrastructure concern</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=x>        $order = $em-&gt;getRepository(Order::class)-&gt;find($orderId);</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=x>        // Business concern</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=x>        if ($order-&gt;getStatus() === &#39;shipped&#39;) {</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=x>            throw new Exception(&#39;Cannot cancel&#39;);</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=x>        }</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=x>        $order-&gt;setStatus(&#39;cancelled&#39;);</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=x>        // Infrastructure concern</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=x>        $em-&gt;persist($order);</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=x>        $em-&gt;flush();</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=x>        // UI concern</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=x>        return new JsonResponse([&#39;success&#39; =&gt; true]);</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=x>    }</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>Hexagonal - Separated Concerns:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=x>// UI Layer - Only handles HTTP</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=x>class OrderController</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=x>{</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=x>    public function __construct(private MessageBusInterface $bus) {}</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=x>    public function cancel(Request $request): JsonResponse</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=x>    {</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=x>        $command = new CancelOrder($request-&gt;get(&#39;id&#39;));</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=x>        $this-&gt;bus-&gt;dispatch($command);</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=x>        return new JsonResponse([&#39;success&#39; =&gt; true]);</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=x>    }</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=x>}</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=x>// Application Layer - Orchestration</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=x>class CancelOrderHandler</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=x>{</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=x>    public function __construct(private OrderRepositoryInterface $orders) {}</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=x>    public function __invoke(CancelOrder $command): void</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=x>    {</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=x>        $order = $this-&gt;orders-&gt;ofId(new OrderId($command-&gt;orderId));</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=x>        $order-&gt;cancel(); // Business logic in Domain</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=x>        $this-&gt;orders-&gt;save($order);</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=x>    }</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=x>}</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=x>// Domain Layer - Business Rules</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=x>class Order</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=x>{</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=x>    public function cancel(): void</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class=x>    {</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=x>        if ($this-&gt;status-&gt;isShipped()) {</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=x>            throw new CannotCancelShippedOrder();</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=x>        }</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=x>        $this-&gt;status = OrderStatus::cancelled();</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class=x>    }</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a><span class=x>}</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=x>// Infrastructure Layer - Persistence</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a><span class=x>class DoctrineOrderRepository implements OrderRepositoryInterface</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a><span class=x>{</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a><span class=x>    public function save(Order $order): void { ... }</span>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a><span class=x>    public function ofId(OrderId $id): ?Order { ... }</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>The Benefits:</strong> - <strong>Change UI:</strong> Swap REST for GraphQL without touching business logic - <strong>Change Database:</strong> Swap MySQL for MongoDB without touching business logic - <strong>Change Business Rules:</strong> Modify domain without touching infrastructure or UI - <strong>Test in Isolation:</strong> Test each concern separately</p> <hr> <h3 id=2105-dependency-injection-di>2.10.5 Dependency Injection (DI)<a class=headerlink href=#2105-dependency-injection-di title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Depend on abstractions, not concretions. Inject dependencies rather than creating them.</p> <p><strong>How Hexagonal Enforces DI:</strong></p> <p>Hexagonal Architecture is <strong>fundamentally built on Dependency Injection</strong>‚Äîit's impossible to implement it without DI.</p> <p><strong>The Pattern:</strong> - Handlers depend on <strong>interfaces</strong> (ports), not concrete implementations - Dependencies are <strong>injected</strong> via constructor - Framework handles <strong>wiring</strong> via dependency injection container - <strong>Inversion of Control</strong> is mandatory, not optional</p> <p><strong>Example:</strong></p> <p><strong>Without DI (Tightly Coupled):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=x>// Handler creates its own dependencies - IMPOSSIBLE to test or swap</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=x>class PlaceOrderHandler</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=x>{</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=x>    public function __invoke(PlaceOrder $command): void</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=x>    {</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=x>        // Creating concrete implementation inside!</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=x>        $repository = new DoctrineOrderRepository();</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=x>        $emailer = new SmtpEmailSender();</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=x>        // Now stuck with Doctrine and SMTP forever</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=x>        $order = Order::create($command-&gt;userId, $command-&gt;items);</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=x>        $repository-&gt;save($order);</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=x>        $emailer-&gt;send($order-&gt;userEmail(), &#39;Order placed&#39;);</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=x>    }</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>With DI (Hexagonal Way):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=x>// Handler receives dependencies via constructor - testable and swappable</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=x>class PlaceOrderHandler</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=x>{</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=x>    public function __construct(</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=x>        private OrderRepositoryInterface $orders,      // Port (abstraction)</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=x>        private EmailSenderInterface $emailer          // Port (abstraction)</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=x>    ) {}</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=x>    public function __invoke(PlaceOrder $command): void</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=x>    {</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=x>        $order = Order::create($command-&gt;userId, $command-&gt;items);</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=x>        $this-&gt;orders-&gt;save($order);</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=x>        $this-&gt;emailer-&gt;send($order-&gt;userEmail(), &#39;Order placed&#39;);</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=x>    }</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=x>}</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=x>// In tests: inject in-memory implementations</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=x>// In production: inject Doctrine + SMTP</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=x>// In staging: inject Doctrine + SendGrid</span>
</span></code></pre></div></p> <p><strong>Why This Matters:</strong> - <strong>Testability:</strong> Inject in-memory fakes for lightning-fast tests - <strong>Flexibility:</strong> Swap implementations without changing handler code - <strong>Clarity:</strong> Dependencies are explicit in constructor - <strong>Framework Agnostic:</strong> Handler doesn't know about Symfony/Laravel/etc.</p> <hr> <h3 id=2106-factory-pattern>2.10.6 Factory Pattern<a class=headerlink href=#2106-factory-pattern title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Encapsulate complex object creation logic in dedicated factories.</p> <p><strong>How Hexagonal Promotes Factory Pattern:</strong></p> <p>Domain entities often have complex creation rules. Hexagonal Architecture promotes factories to keep entities clean and focused on business logic. <strong>Factories work hand-in-hand with the CQRS pattern</strong> - Command Handlers use factories to create entities from Commands, ensuring consistent object creation across all entry points (HTTP, CLI, GraphQL).</p> <p><strong>The Pattern:</strong> - <strong>Factory</strong> handles complex entity creation - <strong>Entity constructor</strong> stays simple (just assignment) - <strong>Business rules</strong> for creation live in factory - <strong>Validation</strong> happens during creation - <strong>CQRS integration:</strong> Command Handlers delegate creation to factories</p> <p><strong>Example:</strong></p> <p><strong>Without Factory (Entity Does Everything):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=x>// Entity constructor bloated with creation logic</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=x>class Order</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=x>{</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=x>    public function __construct(</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=x>        UserId $userId,</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=x>        array $items,</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=x>        ShippingAddress $address,</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=x>        PaymentMethod $payment</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=x>    ) {</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=x>        // Validation logic in constructor!</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=x>        if (empty($items)) {</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=x>            throw new EmptyOrderException();</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=x>        }</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=x>        // Business rules in constructor!</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=x>        if (count($items) &gt; 100) {</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=x>            throw new TooManyItemsException();</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=x>        }</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=x>        // Calculation in constructor!</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=x>        $this-&gt;total = $this-&gt;calculateTotal($items);</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=x>        $this-&gt;tax = $this-&gt;calculateTax($this-&gt;total, $address);</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=x>        // Assignment</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=x>        $this-&gt;id = OrderId::generate();</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=x>        $this-&gt;userId = $userId;</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=x>        $this-&gt;items = $items;</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=x>        // ...</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a><span class=x>    }</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>With Factory (Clean Separation):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=x>// Entity: Simple, focused on behavior</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=x>class Order</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=x>{</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=x>    private function __construct(</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=x>        private OrderId $id,</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=x>        private UserId $userId,</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=x>        private OrderItems $items,</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=x>        private Money $total,</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=x>        private OrderStatus $status</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=x>    ) {}</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=x>    // Behavior methods</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=x>    public function cancel(): void { ... }</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=x>    public function ship(): void { ... }</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=x>}</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=x>// Factory: Handles complex creation</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=x>class OrderFactory</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=x>{</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=x>    public function __construct(</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=x>        private TaxCalculator $taxCalculator,</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=x>        private DiscountCalculator $discountCalculator</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=x>    ) {}</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=x>    public function create(</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=x>        UserId $userId,</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=x>        array $rawItems,</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=x>        ShippingAddress $address,</span>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=x>        PaymentMethod $payment</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=x>    ): Order {</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=x>        // Validation</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=x>        if (empty($rawItems)) {</span>
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=x>            throw new EmptyOrderException();</span>
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=x>        }</span>
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a>
</span><span id=__span-14-36><a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=x>        // Complex construction logic</span>
</span><span id=__span-14-37><a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a><span class=x>        $items = OrderItems::fromArray($rawItems);</span>
</span><span id=__span-14-38><a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a><span class=x>        $subtotal = $items-&gt;calculateTotal();</span>
</span><span id=__span-14-39><a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a><span class=x>        $discount = $this-&gt;discountCalculator-&gt;calculate($userId, $subtotal);</span>
</span><span id=__span-14-40><a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a><span class=x>        $tax = $this-&gt;taxCalculator-&gt;calculate($subtotal, $address);</span>
</span><span id=__span-14-41><a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a><span class=x>        $total = $subtotal-&gt;subtract($discount)-&gt;add($tax);</span>
</span><span id=__span-14-42><a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a>
</span><span id=__span-14-43><a id=__codelineno-14-43 name=__codelineno-14-43 href=#__codelineno-14-43></a><span class=x>        // Clean creation</span>
</span><span id=__span-14-44><a id=__codelineno-14-44 name=__codelineno-14-44 href=#__codelineno-14-44></a><span class=x>        return new Order(</span>
</span><span id=__span-14-45><a id=__codelineno-14-45 name=__codelineno-14-45 href=#__codelineno-14-45></a><span class=x>            OrderId::generate(),</span>
</span><span id=__span-14-46><a id=__codelineno-14-46 name=__codelineno-14-46 href=#__codelineno-14-46></a><span class=x>            $userId,</span>
</span><span id=__span-14-47><a id=__codelineno-14-47 name=__codelineno-14-47 href=#__codelineno-14-47></a><span class=x>            $items,</span>
</span><span id=__span-14-48><a id=__codelineno-14-48 name=__codelineno-14-48 href=#__codelineno-14-48></a><span class=x>            $total,</span>
</span><span id=__span-14-49><a id=__codelineno-14-49 name=__codelineno-14-49 href=#__codelineno-14-49></a><span class=x>            OrderStatus::pending()</span>
</span><span id=__span-14-50><a id=__codelineno-14-50 name=__codelineno-14-50 href=#__codelineno-14-50></a><span class=x>        );</span>
</span><span id=__span-14-51><a id=__codelineno-14-51 name=__codelineno-14-51 href=#__codelineno-14-51></a><span class=x>    }</span>
</span><span id=__span-14-52><a id=__codelineno-14-52 name=__codelineno-14-52 href=#__codelineno-14-52></a><span class=x>}</span>
</span><span id=__span-14-53><a id=__codelineno-14-53 name=__codelineno-14-53 href=#__codelineno-14-53></a>
</span><span id=__span-14-54><a id=__codelineno-14-54 name=__codelineno-14-54 href=#__codelineno-14-54></a><span class=x>// Usage in handler</span>
</span><span id=__span-14-55><a id=__codelineno-14-55 name=__codelineno-14-55 href=#__codelineno-14-55></a><span class=x>class PlaceOrderHandler</span>
</span><span id=__span-14-56><a id=__codelineno-14-56 name=__codelineno-14-56 href=#__codelineno-14-56></a><span class=x>{</span>
</span><span id=__span-14-57><a id=__codelineno-14-57 name=__codelineno-14-57 href=#__codelineno-14-57></a><span class=x>    public function __construct(</span>
</span><span id=__span-14-58><a id=__codelineno-14-58 name=__codelineno-14-58 href=#__codelineno-14-58></a><span class=x>        private OrderFactory $factory,</span>
</span><span id=__span-14-59><a id=__codelineno-14-59 name=__codelineno-14-59 href=#__codelineno-14-59></a><span class=x>        private OrderRepositoryInterface $orders</span>
</span><span id=__span-14-60><a id=__codelineno-14-60 name=__codelineno-14-60 href=#__codelineno-14-60></a><span class=x>    ) {}</span>
</span><span id=__span-14-61><a id=__codelineno-14-61 name=__codelineno-14-61 href=#__codelineno-14-61></a>
</span><span id=__span-14-62><a id=__codelineno-14-62 name=__codelineno-14-62 href=#__codelineno-14-62></a><span class=x>    public function __invoke(PlaceOrder $command): void</span>
</span><span id=__span-14-63><a id=__codelineno-14-63 name=__codelineno-14-63 href=#__codelineno-14-63></a><span class=x>    {</span>
</span><span id=__span-14-64><a id=__codelineno-14-64 name=__codelineno-14-64 href=#__codelineno-14-64></a><span class=x>        $order = $this-&gt;factory-&gt;create(</span>
</span><span id=__span-14-65><a id=__codelineno-14-65 name=__codelineno-14-65 href=#__codelineno-14-65></a><span class=x>            $command-&gt;userId,</span>
</span><span id=__span-14-66><a id=__codelineno-14-66 name=__codelineno-14-66 href=#__codelineno-14-66></a><span class=x>            $command-&gt;items,</span>
</span><span id=__span-14-67><a id=__codelineno-14-67 name=__codelineno-14-67 href=#__codelineno-14-67></a><span class=x>            $command-&gt;address,</span>
</span><span id=__span-14-68><a id=__codelineno-14-68 name=__codelineno-14-68 href=#__codelineno-14-68></a><span class=x>            $command-&gt;payment</span>
</span><span id=__span-14-69><a id=__codelineno-14-69 name=__codelineno-14-69 href=#__codelineno-14-69></a><span class=x>        );</span>
</span><span id=__span-14-70><a id=__codelineno-14-70 name=__codelineno-14-70 href=#__codelineno-14-70></a>
</span><span id=__span-14-71><a id=__codelineno-14-71 name=__codelineno-14-71 href=#__codelineno-14-71></a><span class=x>        $this-&gt;orders-&gt;save($order);</span>
</span><span id=__span-14-72><a id=__codelineno-14-72 name=__codelineno-14-72 href=#__codelineno-14-72></a><span class=x>    }</span>
</span><span id=__span-14-73><a id=__codelineno-14-73 name=__codelineno-14-73 href=#__codelineno-14-73></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>Benefits:</strong> - <strong>Entity Stays Clean:</strong> Focused on business behavior, not creation - <strong>Testable Creation:</strong> Test factory logic independently - <strong>Reusable:</strong> Same factory used by multiple handlers - <strong>Complex Logic Isolated:</strong> Tax, discounts, validation in one place</p> <hr> <h3 id=2107-dto-pattern-data-transfer-objects>2.10.7 DTO Pattern (Data Transfer Objects)<a class=headerlink href=#2107-dto-pattern-data-transfer-objects title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Use simple data structures to transfer data between layers without coupling to business logic.</p> <p><strong>How Hexagonal Promotes DTOs:</strong></p> <p>Hexagonal Architecture uses DTOs extensively to maintain layer boundaries and prevent coupling.</p> <p><strong>The Three Main DTO Types:</strong></p> <p><strong>1. Commands &amp; Queries (Application Layer Input):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=x>// Command DTO - Input to write operations</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=x>final readonly class PlaceOrder</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=x>{</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=x>    public function __construct(</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=x>        public string $userId,</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=x>        public array $items,</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=x>        public string $shippingAddress,</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=x>        public string $paymentMethod</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=x>    ) {}</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=x>}</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=x>// Query DTO - Input to read operations</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=x>final readonly class FindOrderById</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=x>{</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=x>    public function __construct(</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=x>        public string $orderId</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=x>    ) {}</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>2. Response DTOs (Application Layer Output):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=x>// Response DTO - Output from queries</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=x>final readonly class OrderView</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=x>{</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=x>    public function __construct(</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=x>        public string $id,</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=x>        public string $status,</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=x>        public float $total,</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=x>        public array $items,</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=x>        public string $createdAt</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=x>    ) {}</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=x>    public static function fromEntity(Order $order): self</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=x>    {</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=x>        return new self(</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=x>            $order-&gt;id()-&gt;value(),</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=x>            $order-&gt;status()-&gt;value(),</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=x>            $order-&gt;total()-&gt;amount(),</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=x>            $order-&gt;items()-&gt;toArray(),</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=x>            $order-&gt;createdAt()-&gt;format(&#39;Y-m-d H:i:s&#39;)</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=x>        );</span>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=x>    }</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>3. Input DTOs (UI Layer to Application):</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=x>// Input DTO - From forms/API to commands</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=x>final readonly class CreateUserInput</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=x>{</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=x>    public function __construct(</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=x>        public string $email,</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=x>        public string $password,</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=x>        public string $firstName,</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=x>        public string $lastName</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=x>    ) {}</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=x>    public function toCommand(): RegisterUser</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=x>    {</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=x>        return new RegisterUser(</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=x>            $this-&gt;email,</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=x>            $this-&gt;password,</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=x>            $this-&gt;firstName,</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=x>            $this-&gt;lastName</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=x>        );</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=x>    }</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>Why DTOs Matter in Hexagonal:</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=x>// WITHOUT DTOs - Tight Coupling</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=x>class OrderController</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=x>{</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=x>    public function create(Request $request)</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=x>    {</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=x>        // Domain entity exposed to UI layer!</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=x>        $order = new Order(</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=x>            new UserId($request-&gt;get(&#39;user_id&#39;)),</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=x>            $request-&gt;get(&#39;items&#39;),</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=x>            // ...</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=x>        );</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=x>        // UI knows about domain internals - BAD!</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=x>    }</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=x>}</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=x>// WITH DTOs - Proper Decoupling</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=x>class OrderController</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=x>{</span>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=x>    public function __construct(private MessageBusInterface $bus) {}</span>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a>
</span><span id=__span-18-22><a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=x>    public function create(Request $request): JsonResponse</span>
</span><span id=__span-18-23><a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a><span class=x>    {</span>
</span><span id=__span-18-24><a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a><span class=x>        // DTO: Simple data structure</span>
</span><span id=__span-18-25><a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a><span class=x>        $command = new PlaceOrder(</span>
</span><span id=__span-18-26><a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a><span class=x>            $request-&gt;get(&#39;user_id&#39;),</span>
</span><span id=__span-18-27><a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a><span class=x>            $request-&gt;get(&#39;items&#39;),</span>
</span><span id=__span-18-28><a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a><span class=x>            $request-&gt;get(&#39;shipping_address&#39;),</span>
</span><span id=__span-18-29><a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a><span class=x>            $request-&gt;get(&#39;payment_method&#39;)</span>
</span><span id=__span-18-30><a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a><span class=x>        );</span>
</span><span id=__span-18-31><a id=__codelineno-18-31 name=__codelineno-18-31 href=#__codelineno-18-31></a>
</span><span id=__span-18-32><a id=__codelineno-18-32 name=__codelineno-18-32 href=#__codelineno-18-32></a><span class=x>        // Dispatch to application layer</span>
</span><span id=__span-18-33><a id=__codelineno-18-33 name=__codelineno-18-33 href=#__codelineno-18-33></a><span class=x>        $this-&gt;bus-&gt;dispatch($command);</span>
</span><span id=__span-18-34><a id=__codelineno-18-34 name=__codelineno-18-34 href=#__codelineno-18-34></a>
</span><span id=__span-18-35><a id=__codelineno-18-35 name=__codelineno-18-35 href=#__codelineno-18-35></a><span class=x>        return new JsonResponse([&#39;success&#39; =&gt; true]);</span>
</span><span id=__span-18-36><a id=__codelineno-18-36 name=__codelineno-18-36 href=#__codelineno-18-36></a><span class=x>    }</span>
</span><span id=__span-18-37><a id=__codelineno-18-37 name=__codelineno-18-37 href=#__codelineno-18-37></a><span class=x>}</span>
</span></code></pre></div> <p><strong>Benefits:</strong> - <strong>Layer Independence:</strong> UI doesn't know about Domain entities - <strong>Versioning:</strong> Change DTOs without breaking domain - <strong>Serialization:</strong> Easy to serialize/deserialize for APIs - <strong>Validation:</strong> Validate at boundaries before reaching domain - <strong>Documentation:</strong> DTOs serve as API contracts</p> <hr> <h3 id=2108-event-sourcing-pattern>2.10.8 Event Sourcing Pattern<a class=headerlink href=#2108-event-sourcing-pattern title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Store state changes as a sequence of events rather than current state.</p> <p><strong>How Hexagonal Promotes Event Sourcing:</strong></p> <p>Hexagonal Architecture's separation of concerns makes Event Sourcing a natural fit. Domain events are first-class citizens.</p> <p><strong>The Pattern:</strong> - <strong>Domain Events</strong> record what happened - <strong>Event Store</strong> persists event stream - <strong>Event Handlers</strong> react to events - <strong>Projections</strong> rebuild state from events</p> <p><strong>Example:</strong></p> <p><strong>Traditional State Storage:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=x>// Only current state stored</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=x>class Order</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=x>{</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=x>    private OrderStatus $status = OrderStatus::PENDING;</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=x>    public function place(): void</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=x>    {</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=x>        $this-&gt;status = OrderStatus::PLACED;</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=x>        // Lost: WHEN it was placed, WHO placed it</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=x>    }</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=x>    public function ship(): void</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=x>    {</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=x>        $this-&gt;status = OrderStatus::SHIPPED;</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=x>        // Lost: WHEN it shipped, tracking number, carrier</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=x>    }</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=x>}</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=x>// Database stores: { status: &quot;SHIPPED&quot; }</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=x>// History lost forever!</span>
</span></code></pre></div></p> <p><strong>Event Sourcing in Hexagonal:</strong> <div class="language-php highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=x>// Domain Event (immutable DTO)</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=x>final readonly class OrderPlaced</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=x>{</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=x>    public function __construct(</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=x>        public OrderId $orderId,</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=x>        public UserId $userId,</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=x>        public Money $total,</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=x>        public DateTimeImmutable $occurredAt</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=x>    ) {}</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=x>}</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=x>final readonly class OrderShipped</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=x>{</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=x>    public function __construct(</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=x>        public OrderId $orderId,</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=x>        public string $trackingNumber,</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=x>        public string $carrier,</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=x>        public DateTimeImmutable $occurredAt</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=x>    ) {}</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=x>}</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=x>// Entity that emits events</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=x>class Order</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=x>{</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=x>    private array $recordedEvents = [];</span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=x>    private OrderStatus $status;</span>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a>
</span><span id=__span-20-28><a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=x>    public function place(): void</span>
</span><span id=__span-20-29><a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=x>    {</span>
</span><span id=__span-20-30><a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=x>        if (!$this-&gt;status-&gt;isPending()) {</span>
</span><span id=__span-20-31><a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=x>            throw new OrderAlreadyPlacedException();</span>
</span><span id=__span-20-32><a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=x>        }</span>
</span><span id=__span-20-33><a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a>
</span><span id=__span-20-34><a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=x>        $this-&gt;status = OrderStatus::placed();</span>
</span><span id=__span-20-35><a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a>
</span><span id=__span-20-36><a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a><span class=x>        // Record what happened</span>
</span><span id=__span-20-37><a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a><span class=x>        $this-&gt;recordedEvents[] = new OrderPlaced(</span>
</span><span id=__span-20-38><a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a><span class=x>            $this-&gt;id,</span>
</span><span id=__span-20-39><a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=x>            $this-&gt;userId,</span>
</span><span id=__span-20-40><a id=__codelineno-20-40 name=__codelineno-20-40 href=#__codelineno-20-40></a><span class=x>            $this-&gt;total,</span>
</span><span id=__span-20-41><a id=__codelineno-20-41 name=__codelineno-20-41 href=#__codelineno-20-41></a><span class=x>            new DateTimeImmutable()</span>
</span><span id=__span-20-42><a id=__codelineno-20-42 name=__codelineno-20-42 href=#__codelineno-20-42></a><span class=x>        );</span>
</span><span id=__span-20-43><a id=__codelineno-20-43 name=__codelineno-20-43 href=#__codelineno-20-43></a><span class=x>    }</span>
</span><span id=__span-20-44><a id=__codelineno-20-44 name=__codelineno-20-44 href=#__codelineno-20-44></a>
</span><span id=__span-20-45><a id=__codelineno-20-45 name=__codelineno-20-45 href=#__codelineno-20-45></a><span class=x>    public function ship(string $trackingNumber, string $carrier): void</span>
</span><span id=__span-20-46><a id=__codelineno-20-46 name=__codelineno-20-46 href=#__codelineno-20-46></a><span class=x>    {</span>
</span><span id=__span-20-47><a id=__codelineno-20-47 name=__codelineno-20-47 href=#__codelineno-20-47></a><span class=x>        if (!$this-&gt;status-&gt;isPlaced()) {</span>
</span><span id=__span-20-48><a id=__codelineno-20-48 name=__codelineno-20-48 href=#__codelineno-20-48></a><span class=x>            throw new CannotShipUnplacedOrderException();</span>
</span><span id=__span-20-49><a id=__codelineno-20-49 name=__codelineno-20-49 href=#__codelineno-20-49></a><span class=x>        }</span>
</span><span id=__span-20-50><a id=__codelineno-20-50 name=__codelineno-20-50 href=#__codelineno-20-50></a>
</span><span id=__span-20-51><a id=__codelineno-20-51 name=__codelineno-20-51 href=#__codelineno-20-51></a><span class=x>        $this-&gt;status = OrderStatus::shipped();</span>
</span><span id=__span-20-52><a id=__codelineno-20-52 name=__codelineno-20-52 href=#__codelineno-20-52></a>
</span><span id=__span-20-53><a id=__codelineno-20-53 name=__codelineno-20-53 href=#__codelineno-20-53></a><span class=x>        // Record what happened</span>
</span><span id=__span-20-54><a id=__codelineno-20-54 name=__codelineno-20-54 href=#__codelineno-20-54></a><span class=x>        $this-&gt;recordedEvents[] = new OrderShipped(</span>
</span><span id=__span-20-55><a id=__codelineno-20-55 name=__codelineno-20-55 href=#__codelineno-20-55></a><span class=x>            $this-&gt;id,</span>
</span><span id=__span-20-56><a id=__codelineno-20-56 name=__codelineno-20-56 href=#__codelineno-20-56></a><span class=x>            $trackingNumber,</span>
</span><span id=__span-20-57><a id=__codelineno-20-57 name=__codelineno-20-57 href=#__codelineno-20-57></a><span class=x>            $carrier,</span>
</span><span id=__span-20-58><a id=__codelineno-20-58 name=__codelineno-20-58 href=#__codelineno-20-58></a><span class=x>            new DateTimeImmutable()</span>
</span><span id=__span-20-59><a id=__codelineno-20-59 name=__codelineno-20-59 href=#__codelineno-20-59></a><span class=x>        );</span>
</span><span id=__span-20-60><a id=__codelineno-20-60 name=__codelineno-20-60 href=#__codelineno-20-60></a><span class=x>    }</span>
</span><span id=__span-20-61><a id=__codelineno-20-61 name=__codelineno-20-61 href=#__codelineno-20-61></a>
</span><span id=__span-20-62><a id=__codelineno-20-62 name=__codelineno-20-62 href=#__codelineno-20-62></a><span class=x>    public function pullEvents(): array</span>
</span><span id=__span-20-63><a id=__codelineno-20-63 name=__codelineno-20-63 href=#__codelineno-20-63></a><span class=x>    {</span>
</span><span id=__span-20-64><a id=__codelineno-20-64 name=__codelineno-20-64 href=#__codelineno-20-64></a><span class=x>        $events = $this-&gt;recordedEvents;</span>
</span><span id=__span-20-65><a id=__codelineno-20-65 name=__codelineno-20-65 href=#__codelineno-20-65></a><span class=x>        $this-&gt;recordedEvents = [];</span>
</span><span id=__span-20-66><a id=__codelineno-20-66 name=__codelineno-20-66 href=#__codelineno-20-66></a><span class=x>        return $events;</span>
</span><span id=__span-20-67><a id=__codelineno-20-67 name=__codelineno-20-67 href=#__codelineno-20-67></a><span class=x>    }</span>
</span><span id=__span-20-68><a id=__codelineno-20-68 name=__codelineno-20-68 href=#__codelineno-20-68></a><span class=x>}</span>
</span><span id=__span-20-69><a id=__codelineno-20-69 name=__codelineno-20-69 href=#__codelineno-20-69></a>
</span><span id=__span-20-70><a id=__codelineno-20-70 name=__codelineno-20-70 href=#__codelineno-20-70></a><span class=x>// Handler publishes events</span>
</span><span id=__span-20-71><a id=__codelineno-20-71 name=__codelineno-20-71 href=#__codelineno-20-71></a><span class=x>class PlaceOrderHandler</span>
</span><span id=__span-20-72><a id=__codelineno-20-72 name=__codelineno-20-72 href=#__codelineno-20-72></a><span class=x>{</span>
</span><span id=__span-20-73><a id=__codelineno-20-73 name=__codelineno-20-73 href=#__codelineno-20-73></a><span class=x>    public function __construct(</span>
</span><span id=__span-20-74><a id=__codelineno-20-74 name=__codelineno-20-74 href=#__codelineno-20-74></a><span class=x>        private OrderRepositoryInterface $orders,</span>
</span><span id=__span-20-75><a id=__codelineno-20-75 name=__codelineno-20-75 href=#__codelineno-20-75></a><span class=x>        private EventBusInterface $eventBus</span>
</span><span id=__span-20-76><a id=__codelineno-20-76 name=__codelineno-20-76 href=#__codelineno-20-76></a><span class=x>    ) {}</span>
</span><span id=__span-20-77><a id=__codelineno-20-77 name=__codelineno-20-77 href=#__codelineno-20-77></a>
</span><span id=__span-20-78><a id=__codelineno-20-78 name=__codelineno-20-78 href=#__codelineno-20-78></a><span class=x>    public function __invoke(PlaceOrder $command): void</span>
</span><span id=__span-20-79><a id=__codelineno-20-79 name=__codelineno-20-79 href=#__codelineno-20-79></a><span class=x>    {</span>
</span><span id=__span-20-80><a id=__codelineno-20-80 name=__codelineno-20-80 href=#__codelineno-20-80></a><span class=x>        $order = Order::create($command-&gt;userId, $command-&gt;items);</span>
</span><span id=__span-20-81><a id=__codelineno-20-81 name=__codelineno-20-81 href=#__codelineno-20-81></a><span class=x>        $order-&gt;place();</span>
</span><span id=__span-20-82><a id=__codelineno-20-82 name=__codelineno-20-82 href=#__codelineno-20-82></a>
</span><span id=__span-20-83><a id=__codelineno-20-83 name=__codelineno-20-83 href=#__codelineno-20-83></a><span class=x>        $this-&gt;orders-&gt;save($order);</span>
</span><span id=__span-20-84><a id=__codelineno-20-84 name=__codelineno-20-84 href=#__codelineno-20-84></a>
</span><span id=__span-20-85><a id=__codelineno-20-85 name=__codelineno-20-85 href=#__codelineno-20-85></a><span class=x>        // Publish all domain events</span>
</span><span id=__span-20-86><a id=__codelineno-20-86 name=__codelineno-20-86 href=#__codelineno-20-86></a><span class=x>        foreach ($order-&gt;pullEvents() as $event) {</span>
</span><span id=__span-20-87><a id=__codelineno-20-87 name=__codelineno-20-87 href=#__codelineno-20-87></a><span class=x>            $this-&gt;eventBus-&gt;publish($event);</span>
</span><span id=__span-20-88><a id=__codelineno-20-88 name=__codelineno-20-88 href=#__codelineno-20-88></a><span class=x>        }</span>
</span><span id=__span-20-89><a id=__codelineno-20-89 name=__codelineno-20-89 href=#__codelineno-20-89></a><span class=x>    }</span>
</span><span id=__span-20-90><a id=__codelineno-20-90 name=__codelineno-20-90 href=#__codelineno-20-90></a><span class=x>}</span>
</span><span id=__span-20-91><a id=__codelineno-20-91 name=__codelineno-20-91 href=#__codelineno-20-91></a>
</span><span id=__span-20-92><a id=__codelineno-20-92 name=__codelineno-20-92 href=#__codelineno-20-92></a><span class=x>// Event Subscriber reacts to events</span>
</span><span id=__span-20-93><a id=__codelineno-20-93 name=__codelineno-20-93 href=#__codelineno-20-93></a><span class=x>class SendOrderConfirmationEmail</span>
</span><span id=__span-20-94><a id=__codelineno-20-94 name=__codelineno-20-94 href=#__codelineno-20-94></a><span class=x>{</span>
</span><span id=__span-20-95><a id=__codelineno-20-95 name=__codelineno-20-95 href=#__codelineno-20-95></a><span class=x>    public function __construct(private EmailSenderInterface $emailer) {}</span>
</span><span id=__span-20-96><a id=__codelineno-20-96 name=__codelineno-20-96 href=#__codelineno-20-96></a>
</span><span id=__span-20-97><a id=__codelineno-20-97 name=__codelineno-20-97 href=#__codelineno-20-97></a><span class=x>    public function __invoke(OrderPlaced $event): void</span>
</span><span id=__span-20-98><a id=__codelineno-20-98 name=__codelineno-20-98 href=#__codelineno-20-98></a><span class=x>    {</span>
</span><span id=__span-20-99><a id=__codelineno-20-99 name=__codelineno-20-99 href=#__codelineno-20-99></a><span class=x>        $this-&gt;emailer-&gt;send(</span>
</span><span id=__span-20-100><a id=__codelineno-20-100 name=__codelineno-20-100 href=#__codelineno-20-100></a><span class=x>            $event-&gt;userId,</span>
</span><span id=__span-20-101><a id=__codelineno-20-101 name=__codelineno-20-101 href=#__codelineno-20-101></a><span class=x>            &#39;Order Confirmation&#39;,</span>
</span><span id=__span-20-102><a id=__codelineno-20-102 name=__codelineno-20-102 href=#__codelineno-20-102></a><span class=x>            &quot;Your order #{$event-&gt;orderId-&gt;value()} has been placed!&quot;</span>
</span><span id=__span-20-103><a id=__codelineno-20-103 name=__codelineno-20-103 href=#__codelineno-20-103></a><span class=x>        );</span>
</span><span id=__span-20-104><a id=__codelineno-20-104 name=__codelineno-20-104 href=#__codelineno-20-104></a><span class=x>    }</span>
</span><span id=__span-20-105><a id=__codelineno-20-105 name=__codelineno-20-105 href=#__codelineno-20-105></a><span class=x>}</span>
</span><span id=__span-20-106><a id=__codelineno-20-106 name=__codelineno-20-106 href=#__codelineno-20-106></a>
</span><span id=__span-20-107><a id=__codelineno-20-107 name=__codelineno-20-107 href=#__codelineno-20-107></a><span class=x>// Event Store (if doing full event sourcing)</span>
</span><span id=__span-20-108><a id=__codelineno-20-108 name=__codelineno-20-108 href=#__codelineno-20-108></a><span class=x>interface EventStoreInterface</span>
</span><span id=__span-20-109><a id=__codelineno-20-109 name=__codelineno-20-109 href=#__codelineno-20-109></a><span class=x>{</span>
</span><span id=__span-20-110><a id=__codelineno-20-110 name=__codelineno-20-110 href=#__codelineno-20-110></a><span class=x>    public function append(OrderId $orderId, array $events): void;</span>
</span><span id=__span-20-111><a id=__codelineno-20-111 name=__codelineno-20-111 href=#__codelineno-20-111></a><span class=x>    public function loadEvents(OrderId $orderId): array;</span>
</span><span id=__span-20-112><a id=__codelineno-20-112 name=__codelineno-20-112 href=#__codelineno-20-112></a><span class=x>}</span>
</span><span id=__span-20-113><a id=__codelineno-20-113 name=__codelineno-20-113 href=#__codelineno-20-113></a>
</span><span id=__span-20-114><a id=__codelineno-20-114 name=__codelineno-20-114 href=#__codelineno-20-114></a><span class=x>// Rebuild entity from events</span>
</span><span id=__span-20-115><a id=__codelineno-20-115 name=__codelineno-20-115 href=#__codelineno-20-115></a><span class=x>class OrderEventSourcedRepository implements OrderRepositoryInterface</span>
</span><span id=__span-20-116><a id=__codelineno-20-116 name=__codelineno-20-116 href=#__codelineno-20-116></a><span class=x>{</span>
</span><span id=__span-20-117><a id=__codelineno-20-117 name=__codelineno-20-117 href=#__codelineno-20-117></a><span class=x>    public function __construct(private EventStoreInterface $eventStore) {}</span>
</span><span id=__span-20-118><a id=__codelineno-20-118 name=__codelineno-20-118 href=#__codelineno-20-118></a>
</span><span id=__span-20-119><a id=__codelineno-20-119 name=__codelineno-20-119 href=#__codelineno-20-119></a><span class=x>    public function ofId(OrderId $id): ?Order</span>
</span><span id=__span-20-120><a id=__codelineno-20-120 name=__codelineno-20-120 href=#__codelineno-20-120></a><span class=x>    {</span>
</span><span id=__span-20-121><a id=__codelineno-20-121 name=__codelineno-20-121 href=#__codelineno-20-121></a><span class=x>        $events = $this-&gt;eventStore-&gt;loadEvents($id);</span>
</span><span id=__span-20-122><a id=__codelineno-20-122 name=__codelineno-20-122 href=#__codelineno-20-122></a>
</span><span id=__span-20-123><a id=__codelineno-20-123 name=__codelineno-20-123 href=#__codelineno-20-123></a><span class=x>        if (empty($events)) {</span>
</span><span id=__span-20-124><a id=__codelineno-20-124 name=__codelineno-20-124 href=#__codelineno-20-124></a><span class=x>            return null;</span>
</span><span id=__span-20-125><a id=__codelineno-20-125 name=__codelineno-20-125 href=#__codelineno-20-125></a><span class=x>        }</span>
</span><span id=__span-20-126><a id=__codelineno-20-126 name=__codelineno-20-126 href=#__codelineno-20-126></a>
</span><span id=__span-20-127><a id=__codelineno-20-127 name=__codelineno-20-127 href=#__codelineno-20-127></a><span class=x>        // Replay events to rebuild state</span>
</span><span id=__span-20-128><a id=__codelineno-20-128 name=__codelineno-20-128 href=#__codelineno-20-128></a><span class=x>        return Order::fromEvents($events);</span>
</span><span id=__span-20-129><a id=__codelineno-20-129 name=__codelineno-20-129 href=#__codelineno-20-129></a><span class=x>    }</span>
</span><span id=__span-20-130><a id=__codelineno-20-130 name=__codelineno-20-130 href=#__codelineno-20-130></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>Why Event Sourcing Fits Hexagonal:</strong></p> <table> <thead> <tr> <th>Hexagonal Concept</th> <th>Event Sourcing Benefit</th> </tr> </thead> <tbody> <tr> <td><strong>Domain Events</strong></td> <td>Natural part of domain model</td> </tr> <tr> <td><strong>Ports</strong></td> <td>Easy to swap event store implementations</td> </tr> <tr> <td><strong>Adapters</strong></td> <td>Event subscribers in infrastructure layer</td> </tr> <tr> <td><strong>SoC</strong></td> <td>Events separate "what happened" from "what to do"</td> </tr> <tr> <td><strong>Testability</strong></td> <td>Test event emission without infrastructure</td> </tr> </tbody> </table> <p><strong>Benefits:</strong> - <strong>Complete Audit Trail:</strong> Know WHEN, WHO, WHAT for everything - <strong>Time Travel:</strong> Reconstruct state at any point in time - <strong>Business Intelligence:</strong> Analyze event streams for insights - <strong>Debugging:</strong> Replay events to reproduce bugs - <strong>CQRS Ready:</strong> Events naturally separate writes from reads</p> <hr> <h3 id=2109-strategy-pattern>2.10.9 Strategy Pattern<a class=headerlink href=#2109-strategy-pattern title="Permanent link">&para;</a></h3> <p><strong>The Principle:</strong> Define a family of algorithms, encapsulate each one, and make them interchangeable.</p> <p><strong>How Hexagonal Promotes Strategy Pattern:</strong></p> <p>Hexagonal Architecture's use of ports (interfaces) is essentially the Strategy pattern at the architectural level. Every port is a strategy contract.</p> <p><strong>The Pattern:</strong> - <strong>Port Interface</strong> defines the strategy contract - <strong>Multiple Adapters</strong> implement different strategies - <strong>Dependency Injection</strong> selects which strategy to use - <strong>Runtime Switching</strong> possible via configuration or business logic</p> <p><strong>Example 1: Payment Processing Strategies</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=x>// Port - Strategy Interface</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=x>interface PaymentProcessorInterface</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=x>{</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=x>    public function charge(Money $amount, PaymentDetails $details): PaymentResult;</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=x>    public function refund(TransactionId $transactionId, Money $amount): RefundResult;</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=x>}</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=x>// Strategy 1: Stripe Adapter</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=x>class StripePaymentProcessor implements PaymentProcessorInterface</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=x>{</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=x>    public function __construct(private StripeClient $client) {}</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=x>    public function charge(Money $amount, PaymentDetails $details): PaymentResult</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=x>    {</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=x>        $charge = $this-&gt;client-&gt;charges-&gt;create([</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=x>            &#39;amount&#39; =&gt; $amount-&gt;cents(),</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=x>            &#39;currency&#39; =&gt; $amount-&gt;currency(),</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=x>            &#39;source&#39; =&gt; $details-&gt;token()</span>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=x>        ]);</span>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=x>        return PaymentResult::success($charge-&gt;id);</span>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=x>    }</span>
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>
</span><span id=__span-21-24><a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a><span class=x>    public function refund(TransactionId $transactionId, Money $amount): RefundResult</span>
</span><span id=__span-21-25><a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a><span class=x>    {</span>
</span><span id=__span-21-26><a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a><span class=x>        // Stripe-specific refund logic</span>
</span><span id=__span-21-27><a id=__codelineno-21-27 name=__codelineno-21-27 href=#__codelineno-21-27></a><span class=x>    }</span>
</span><span id=__span-21-28><a id=__codelineno-21-28 name=__codelineno-21-28 href=#__codelineno-21-28></a><span class=x>}</span>
</span><span id=__span-21-29><a id=__codelineno-21-29 name=__codelineno-21-29 href=#__codelineno-21-29></a>
</span><span id=__span-21-30><a id=__codelineno-21-30 name=__codelineno-21-30 href=#__codelineno-21-30></a><span class=x>// Strategy 2: PayPal Adapter</span>
</span><span id=__span-21-31><a id=__codelineno-21-31 name=__codelineno-21-31 href=#__codelineno-21-31></a><span class=x>class PayPalPaymentProcessor implements PaymentProcessorInterface</span>
</span><span id=__span-21-32><a id=__codelineno-21-32 name=__codelineno-21-32 href=#__codelineno-21-32></a><span class=x>{</span>
</span><span id=__span-21-33><a id=__codelineno-21-33 name=__codelineno-21-33 href=#__codelineno-21-33></a><span class=x>    public function __construct(private PayPalClient $client) {}</span>
</span><span id=__span-21-34><a id=__codelineno-21-34 name=__codelineno-21-34 href=#__codelineno-21-34></a>
</span><span id=__span-21-35><a id=__codelineno-21-35 name=__codelineno-21-35 href=#__codelineno-21-35></a><span class=x>    public function charge(Money $amount, PaymentDetails $details): PaymentResult</span>
</span><span id=__span-21-36><a id=__codelineno-21-36 name=__codelineno-21-36 href=#__codelineno-21-36></a><span class=x>    {</span>
</span><span id=__span-21-37><a id=__codelineno-21-37 name=__codelineno-21-37 href=#__codelineno-21-37></a><span class=x>        $payment = $this-&gt;client-&gt;createPayment([</span>
</span><span id=__span-21-38><a id=__codelineno-21-38 name=__codelineno-21-38 href=#__codelineno-21-38></a><span class=x>            &#39;amount&#39; =&gt; $amount-&gt;cents(),</span>
</span><span id=__span-21-39><a id=__codelineno-21-39 name=__codelineno-21-39 href=#__codelineno-21-39></a><span class=x>            &#39;currency_code&#39; =&gt; $amount-&gt;currency(),</span>
</span><span id=__span-21-40><a id=__codelineno-21-40 name=__codelineno-21-40 href=#__codelineno-21-40></a><span class=x>            &#39;payment_method_token&#39; =&gt; $details-&gt;token()</span>
</span><span id=__span-21-41><a id=__codelineno-21-41 name=__codelineno-21-41 href=#__codelineno-21-41></a><span class=x>        ]);</span>
</span><span id=__span-21-42><a id=__codelineno-21-42 name=__codelineno-21-42 href=#__codelineno-21-42></a>
</span><span id=__span-21-43><a id=__codelineno-21-43 name=__codelineno-21-43 href=#__codelineno-21-43></a><span class=x>        return PaymentResult::success($payment-&gt;id);</span>
</span><span id=__span-21-44><a id=__codelineno-21-44 name=__codelineno-21-44 href=#__codelineno-21-44></a><span class=x>    }</span>
</span><span id=__span-21-45><a id=__codelineno-21-45 name=__codelineno-21-45 href=#__codelineno-21-45></a>
</span><span id=__span-21-46><a id=__codelineno-21-46 name=__codelineno-21-46 href=#__codelineno-21-46></a><span class=x>    public function refund(TransactionId $transactionId, Money $amount): RefundResult</span>
</span><span id=__span-21-47><a id=__codelineno-21-47 name=__codelineno-21-47 href=#__codelineno-21-47></a><span class=x>    {</span>
</span><span id=__span-21-48><a id=__codelineno-21-48 name=__codelineno-21-48 href=#__codelineno-21-48></a><span class=x>        // PayPal-specific refund logic</span>
</span><span id=__span-21-49><a id=__codelineno-21-49 name=__codelineno-21-49 href=#__codelineno-21-49></a><span class=x>    }</span>
</span><span id=__span-21-50><a id=__codelineno-21-50 name=__codelineno-21-50 href=#__codelineno-21-50></a><span class=x>}</span>
</span><span id=__span-21-51><a id=__codelineno-21-51 name=__codelineno-21-51 href=#__codelineno-21-51></a>
</span><span id=__span-21-52><a id=__codelineno-21-52 name=__codelineno-21-52 href=#__codelineno-21-52></a><span class=x>// Strategy 3: Test/Mock Adapter</span>
</span><span id=__span-21-53><a id=__codelineno-21-53 name=__codelineno-21-53 href=#__codelineno-21-53></a><span class=x>class InMemoryPaymentProcessor implements PaymentProcessorInterface</span>
</span><span id=__span-21-54><a id=__codelineno-21-54 name=__codelineno-21-54 href=#__codelineno-21-54></a><span class=x>{</span>
</span><span id=__span-21-55><a id=__codelineno-21-55 name=__codelineno-21-55 href=#__codelineno-21-55></a><span class=x>    private array $transactions = [];</span>
</span><span id=__span-21-56><a id=__codelineno-21-56 name=__codelineno-21-56 href=#__codelineno-21-56></a>
</span><span id=__span-21-57><a id=__codelineno-21-57 name=__codelineno-21-57 href=#__codelineno-21-57></a><span class=x>    public function charge(Money $amount, PaymentDetails $details): PaymentResult</span>
</span><span id=__span-21-58><a id=__codelineno-21-58 name=__codelineno-21-58 href=#__codelineno-21-58></a><span class=x>    {</span>
</span><span id=__span-21-59><a id=__codelineno-21-59 name=__codelineno-21-59 href=#__codelineno-21-59></a><span class=x>        $id = uniqid(&#39;txn_&#39;);</span>
</span><span id=__span-21-60><a id=__codelineno-21-60 name=__codelineno-21-60 href=#__codelineno-21-60></a><span class=x>        $this-&gt;transactions[$id] = [&#39;amount&#39; =&gt; $amount, &#39;status&#39; =&gt; &#39;charged&#39;];</span>
</span><span id=__span-21-61><a id=__codelineno-21-61 name=__codelineno-21-61 href=#__codelineno-21-61></a><span class=x>        return PaymentResult::success($id);</span>
</span><span id=__span-21-62><a id=__codelineno-21-62 name=__codelineno-21-62 href=#__codelineno-21-62></a><span class=x>    }</span>
</span><span id=__span-21-63><a id=__codelineno-21-63 name=__codelineno-21-63 href=#__codelineno-21-63></a>
</span><span id=__span-21-64><a id=__codelineno-21-64 name=__codelineno-21-64 href=#__codelineno-21-64></a><span class=x>    public function refund(TransactionId $transactionId, Money $amount): RefundResult</span>
</span><span id=__span-21-65><a id=__codelineno-21-65 name=__codelineno-21-65 href=#__codelineno-21-65></a><span class=x>    {</span>
</span><span id=__span-21-66><a id=__codelineno-21-66 name=__codelineno-21-66 href=#__codelineno-21-66></a><span class=x>        $this-&gt;transactions[$transactionId-&gt;value()][&#39;status&#39;] = &#39;refunded&#39;;</span>
</span><span id=__span-21-67><a id=__codelineno-21-67 name=__codelineno-21-67 href=#__codelineno-21-67></a><span class=x>        return RefundResult::success();</span>
</span><span id=__span-21-68><a id=__codelineno-21-68 name=__codelineno-21-68 href=#__codelineno-21-68></a><span class=x>    }</span>
</span><span id=__span-21-69><a id=__codelineno-21-69 name=__codelineno-21-69 href=#__codelineno-21-69></a><span class=x>}</span>
</span><span id=__span-21-70><a id=__codelineno-21-70 name=__codelineno-21-70 href=#__codelineno-21-70></a>
</span><span id=__span-21-71><a id=__codelineno-21-71 name=__codelineno-21-71 href=#__codelineno-21-71></a><span class=x>// Handler - Strategy Consumer</span>
</span><span id=__span-21-72><a id=__codelineno-21-72 name=__codelineno-21-72 href=#__codelineno-21-72></a><span class=x>class ProcessPaymentHandler</span>
</span><span id=__span-21-73><a id=__codelineno-21-73 name=__codelineno-21-73 href=#__codelineno-21-73></a><span class=x>{</span>
</span><span id=__span-21-74><a id=__codelineno-21-74 name=__codelineno-21-74 href=#__codelineno-21-74></a><span class=x>    public function __construct(</span>
</span><span id=__span-21-75><a id=__codelineno-21-75 name=__codelineno-21-75 href=#__codelineno-21-75></a><span class=x>        private PaymentProcessorInterface $processor  // Strategy injected!</span>
</span><span id=__span-21-76><a id=__codelineno-21-76 name=__codelineno-21-76 href=#__codelineno-21-76></a><span class=x>    ) {}</span>
</span><span id=__span-21-77><a id=__codelineno-21-77 name=__codelineno-21-77 href=#__codelineno-21-77></a>
</span><span id=__span-21-78><a id=__codelineno-21-78 name=__codelineno-21-78 href=#__codelineno-21-78></a><span class=x>    public function __invoke(ProcessPayment $command): void</span>
</span><span id=__span-21-79><a id=__codelineno-21-79 name=__codelineno-21-79 href=#__codelineno-21-79></a><span class=x>    {</span>
</span><span id=__span-21-80><a id=__codelineno-21-80 name=__codelineno-21-80 href=#__codelineno-21-80></a><span class=x>        // Business logic doesn&#39;t know WHICH processor is used</span>
</span><span id=__span-21-81><a id=__codelineno-21-81 name=__codelineno-21-81 href=#__codelineno-21-81></a><span class=x>        $result = $this-&gt;processor-&gt;charge(</span>
</span><span id=__span-21-82><a id=__codelineno-21-82 name=__codelineno-21-82 href=#__codelineno-21-82></a><span class=x>            new Money($command-&gt;amount, $command-&gt;currency),</span>
</span><span id=__span-21-83><a id=__codelineno-21-83 name=__codelineno-21-83 href=#__codelineno-21-83></a><span class=x>            new PaymentDetails($command-&gt;paymentToken)</span>
</span><span id=__span-21-84><a id=__codelineno-21-84 name=__codelineno-21-84 href=#__codelineno-21-84></a><span class=x>        );</span>
</span><span id=__span-21-85><a id=__codelineno-21-85 name=__codelineno-21-85 href=#__codelineno-21-85></a>
</span><span id=__span-21-86><a id=__codelineno-21-86 name=__codelineno-21-86 href=#__codelineno-21-86></a><span class=x>        if ($result-&gt;failed()) {</span>
</span><span id=__span-21-87><a id=__codelineno-21-87 name=__codelineno-21-87 href=#__codelineno-21-87></a><span class=x>            throw new PaymentFailedException($result-&gt;error());</span>
</span><span id=__span-21-88><a id=__codelineno-21-88 name=__codelineno-21-88 href=#__codelineno-21-88></a><span class=x>        }</span>
</span><span id=__span-21-89><a id=__codelineno-21-89 name=__codelineno-21-89 href=#__codelineno-21-89></a><span class=x>    }</span>
</span><span id=__span-21-90><a id=__codelineno-21-90 name=__codelineno-21-90 href=#__codelineno-21-90></a><span class=x>}</span>
</span><span id=__span-21-91><a id=__codelineno-21-91 name=__codelineno-21-91 href=#__codelineno-21-91></a>
</span><span id=__span-21-92><a id=__codelineno-21-92 name=__codelineno-21-92 href=#__codelineno-21-92></a><span class=x>// Configuration - Strategy Selection</span>
</span><span id=__span-21-93><a id=__codelineno-21-93 name=__codelineno-21-93 href=#__codelineno-21-93></a><span class=x>// config/services.yaml</span>
</span><span id=__span-21-94><a id=__codelineno-21-94 name=__codelineno-21-94 href=#__codelineno-21-94></a><span class=x>services:</span>
</span><span id=__span-21-95><a id=__codelineno-21-95 name=__codelineno-21-95 href=#__codelineno-21-95></a><span class=x>    # Production: Use Stripe</span>
</span><span id=__span-21-96><a id=__codelineno-21-96 name=__codelineno-21-96 href=#__codelineno-21-96></a><span class=x>    PaymentProcessorInterface:</span>
</span><span id=__span-21-97><a id=__codelineno-21-97 name=__codelineno-21-97 href=#__codelineno-21-97></a><span class=x>        class: StripePaymentProcessor</span>
</span><span id=__span-21-98><a id=__codelineno-21-98 name=__codelineno-21-98 href=#__codelineno-21-98></a>
</span><span id=__span-21-99><a id=__codelineno-21-99 name=__codelineno-21-99 href=#__codelineno-21-99></a><span class=x>    # Or PayPal for specific regions</span>
</span><span id=__span-21-100><a id=__codelineno-21-100 name=__codelineno-21-100 href=#__codelineno-21-100></a><span class=x>    # PaymentProcessorInterface:</span>
</span><span id=__span-21-101><a id=__codelineno-21-101 name=__codelineno-21-101 href=#__codelineno-21-101></a><span class=x>    #     class: PayPalPaymentProcessor</span>
</span><span id=__span-21-102><a id=__codelineno-21-102 name=__codelineno-21-102 href=#__codelineno-21-102></a>
</span><span id=__span-21-103><a id=__codelineno-21-103 name=__codelineno-21-103 href=#__codelineno-21-103></a><span class=x>    # Or in-memory for tests</span>
</span><span id=__span-21-104><a id=__codelineno-21-104 name=__codelineno-21-104 href=#__codelineno-21-104></a><span class=x>    # PaymentProcessorInterface:</span>
</span><span id=__span-21-105><a id=__codelineno-21-105 name=__codelineno-21-105 href=#__codelineno-21-105></a><span class=x>    #     class: InMemoryPaymentProcessor</span>
</span></code></pre></div> <p><strong>Example 2: Dynamic Strategy Selection Based on Business Rules</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=x>// Multiple notification strategies</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=x>interface NotificationSenderInterface</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=x>{</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=x>    public function send(UserId $userId, string $message): void;</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=x>    public function supports(NotificationPreference $preference): bool;</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=x>}</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=x>class EmailNotificationSender implements NotificationSenderInterface</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=x>{</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=x>    public function send(UserId $userId, string $message): void</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=x>    {</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=x>        // Send email</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=x>    }</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=x>    public function supports(NotificationPreference $preference): bool</span>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=x>    {</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=x>        return $preference-&gt;isEmail();</span>
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=x>    }</span>
</span><span id=__span-22-19><a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=x>}</span>
</span><span id=__span-22-20><a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a>
</span><span id=__span-22-21><a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=x>class SmsNotificationSender implements NotificationSenderInterface</span>
</span><span id=__span-22-22><a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a><span class=x>{</span>
</span><span id=__span-22-23><a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=x>    public function send(UserId $userId, string $message): void</span>
</span><span id=__span-22-24><a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=x>    {</span>
</span><span id=__span-22-25><a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=x>        // Send SMS</span>
</span><span id=__span-22-26><a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a><span class=x>    }</span>
</span><span id=__span-22-27><a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a>
</span><span id=__span-22-28><a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a><span class=x>    public function supports(NotificationPreference $preference): bool</span>
</span><span id=__span-22-29><a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a><span class=x>    {</span>
</span><span id=__span-22-30><a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a><span class=x>        return $preference-&gt;isSms();</span>
</span><span id=__span-22-31><a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a><span class=x>    }</span>
</span><span id=__span-22-32><a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a><span class=x>}</span>
</span><span id=__span-22-33><a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a>
</span><span id=__span-22-34><a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a><span class=x>class PushNotificationSender implements NotificationSenderInterface</span>
</span><span id=__span-22-35><a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a><span class=x>{</span>
</span><span id=__span-22-36><a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a><span class=x>    public function send(UserId $userId, string $message): void</span>
</span><span id=__span-22-37><a id=__codelineno-22-37 name=__codelineno-22-37 href=#__codelineno-22-37></a><span class=x>    {</span>
</span><span id=__span-22-38><a id=__codelineno-22-38 name=__codelineno-22-38 href=#__codelineno-22-38></a><span class=x>        // Send push notification</span>
</span><span id=__span-22-39><a id=__codelineno-22-39 name=__codelineno-22-39 href=#__codelineno-22-39></a><span class=x>    }</span>
</span><span id=__span-22-40><a id=__codelineno-22-40 name=__codelineno-22-40 href=#__codelineno-22-40></a>
</span><span id=__span-22-41><a id=__codelineno-22-41 name=__codelineno-22-41 href=#__codelineno-22-41></a><span class=x>    public function supports(NotificationPreference $preference): bool</span>
</span><span id=__span-22-42><a id=__codelineno-22-42 name=__codelineno-22-42 href=#__codelineno-22-42></a><span class=x>    {</span>
</span><span id=__span-22-43><a id=__codelineno-22-43 name=__codelineno-22-43 href=#__codelineno-22-43></a><span class=x>        return $preference-&gt;isPush();</span>
</span><span id=__span-22-44><a id=__codelineno-22-44 name=__codelineno-22-44 href=#__codelineno-22-44></a><span class=x>    }</span>
</span><span id=__span-22-45><a id=__codelineno-22-45 name=__codelineno-22-45 href=#__codelineno-22-45></a><span class=x>}</span>
</span><span id=__span-22-46><a id=__codelineno-22-46 name=__codelineno-22-46 href=#__codelineno-22-46></a>
</span><span id=__span-22-47><a id=__codelineno-22-47 name=__codelineno-22-47 href=#__codelineno-22-47></a><span class=x>// Strategy Selector (Chain of Responsibility + Strategy)</span>
</span><span id=__span-22-48><a id=__codelineno-22-48 name=__codelineno-22-48 href=#__codelineno-22-48></a><span class=x>class NotificationService</span>
</span><span id=__span-22-49><a id=__codelineno-22-49 name=__codelineno-22-49 href=#__codelineno-22-49></a><span class=x>{</span>
</span><span id=__span-22-50><a id=__codelineno-22-50 name=__codelineno-22-50 href=#__codelineno-22-50></a><span class=x>    /** @param NotificationSenderInterface[] $senders */</span>
</span><span id=__span-22-51><a id=__codelineno-22-51 name=__codelineno-22-51 href=#__codelineno-22-51></a><span class=x>    public function __construct(</span>
</span><span id=__span-22-52><a id=__codelineno-22-52 name=__codelineno-22-52 href=#__codelineno-22-52></a><span class=x>        private iterable $senders,</span>
</span><span id=__span-22-53><a id=__codelineno-22-53 name=__codelineno-22-53 href=#__codelineno-22-53></a><span class=x>        private UserRepositoryInterface $users</span>
</span><span id=__span-22-54><a id=__codelineno-22-54 name=__codelineno-22-54 href=#__codelineno-22-54></a><span class=x>    ) {}</span>
</span><span id=__span-22-55><a id=__codelineno-22-55 name=__codelineno-22-55 href=#__codelineno-22-55></a>
</span><span id=__span-22-56><a id=__codelineno-22-56 name=__codelineno-22-56 href=#__codelineno-22-56></a><span class=x>    public function notify(UserId $userId, string $message): void</span>
</span><span id=__span-22-57><a id=__codelineno-22-57 name=__codelineno-22-57 href=#__codelineno-22-57></a><span class=x>    {</span>
</span><span id=__span-22-58><a id=__codelineno-22-58 name=__codelineno-22-58 href=#__codelineno-22-58></a><span class=x>        $user = $this-&gt;users-&gt;ofId($userId);</span>
</span><span id=__span-22-59><a id=__codelineno-22-59 name=__codelineno-22-59 href=#__codelineno-22-59></a><span class=x>        $preference = $user-&gt;notificationPreference();</span>
</span><span id=__span-22-60><a id=__codelineno-22-60 name=__codelineno-22-60 href=#__codelineno-22-60></a>
</span><span id=__span-22-61><a id=__codelineno-22-61 name=__codelineno-22-61 href=#__codelineno-22-61></a><span class=x>        // Select strategy based on business rules</span>
</span><span id=__span-22-62><a id=__codelineno-22-62 name=__codelineno-22-62 href=#__codelineno-22-62></a><span class=x>        foreach ($this-&gt;senders as $sender) {</span>
</span><span id=__span-22-63><a id=__codelineno-22-63 name=__codelineno-22-63 href=#__codelineno-22-63></a><span class=x>            if ($sender-&gt;supports($preference)) {</span>
</span><span id=__span-22-64><a id=__codelineno-22-64 name=__codelineno-22-64 href=#__codelineno-22-64></a><span class=x>                $sender-&gt;send($userId, $message);</span>
</span><span id=__span-22-65><a id=__codelineno-22-65 name=__codelineno-22-65 href=#__codelineno-22-65></a><span class=x>                return;</span>
</span><span id=__span-22-66><a id=__codelineno-22-66 name=__codelineno-22-66 href=#__codelineno-22-66></a><span class=x>            }</span>
</span><span id=__span-22-67><a id=__codelineno-22-67 name=__codelineno-22-67 href=#__codelineno-22-67></a><span class=x>        }</span>
</span><span id=__span-22-68><a id=__codelineno-22-68 name=__codelineno-22-68 href=#__codelineno-22-68></a>
</span><span id=__span-22-69><a id=__codelineno-22-69 name=__codelineno-22-69 href=#__codelineno-22-69></a><span class=x>        throw new NoSupportedNotificationMethodException();</span>
</span><span id=__span-22-70><a id=__codelineno-22-70 name=__codelineno-22-70 href=#__codelineno-22-70></a><span class=x>    }</span>
</span><span id=__span-22-71><a id=__codelineno-22-71 name=__codelineno-22-71 href=#__codelineno-22-71></a><span class=x>}</span>
</span><span id=__span-22-72><a id=__codelineno-22-72 name=__codelineno-22-72 href=#__codelineno-22-72></a>
</span><span id=__span-22-73><a id=__codelineno-22-73 name=__codelineno-22-73 href=#__codelineno-22-73></a><span class=x>// Configuration - Register all strategies</span>
</span><span id=__span-22-74><a id=__codelineno-22-74 name=__codelineno-22-74 href=#__codelineno-22-74></a><span class=x>// config/services.yaml</span>
</span><span id=__span-22-75><a id=__codelineno-22-75 name=__codelineno-22-75 href=#__codelineno-22-75></a><span class=x>services:</span>
</span><span id=__span-22-76><a id=__codelineno-22-76 name=__codelineno-22-76 href=#__codelineno-22-76></a><span class=x>    EmailNotificationSender:</span>
</span><span id=__span-22-77><a id=__codelineno-22-77 name=__codelineno-22-77 href=#__codelineno-22-77></a><span class=x>        tags: [&#39;notification.sender&#39;]</span>
</span><span id=__span-22-78><a id=__codelineno-22-78 name=__codelineno-22-78 href=#__codelineno-22-78></a>
</span><span id=__span-22-79><a id=__codelineno-22-79 name=__codelineno-22-79 href=#__codelineno-22-79></a><span class=x>    SmsNotificationSender:</span>
</span><span id=__span-22-80><a id=__codelineno-22-80 name=__codelineno-22-80 href=#__codelineno-22-80></a><span class=x>        tags: [&#39;notification.sender&#39;]</span>
</span><span id=__span-22-81><a id=__codelineno-22-81 name=__codelineno-22-81 href=#__codelineno-22-81></a>
</span><span id=__span-22-82><a id=__codelineno-22-82 name=__codelineno-22-82 href=#__codelineno-22-82></a><span class=x>    PushNotificationSender:</span>
</span><span id=__span-22-83><a id=__codelineno-22-83 name=__codelineno-22-83 href=#__codelineno-22-83></a><span class=x>        tags: [&#39;notification.sender&#39;]</span>
</span><span id=__span-22-84><a id=__codelineno-22-84 name=__codelineno-22-84 href=#__codelineno-22-84></a>
</span><span id=__span-22-85><a id=__codelineno-22-85 name=__codelineno-22-85 href=#__codelineno-22-85></a><span class=x>    NotificationService:</span>
</span><span id=__span-22-86><a id=__codelineno-22-86 name=__codelineno-22-86 href=#__codelineno-22-86></a><span class=x>        arguments:</span>
</span><span id=__span-22-87><a id=__codelineno-22-87 name=__codelineno-22-87 href=#__codelineno-22-87></a><span class=x>            $senders: !tagged_iterator notification.sender</span>
</span></code></pre></div> <p><strong>Example 3: Storage Strategy</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=x>// Port - Storage Strategy</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=x>interface FileStorageInterface</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=x>{</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=x>    public function store(string $path, string $contents): void;</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=x>    public function retrieve(string $path): string;</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=x>    public function delete(string $path): void;</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=x>}</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=x>// Strategy 1: Local Filesystem</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=x>class LocalFileStorage implements FileStorageInterface</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=x>{</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=x>    public function __construct(private string $basePath) {}</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=x>    public function store(string $path, string $contents): void</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=x>    {</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=x>        file_put_contents($this-&gt;basePath . &#39;/&#39; . $path, $contents);</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=x>    }</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a>
</span><span id=__span-23-19><a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=x>    public function retrieve(string $path): string</span>
</span><span id=__span-23-20><a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=x>    {</span>
</span><span id=__span-23-21><a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a><span class=x>        return file_get_contents($this-&gt;basePath . &#39;/&#39; . $path);</span>
</span><span id=__span-23-22><a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=x>    }</span>
</span><span id=__span-23-23><a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a>
</span><span id=__span-23-24><a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=x>    public function delete(string $path): void</span>
</span><span id=__span-23-25><a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a><span class=x>    {</span>
</span><span id=__span-23-26><a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a><span class=x>        unlink($this-&gt;basePath . &#39;/&#39; . $path);</span>
</span><span id=__span-23-27><a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a><span class=x>    }</span>
</span><span id=__span-23-28><a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a><span class=x>}</span>
</span><span id=__span-23-29><a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a>
</span><span id=__span-23-30><a id=__codelineno-23-30 name=__codelineno-23-30 href=#__codelineno-23-30></a><span class=x>// Strategy 2: AWS S3</span>
</span><span id=__span-23-31><a id=__codelineno-23-31 name=__codelineno-23-31 href=#__codelineno-23-31></a><span class=x>class S3FileStorage implements FileStorageInterface</span>
</span><span id=__span-23-32><a id=__codelineno-23-32 name=__codelineno-23-32 href=#__codelineno-23-32></a><span class=x>{</span>
</span><span id=__span-23-33><a id=__codelineno-23-33 name=__codelineno-23-33 href=#__codelineno-23-33></a><span class=x>    public function __construct(private S3Client $client, private string $bucket) {}</span>
</span><span id=__span-23-34><a id=__codelineno-23-34 name=__codelineno-23-34 href=#__codelineno-23-34></a>
</span><span id=__span-23-35><a id=__codelineno-23-35 name=__codelineno-23-35 href=#__codelineno-23-35></a><span class=x>    public function store(string $path, string $contents): void</span>
</span><span id=__span-23-36><a id=__codelineno-23-36 name=__codelineno-23-36 href=#__codelineno-23-36></a><span class=x>    {</span>
</span><span id=__span-23-37><a id=__codelineno-23-37 name=__codelineno-23-37 href=#__codelineno-23-37></a><span class=x>        $this-&gt;client-&gt;putObject([</span>
</span><span id=__span-23-38><a id=__codelineno-23-38 name=__codelineno-23-38 href=#__codelineno-23-38></a><span class=x>            &#39;Bucket&#39; =&gt; $this-&gt;bucket,</span>
</span><span id=__span-23-39><a id=__codelineno-23-39 name=__codelineno-23-39 href=#__codelineno-23-39></a><span class=x>            &#39;Key&#39; =&gt; $path,</span>
</span><span id=__span-23-40><a id=__codelineno-23-40 name=__codelineno-23-40 href=#__codelineno-23-40></a><span class=x>            &#39;Body&#39; =&gt; $contents</span>
</span><span id=__span-23-41><a id=__codelineno-23-41 name=__codelineno-23-41 href=#__codelineno-23-41></a><span class=x>        ]);</span>
</span><span id=__span-23-42><a id=__codelineno-23-42 name=__codelineno-23-42 href=#__codelineno-23-42></a><span class=x>    }</span>
</span><span id=__span-23-43><a id=__codelineno-23-43 name=__codelineno-23-43 href=#__codelineno-23-43></a>
</span><span id=__span-23-44><a id=__codelineno-23-44 name=__codelineno-23-44 href=#__codelineno-23-44></a><span class=x>    public function retrieve(string $path): string</span>
</span><span id=__span-23-45><a id=__codelineno-23-45 name=__codelineno-23-45 href=#__codelineno-23-45></a><span class=x>    {</span>
</span><span id=__span-23-46><a id=__codelineno-23-46 name=__codelineno-23-46 href=#__codelineno-23-46></a><span class=x>        $result = $this-&gt;client-&gt;getObject([</span>
</span><span id=__span-23-47><a id=__codelineno-23-47 name=__codelineno-23-47 href=#__codelineno-23-47></a><span class=x>            &#39;Bucket&#39; =&gt; $this-&gt;bucket,</span>
</span><span id=__span-23-48><a id=__codelineno-23-48 name=__codelineno-23-48 href=#__codelineno-23-48></a><span class=x>            &#39;Key&#39; =&gt; $path</span>
</span><span id=__span-23-49><a id=__codelineno-23-49 name=__codelineno-23-49 href=#__codelineno-23-49></a><span class=x>        ]);</span>
</span><span id=__span-23-50><a id=__codelineno-23-50 name=__codelineno-23-50 href=#__codelineno-23-50></a><span class=x>        return $result[&#39;Body&#39;]-&gt;getContents();</span>
</span><span id=__span-23-51><a id=__codelineno-23-51 name=__codelineno-23-51 href=#__codelineno-23-51></a><span class=x>    }</span>
</span><span id=__span-23-52><a id=__codelineno-23-52 name=__codelineno-23-52 href=#__codelineno-23-52></a>
</span><span id=__span-23-53><a id=__codelineno-23-53 name=__codelineno-23-53 href=#__codelineno-23-53></a><span class=x>    public function delete(string $path): void</span>
</span><span id=__span-23-54><a id=__codelineno-23-54 name=__codelineno-23-54 href=#__codelineno-23-54></a><span class=x>    {</span>
</span><span id=__span-23-55><a id=__codelineno-23-55 name=__codelineno-23-55 href=#__codelineno-23-55></a><span class=x>        $this-&gt;client-&gt;deleteObject([</span>
</span><span id=__span-23-56><a id=__codelineno-23-56 name=__codelineno-23-56 href=#__codelineno-23-56></a><span class=x>            &#39;Bucket&#39; =&gt; $this-&gt;bucket,</span>
</span><span id=__span-23-57><a id=__codelineno-23-57 name=__codelineno-23-57 href=#__codelineno-23-57></a><span class=x>            &#39;Key&#39; =&gt; $path</span>
</span><span id=__span-23-58><a id=__codelineno-23-58 name=__codelineno-23-58 href=#__codelineno-23-58></a><span class=x>        ]);</span>
</span><span id=__span-23-59><a id=__codelineno-23-59 name=__codelineno-23-59 href=#__codelineno-23-59></a><span class=x>    }</span>
</span><span id=__span-23-60><a id=__codelineno-23-60 name=__codelineno-23-60 href=#__codelineno-23-60></a><span class=x>}</span>
</span><span id=__span-23-61><a id=__codelineno-23-61 name=__codelineno-23-61 href=#__codelineno-23-61></a>
</span><span id=__span-23-62><a id=__codelineno-23-62 name=__codelineno-23-62 href=#__codelineno-23-62></a><span class=x>// Strategy 3: In-Memory (for tests)</span>
</span><span id=__span-23-63><a id=__codelineno-23-63 name=__codelineno-23-63 href=#__codelineno-23-63></a><span class=x>class InMemoryFileStorage implements FileStorageInterface</span>
</span><span id=__span-23-64><a id=__codelineno-23-64 name=__codelineno-23-64 href=#__codelineno-23-64></a><span class=x>{</span>
</span><span id=__span-23-65><a id=__codelineno-23-65 name=__codelineno-23-65 href=#__codelineno-23-65></a><span class=x>    private array $files = [];</span>
</span><span id=__span-23-66><a id=__codelineno-23-66 name=__codelineno-23-66 href=#__codelineno-23-66></a>
</span><span id=__span-23-67><a id=__codelineno-23-67 name=__codelineno-23-67 href=#__codelineno-23-67></a><span class=x>    public function store(string $path, string $contents): void</span>
</span><span id=__span-23-68><a id=__codelineno-23-68 name=__codelineno-23-68 href=#__codelineno-23-68></a><span class=x>    {</span>
</span><span id=__span-23-69><a id=__codelineno-23-69 name=__codelineno-23-69 href=#__codelineno-23-69></a><span class=x>        $this-&gt;files[$path] = $contents;</span>
</span><span id=__span-23-70><a id=__codelineno-23-70 name=__codelineno-23-70 href=#__codelineno-23-70></a><span class=x>    }</span>
</span><span id=__span-23-71><a id=__codelineno-23-71 name=__codelineno-23-71 href=#__codelineno-23-71></a>
</span><span id=__span-23-72><a id=__codelineno-23-72 name=__codelineno-23-72 href=#__codelineno-23-72></a><span class=x>    public function retrieve(string $path): string</span>
</span><span id=__span-23-73><a id=__codelineno-23-73 name=__codelineno-23-73 href=#__codelineno-23-73></a><span class=x>    {</span>
</span><span id=__span-23-74><a id=__codelineno-23-74 name=__codelineno-23-74 href=#__codelineno-23-74></a><span class=x>        return $this-&gt;files[$path] ?? throw new FileNotFoundException();</span>
</span><span id=__span-23-75><a id=__codelineno-23-75 name=__codelineno-23-75 href=#__codelineno-23-75></a><span class=x>    }</span>
</span><span id=__span-23-76><a id=__codelineno-23-76 name=__codelineno-23-76 href=#__codelineno-23-76></a>
</span><span id=__span-23-77><a id=__codelineno-23-77 name=__codelineno-23-77 href=#__codelineno-23-77></a><span class=x>    public function delete(string $path): void</span>
</span><span id=__span-23-78><a id=__codelineno-23-78 name=__codelineno-23-78 href=#__codelineno-23-78></a><span class=x>    {</span>
</span><span id=__span-23-79><a id=__codelineno-23-79 name=__codelineno-23-79 href=#__codelineno-23-79></a><span class=x>        unset($this-&gt;files[$path]);</span>
</span><span id=__span-23-80><a id=__codelineno-23-80 name=__codelineno-23-80 href=#__codelineno-23-80></a><span class=x>    }</span>
</span><span id=__span-23-81><a id=__codelineno-23-81 name=__codelineno-23-81 href=#__codelineno-23-81></a><span class=x>}</span>
</span><span id=__span-23-82><a id=__codelineno-23-82 name=__codelineno-23-82 href=#__codelineno-23-82></a>
</span><span id=__span-23-83><a id=__codelineno-23-83 name=__codelineno-23-83 href=#__codelineno-23-83></a><span class=x>// Usage in domain</span>
</span><span id=__span-23-84><a id=__codelineno-23-84 name=__codelineno-23-84 href=#__codelineno-23-84></a><span class=x>class UploadDocumentHandler</span>
</span><span id=__span-23-85><a id=__codelineno-23-85 name=__codelineno-23-85 href=#__codelineno-23-85></a><span class=x>{</span>
</span><span id=__span-23-86><a id=__codelineno-23-86 name=__codelineno-23-86 href=#__codelineno-23-86></a><span class=x>    public function __construct(</span>
</span><span id=__span-23-87><a id=__codelineno-23-87 name=__codelineno-23-87 href=#__codelineno-23-87></a><span class=x>        private FileStorageInterface $storage,  // Strategy!</span>
</span><span id=__span-23-88><a id=__codelineno-23-88 name=__codelineno-23-88 href=#__codelineno-23-88></a><span class=x>        private DocumentRepositoryInterface $documents</span>
</span><span id=__span-23-89><a id=__codelineno-23-89 name=__codelineno-23-89 href=#__codelineno-23-89></a><span class=x>    ) {}</span>
</span><span id=__span-23-90><a id=__codelineno-23-90 name=__codelineno-23-90 href=#__codelineno-23-90></a>
</span><span id=__span-23-91><a id=__codelineno-23-91 name=__codelineno-23-91 href=#__codelineno-23-91></a><span class=x>    public function __invoke(UploadDocument $command): void</span>
</span><span id=__span-23-92><a id=__codelineno-23-92 name=__codelineno-23-92 href=#__codelineno-23-92></a><span class=x>    {</span>
</span><span id=__span-23-93><a id=__codelineno-23-93 name=__codelineno-23-93 href=#__codelineno-23-93></a><span class=x>        // Business logic doesn&#39;t know WHERE files are stored</span>
</span><span id=__span-23-94><a id=__codelineno-23-94 name=__codelineno-23-94 href=#__codelineno-23-94></a><span class=x>        $this-&gt;storage-&gt;store(</span>
</span><span id=__span-23-95><a id=__codelineno-23-95 name=__codelineno-23-95 href=#__codelineno-23-95></a><span class=x>            $command-&gt;filePath,</span>
</span><span id=__span-23-96><a id=__codelineno-23-96 name=__codelineno-23-96 href=#__codelineno-23-96></a><span class=x>            $command-&gt;fileContents</span>
</span><span id=__span-23-97><a id=__codelineno-23-97 name=__codelineno-23-97 href=#__codelineno-23-97></a><span class=x>        );</span>
</span><span id=__span-23-98><a id=__codelineno-23-98 name=__codelineno-23-98 href=#__codelineno-23-98></a>
</span><span id=__span-23-99><a id=__codelineno-23-99 name=__codelineno-23-99 href=#__codelineno-23-99></a><span class=x>        $document = Document::create($command-&gt;filePath, $command-&gt;fileName);</span>
</span><span id=__span-23-100><a id=__codelineno-23-100 name=__codelineno-23-100 href=#__codelineno-23-100></a><span class=x>        $this-&gt;documents-&gt;save($document);</span>
</span><span id=__span-23-101><a id=__codelineno-23-101 name=__codelineno-23-101 href=#__codelineno-23-101></a><span class=x>    }</span>
</span><span id=__span-23-102><a id=__codelineno-23-102 name=__codelineno-23-102 href=#__codelineno-23-102></a><span class=x>}</span>
</span></code></pre></div> <p><strong>Why Strategy Pattern Fits Hexagonal:</strong></p> <table> <thead> <tr> <th>Hexagonal Concept</th> <th>Strategy Benefit</th> </tr> </thead> <tbody> <tr> <td><strong>Ports</strong></td> <td>Strategy interfaces (contracts)</td> </tr> <tr> <td><strong>Adapters</strong></td> <td>Strategy implementations (algorithms)</td> </tr> <tr> <td><strong>DI</strong></td> <td>Runtime strategy selection</td> </tr> <tr> <td><strong>Testability</strong></td> <td>Inject test strategies easily</td> </tr> <tr> <td><strong>Flexibility</strong></td> <td>Swap strategies per environment</td> </tr> </tbody> </table> <p><strong>Real-World Scenarios:</strong></p> <div class="language-php highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=x>// Development environment</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=x>FileStorageInterface -&gt; LocalFileStorage</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=x>// Staging environment</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=x>FileStorageInterface -&gt; S3FileStorage (staging bucket)</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=x>// Production environment</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=x>FileStorageInterface -&gt; S3FileStorage (production bucket)</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=x>// Tests</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=x>FileStorageInterface -&gt; InMemoryFileStorage</span>
</span></code></pre></div> <p><strong>Benefits:</strong> - <strong>Algorithm Flexibility:</strong> Change algorithms without changing business logic - <strong>Configuration-Based:</strong> Select strategy via config, not code changes - <strong>Environment-Specific:</strong> Different strategies per environment (dev/staging/prod) - <strong>A/B Testing:</strong> Switch strategies to compare performance - <strong>Gradual Migration:</strong> Run old and new strategies in parallel - <strong>Open/Closed Principle:</strong> Add new strategies without modifying existing code</p> <p><strong>The Power:</strong></p> <p>Traditional approach requires code changes: <div class="language-php highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=x>// BAD: Hard-coded strategy</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=x>class PaymentHandler</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=x>{</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=x>    public function process()</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=x>    {</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=x>        $stripe = new StripeClient();  // Changing to PayPal? Rewrite!</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=x>        $stripe-&gt;charge(...);</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=x>    }</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=x>}</span>
</span></code></pre></div></p> <p>Hexagonal with Strategy pattern: <div class="language-php highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=x>// GOOD: Strategy injected</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=x>class PaymentHandler</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=x>{</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=x>    public function __construct(private PaymentProcessorInterface $processor) {}</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=x>    public function process()</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=x>    {</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=x>        $this-&gt;processor-&gt;charge(...);  // Changing to PayPal? Change config!</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=x>    }</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=x>}</span>
</span></code></pre></div></p> <p><strong>Key Insight:</strong> In Hexagonal Architecture, <strong>every port is a potential strategy</strong>. The pattern is baked into the architecture itself.</p> <hr> <h3 id=21010-why-these-patterns-matter-together>2.10.10 Why These Patterns Matter Together<a class=headerlink href=#21010-why-these-patterns-matter-together title="Permanent link">&para;</a></h3> <p>Hexagonal Architecture doesn't just allow these patterns‚Äîit <strong>naturally promotes</strong> them:</p> <pre class=mermaid><code>%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'12px'}}}%%
graph TD
    A["üéØ Hexagonal&lt;br/&gt;Architecture"]
    B["‚úÖ DRY&lt;br/&gt;Single source of truth"]
    C["‚úÖ KISS&lt;br/&gt;Pure, simple code"]
    D["‚úÖ YAGNI&lt;br/&gt;Build what you need"]
    E["‚úÖ SoC&lt;br/&gt;Clear layer boundaries"]
    F["üîå Dependency Injection&lt;br/&gt;Inject ports, not implementations"]
    G["üè≠ Factory Pattern&lt;br/&gt;Clean entity creation"]
    H["üì¶ DTO Pattern&lt;br/&gt;Layer decoupling"]
    I["üìÖ Event Sourcing&lt;br/&gt;Domain events as first-class"]
    J["‚ö° Strategy Pattern&lt;br/&gt;Swappable algorithms"]

    A ==&gt; B
    A ==&gt; C
    A ==&gt; D
    A ==&gt; E
    A ==&gt; F
    A ==&gt; G
    A ==&gt; H
    A ==&gt; I
    A ==&gt; J

    style A fill:#C8E6C9,stroke:#2E7D32,stroke-width:4px,color:#000
    style B fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#000
    style C fill:#FFF9C4,stroke:#F57C00,stroke-width:2px,color:#000
    style D fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,color:#000
    style E fill:#FFE0B2,stroke:#E65100,stroke-width:2px,color:#000
    style F fill:#E1F5FE,stroke:#0277BD,stroke-width:2px,color:#000
    style G fill:#FCE4EC,stroke:#C2185B,stroke-width:2px,color:#000
    style H fill:#F3E5F5,stroke:#6A1B9A,stroke-width:2px,color:#000
    style I fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#000
    style J fill:#FFF3E0,stroke:#EF6C00,stroke-width:2px,color:#000</code></pre> <p><strong>The Synergy:</strong></p> <table> <thead> <tr> <th>Principle/Pattern</th> <th>How Hexagonal Enforces It</th> </tr> </thead> <tbody> <tr> <td><strong>DRY</strong></td> <td>Business rules in Domain, used everywhere via handlers</td> </tr> <tr> <td><strong>KISS</strong></td> <td>Pure entities, simple interfaces, focused handlers</td> </tr> <tr> <td><strong>YAGNI</strong></td> <td>Minimal ports, add methods only when needed</td> </tr> <tr> <td><strong>SoC</strong></td> <td>Strict layer boundaries, clear responsibilities</td> </tr> <tr> <td><strong>DI</strong></td> <td>Mandatory for ports/adapters, enables testing</td> </tr> <tr> <td><strong>Factory</strong></td> <td>Complex creation isolated from entity behavior</td> </tr> <tr> <td><strong>DTO</strong></td> <td>Commands, Queries, Responses decouple layers</td> </tr> <tr> <td><strong>Event Sourcing</strong></td> <td>Domain events natural, easy to implement</td> </tr> <tr> <td><strong>Strategy</strong></td> <td>Every port is a strategy, swap via config/DI</td> </tr> </tbody> </table> <p><strong>The Result:</strong> - Code that's <strong>easy to understand</strong> (KISS + DTOs) - Code that's <strong>easy to maintain</strong> (DRY + SoC) - Code that's <strong>easy to test</strong> (DI + Factories + Strategy) - Code that's <strong>easy to evolve</strong> (YAGNI + Event Sourcing) - Code that's <strong>flexible</strong> (Strategy + DI for runtime swapping) - Code that <strong>survives technology changes</strong> (SoC + Ports/Adapters)</p> <p><strong>Real-World Impact:</strong> - Change database? <strong>DI + Strategy</strong> makes it trivial (inject different repository) - Change payment provider? <strong>Strategy</strong> pattern (Stripe ‚Üí PayPal via config) - Add new feature? <strong>Factory + DTOs</strong> keep it clean - Track user actions? <strong>Event Sourcing</strong> gives complete audit trail - Understand business rules? <strong>DRY</strong> means one place to look - Test complex scenarios? <strong>DI + DTOs + Strategy</strong> make tests lightning fast - A/B test algorithms? <strong>Strategy</strong> enables runtime switching</p> <hr> <h2 id=211-complete-decision-tree-what-to-create-and-how>2.11 Complete Decision Tree: What to Create and How üå≥<a class=headerlink href=#211-complete-decision-tree-what-to-create-and-how title="Permanent link">&para;</a></h2> <p>This comprehensive decision tree covers <strong>ALL possible scenarios</strong> when building with hexagonal architecture. Follow the flow to know exactly what to create, how to create it, and whether you need an interface.</p> <h3 id=the-master-decision-tree>üéØ The Master Decision Tree<a class=headerlink href=#the-master-decision-tree title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>What do you need to create?
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>‚îÇ
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>‚îÇ üì¶ DOMAIN LAYER (Core Business Logic - Pure PHP)
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>‚îÇ
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>‚îú‚îÄ 1Ô∏è‚É£ Entity (User, Order, Product)?
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:entity user/account User [--with-repository] [--with-id-vo]
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>‚îÇ     Generates: Entity + YAML mapping
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>‚îÇ     Options:
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>‚îÇ       --with-repository ‚Üí adds Port interface + Doctrine adapter
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>‚îÇ       --with-id-vo ‚Üí adds UserId value object
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>‚îÇ
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>‚îú‚îÄ 2Ô∏è‚É£ Value Object (Email, Money, Address)?
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:value-object user/account Email
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>‚îÇ
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>‚îú‚îÄ 3Ô∏è‚É£ Domain Exception (InvalidEmail, InsufficientFunds)?
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:exception user/account InvalidEmailException
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a>‚îÇ
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a>‚îú‚îÄ 4Ô∏è‚É£ Domain Event (OrderPlaced, UserRegistered)?
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:domain-event order/payment OrderPlaced [--with-subscriber]
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a>‚îÇ     Options:
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a>‚îÇ       --with-subscriber ‚Üí adds event subscriber in Application layer
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a>‚îÇ
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a>‚îú‚îÄ 5Ô∏è‚É£ Domain Service (PriceCalculator, IdGenerator)?
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a>‚îÇ  ‚îî‚îÄ üéØ Create manually - Concrete class in Domain/Service/
</span><span id=__span-27-27><a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a>‚îÇ     No interface needed (pure business logic)
</span><span id=__span-27-28><a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a>‚îÇ
</span><span id=__span-27-29><a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a>‚îú‚îÄ 6Ô∏è‚É£ Repository (data access)?
</span><span id=__span-27-30><a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:repository user/account User
</span><span id=__span-27-31><a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a>‚îÇ     Generates: Port interface + Doctrine adapter
</span><span id=__span-27-32><a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a>‚îÇ
</span><span id=__span-27-33><a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a>‚îÇ
</span><span id=__span-27-34><a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-35><a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a>‚îÇ ‚öôÔ∏è APPLICATION LAYER (Use Cases &amp; Orchestration)
</span><span id=__span-27-36><a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-37><a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a>‚îÇ
</span><span id=__span-27-38><a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a>‚îú‚îÄ 7Ô∏è‚É£ Command (write operation)?
</span><span id=__span-27-39><a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:command user/account register [--factory] [--with-tests]
</span><span id=__span-27-40><a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a>‚îÇ     Options:
</span><span id=__span-27-41><a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a>‚îÇ       --factory ‚Üí adds entity factory
</span><span id=__span-27-42><a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a>‚îÇ       --with-tests ‚Üí adds unit + integration tests
</span><span id=__span-27-43><a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a>‚îÇ
</span><span id=__span-27-44><a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a>‚îú‚îÄ 8Ô∏è‚É£ Query (read operation)?
</span><span id=__span-27-45><a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:query user/account find-by-id
</span><span id=__span-27-46><a id=__codelineno-27-46 name=__codelineno-27-46 href=#__codelineno-27-46></a>‚îÇ     Generates: Query + Handler + Response
</span><span id=__span-27-47><a id=__codelineno-27-47 name=__codelineno-27-47 href=#__codelineno-27-47></a>‚îÇ
</span><span id=__span-27-48><a id=__codelineno-27-48 name=__codelineno-27-48 href=#__codelineno-27-48></a>‚îú‚îÄ 9Ô∏è‚É£ UseCase?
</span><span id=__span-27-49><a id=__codelineno-27-49 name=__codelineno-27-49 href=#__codelineno-27-49></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:use-case user/account CreateUser [--with-test]
</span><span id=__span-27-50><a id=__codelineno-27-50 name=__codelineno-27-50 href=#__codelineno-27-50></a>‚îÇ     Options:
</span><span id=__span-27-51><a id=__codelineno-27-51 name=__codelineno-27-51 href=#__codelineno-27-51></a>‚îÇ       --with-test ‚Üí adds test (KernelTestCase)
</span><span id=__span-27-52><a id=__codelineno-27-52 name=__codelineno-27-52 href=#__codelineno-27-52></a>‚îÇ
</span><span id=__span-27-53><a id=__codelineno-27-53 name=__codelineno-27-53 href=#__codelineno-27-53></a>‚îú‚îÄ üîü Input DTO?
</span><span id=__span-27-54><a id=__codelineno-27-54 name=__codelineno-27-54 href=#__codelineno-27-54></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:input user/account CreateUserInput
</span><span id=__span-27-55><a id=__codelineno-27-55 name=__codelineno-27-55 href=#__codelineno-27-55></a>‚îÇ
</span><span id=__span-27-56><a id=__codelineno-27-56 name=__codelineno-27-56 href=#__codelineno-27-56></a>‚îú‚îÄ 1Ô∏è‚É£1Ô∏è‚É£ Event Subscriber (business workflow)?
</span><span id=__span-27-57><a id=__codelineno-27-57 name=__codelineno-27-57 href=#__codelineno-27-57></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:event-subscriber order/payment OrderPlaced --layer=application
</span><span id=__span-27-58><a id=__codelineno-27-58 name=__codelineno-27-58 href=#__codelineno-27-58></a>‚îÇ
</span><span id=__span-27-59><a id=__codelineno-27-59 name=__codelineno-27-59 href=#__codelineno-27-59></a>‚îÇ
</span><span id=__span-27-60><a id=__codelineno-27-60 name=__codelineno-27-60 href=#__codelineno-27-60></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-61><a id=__codelineno-27-61 name=__codelineno-27-61 href=#__codelineno-27-61></a>‚îÇ üéÆ UI LAYER (Primary Adapters - User Interfaces)
</span><span id=__span-27-62><a id=__codelineno-27-62 name=__codelineno-27-62 href=#__codelineno-27-62></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-63><a id=__codelineno-27-63 name=__codelineno-27-63 href=#__codelineno-27-63></a>‚îÇ
</span><span id=__span-27-64><a id=__codelineno-27-64 name=__codelineno-27-64 href=#__codelineno-27-64></a>‚îú‚îÄ 1Ô∏è‚É£2Ô∏è‚É£ Controller?
</span><span id=__span-27-65><a id=__codelineno-27-65 name=__codelineno-27-65 href=#__codelineno-27-65></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:controller user/account CreateUser /users/create [--with-workflow]
</span><span id=__span-27-66><a id=__codelineno-27-66 name=__codelineno-27-66 href=#__codelineno-27-66></a>‚îÇ     Options:
</span><span id=__span-27-67><a id=__codelineno-27-67 name=__codelineno-27-67 href=#__codelineno-27-67></a>‚îÇ       --with-workflow ‚Üí adds Form + UseCase + Command + Input (6 files!)
</span><span id=__span-27-68><a id=__codelineno-27-68 name=__codelineno-27-68 href=#__codelineno-27-68></a>‚îÇ
</span><span id=__span-27-69><a id=__codelineno-27-69 name=__codelineno-27-69 href=#__codelineno-27-69></a>‚îú‚îÄ 1Ô∏è‚É£3Ô∏è‚É£ Form?
</span><span id=__span-27-70><a id=__codelineno-27-70 name=__codelineno-27-70 href=#__codelineno-27-70></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:form user/account User [--with-command --action=Create]
</span><span id=__span-27-71><a id=__codelineno-27-71 name=__codelineno-27-71 href=#__codelineno-27-71></a>‚îÇ     Options:
</span><span id=__span-27-72><a id=__codelineno-27-72 name=__codelineno-27-72 href=#__codelineno-27-72></a>‚îÇ       --with-command ‚Üí adds Command + Input
</span><span id=__span-27-73><a id=__codelineno-27-73 name=__codelineno-27-73 href=#__codelineno-27-73></a>‚îÇ
</span><span id=__span-27-74><a id=__codelineno-27-74 name=__codelineno-27-74 href=#__codelineno-27-74></a>‚îú‚îÄ 1Ô∏è‚É£4Ô∏è‚É£ CLI Command?
</span><span id=__span-27-75><a id=__codelineno-27-75 name=__codelineno-27-75 href=#__codelineno-27-75></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:cli-command user/account CreateUser app:user:create [--with-use-case]
</span><span id=__span-27-76><a id=__codelineno-27-76 name=__codelineno-27-76 href=#__codelineno-27-76></a>‚îÇ     Options:
</span><span id=__span-27-77><a id=__codelineno-27-77 name=__codelineno-27-77 href=#__codelineno-27-77></a>‚îÇ       --with-use-case ‚Üí adds UseCase + Command + Input
</span><span id=__span-27-78><a id=__codelineno-27-78 name=__codelineno-27-78 href=#__codelineno-27-78></a>‚îÇ
</span><span id=__span-27-79><a id=__codelineno-27-79 name=__codelineno-27-79 href=#__codelineno-27-79></a>‚îÇ
</span><span id=__span-27-80><a id=__codelineno-27-80 name=__codelineno-27-80 href=#__codelineno-27-80></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-81><a id=__codelineno-27-81 name=__codelineno-27-81 href=#__codelineno-27-81></a>‚îÇ üîå INFRASTRUCTURE LAYER (Secondary Adapters - External Services)
</span><span id=__span-27-82><a id=__codelineno-27-82 name=__codelineno-27-82 href=#__codelineno-27-82></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-83><a id=__codelineno-27-83 name=__codelineno-27-83 href=#__codelineno-27-83></a>‚îÇ
</span><span id=__span-27-84><a id=__codelineno-27-84 name=__codelineno-27-84 href=#__codelineno-27-84></a>‚îú‚îÄ 1Ô∏è‚É£5Ô∏è‚É£ External Service (Email, FileStorage, Payment, Cache, Notification, etc.)?
</span><span id=__span-27-85><a id=__codelineno-27-85 name=__codelineno-27-85 href=#__codelineno-27-85></a>‚îÇ  ‚îî‚îÄ üéØ Create manually - Port + Adapter pattern
</span><span id=__span-27-86><a id=__codelineno-27-86 name=__codelineno-27-86 href=#__codelineno-27-86></a>‚îÇ     Step 1: Create interface in Domain/Port/{Service}Interface.php
</span><span id=__span-27-87><a id=__codelineno-27-87 name=__codelineno-27-87 href=#__codelineno-27-87></a>‚îÇ     Step 2: Create adapter in Infrastructure/Service/{Service}Adapter.php
</span><span id=__span-27-88><a id=__codelineno-27-88 name=__codelineno-27-88 href=#__codelineno-27-88></a>‚îÇ     Step 3: Configure binding in config/services.yaml
</span><span id=__span-27-89><a id=__codelineno-27-89 name=__codelineno-27-89 href=#__codelineno-27-89></a>‚îÇ     Examples: EmailSender, FileStorage, PaymentGateway, CacheService, HttpClient
</span><span id=__span-27-90><a id=__codelineno-27-90 name=__codelineno-27-90 href=#__codelineno-27-90></a>‚îÇ
</span><span id=__span-27-91><a id=__codelineno-27-91 name=__codelineno-27-91 href=#__codelineno-27-91></a>‚îú‚îÄ 1Ô∏è‚É£6Ô∏è‚É£ Framework Bridge (Filesystem, Mailer wrapper)?
</span><span id=__span-27-92><a id=__codelineno-27-92 name=__codelineno-27-92 href=#__codelineno-27-92></a>‚îÇ  ‚îî‚îÄ üéØ Create manually - Concrete class (no interface)
</span><span id=__span-27-93><a id=__codelineno-27-93 name=__codelineno-27-93 href=#__codelineno-27-93></a>‚îÇ     Location: Infrastructure/Bridge/{Service}Handler.php
</span><span id=__span-27-94><a id=__codelineno-27-94 name=__codelineno-27-94 href=#__codelineno-27-94></a>‚îÇ     Use: Simplify framework component usage
</span><span id=__span-27-95><a id=__codelineno-27-95 name=__codelineno-27-95 href=#__codelineno-27-95></a>‚îÇ
</span><span id=__span-27-96><a id=__codelineno-27-96 name=__codelineno-27-96 href=#__codelineno-27-96></a>‚îú‚îÄ 1Ô∏è‚É£7Ô∏è‚É£ Event Subscriber (technical concerns)?
</span><span id=__span-27-97><a id=__codelineno-27-97 name=__codelineno-27-97 href=#__codelineno-27-97></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:event-subscriber shared/logging Exception --layer=infrastructure
</span><span id=__span-27-98><a id=__codelineno-27-98 name=__codelineno-27-98 href=#__codelineno-27-98></a>‚îÇ
</span><span id=__span-27-99><a id=__codelineno-27-99 name=__codelineno-27-99 href=#__codelineno-27-99></a>‚îú‚îÄ 1Ô∏è‚É£8Ô∏è‚É£ Async Message Handler (background jobs, emails, workers)?
</span><span id=__span-27-100><a id=__codelineno-27-100 name=__codelineno-27-100 href=#__codelineno-27-100></a>‚îÇ  ‚îî‚îÄ üéØ bin/console make:hexagonal:message-handler user/account SendWelcomeEmail [--with-message]
</span><span id=__span-27-101><a id=__codelineno-27-101 name=__codelineno-27-101 href=#__codelineno-27-101></a>‚îÇ     Generates: Infrastructure/Messaging/Handler/{Name}Handler.php
</span><span id=__span-27-102><a id=__codelineno-27-102 name=__codelineno-27-102 href=#__codelineno-27-102></a>‚îÇ     Use for: Async emails, background jobs, queue processing
</span><span id=__span-27-103><a id=__codelineno-27-103 name=__codelineno-27-103 href=#__codelineno-27-103></a>‚îÇ
</span><span id=__span-27-104><a id=__codelineno-27-104 name=__codelineno-27-104 href=#__codelineno-27-104></a>‚îÇ
</span><span id=__span-27-105><a id=__codelineno-27-105 name=__codelineno-27-105 href=#__codelineno-27-105></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-106><a id=__codelineno-27-106 name=__codelineno-27-106 href=#__codelineno-27-106></a>‚îÇ üß™ TESTING (Test Coverage)
</span><span id=__span-27-107><a id=__codelineno-27-107 name=__codelineno-27-107 href=#__codelineno-27-107></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-108><a id=__codelineno-27-108 name=__codelineno-27-108 href=#__codelineno-27-108></a>‚îÇ
</span><span id=__span-27-109><a id=__codelineno-27-109 name=__codelineno-27-109 href=#__codelineno-27-109></a>‚îú‚îÄ 1Ô∏è‚É£9Ô∏è‚É£ Tests?
</span><span id=__span-27-110><a id=__codelineno-27-110 name=__codelineno-27-110 href=#__codelineno-27-110></a>‚îÇ  ‚îú‚îÄ UseCase test: bin/console make:hexagonal:use-case-test blog/post CreatePost
</span><span id=__span-27-111><a id=__codelineno-27-111 name=__codelineno-27-111 href=#__codelineno-27-111></a>‚îÇ  ‚îú‚îÄ Controller test: bin/console make:hexagonal:controller-test blog/post CreatePost /posts/create
</span><span id=__span-27-112><a id=__codelineno-27-112 name=__codelineno-27-112 href=#__codelineno-27-112></a>‚îÇ  ‚îú‚îÄ CLI test: bin/console make:hexagonal:cli-command-test blog/post CreatePost app:post:create
</span><span id=__span-27-113><a id=__codelineno-27-113 name=__codelineno-27-113 href=#__codelineno-27-113></a>‚îÇ  ‚îî‚îÄ Test config: bin/console make:hexagonal:test-config
</span><span id=__span-27-114><a id=__codelineno-27-114 name=__codelineno-27-114 href=#__codelineno-27-114></a>‚îÇ
</span><span id=__span-27-115><a id=__codelineno-27-115 name=__codelineno-27-115 href=#__codelineno-27-115></a>‚îÇ
</span><span id=__span-27-116><a id=__codelineno-27-116 name=__codelineno-27-116 href=#__codelineno-27-116></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-117><a id=__codelineno-27-117 name=__codelineno-27-117 href=#__codelineno-27-117></a>‚îÇ üöÄ RAPID DEVELOPMENT (Scaffolding)
</span><span id=__span-27-118><a id=__codelineno-27-118 name=__codelineno-27-118 href=#__codelineno-27-118></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span id=__span-27-119><a id=__codelineno-27-119 name=__codelineno-27-119 href=#__codelineno-27-119></a>‚îÇ
</span><span id=__span-27-120><a id=__codelineno-27-120 name=__codelineno-27-120 href=#__codelineno-27-120></a>‚îî‚îÄ 2Ô∏è‚É£0Ô∏è‚É£ Complete CRUD (all layers)?
</span><span id=__span-27-121><a id=__codelineno-27-121 name=__codelineno-27-121 href=#__codelineno-27-121></a>   ‚îî‚îÄ üéØ bin/console make:hexagonal:crud blog/post Post [--with-tests] [--with-id-vo]
</span><span id=__span-27-122><a id=__codelineno-27-122 name=__codelineno-27-122 href=#__codelineno-27-122></a>      Generates 20+ files: Entity + Repository + 5 UseCases + 5 Controllers + Form + Tests
</span></code></pre></div> <hr> <h3 id=quick-reference-interface-decision-matrix>üìä Quick Reference: Interface Decision Matrix<a class=headerlink href=#quick-reference-interface-decision-matrix title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>What you're creating</th> <th>Need Interface?</th> <th>Why?</th> </tr> </thead> <tbody> <tr> <td><strong>Domain Entity</strong></td> <td>üå™Ô∏è NO</td> <td>Concrete business concept</td> </tr> <tr> <td><strong>Value Object</strong></td> <td>üå™Ô∏è NO</td> <td>Immutable value</td> </tr> <tr> <td><strong>Domain Exception</strong></td> <td>üå™Ô∏è NO</td> <td>Exception class</td> </tr> <tr> <td><strong>Domain Event</strong></td> <td>üå™Ô∏è NO</td> <td>Immutable DTO</td> </tr> <tr> <td><strong>Domain Service</strong> (pure logic)</td> <td>üå™Ô∏è NO</td> <td>No external dependencies</td> </tr> <tr> <td><strong>Repository</strong></td> <td>üéØ YES</td> <td>Database can be swapped</td> </tr> <tr> <td><strong>Command/Query Handler</strong></td> <td>üå™Ô∏è NO</td> <td>Decoupled via Messenger</td> </tr> <tr> <td><strong>UseCase</strong></td> <td>üå™Ô∏è NO</td> <td>Concrete orchestrator</td> </tr> <tr> <td><strong>Input DTO</strong></td> <td>üå™Ô∏è NO</td> <td>Data structure</td> </tr> <tr> <td><strong>Controller</strong></td> <td>üå™Ô∏è NO</td> <td>UI adapter</td> </tr> <tr> <td><strong>Form</strong></td> <td>üå™Ô∏è NO</td> <td>UI component</td> </tr> <tr> <td><strong>CLI Command</strong></td> <td>üå™Ô∏è NO</td> <td>UI adapter</td> </tr> <tr> <td><strong>EmailSender</strong></td> <td>üéØ YES</td> <td>Can swap SMTP/SendGrid/etc</td> </tr> <tr> <td><strong>FileStorage</strong></td> <td>üéØ YES</td> <td>Can swap Local/S3/Cloud</td> </tr> <tr> <td><strong>PaymentGateway</strong></td> <td>üéØ YES</td> <td>Can swap Stripe/PayPal/etc</td> </tr> <tr> <td><strong>Cache</strong></td> <td>üéØ YES</td> <td>Can swap Redis/Memcached/etc</td> </tr> <tr> <td><strong>HTTP Client</strong></td> <td>üéØ YES</td> <td>Can swap implementations</td> </tr> <tr> <td><strong>Notification</strong></td> <td>üéØ YES</td> <td>Can swap SMS/Push/Email</td> </tr> <tr> <td><strong>Framework Bridge</strong></td> <td>üå™Ô∏è NO</td> <td>Internal utility</td> </tr> <tr> <td><strong>Parser/Serializer</strong></td> <td>üå™Ô∏è NO (usually)</td> <td>Internal utility</td> </tr> </tbody> </table> <hr> <h3 id=golden-rule-for-interfaces>üéØ Golden Rule for Interfaces<a class=headerlink href=#golden-rule-for-interfaces title="Permanent link">&para;</a></h3> <p><strong>Create an interface (Port) if and ONLY if:</strong> 1. üéØ It's an <strong>external dependency</strong> (database, API, file, email, etc.) 2. üéØ You want to <strong>swap implementations</strong> (MySQL ‚Üí MongoDB, Local ‚Üí S3) 3. üéØ You want to <strong>easily mock</strong> in tests (in-memory repository)</p> <p><strong>Otherwise, use a concrete class!</strong></p> <hr> <h3 id=common-scenarios>üí° Common Scenarios<a class=headerlink href=#common-scenarios title="Permanent link">&para;</a></h3> <p><strong>User Registration:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>bin/console<span class=w> </span>make:hexagonal:entity<span class=w> </span>user/account<span class=w> </span>User<span class=w> </span>--with-repository<span class=w> </span>--with-id-vo
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>bin/console<span class=w> </span>make:hexagonal:command<span class=w> </span>user/account<span class=w> </span>register<span class=w> </span>--factory
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>bin/console<span class=w> </span>make:hexagonal:controller<span class=w> </span>user/account<span class=w> </span>Register<span class=w> </span>/register<span class=w> </span>--with-workflow
</span></code></pre></div></p> <p><strong>Complete CRUD:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>bin/console<span class=w> </span>make:hexagonal:crud<span class=w> </span>product/catalog<span class=w> </span>Product<span class=w> </span>--with-tests<span class=w> </span>--with-id-vo
</span></code></pre></div></p> <hr> <p>This decision tree covers <strong>100% of scenarios</strong> you'll encounter when building with hexagonal architecture! üéâ</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../SOLID/ class="md-footer__link md-footer__link--prev" aria-label="Previous: SOLID Principles"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> SOLID Principles </div> </div> </a> <a href=../examples/user-registration/ class="md-footer__link md-footer__link--next" aria-label="Next: User Registration"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> User Registration </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024-2026 Ahmed EBEN HASSINE - <a href=https://github.com/ahmed-bhs/hexagonal-maker-bundle/blob/main/LICENSE>MIT License</a> </div> </div> <div class=md-social> <a href=https://github.com/ahmed-bhs target=_blank rel=noopener title="Ahmed EBEN HASSINE on GitHub" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.buymeacoffee.com/w6ZhBSGX2 target=_blank rel=noopener title="Buy Me a Coffee" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M152-16c-13.3 0-24 10.7-24 24 0 38.9 23.4 59.4 39.1 73.1l1.1 1C184.5 96.4 192 103.9 192 120c0 13.3 10.7 24 24 24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C183.5 31.7 176 24.1 176 8c0-13.3-10.7-24-24-24M96 192c-17.7 0-32 14.3-32 32v192c0 53 43 96 96 96h192c41.8 0 77.4-26.7 90.5-64h5.5c70.7 0 128-57.3 128-128s-57.3-128-128-128zm352 192V256c35.3 0 64 28.7 64 64s-28.7 64-64 64M288 8c0-13.3-10.7-24-24-24S240-5.3 240 8c0 38.9 23.4 59.4 39.1 73.1l1.1 1C296.5 96.4 304 103.9 304 120c0 13.3 10.7 24 24 24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C295.5 31.7 288 24.1 288 8"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "navigation.indexes", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.action.edit", "content.tabs.link", "toc.follow"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../javascripts/extra.js></script> </body> </html>